
# **공유 커널(Shared Kernel) 패턴이란?**

- **두 개 이상의 바운디드 컨텍스트(BC)가 핵심 도메인 모델 일부를 공유하며 공동으로 관리하는 패턴**
- 공유하는 모델(코드)을 별도의 모듈(패키지, 라이브러리)로 분리해서, 양쪽에서 직접 의존함
- 공유 영역 변경 시 양쪽 팀의 협의와 조율이 필수
- 공유 커널을 통해 모델 불일치 문제를 줄이고, 협업과 일관성 유지
    

---

# **1. 공유 커널 그림**

```
+--------------------+      공유 커널        +--------------------+
|  주문 바운디드 컨텍스트  | <----------------> |  결제 바운디드 컨텍스트  |
| (Order Context)    |                     | (Payment Context)  |
|                    |                     |                    |
|   +-------------+  |                     |  +-------------+   |
|   |  Shared     |  |                     |  |  Shared     |   |
|   |  Kernel     |  |                     |  |  Kernel     |   |
|   | (공통 도메인 모델) |                     |  | (공통 도메인 모델)| |
|   +-------------+  |                     |  +-------------+   |
+--------------------+                     +--------------------+
        ↑                                            ↑
        |             공통 모듈 (공유 커널) 의존           |
        +--------------------------------------------+
```

- Shared Kernel 모듈은 양쪽 컨텍스트에서 같이 사용
- 공유 영역 내 모델(엔티티, 값 객체 등)을 공동 소유, 공동 관리
    

---

# **2. 공유 커널 코드 예시 (Kotlin)**

### **2-1. Shared Kernel 모듈**

```kotlin
// shared-kernel/src/main/kotlin/com/example/sharedkernel/OrderId.kt
package com.example.sharedkernel

data class OrderId(val value: String)

data class Product(val id: String, val name: String)
```

---

### **2-2. Order Context**

```kotlin
package com.example.order

import com.example.sharedkernel.OrderId
import com.example.sharedkernel.Product

class Order(
    val orderId: OrderId,
    val products: List<Product>
) {
    fun totalItems() = products.size
}
```

---

### **2-3. Payment Context**

```kotlin
package com.example.payment

import com.example.sharedkernel.OrderId

class Payment(
    val paymentId: String,
    val orderId: OrderId,
    val amount: Double
) {
    fun process() {
        println("Processing payment for order $orderId with amount $amount")
    }
}
```

---

# **3. 공유 커널 핵심 정리**

|**구분**|**내용**|
|---|---|
|소유권|양쪽 팀이 공동으로 소유 및 관리|
|변경|변경 시 양쪽 협의 필요|
|사용 방법|별도 공통 모듈로 분리하여 의존|
|장점|모델 일관성 유지, 중복 코드 방지|
|단점|협업 비용, 변경 시 조율 필요|

---

공유 커널(Shared Kernel) 패턴에서 **공통 모델의 소유권은 양팀(또는 여러 바운디드 컨텍스트 팀)이 공동으로 갖습니다**.

### **구체적으로 설명하면**

- **공유 커널 영역(모듈, 라이브러리, 코드 베이스 등)은 각 팀이 함께 관리해요.**
    → 변경 시 반드시 서로 협의하고, 합의를 봐야 합니다.
    
- **한쪽 팀이 마음대로 임의 변경을 하면 다른 팀에 영향이 커서 위험하기 때문에**
    공유 커널은 팀 간 신뢰와 협업이 필수입니다.
    
- 따라서 공유 커널은 **진입장벽이 높은 협업 영역**이며, 너무 많은 컨텍스트가 공유하면 갈등과 복잡성이 증가할 수 있습니다.

---

### **결론**

|**소유권**|**양 팀(컨텍스트) 공동 소유 및 관리**|
|---|---|
|변경 권한|변경 시 서로 합의 필요|
|관리 방식|협업과 버전 관리, 코드 리뷰 필수|

공유 커널(Shared Kernel) 패턴의 **좋은 경우와 안 좋은 경우**를 비교한 표 정리입니다:

| **구분**      | **좋은 경우**                              | **안 좋은 경우**                               |
| ----------- | -------------------------------------- | ----------------------------------------- |
| **도메인 연관성** | 두 BC가 밀접하게 연관된 핵심 도메인 모델 일부를 공유해야 할 때  | 서로 완전히 독립적이고 도메인 모델이 겹치지 않을 때             |
| **모델 일관성**  | 공통 개념을 일관되게 유지하고 중복/불일치 문제를 줄이고 싶을 때   | 모델 변경이 자주 발생하고 양쪽 팀 간 합의가 어려울 때           |
| **공유 범위**   | 공유 영역이 작고 안정적이며 변경 빈도가 낮은 경우           | 공유 범위가 크거나 복잡해 협업 비용과 충돌 가능성이 높을 때        |
| **협업 환경**   | 팀 간 신뢰와 소통이 원활하여 변경 시 협의와 조율이 잘 이루어질 때 | 팀 간 협업이나 소통이 부족해 변경 조율이 어렵거나 잦은 갈등이 발생할 때 |
| **운영 복잡도**  | 공동 관리와 버전 관리를 잘 할 수 있어 운영이 원활한 경우      | 공유 커널 관리에 따른 운영 부담과 프로세스가 복잡하거나 비효율적일 때   |
