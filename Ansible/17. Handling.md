
Ansible의 **Handlers**는 특정 작업이 실행될 때만 트리거되는 특별한 태스크입니다. Handlers는 일반적으로 시스템 상태 변경(예: 구성 파일 수정)에 따라 실행되어, 수동 개입 없이 필요한 작업(예: 서비스 재시작)을 자동화합니다.

### **Handlers 사용 시나리오**

#### **문제 상황**

• 웹 서버의 설정 파일을 자주 변경해야 함.
• 설정 파일 변경만으로는 변경 사항이 적용되지 않음.
• 변경 사항을 적용하려면 **웹 서버 서비스를 수동으로 재시작**해야 함.
• 인프라가 커질수록 수동 작업이 많아지고, 오류 발생 가능성 증가.

#### **해결책: Handlers**

• 설정 파일을 수정하는 태스크에 **notify** 디렉티브를 추가하여 핸들러를 호출.
• 핸들러는 설정 파일이 수정된 경우에만 웹 서버 서비스를 자동으로 재시작.
• 이를 통해 작업 효율성과 안정성을 개선.

#### **Handlers의 작동 방식**

##### 1. **핸들러 정의**:

• 핸들러는 일반 태스크와 유사하지만, 특정 이벤트(알림)가 발생할 때만 실행됩니다.
• 예: 서비스 재시작, 캐시 삭제 등.

##### 2. **태스크에서 핸들러 호출**:

• 태스크에 notify 디렉티브를 추가하여 핸들러를 호출.
• 태스크가 변경을 수행한 경우에만 핸들러가 실행됩니다.

##### 3. **핸들러 실행**:

• Playbook 실행이 끝날 때 핸들러가 실행됩니다.
• 동일한 핸들러가 여러 번 호출되더라도 중복 실행되지 않습니다.

#### **Handlers 사용 예제**

**예제: 설정 파일 변경 시 웹 서버 재시작**

```yaml
---
- name: 웹 서버 관리
  hosts: webservers
  tasks:
    - name: 설정 파일 복사
      copy:
        src: /path/to/config.conf
        dest: /etc/webserver/config.conf
      notify:
        - Restart Web Server

  handlers:
    - name: Restart Web Server
      service:
        name: webserver
        state: restarted
```

### **설명**

#### 1. **태스크**:

• copy 모듈로 설정 파일을 복사.
• notify 디렉티브를 사용하여 Restart Web Server 핸들러를 호출.

#### 2. **핸들러**:

• service 모듈로 웹 서버 서비스를 재시작.
• 설정 파일이 변경된 경우에만 실행.

### **핸들러 실행 조건**

• 핸들러는 태스크가 변경을 수행한 경우에만 실행됩니다.
• 예: 설정 파일이 새로 복사되거나 수정된 경우.
• 변경이 없으면 핸들러는 실행되지 않습니다.
• 동일한 핸들러가 여러 태스크에서 호출되더라도 **중복 실행되지 않습니다.**

**고급 예제: 여러 핸들러 사용**

예제: 애플리케이션 배포 및 서비스 재시작

```yml
---
- name: 웹 서버 관리
  hosts: webservers
  tasks:
    - name: 설정 파일 복사
      copy:
        src: /path/to/config.conf
        dest: /etc/webserver/config.conf
      notify:
        - Restart Web Server

  handlers:
    - name: Restart Web Server
      service:
        name: webserver
        state: restarted
```

**설명**

• 애플리케이션 코드를 복사하는 태스크가 실행되면:

1. Restart Application Service 핸들러가 애플리케이션 서비스를 재시작.
2. Clear Cache 핸들러가 애플리케이션 캐시를 삭제.

### **핸들러의 이점**

#### 1. **자동화**:

• 태스크 실행 시 필요한 후속 작업을 자동으로 처리.
#### 2. **효율성**:

• 설정 변경 사항이 있는 경우에만 실행되므로 불필요한 작업 방지.
#### 3. **안정성**:

• 사람이 직접 재시작 명령을 내릴 필요가 없어 오류 가능성 감소.
#### 4. **중복 방지**:

• 동일한 핸들러가 여러 번 호출되어도 한 번만 실행.

### **결론**

Ansible Handlers는 설정 변경 시 필요한 후속 작업(예: 서비스 재시작)을 자동화하여 작업의 효율성과 안정성을 높입니다. notify와 핸들러를 적절히 활용하면 대규모 인프라에서도 반복 작업을 최소화하고, 변경 관리 프로세스를 간소화할 수 있습니다. 