
### **매직 변수란 무엇인가?**

Ansible에서 **매직 변수(Magic Variables)**는 특별한 용도로 사용되는 변수로, 일반 변수와 달리 자동으로 제공되며, 플레이북 내에서 다양한 정보를 동적으로 참조할 수 있게 해줍니다. 매직 변수는 Ansible의 강력한 기능 중 하나로, 복잡한 자동화 작업을 보다 효율적으로 수행할 수 있도록 도와줍니다.

### **변수의 범위 다시 보기**


매직 변수를 이해하기 전에, 이전 강의에서 다룬 **변수의 범위(scope)**에 대해 간단히 복습해보겠습니다. 변수의 범위는 변수가 접근 가능한 범위를 정의하며, 크게 세 가지로 나눌 수 있습니다:

1. **호스트 범위 (Host Scope)**: 특정 호스트에만 적용되는 변수.
2. **플레이 범위 (Play Scope)**: 특정 플레이 내에서만 유효한 변수.
3. **글로벌 범위 (Global Scope)**: 플레이북 전체에서 접근 가능한 변수.

### **매직 변수의 필요성**

대규모 인프라 환경에서는 여러 호스트 간에 변수를 공유하거나 참조할 필요가 있습니다. 예를 들어, 한 호스트에 정의된 DNS 서버 정보를 다른 호스트에서 사용하고자 할 때, 일반 변수만으로는 이를 직접 참조하기 어렵습니다. 이때 매직 변수를 활용하면 다른 호스트의 변수에 접근할 수 있어 매우 유용합니다.

### **주요 매직 변수 소개**

#### **1. hostvars**

hostvars는 특정 호스트의 변수를 참조할 수 있게 해주는 매직 변수입니다. 이를 통해 한 호스트에서 다른 호스트의 변수에 접근할 수 있습니다.

**예시:**

```yaml
- name: DNS 서버 정보 출력
  hosts: all
  tasks:
    - name: 웹 서버의 DNS 서버 IP 주소 가져오기
      debug:
        msg: "웹2의 DNS 서버 IP는 {{ hostvars['web2']['dns_server'] }} 입니다."
```

위 예제에서 hostvars['web2']['dns_server']는 web2 호스트에 정의된 dns_server 변수의 값을 가져옵니다. 이 방식으로 다른 호스트의 변수를 손쉽게 참조할 수 있습니다.

**참고:** 대괄호([])와 작은따옴표(' ')를 사용하여 호스트 이름과 변수 이름을 지정할 수 있으며, 큰따옴표(" ")를 사용하여 문자열을 감쌀 수도 있습니다.

#### **2. groups**

groups는 특정 그룹에 속한 모든 호스트를 반환하거나, 현재 호스트가 속한 모든 그룹을 반환하는 매직 변수입니다.

**예시:**

```yaml
- name: 그룹 내 호스트 목록 출력
  hosts: web1
  tasks:
    - name: 웹 서버 그룹의 모든 호스트 출력
      debug:
        msg: "웹 서버 그룹의 호스트들: {{ groups['webservers'] }}"

    - name: 현재 호스트가 속한 모든 그룹 출력
      debug:
        msg: "현재 호스트가 속한 그룹들: {{ groups }}"
```

첫 번째 debug 태스크는 webservers 그룹에 속한 모든 호스트를 출력하며, 두 번째 debug 태스크는 현재 호스트가 속한 모든 그룹을 출력합니다.

#### **3. inventory_hostname**

  

inventory_hostname은 인벤토리 파일에 정의된 호스트의 이름을 반환하는 매직 변수입니다. 이는 실제 호스트 이름이나 FQDN과는 다를 수 있습니다.

  
```
- name: 인벤토리 호스트 이름 출력
  hosts: all
  tasks:
    - name: 인벤토리 호스트 이름 확인
      debug:
        msg: "인벤토리 호스트 이름은 {{ inventory_hostname }} 입니다."
```

**매직 변수 사용 예제**

다음은 매직 변수를 활용하여 다른 호스트의 정보를 참조하는 간단한 플레이북 예제입니다.

**인벤토리 파일 (**hosts.ini**):**

  
```ini
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11 dns_server=8.8.8.8
web3 ansible_host=192.168.1.12
```


플레이북 (playbook.yml):

  
```yaml
---
- name: DNS 서버 정보 출력 플레이북
  hosts: all
  tasks:
    - name: 다른 호스트의 DNS 서버 정보 가져오기
      debug:
        msg: "web2의 DNS 서버 IP는 {{ hostvars['web2']['dns_server'] }} 입니다."

    - name: 현재 호스트가 속한 그룹들 출력
      debug:
        msg: "현재 호스트가 속한 그룹들: {{ groups }}"
```

플레이북을 실행하면, 각 호스트에서 web2의 dns_server 변수를 참조하여 DNS 서버 IP 주소를 출력하게 됩니다.

### **매직 변수의 장점**

• **유연성**: 다양한 호스트 간에 변수를 쉽게 공유하고 참조할 수 있습니다.

• **재사용성**: 플레이북을 수정하지 않고도 인벤토리 파일이나 변수 파일만 변경하여 다양한 환경에 적용할 수 있습니다.

• **효율성**: 반복적인 작업을 줄이고, 자동화 스크립트의 복잡성을 낮출 수 있습니다.

### **매직 변수 문서 참조**

Ansible의 매직 변수는 [Ansible 공식 문서](https://docs.ansible.com/)의 **Using Variables** 섹션과 **Working with Playbooks** 섹션에서 자세히 다루고 있습니다. 다양한 매직 변수와 그 활용 방법을 익히기 위해 공식 문서를 참고하는 것이 좋습니다.

### **결론**

매직 변수는 Ansible 플레이북에서 다른 호스트의 변수에 접근하거나 그룹 정보를 활용할 때 매우 유용한 도구입니다. 이를 통해 대규모 인프라 환경에서도 효율적이고 유연한 자동화 작업을 수행할 수 있습니다. 매직 변수의 개념과 사용법을 잘 이해하고 활용함으로써, Ansible을 더욱 강력하게 사용할 수 있게 될 것입니다.
