
다른 스크립팅이나 프로그래밍 언어와 마찬가지로, Ansible에서도 변수는 서로 다른 항목에 따라 값이 변하는 데이터를 저장하는 데 사용됩니다. 변수는 반복적인 작업을 효율적으로 관리하고, 유연성을 높이는 데 중요한 역할을 합니다.


## **변수의 필요성**

  

예를 들어, 수백 대의 서버에 패치를 적용하는 동일한 작업을 수행한다고 가정해봅시다. 이 경우, 모든 서버에 대해 하나의 플레이북만 필요합니다. 그러나 각 서버마다 호스트 이름, 사용자 이름 또는 비밀번호와 같은 정보가 다를 수 있습니다. 이러한 정보를 변수로 저장함으로써, 동일한 플레이북을 재사용하면서도 각 서버의 고유한 설정을 유지할 수 있습니다.

  

## **인벤토리 파일에서의 변수**

  

이미 인벤토리 섹션에서 변수를 다루었을 때, ansible_host, ansible_connection, ansible_ssh_pass 등이 변수의 예시임을 보았습니다. 이러한 변수들은 필요한 만큼 정의할 수 있으며, 각 서버의 고유한 정보를 저장하는 데 사용됩니다.

  

## **플레이북 내에서 변수 정의하기**

  

변수는 플레이북 내에서도 정의할 수 있습니다. 예를 들어, 이전에 /etc/resolv.conf 파일에 DNS 항목을 추가하는 플레이북을 작성했다고 가정해보겠습니다. 이때 변수를 추가하려면 vars 지시어를 사용하여 키-값 쌍 형식으로 변수를 정의할 수 있습니다. 예를 들어, dns_server 변수에 DNS 서버의 IP 주소를 할당할 수 있습니다.

```yaml
---
- name: Add DNS entry
  hosts: all
  vars:
    dns_server: 8.8.8.8
  tasks:
    - name: Update resolv.conf
      lineinfile:
        path: /etc/resolv.conf
        regexp: '^nameserver'
        line: "nameserver {{ dns_server }}"
```
  

또한, 변수를 별도의 파일에 정의하여 관리할 수도 있습니다. 이는 변수의 재사용성을 높이고, 플레이북을 더 깔끔하게 유지하는 데 도움이 됩니다. 이러한 방법은 이후 includes 및 roles를 다룰 때 더 자세히 알아볼 예정입니다.

  

### **변수 사용 방법**

  

변수를 정의했지만, 이를 어떻게 사용하는지 알아보겠습니다. 앞서 정의한 dns_server 변수를 예로 들어보겠습니다. 이 변수를 실제로 사용하려면, 변수명을 중괄호({{ }})로 감싸서 참조하면 됩니다.

  
```yaml
line: "nameserver {{ dns_server }}"
```

플레이북을 실행하면, Ansible은 {{ dns_server }}를 변수에 정의된 값으로 대체하여 작업을 수행합니다.

### **변수의 효율적인 관리**

더 긴 플레이북을 예로 들어, 여러 방화벽 설정을 적용한다고 가정해봅시다. 이 플레이북에 여러 값이 하드코딩되어 있다면, 재사용할 때마다 플레이북을 수정해야 하는 번거로움이 있습니다. 이를 해결하기 위해, 변할 수 있는 값을 인벤토리 파일로 옮기고, 플레이북에서는 변수를 참조하도록 변경할 수 있습니다. 이렇게 하면 미래에 인벤토리 파일만 수정하면 되므로 플레이북 자체를 수정할 필요가 없어집니다.

더 나아가, 변수를 호스트별로 파일에 저장하는 것이 좋습니다. 예를 들어, web.yml이라는 파일에 변수를 정의하면, 해당 호스트에서 실행되는 플레이북에서 이 변수를 사용할 수 있습니다. 이는 변수를 보다 체계적으로 관리하고, 재사용성을 높이는 데 도움이 됩니다.

### **Jinja2 템플릿과 변수**

Ansible에서 변수를 사용하는 형식은 **Jinja2 템플릿**이라고 불립니다. Jinja2 템플릿은 변수의 값을 동적으로 대체할 수 있는 강력한 기능을 제공합니다. KodeKloud에서는 초보자를 위한 Jinja2 템플릿 관련 전체 과정을 제공하므로, 시간이 날 때 참고해보는 것을 추천드립니다.

**주의사항:** 변수를 Jinja2 템플릿으로 사용할 때, 변수가 문장의 시작 부분에 위치한다면 큰따옴표(" ")로 감싸야 합니다. 하지만 변수가 문장 중간에 위치할 경우에는 큰따옴표가 필요하지 않습니다.

## **결론**

Ansible에서 변수는 반복적인 작업을 효율적으로 관리하고, 플레이북의 유연성을 높이는 데 필수적인 요소입니다. 변수를 적절히 활용하면, 복잡한 인프라 환경에서도 일관성 있고 관리하기 쉬운 자동화 작업을 구현할 수 있습니다. 다음 글에서는 변수를 더욱 효과적으로 관리하기 위한 고급 기법과 모범 사례에 대해 알아보겠습니다.


## 변수 오버라이딩

![](Pasted%20image%2020250108130717.png)