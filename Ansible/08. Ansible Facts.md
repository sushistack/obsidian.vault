
Ansible에서 **Facts**는 플레이북이 대상 머신에 연결될 때 자동으로 수집되는 시스템 정보들을 의미합니다. 이러한 정보에는 시스템 아키텍처, 운영 체제 버전, 프로세서 세부 사항, 메모리 정보, 일련 번호 등 기본적인 시스템 정보가 포함됩니다. 또한, 네트워크 연결 상태, 다양한 인터페이스, IP 주소, FQDN(정규화된 도메인 이름), MAC 주소 등 네트워크 관련 정보와 디스크, 볼륨, 마운트 정보, 사용 가능한 공간, 시스템의 날짜 및 시간 등 장치 관련 정보도 포함됩니다.

### **Facts 수집 과정**

Ansible은 플레이북을 실행하고 대상 머신에 연결할 때, **setup 모듈**을 사용하여 Facts를 수집합니다. setup 모듈은 플레이북 내에서 명시적으로 사용하지 않더라도 자동으로 실행되며, 호스트에 대한 다양한 정보를 수집합니다.

**예시: 간단한 플레이북에서 Facts 수집 확인**

```yaml
---
- name: Hello 메시지 출력 플레이북
  hosts: all
  tasks:
    - name: 인사말 출력
      debug:
        msg: "안녕하세요!"
```

위의 플레이북을 실행하면, 실제로는 두 개의 태스크가 실행됩니다:
1. **Facts 수집**: Ansible이 자동으로 setup 모듈을 실행하여 호스트의 Facts를 수집합니다.
2. **메시지 출력**: 플레이북에 명시된 debug 모듈을 사용하여 메시지를 출력합니다.

### **Facts 확인하기**

수집된 모든 Facts는 ansible_facts라는 변수에 저장됩니다. 이 변수를 활용하여 호스트의 다양한 정보를 플레이북 내에서 참조할 수 있습니다.

**예시: ansible_facts 변수 출력**

```yaml
---
- name: Facts 정보 출력 플레이북
  hosts: all
  tasks:
    - name: Facts 출력
      debug:
        var: ansible_facts
```

이 플레이북을 실행하면, 각 호스트에 대한 IP 주소, 시스템 아키텍처, 운영 체제 버전, DNS 서버 설정, FQDN, 인터페이스 정보, 메모리 세부 사항, 디바이스 정보, 프로세서 세부 사항 등 다양한 정보가 출력됩니다. 이러한 정보는 플레이북 내에서 조건부 작업을 수행하거나, 동적으로 설정을 적용할 때 유용하게 사용할 수 있습니다.

### **Facts 수집 비활성화하기**


때로는 Facts 수집이 필요하지 않을 수 있습니다. 예를 들어, 플레이북이 호스트의 시스템 정보에 의존하지 않는 경우, Facts 수집을 비활성화하여 플레이북의 실행 시간을 단축할 수 있습니다.

**예시: Facts 수집 비활성화**

```yaml
---
- name: Facts 수집 비활성화 플레이북
  hosts: all
  gather_facts: no
  tasks:
    - name: 인사말 출력
      debug:
        msg: "안녕하세요!"
```
  

위의 플레이북에서 gather_facts: no를 설정하면, Ansible은 Facts를 수집하지 않고 지정된 태스크만 실행하게 됩니다. 따라서 출력 결과는 단일 태스크인 인사말 출력만 포함됩니다.

### **Facts 수집 설정**

Facts 수집 동작은 Ansible 설정 파일의 gathering 옵션에 의해 제어됩니다. 기본적으로 gathering은 implicit로 설정되어 있어, 플레이북 실행 시 자동으로 Facts를 수집합니다. 반대로 explicit으로 설정하면, 기본적으로 Facts를 수집하지 않으며, 플레이북 내에서 gather_facts: yes를 명시적으로 설정해야 Facts를 수집하게 됩니다.

### **설정 우선순위**

플레이북 내에서 설정한 gather_facts 옵션은 설정 파일의 gathering 옵션보다 우선순위를 가집니다. 예를 들어, 설정 파일에서 gathering: implicit로 설정되어 있어도, 플레이북 내에서 gather_facts: no로 설정하면 Facts 수집이 비활성화됩니다.

### **Facts 수집 대상 호스트 제한**

Ansible은 플레이북에서 지정된 호스트에 대해서만 Facts를 수집합니다. 예를 들어, 인벤토리 파일에 web1과 web2 두 호스트가 있고, 플레이북이 web1만을 대상으로 한다면, Facts는 web1에 대해서만 수집됩니다. 이는 플레이북의 타겟 호스트에 따라 Facts 수집 범위가 제한됨을 의미합니다.

### **Facts 활용 예시**

Facts는 다양한 상황에서 유용하게 활용될 수 있습니다. 예를 들어, 특정 호스트의 디스크 정보를 기반으로 논리 볼륨을 구성하거나, 네트워크 설정을 동적으로 조정할 때 Facts를 참조할 수 있습니다.

**예시: Facts를 활용한 조건부 태스크 실행**

```yaml
---
- name: 디스크 공간 확인 후 작업 실행
  hosts: all
  tasks:
    - name: 디스크 사용량 확인
      debug:
        msg: "디스크 사용량: {{ ansible_facts['ansible_mounts'][0]['size_available'] }} bytes"
    
    - name: 디스크 공간이 충분한지 확인
      fail:
        msg: "디스크 공간이 부족합니다!"
      when: ansible_facts['ansible_mounts'][0]['size_available'] < 1000000000
```
  

위의 플레이북에서는 첫 번째 태스크에서 디스크 사용 가능 공간을 출력하고, 두 번째 태스크에서는 디스크 공간이 특정 임계값 이하일 경우 플레이북 실행을 실패하게 만듭니다.

### **결론**


Ansible에서 Facts는 대상 호스트에 대한 상세한 정보를 제공하여, 보다 유연하고 동적인 플레이북을 작성하는 데 중요한 역할을 합니다. Facts를 효율적으로 활용하면, 복잡한 인프라 환경에서도 일관성 있고 자동화된 작업을 수행할 수 있습니다. 또한, 필요에 따라 Facts 수집을 비활성화하거나, 설정 파일과 플레이북 내에서 우선순위를 조정하여 최적의 성능을 유지할 수 있습니다.
