
Ansible에서 변수의 범위(scope)는 변수의 접근 가능성 또는 가시성을 정의합니다. 이는 변수가 정의된 위치와 방식에 따라 달라지며, 변수의 유효 범위를 명확히 이해하는 것은 효과적인 자동화 스크립트 작성에 필수적입니다. 프로그래밍 언어에서 변수의 범위가 변수의 사용 가능 위치를 결정하는 것과 유사하게, Ansible에서도 변수의 범위는 변수의 사용 가능성을 결정합니다.

### **예제: 호스트별 변수 범위**

간단한 인벤토리 파일을 예로 들어보겠습니다. 이 파일에서 web2 호스트에 DNS 서버가 지정되어 있다고 가정해봅시다.

```ini
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11 dns_server=8.8.8.8
web3 ansible_host=192.168.1.12
```

위 예제에서 web2 호스트에 지정된 dns_server 변수는 web1과 web3 호스트에서 접근할 수 없습니다. 이는 dns_server 변수의 범위가 web2 호스트에만 국한되기 때문입니다.

### **변수의 세 가지 범위**

Ansible에서는 변수를 호스트 범위, 플레이 범위, 글로벌 범위로 나눌 수 있습니다. 각각의 범위는 변수가 어디에서 정의되고 어떻게 접근되는지를 결정합니다.

  

#### **1. 호스트 범위 (Host Scope)**

  

호스트 범위의 변수는 특정 호스트에만 적용됩니다. 이는 인벤토리 파일 내에서 호스트별로 정의된 변수나 그룹 변수에서 유래할 수 있습니다. 호스트 범위의 변수는 해당 호스트에 대한 플레이에서만 접근 가능합니다.

##### **예시: 인벤토리 파일에서 호스트 변수 정의**

```ini
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11 dns_server=8.8.8.8
web3 ansible_host=192.168.1.12
```
위 예제에서 dns_server 변수는 web2 호스트에만 적용됩니다.

#### **2. 플레이 범위 (Play Scope)**

플레이 범위의 변수는 특정 플레이 내에서만 유효합니다. 플레이는 Ansible에서 작업 단위를 의미하며, 하나의 플레이는 하나 이상의 태스크를 포함할 수 있습니다. 플레이 범위의 변수는 해당 플레이에서만 접근 가능하며, 다른 플레이에서는 사용할 수 없습니다.

##### **예시: 플레이북에서 플레이 범위 변수 정의**
```yaml
---
- name: 첫 번째 플레이 - NTP 서버 설정
  hosts: all
  vars:
    ntp_server: 192.168.1.100
  tasks:
    - name: NTP 서버 설정
      lineinfile:
        path: /etc/ntp.conf
        regexp: '^server'
        line: "server {{ ntp_server }}"

- name: 두 번째 플레이 - DNS 서버 설정
  hosts: all
  tasks:
    - name: DNS 서버 설정 확인
      debug:
        msg: "DNS 서버는 {{ ntp_server }} 입니다."
```

위 예제에서 ntp_server 변수는 첫 번째 플레이 내에서만 유효하며, 두 번째 플레이에서는 접근할 수 없습니다. 따라서 두 번째 플레이에서 변수에 접근하려고 하면 오류가 발생합니다.

#### **3. 글로벌 범위 (Global Scope)**

글로벌 범위의 변수는 플레이북 전체에서 접근 가능합니다. 이는 Ansible 명령어를 실행할 때 추가 변수로 전달되거나, 플레이북 전역에서 정의된 변수에서 유래할 수 있습니다.

##### **예시: 명령어를 통한 글로벌 변수 전달**

```bash
ansible-playbook playbook.yml -e "global_var=전역변수값"
```

플레이북 내에서 global_var 변수는 모든 플레이와 태스크에서 접근 가능합니다.

**변수 범위의 중요성**

변수의 범위를 올바르게 이해하고 관리하는 것은 Ansible 플레이북의 유연성과 재사용성을 높이는 데 중요한 역할을 합니다. 변수 범위를 잘못 이해하면 변수 충돌, 예상치 못한 동작, 유지보수의 어려움 등이 발생할 수 있습니다. 따라서 변수의 범위를 명확히 정의하고, 필요에 따라 적절한 범위를 설정하는 것이 중요합니다.


### **요약**

• **호스트 범위**: 특정 호스트에만 적용되는 변수. 인벤토리 파일이나 그룹 변수에서 정의.
• **플레이 범위**: 특정 플레이 내에서만 유효한 변수. 플레이북 내에서 vars 지시어로 정의.
• **글로벌 범위**: 플레이북 전체에서 접근 가능한 변수. 명령어 추가 변수(-e)로 전달되거나 전역 변수 파일에서 정의.

Ansible에서 변수의 범위를 정확히 이해하고 활용하면, 복잡한 인프라 환경에서도 효율적이고 안정적인 자동화 스크립트를 작성할 수 있습니다. 다음 강의에서는 변수 범위를 바탕으로 한 매직 변수(Magic Variables)에 대해 심층적으로 알아보겠습니다.
