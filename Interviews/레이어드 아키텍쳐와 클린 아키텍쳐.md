
# **ğŸ§± 1. êµ¬ì¡° ê°œìš” ë¹„êµ**

![](Pasted%20image%2020250626115029.png)

|**êµ¬ë¶„**|**Layered Architecture**|**Clean Architecture**|
|---|---|---|
|ì¤‘ì‹¬|ê¸°ìˆ  (Controller â†’ Service â†’ Repository)|ë„ë©”ì¸ ë¡œì§ (UseCase, Entity ì¤‘ì‹¬)|
|ì˜ì¡´ ë°©í–¥|ìœ„ â†’ ì•„ë˜ (Controller â†’ Service â†’ Repository)|ë°”ê¹¥ â†’ ì•ˆ (Interface â†’ UseCase â†’ Entity)|
|ë„ë©”ì¸|Serviceì— í¬í•¨ë˜ê±°ë‚˜ íë¦¿í•¨|ë„ë©”ì¸ê³¼ ìœ ìŠ¤ì¼€ì´ìŠ¤ê°€ ëª…í™•íˆ ë¶„ë¦¬|
|í…ŒìŠ¤íŠ¸ ìš©ì´ì„±|DB/ì™¸ë¶€ ì˜ì¡´ì´ ë§ì•„ í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€|ì™¸ë¶€ì™€ ë¶„ë¦¬ë˜ì–´ ë„ë©”ì¸ ë‹¨ë… í…ŒìŠ¤íŠ¸ ì‰¬ì›€|

---

# **ğŸ ì˜ˆì œ: ì¿ í° ë°œê¸‰**

## **âœ… ìš”êµ¬ì‚¬í•­**

- ì‚¬ìš©ìëŠ” ì¿ í°ì„ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆë‹¤.
- ì¿ í°ì€ ë°œê¸‰ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸ í›„ ì €ì¥ëœë‹¤.

---

## **ğŸ§± 2. Layered Architecture ì˜ˆì œ**

### **ğŸ“ êµ¬ì¡°**

```
CouponController
 â””â”€â”€ CouponService
      â””â”€â”€ CouponRepository
```

### **â–¶ï¸ ì½”ë“œ**
#### **CouponController.java**

```java
@RestController
public class CouponController {
    @Autowired
    private CouponService couponService;

    @PostMapping("/coupon")
    public ResponseEntity<String> issueCoupon(@RequestParam Long userId) {
        couponService.issue(userId);
        return ResponseEntity.ok("ì¿ í° ë°œê¸‰ ì™„ë£Œ");
    }
}
```

#### **CouponService.java**

```java
@Service
public class CouponService {
    @Autowired
    private CouponRepository couponRepository;

    public void issue(Long userId) {
        if (!couponRepository.existsByUserId(userId)) {
            Coupon coupon = new Coupon(userId, LocalDate.now());
            couponRepository.save(coupon);
        }
    }
}
```

#### **CouponRepository.java**

```java
public interface CouponRepository extends JpaRepository<Coupon, Long> {
    boolean existsByUserId(Long userId);
}
```

---

## **ğŸ§¼ 3. Clean Architecture ì˜ˆì œ**

### **ğŸ“ êµ¬ì¡°**

```java
- controller/
   - CouponController
- application/
   - port/in/IssueCouponUseCase
   - service/CouponService
- domain/
   - model/Coupon
   - repository/CouponRepository (interface)
- infrastructure/
   - persistence/JpaCouponRepository
```

---

### **â–¶ï¸ ì½”ë“œ**

#### **CouponController.java**

```java
@RestController
public class CouponController {
    private final IssueCouponUseCase issueCouponUseCase;

    public CouponController(IssueCouponUseCase issueCouponUseCase) {
        this.issueCouponUseCase = issueCouponUseCase;
    }

    @PostMapping("/coupon")
    public ResponseEntity<String> issue(@RequestParam Long userId) {
        issueCouponUseCase.issue(userId);
        return ResponseEntity.ok("ì¿ í° ë°œê¸‰ ì™„ë£Œ");
    }
}
```

---

#### **IssueCouponUseCase.java**

#### Â **(Input Port)**

```java
public interface IssueCouponUseCase {
    void issue(Long userId);
}
```

---

#### **CouponService.java**

#### Â **(Application Layer)**

```java
@Service
public class CouponService implements IssueCouponUseCase {
    private final CouponRepository couponRepository;

    public CouponService(CouponRepository couponRepository) {
        this.couponRepository = couponRepository;
    }

    @Override
    public void issue(Long userId) {
        if (!couponRepository.existsByUserId(userId)) {
            Coupon coupon = new Coupon(userId, LocalDate.now());
            couponRepository.save(coupon);
        }
    }
}
```

---

#### **Coupon.java**

#### Â **(Domain Entity)**

```java
public class Coupon {
    private Long userId;
    private LocalDate issuedDate;

    public Coupon(Long userId, LocalDate issuedDate) {
        this.userId = userId;
        this.issuedDate = issuedDate;
    }

    // getter...
}
```

---

#### **CouponRepository.java**

#### Â **(Domain Port)**

```java
public interface CouponRepository {
    boolean existsByUserId(Long userId);
    void save(Coupon coupon);
}
```

---

#### **JpaCouponRepository.java**

#### Â **(Infra Adapter)**

```java
@Repository
public class JpaCouponRepository implements CouponRepository {
    private final SpringDataJpaCouponRepository jpaRepo;

    public JpaCouponRepository(SpringDataJpaCouponRepository jpaRepo) {
        this.jpaRepo = jpaRepo;
    }

    @Override
    public boolean existsByUserId(Long userId) {
        return jpaRepo.existsByUserId(userId);
    }

    @Override
    public void save(Coupon coupon) {
        jpaRepo.save(new CouponEntity(coupon));
    }
}
```

---

## **ğŸ§© ì°¨ì´ ìš”ì•½**

|**í•­ëª©**|**Layered**|**Clean**|
|---|---|---|
|ë„ë©”ì¸ ì¤‘ì‹¬|âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ Serviceì— í©ì–´ì§|âœ… ë„ë©”ì¸ê³¼ ìœ ìŠ¤ì¼€ì´ìŠ¤ ëª…í™•íˆ ë¶„ë¦¬|
|í…ŒìŠ¤íŠ¸ ìš©ì´ì„±|âŒ DB ì—†ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€|âœ… í¬íŠ¸ë¥¼ í†µí•´ Mockìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥|
|ì˜ì¡´ ë°©í–¥|ê¸°ìˆ  ì¤‘ì‹¬ (Controller â†’ Repository)|ë„ë©”ì¸ ì¤‘ì‹¬ (Entity â† UseCase â† Interface)|
|ìœ ì—°ì„±|ê¸°ìˆ  ë³€ê²½ ì‹œ ì˜í–¥ í¼|ì™¸ë¶€ ê¸°ìˆ  êµì²´ ìš©ì´|
