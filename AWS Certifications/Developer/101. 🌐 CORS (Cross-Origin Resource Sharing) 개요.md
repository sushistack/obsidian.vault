
CORS(Cross-Origin Resource Sharing)는 **교차 출처 리소스 공유**를 의미하며, 웹 브라우저의 중요한 보안 메커니즘 중 하나입니다. 한 웹 페이지의 스크립트가 다른 **출처(Origin)**의 리소스(API, 이미지, 파일 등)에 접근할 수 있도록 허용하거나 차단하는 규칙을 정의합니다. S3 버킷에 저장된 자산을 다른 웹사이트에서 사용하려면 CORS 설정을 이해하고 올바르게 적용해야 합니다.

---

### 1. 출처(Origin)의 정의

웹 브라우저에서 **출처**는 다음 세 가지 요소로 구성됩니다.

- **스키마(Scheme) / 프로토콜:** `http` 또는 `https`
- **호스트(Host) / 도메인:** `www.example.com`
- **포트(Port):** `80` (HTTP의 기본값), `443` (HTTPS의 기본값)

이 세 가지 요소가 모두 동일해야 **"동일 출처(Same Origin)"**로 간주됩니다. 하나라도 다르면 **"교차 출처(Cross-Origin)"**가 됩니다.

---

### 2. CORS 작동 원리

![[Pasted image 20250809212845.png]]

웹 브라우저는 기본적으로 보안상의 이유로 **교차 출처 요청(Cross-Origin Request)**을 차단합니다. 다른 출처의 리소스를 가져오려면 리소스가 있는 서버가 명시적으로 해당 요청을 허용해야 합니다. 이 과정은 주로 HTTP 헤더를 통해 이루어집니다.

1. **웹페이지 요청:** 사용자가 `https://www.example.com` 웹사이트에 접속합니다.

2. **교차 출처 요청 발생:** `index.html` 파일에 `https://www.other.com/image.jpg` 파일을 가져오는 스크립트가 포함되어 있습니다.

3. **사전 요청(Pre-flight Request):** 웹 브라우저는 실제 `GET` 요청을 보내기 전에, `OPTIONS` 메서드를 사용하여 `https://www.other.com` 서버에 **사전 요청**을 보냅니다. 이 요청에는 `Origin: https://www.example.com` 헤더가 포함되어, "내가 `example.com`에서 왔는데, 너의 리소스를 가져와도 될까?"라고 묻는 역할을 합니다.

4. **CORS 헤더 응답:** `https://www.other.com` 서버가 CORS 설정을 통해 `example.com`에서의 요청을 허용한다면, 다음과 같은 헤더를 포함한 응답을 보냅니다.
    - `Access-Control-Allow-Origin: https://www.example.com`
    - `Access-Control-Allow-Methods: GET, PUT, DELETE`

5. **실제 요청:** 웹 브라우저는 서버의 응답을 확인한 후, 실제 `GET` 요청을 보냅니다.

---

### 3. Amazon S3와 CORS

![[Pasted image 20250809212902.png]]

S3 버킷에 저장된 자산(예: 이미지)을 다른 도메인의 웹사이트에서 사용하려면, S3 버킷에 **CORS 구성**을 설정해야 합니다.

- **시나리오:**
    - `my-website-bucket`에 정적 웹사이트(`index.html`)가 호스팅되어 있습니다.
    - `my-assets-bucket`에 웹사이트에서 사용할 이미지 파일(`image.jpg`)이 저장되어 있습니다.
    - 사용자가 `my-website-bucket`의 웹사이트에 접속하면, 브라우저는 `my-assets-bucket`에 있는 이미지를 가져오려고 합니다.

- **해결책:** `my-assets-bucket`의 `CORS` 설정에 `my-website-bucket`의 도메인을 `Access-Control-Allow-Origin`으로 허용해야 합니다. 만약 모든 출처에서 접근을 허용하고 싶다면, `*`를 설정할 수도 있습니다.

**CORS 설정 예시 (JSON):**

```JSON
[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "GET",
            "PUT"
        ],
        "AllowedOrigins": [
            "https://www.example.com"
        ],
        "ExposeHeaders": []
    }
]
```