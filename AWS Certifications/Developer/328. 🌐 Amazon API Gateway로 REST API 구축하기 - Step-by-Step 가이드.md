
이번 가이드에서는 Amazon API Gateway와 Lambda 함수를 연동하여 간단한 REST API를 구축하는 방법을 상세히 알아보겠습니다. API Gateway의 다양한 설정 옵션과 Lambda 함수와의 연동 과정을 단계별로 따라가며, 실제 웹 브라우저에서 API를 호출하는 것까지 확인해 보세요.

---

## 🚀 1단계: API Gateway 설정 시작하기

Amazon API Gateway 콘솔에 접속하여 새로운 REST API를 생성하는 것부터 시작합니다.

1. **API 유형 선택**: 여러 API 유형(HTTP, WebSocket, REST) 중에서 **REST API**를 선택합니다.
    
2. **API 구축 옵션**: **새 API 생성(New API)**을 선택하고, API 이름을 **MyFirstAPI**로 지정합니다.
    
3. **엔드포인트 유형(Endpoint Type)**:
    
    - **Regional**: 단일 AWS 리전에 배포됩니다.
        
    - **Edge-optimized**: CloudFront를 사용하여 전 세계 여러 엣지 로케이션에 배포되지만, API 자체는 한 리전에 위치합니다.
        
    - Private: VPC 내에서만 접근 가능한 프라이빗 API입니다.
        
        이 가이드에서는 Regional을 선택합니다.
        

---

## 💻 2단계: Lambda 함수 생성하기

API Gateway에 연결할 Lambda 함수를 생성합니다. 이 함수는 API 요청에 응답하는 역할을 합니다.

1. **Lambda 콘솔 접속**: Lambda 콘솔로 이동하여 **함수 생성(Create function)**을 클릭합니다.
    
2. **함수 정보 입력**:
    
    - **함수 이름**: `api-gateway-route-gets`
        
    - **런타임**: Python 3.11 (또는 다른 Python 3 버전)
        
3. **함수 코드 작성**: 다음 코드를 함수 코드 편집기에 붙여넣고 **배포(Deploy)** 버튼을 클릭합니다.


```Python
import json

def lambda_handler(event, context):
    print("Received event: " + json.dumps(event, indent=2))
    return {
        'statusCode': 200,
        'headers': {
            'Content-Type': 'application/json'
        },
        'body': json.dumps('hello from Lambda')
    }
```

4. **함수 테스트**: **테스트(Test)** 탭에서 테스트 이벤트를 생성하고 실행하여 함수가 제대로 작동하는지 확인합니다. 상태 코드 200과 함께 "hello from Lambda" 메시지가 반환되면 성공입니다.
    

---

## 🔗 3단계: API Gateway와 Lambda 연동하기

이제 생성한 API Gateway에 Lambda 함수를 통합하는 단계를 진행합니다.

1. **메서드 생성**: API Gateway 콘솔로 돌아와서 **리소스(Resources)** 패널에서 `/` 리소스를 선택한 후 **메서드 생성(Create method)**을 클릭합니다.
    
2. **메서드 유형 및 통합**:
    
    - **메서드 유형**: **GET**
        
    - **통합 유형(Integration Type)**: **Lambda 함수**
        
    - **Lambda 프록시 통합 사용(Use Lambda Proxy Integration)**: 체크 박스를 선택합니다. 이 옵션은 API Gateway가 요청의 전체 데이터를 Lambda 함수로 전달하고, Lambda가 반환하는 전체 응답을 클라이언트로 전달하도록 합니다.
        
    - **Lambda 함수**: 방금 생성한 Lambda 함수의 ARN을 입력하거나 함수 이름을 직접 검색하여 선택합니다.
        
    - **타임아웃(Timeout)**: API Gateway의 기본 타임아웃은 **29초**입니다. Lambda 함수의 타임아웃이 이보다 길더라도 API Gateway는 29초까지만 기다립니다.
        
    
    **참고:** 이 과정에서 API Gateway가 Lambda 함수를 호출할 수 있도록 자동으로 **리소스 기반 정책(Resource-based policy)** 권한이 추가됩니다.
    
3. **통합 테스트**: **테스트(Test)** 탭을 클릭하여 API Gateway에서 직접 Lambda 함수를 호출해 봅니다. 응답 본문에 "hello from Lambda"가 나타나면 성공입니다.
    
4. **디버깅을 위한 이벤트 로깅**: Lambda 함수 코드에 `print(event)`를 추가하고 다시 배포한 후 테스트를 실행해 보세요. CloudWatch Logs에서 API Gateway로부터 받은 이벤트 데이터(경로, 메서드, 헤더 등)를 확인할 수 있습니다.
    

|요청 정보|설명|
|---|---|
|**resource**|API Gateway에 정의된 리소스 경로 (예: `/`)|
|**path**|요청에 사용된 전체 경로|
|**httpMethod**|HTTP 메서드 (예: `GET`)|
|**headers**|클라이언트에서 보낸 헤더 정보|
|**queryStringParameters**|URL의 쿼리 스트링 파라미터 정보|

---

## 🏠 4단계: 추가 리소스 생성 및 배포하기

이번에는 다른 경로(`/houses`)에 또 다른 Lambda 함수를 연결하여 API를 확장합니다.

1. **새 리소스 생성**: API Gateway 콘솔에서 `/` 리소스를 선택하고 **리소스 생성(Create Resource)**을 클릭합니다.
    
2. **리소스 이름**: `houses`로 지정합니다.
    
3. **새 Lambda 함수 생성**: `api-gateway-route-houses`라는 이름의 Lambda 함수를 생성하고, 반환 메시지를 `"hello from my pretty house"`로 변경합니다.
    
4. **GET 메서드 추가**: `/houses` 리소스에 **GET** 메서드를 추가하고, 새로 생성한 `api-gateway-route-houses` Lambda 함수와 연결합니다.
    
5. **API 배포**: 모든 설정이 완료되면 **API 배포(Deploy API)**를 클릭합니다.
    
    - **배포 단계(Stage)**: 새로운 단계를 `dev`로 생성합니다.
        
    - **Invoke URL**: 배포가 완료되면 API를 호출할 수 있는 **Invoke URL**이 생성됩니다.
        

---

## ✅ 5단계: 웹 브라우저에서 API 호출하기

이제 마지막으로 실제로 웹 브라우저에서 API를 호출하여 잘 작동하는지 확인합니다.

1. **기본 경로 호출**: 생성된 Invoke URL에 `/dev`를 추가한 후 웹 브라우저에 입력합니다.
    
    - 예시: `https://your-api-id.execute-api.region.amazonaws.com/dev`
        
    - 결과: `"hello from Lambda"`
        
2. **`/houses` 경로 호출**: URL 끝에 `/houses`를 추가하여 입력합니다.
    
    - 예시: `https://your-api-id.execute-api.region.amazonaws.com/dev/houses`
        
    - 결과: `"hello from my pretty house"`
        

이처럼 API Gateway는 서로 다른 경로에 대해 각각 다른 Lambda 함수를 호출하여 응답하는 강력한 기능을 제공합니다. 이를 통해 서버리스 아키텍처에서 다양한 기능을 가진 API를 손쉽게 구축할 수 있습니다.