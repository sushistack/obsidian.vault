
AWS KMS(Key Management Service)λ” λ°μ΄ν„° μ•”νΈν™” λ° λ³µνΈν™” μ‘μ—…μ„ μν–‰ν•λ” λ° ν•„μμ μΈ μ„λΉ„μ¤μ…λ‹λ‹¤. μ΄ μ•„ν‹°ν΄μ—μ„λ” KMSμ ν•µμ‹¬ APIμΈ `Encrypt` λ° `Decrypt`κ°€ μ–΄λ–»κ² λ™μ‘ν•λ”μ§€ μ‚΄ν΄λ³΄κ³ , 4KB μ΄μƒμ λ€μ©λ‰ λ°μ΄ν„°λ¥Ό λ‹¤λ£¨λ” **Envelope Encryption** κΈ°μ κ³Ό κ΄€λ ¨ APIλ“¤μ„ μ‹¬μΈµμ μΌλ΅ μ•μ•„λ³΄κ² μµλ‹λ‹¤.

---

## π”‘ μΌλ°μ μΈ μ•”νΈν™” λ° λ³µνΈν™” (Encrypt & Decrypt API)

KMSλ¥Ό μ‚¬μ©ν• κ°€μ¥ κΈ°λ³Έμ μΈ μ•”νΈν™” κ³Όμ •μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

**![[Pasted image 20250914191548.png]]**

1. **μ•”νΈν™” (Encrypt)**:
    
    - **μ‚¬μ©μ**: `Encrypt` APIλ¥Ό νΈμ¶ν•μ—¬ **4KB λ―Έλ§**μ λ°μ΄ν„°λ¥Ό KMS μ„λΉ„μ¤λ΅ μ „μ†΅ν•©λ‹λ‹¤. μ‚¬μ©ν•  CMK(Customer Master Key)λ¥Ό μ§€μ •ν•©λ‹λ‹¤.
        
    - **KMS**: μ‚¬μ©μμ IAM κ¶ν•μ„ ν™•μΈν• ν›„, CMKλ¥Ό μ‚¬μ©ν•μ—¬ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•©λ‹λ‹¤.
        
    - **κ²°κ³Ό**: KMSλ” μ•”νΈν™”λ λ°μ΄ν„°(`CiphertextBlob`)λ¥Ό μ‚¬μ©μμ—κ² λ°ν™ν•©λ‹λ‹¤.
        
2. **λ³µνΈν™” (Decrypt)**:
    
    - **μ‚¬μ©μ**: `Decrypt` APIλ¥Ό νΈμ¶ν•μ—¬ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό KMSλ΅ μ „μ†΅ν•©λ‹λ‹¤.
        
    - **KMS**: KMSλ” μ•”νΈν™”λ λ°μ΄ν„°μ— ν¬ν•¨λ ν‚¤ μ •λ³΄λ¥Ό μλ™μΌλ΅ μΈμ‹ν•κ³ , μ‚¬μ©μμ IAM κ¶ν•μ„ ν™•μΈν•©λ‹λ‹¤.
        
    - **κ²°κ³Ό**: KMSλ” λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•μ—¬ ν‰λ¬Έ(Plaintext) μƒνƒμ μ›λ³Έ λ°μ΄ν„°λ¥Ό μ‚¬μ©μμ—κ² λ°ν™ν•©λ‹λ‹¤.
        

μ΄ λ°©μ‹μ€ κ°„λ‹¨ν•μ§€λ§, **μ•”νΈν™”ν•  μ μλ” λ°μ΄ν„°μ ν¬κΈ°κ°€ 4KBλ΅ μ ν•**λλ‹¤λ” λ…ν™•ν• ν•κ³„κ°€ μμµλ‹λ‹¤. λ€μ©λ‰ νμΌμ„ λ‹¤λ£¨κΈ° μ„ν•΄μ„λ” λ‹¤λ¥Έ μ ‘κ·Ό λ°©μ‹μ΄ ν•„μ”ν•©λ‹λ‹¤.

---

## π’ Envelope Encryption (λ΄‰ν¬ μ•”νΈν™”)

Envelope Encryptionμ€ **4KB μ΄μƒμ λ€μ©λ‰ λ°μ΄ν„°λ¥Ό μ•”νΈν™”**ν•κΈ° μ„ν• KMSμ ν•µμ‹¬ κΈ°μ μ…λ‹λ‹¤. μ΄ κΈ°λ²•μ€ μ•”νΈν™” μ‘μ—…μ„ ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μν–‰ν•κ³ , KMSλ” ν‚¤ κ΄€λ¦¬ μ—­ν• λ§ λ‹΄λ‹Ήν•λ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.

### Envelope Encryptionμ λ™μ‘ μ›λ¦¬

![[Pasted image 20250914191614.png]]

1. **λ°μ΄ν„° ν‚¤ μƒμ„± (GenerateDataKey API)**:
    
    - **μ‚¬μ©μ**: `GenerateDataKey` APIλ¥Ό νΈμ¶ν•λ©°, μ‚¬μ©ν•  CMKλ¥Ό μ§€μ •ν•©λ‹λ‹¤.
        
    - **KMS**: μ‚¬μ©μμ IAM κ¶ν•μ„ ν™•μΈν• ν›„, **λ°μ΄ν„° μ•”νΈν™” ν‚¤(DEK, Data Encryption Key)**λ¥Ό μƒμ„±ν•©λ‹λ‹¤. μ΄ DEKλ” μ‹¤μ  λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•λ” λ° μ‚¬μ©λλ” ν‚¤μ…λ‹λ‹¤.
        
    - **κ²°κ³Ό**: KMSλ” λ‘ κ°€μ§€ ν•νƒμ DEKλ¥Ό μ‚¬μ©μμ—κ² λ°ν™ν•©λ‹λ‹¤.
        
        - **Plaintext DEK**: ν‰λ¬Έ ν•νƒμ DEK.
            
        - **Encrypted DEK**: CMKλ΅ μ•”νΈν™”λ DEK.
            
2. **ν΄λΌμ΄μ–ΈνΈ μΈ΅ μ•”νΈν™”**:
    
    - **μ‚¬μ©μ**: KMSλ΅λ¶€ν„° λ°›μ€ **Plaintext DEK**λ¥Ό μ‚¬μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈ(μ‚¬μ©μ μ»΄ν“¨ν„°)μ—μ„ λ€μ©λ‰ νμΌμ„ μ§μ ‘ μ•”νΈν™”ν•©λ‹λ‹¤. μ΄ μ‘μ—…μ€ KMS μ„λΉ„μ¤μ— λ°μ΄ν„°λ¥Ό μ „μ†΅ν•  ν•„μ” μ—†μ΄ λ΅μ»¬μ—μ„ κ³ μ†μΌλ΅ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.
        
    - **κ²°κ³Ό**: μ•”νΈν™”λ νμΌμ΄ μƒμ„±λ©λ‹λ‹¤.
        
3. **μ•”νΈν™”λ DEK μ €μ¥**:
    
    - **μ‚¬μ©μ**: μ•”νΈν™”λ νμΌκ³Ό ν•¨κ», KMSλ΅λ¶€ν„° λ°›μ€ **Encrypted DEK**λ¥Ό ν•¨κ» μ €μ¥ν•©λ‹λ‹¤. μ΄ Encrypted DEKκ°€ λ§μΉ νμΌ μ „μ²΄λ¥Ό κ°μ‹Έλ” 'λ΄‰ν¬(Envelope)'μ™€ κ°™λ‹¤κ³  ν•΄μ„ λ΄‰ν¬ μ•”νΈν™”λΌλ” μ΄λ¦„μ΄ λ¶™μ—μµλ‹λ‹¤.
        

### Envelope Encryptionμ λ³µνΈν™” κ³Όμ •

![[Pasted image 20250914191626.png]]

1. **μ•”νΈν™”λ DEK λ³µνΈν™”**:
    
    - **μ‚¬μ©μ**: μ €μ¥λ **Encrypted DEK**(4KB λ―Έλ§)λ¥Ό `Decrypt` APIλ¥Ό ν†µν•΄ KMSλ΅ μ „μ†΅ν•©λ‹λ‹¤.
        
    - **KMS**: μ‚¬μ©μμ IAM κ¶ν•μ„ ν™•μΈν• ν›„, CMKλ¥Ό μ‚¬μ©ν•μ—¬ Encrypted DEKλ¥Ό λ³µνΈν™”ν•©λ‹λ‹¤.
        
    - **κ²°κ³Ό**: KMSλ” **Plaintext DEK**λ¥Ό μ‚¬μ©μμ—κ² λ°ν™ν•©λ‹λ‹¤.
        
2. **ν΄λΌμ΄μ–ΈνΈ μΈ΅ λ³µνΈν™”**:
    
    - **μ‚¬μ©μ**: KMSλ΅λ¶€ν„° λ°›μ€ **Plaintext DEK**λ¥Ό μ‚¬μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ€μ©λ‰ μ•”νΈν™” νμΌμ„ μ§μ ‘ λ³µνΈν™”ν•©λ‹λ‹¤.
        
    - **κ²°κ³Ό**: μ›λ³Έ ν‰λ¬Έ νμΌμ΄ λ³µμ›λ©λ‹λ‹¤.
        

μ΄ λ°©μ‹μ ν•µμ‹¬μ€ **KMSκ°€ μ§μ ‘ λ€μ©λ‰ λ°μ΄ν„°λ¥Ό λ‹¤λ£¨μ§€ μ•κ³ , ν‚¤ μƒμ„± λ° κ΄€λ¦¬ μ—­ν• λ§ μν–‰**ν•λ‹¤λ” μ μ…λ‹λ‹¤. μ‹¤μ  λ°μ΄ν„° μ•”νΈν™” λ° λ³µνΈν™”λ” ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ΄λ£¨μ–΄μ§€λ―€λ΅, KMSμ 4KB ν•κ³„λ¥Ό μ°νν•κ³  λ„¤νΈμ›ν¬ μ¤λ²„ν—¤λ“λ¥Ό μ¤„μΌ μ μμµλ‹λ‹¤.

---

## π’΅ AWS Encryption SDK

Envelope Encryptionμ€ κµ¬ν„μ΄ λ³µμ΅ν•  μ μμµλ‹λ‹¤. AWSλ” μ΄λ¬ν• λ³µμ΅μ„±μ„ ν•΄κ²°ν•κΈ° μ„ν•΄ **AWS Encryption SDK**λ¥Ό μ κ³µν•©λ‹λ‹¤. μ΄ SDKλ” Envelope Encryption ν¨ν„΄μ„ μλ™μΌλ΅ κµ¬ν„ν•΄μ£Όλ©°, κ°λ°μκ°€ μ§μ ‘ μ΄ λ³µμ΅ν• λ΅μ§μ„ μ‘μ„±ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.

- **SDK κΈ°λ¥**: `Java`, `Python`, `C`, `JavaScript` λ“± λ‹¤μ–‘ν• μ–Έμ–΄λ΅ μ κ³µλ©λ‹λ‹¤.
    
- **CLI λ„κµ¬**: CLIλ΅λ„ μ„¤μΉν•μ—¬ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.
    
- **λ°μ΄ν„° ν‚¤ μΊμ‹±**: SDKλ” **λ°μ΄ν„° ν‚¤ μΊμ‹±** κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. λ™μΌν• CMKλ¥Ό μ‚¬μ©ν•μ—¬ μ—¬λ¬ νμΌμ„ μ•”νΈν™”ν•  κ²½μ°, λ§¤λ² `GenerateDataKey` APIλ¥Ό νΈμ¶ν•λ” λ€μ‹  κΈ°μ΅΄μ— μƒμ„±λ DEKλ¥Ό μ¬μ‚¬μ©ν•  μ μμµλ‹λ‹¤.
    
    - **μ¥μ **: KMS API νΈμ¶ νμλ¥Ό μ¤„μ—¬ **λΉ„μ©μ„ μ κ°**ν•  μ μμµλ‹λ‹¤.
        
    - **λ‹¨μ **: λ™μΌν• DEKλ¥Ό μ—¬λ¬ λ² μ‚¬μ©ν•λ―€λ΅ **λ³΄μ•μƒμ νΈλ μ΄λ“μ¤ν”„**κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.
        

---

## π“ KMS μ£Όμ” API μ”μ•½ (μ‹ν— λ€λΉ„)

|API μ΄λ¦„|κΈ°λ¥|νΉμ§• λ° μ©λ„|
|---|---|---|
|**`Encrypt`**|λ°μ΄ν„° μ•”νΈν™”|4KB λ―Έλ§μ λ°μ΄ν„°λ¥Ό KMSλ΅ μ§μ ‘ μ „μ†΅ν•μ—¬ CMKλ΅ μ•”νΈν™”.|
|**`Decrypt`**|λ°μ΄ν„° λ³µνΈν™”|KMSλ΅ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•μ—¬ λ³µνΈν™”. **Envelope Encryptionμ Encrypted DEKλ¥Ό λ³µνΈν™”ν•  λ•λ„ μ‚¬μ©λ¨.**|
|**`GenerateDataKey`**|DEK μƒμ„±|**Envelope Encryption**μ ν•µμ‹¬ API. Plaintext DEKμ™€ Encrypted DEKλ¥Ό λ¨λ‘ λ°ν™ν•μ—¬ ν΄λΌμ΄μ–ΈνΈ μΈ΅ μ•”νΈν™”λ¥Ό κ°€λ¥ν•κ² ν•¨.|
|**`GenerateDataKeyWithoutPlaintext`**|DEK μƒμ„± (Plaintext μ—†μ)|Encrypted DEKλ§ λ°ν™. μ¦‰μ‹ μ‚¬μ©ν•κΈ° μ„ν•¨μ΄ μ•„λ‹ κ²½μ°μ— μ‚¬μ©. λ³µνΈν™”λ¥Ό μ„ν•΄ μ¶”κ°€μ μΈ `Decrypt` API νΈμ¶μ΄ ν•„μ”.|
|**`GenerateRandom`**|λ¬΄μ‘μ„ λ°”μ΄νΈ λ¬Έμμ—΄ μƒμ„±|μ•”νΈν™”μ— μ‚¬μ©ν•  μ μλ” λ¬΄μ‘μ„ λ°”μ΄νΈ λ¬Έμμ—΄μ„ μƒμ„±.|