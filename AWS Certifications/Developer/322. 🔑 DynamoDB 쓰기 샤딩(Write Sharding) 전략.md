
DynamoDB는 NoSQL 데이터베이스로서 뛰어난 확장성을 자랑하지만, 데이터 모델링을 잘못하면 성능 저하를 겪을 수 있습니다. 특히 특정 파티션 키에 대한 쓰기 및 읽기 요청이 집중될 때 발생하는 **핫 파티션(Hot Partition)** 문제는 DynamoDB 성능의 가장 큰 걸림돌입니다. **쓰기 샤딩(Write Sharding)**은 이러한 문제를 해결하기 위한 중요한 전략입니다.

---

## 🔥 핫 파티션(Hot Partition) 문제란?

DynamoDB는 파티션 키(Partition Key)를 기준으로 데이터를 여러 파티션에 분산 저장합니다. 각 파티션은 할당된 읽기/쓰기 용량(RCU/WCU)이 정해져 있으며, 균형 있게 용량을 분배하여 전체 테이블의 처리량을 최적화합니다.

하지만 특정 파티션 키에 대한 요청이 다른 키에 비해 압도적으로 많아지면, 해당 파티션에 부하가 집중되면서 핫 파티션이 발생합니다. 이는 해당 파티션의 용량 한계를 초과하여 **쓰로틀링(Throttling)**으로 이어지고, 결국 전체 애플리케이션의 성능을 저하시킵니다.

### **예시: 투표 애플리케이션**

후보 A와 후보 B에 대한 투표를 DynamoDB에 저장하는 시나리오를 생각해 봅시다. 만약 파티션 키를 `candidate_id`로 설정하면, 모든 투표 데이터는 단 두 개의 파티션, 즉 '후보 A' 파티션과 '후보 B' 파티션에만 집중됩니다.

이 경우, 대부분의 쓰기 요청이 이 두 파티션에 몰리면서 핫 파티션이 발생하게 됩니다.

---

## 💡 쓰기 샤딩(Write Sharding) 전략

쓰기 샤딩은 데이터가 소수의 파티션에 집중되는 것을 방지하기 위해, **파티션 키에 추가적인 무작위성을 부여**하여 데이터를 여러 파티션에 고르게 분산시키는 전략입니다.

### **방법: 접두사/접미사(Prefix/Suffix) 추가**

가장 일반적인 방법은 파티션 키 값에 **무작위 숫자나 문자열을 접두사(Prefix) 또는 접미사(Suffix)로 추가**하는 것입니다.

예시:

후보 A에 대한 투표를 candidate_A라는 파티션 키에 저장하는 대신, candidate_A_1, candidate_A_2, candidate_A_3... 와 같은 파티션 키를 사용합니다.


![[Pasted image 20250906195155.png]]

```
+----------+------------+------------+
| candidate_id | shard_id | vote_count |
+----------+------------+------------+
| candidate_A | 1        | 1234       |
| candidate_A | 2        | 2341       |
| candidate_A | 3        | 3412       |
+----------+------------+------------+
```

이렇게 하면 '후보 A'에 대한 투표 요청이 하나의 파티션에 몰리는 대신, 여러 파티션에 분산되어 처리됩니다. 이는 쓰기 용량을 효율적으로 활용하고 핫 파티션 문제를 해결합니다.

### **샤딩 값 생성 방법**

접미사/접두사에 사용할 샤딩 값은 다음 두 가지 방법으로 생성할 수 있습니다.

1. **랜덤(Random) 샤딩**:
    
    - **방법**: 1부터 N까지의 숫자 범위에서 무작위로 숫자를 선택하여 파티션 키에 추가합니다.
        
    - **예시**: `candidate_A_` 뒤에 1~100 사이의 무작위 숫자를 붙이는 방식.
        
    - **특징**: 모든 쓰기 작업을 완벽하게 분산시킬 수 있습니다. 하지만 특정 후보에 대한 전체 투표 수를 읽어오려면 모든 샤드(shard)에 대한 읽기 작업을 수행해야 하므로 읽기 작업이 복잡하고 비효율적일 수 있습니다.
        
2. **해시(Hashing) 기반 샤딩**:
    
    - **방법**: 아이템의 다른 속성(예: 사용자 ID)을 해싱하여 파티션 키의 접미사로 사용합니다.
        
    - **예시**: `candidate_A_` + `hash(user_id)`의 결과 값.
        
    - **특징**: 무작위 샤딩과 달리 특정 사용자의 모든 투표 데이터를 효율적으로 찾을 수 있습니다.
        

---

## 📌 쓰기 샤딩의 장단점

|장점|단점|
|---|---|
|**쓰기 부하 분산**: 핫 파티션을 효과적으로 방지.|**읽기 작업의 복잡성**: 전체 데이터를 읽으려면 여러 샤드에서 데이터를 읽어와야 함. (`Query` 작업 대신 `Scan`이나 여러 `Query` 작업을 사용해야 할 수 있음)|
|**높은 처리량 달성**: 전체 테이블의 쓰기 용량을 고르게 활용하여 최대 성능을 발휘.|**데이터 모델링 복잡성**: 애플리케이션 로직에 샤딩 전략을 반영해야 하므로 모델링이 복잡해질 수 있음.|

---

## 🚀 결론

DynamoDB 쓰기 샤딩은 특정 파티션 키에 대한 쓰기 작업이 집중될 때 발생하는 핫 파티션 문제를 해결하는 핵심 전략입니다. 파티션 키에 무작위 접미사를 추가하여 데이터를 여러 파티션에 고르게 분산시킴으로써, 높은 쓰기 처리량을 안정적으로 확보할 수 있습니다. 하지만 이 전략은 읽기 작업의 복잡성을 증가시킬 수 있으므로, 애플리케이션의 읽기/쓰기 패턴을 면밀히 분석하여 적절한 샤딩 전략을 선택하는 것이 중요합니다.