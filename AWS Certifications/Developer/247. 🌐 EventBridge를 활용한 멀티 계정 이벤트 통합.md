## 문제 해결: 분산된 이벤트를 중앙에서 관리하기

![[Pasted image 20250824210256.png]]

대규모 AWS 환경에서는 여러 개의 AWS 계정을 운영하는 경우가 많습니다. 이럴 때 각 계정에서 발생하는 중요한 이벤트(예: EC2 인스턴스 상태 변경, IAM 사용자 생성 등)를 중앙 집중식으로 관리하고 모니터링해야 할 필요성이 생깁니다. 

**Amazon EventBridge**의 교차 계정(Cross-Account) 기능은 이 문제를 효율적으로 해결할 수 있게 해줍니다.

---

## 🏗️ 아키텍처 구성 요소

멀티 계정 이벤트 통합은 크게 두 가지 역할을 하는 계정으로 구성됩니다.

1. **중앙 계정(Central Account)**: 이벤트를 수신하고 관리하는 계정입니다. 이 계정의 이벤트 버스에 모든 이벤트가 모이게 됩니다.

2. **발신 계정(Sending Account)**: 이벤트를 중앙 계정으로 보내는 계정입니다.

### 핵심 개념: EventBridge 리소스 기반 정책 (Resource-based Policy)

기본적으로 AWS 계정 간에는 직접적인 통신이 허용되지 않습니다. EventBridge의 **리소스 기반 정책**은 중앙 계정의 이벤트 버스에 설정하여, 특정 발신 계정으로부터 이벤트를 수신하도록 허용하는 역할을 합니다.

---

## ⚙️ 단계별 설정 가이드

### 1단계: 중앙 계정 설정

1. **중앙 이벤트 버스**: 중앙 계정의 EventBridge 콘솔에서 기본 이벤트 버스(`default` bus)를 사용하거나, 필요에 따라 새로운 이벤트 버스를 생성합니다.

2. **리소스 기반 정책 설정**: 중앙 이벤트 버스에 **리소스 기반 정책**을 추가합니다. 이 정책은 발신 계정의 AWS 계정 ID를 명시하여 해당 계정에서 `events:PutEvents` API 호출을 허용합니다.


**정책 예시**:

```JSON
{
  "Statement": [
    {
      "Sid": "AllowAccountToSendEvents",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::[발신 계정 ID]:root"
      },
      "Action": "events:PutEvents",
      "Resource": "arn:aws:events:[리전]:[중앙 계정 ID]:event-bus/default"
    }
  ]
}
```

위 정책은 `[발신 계정 ID]`를 가진 계정이 중앙 계정의 이벤트 버스로 이벤트를 보낼 수 있도록 허용합니다.

### 2단계: 발신 계정 설정

1. **이벤트 규칙 생성**: 발신 계정에서 이벤트를 포착하기 위한 규칙을 생성합니다.
    
    - **이벤트 패턴**: 모니터링하려는 이벤트(예: EC2 인스턴스 상태 변경)에 대한 패턴을 정의합니다.
    
    - **대상(Target)**: 규칙의 대상으로 `Event bus in another account`를 선택하고, 중앙 계정의 이벤트 버스 ARN(Amazon Resource Name)을 입력합니다.

### 3단계: 중앙 계정에서 이벤트 처리

모든 발신 계정에서 발생하는 이벤트는 이제 중앙 계정의 이벤트 버스로 전송됩니다. 중앙 계정에서는 이 이벤트를 처리하기 위한 규칙을 만들 수 있습니다.

1. **새 규칙 생성**: 중앙 이벤트 버스에 새로운 규칙을 생성합니다.

2. **이벤트 패턴**: 규칙이 반응할 이벤트 패턴을 정의합니다. (예: `EC2 인스턴스 종료` 이벤트)

3. **대상**: 이벤트를 처리할 대상(예: SNS 알림, Lambda 함수)을 지정합니다.


|역할|수행 작업|
|---|---|
|**발신 계정 A, B, C...**|이벤트 패턴 규칙을 생성하여 이벤트를 중앙 계정으로 전송|
|**중앙 계정**|발신 계정의 이벤트를 허용하는 정책을 설정하고, 수신된 이벤트를 처리하는 규칙을 생성|

이러한 아키텍처를 통해, 각 계정의 이벤트가 중앙 계정으로 모이므로 단일 대시보드에서 모든 이벤트를 모니터링하고 관리할 수 있습니다.