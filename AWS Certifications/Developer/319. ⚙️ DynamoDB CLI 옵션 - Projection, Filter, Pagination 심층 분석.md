
DynamoDB를 효과적으로 다루기 위해서는 CLI(Command Line Interface) 옵션을 잘 이해하는 것이 필수적입니다. 이 옵션들은 데이터를 조회할 때 필요한 부분만 가져오고, 대량의 데이터를 효율적으로 처리하며, 네트워크 타임아웃을 방지하는 데 큰 도움이 됩니다. 이번 아티클에서는 DynamoDB `scan` 및 `query` 작업에 자주 사용되는 CLI 옵션들을 자세히 살펴보겠습니다.

---

## 🔍 `projection-expression`: 필요한 속성만 가져오기

테이블의 모든 속성을 가져오는 대신, **`projection-expression`**을 사용하면 특정 속성(컬럼)만 지정하여 가져올 수 있습니다. 이는 네트워크 트래픽을 줄이고, 불필요한 데이터를 처리하는 오버헤드를 줄여줍니다.

### **사용 예시**

`UserPosts` 테이블에 `user_id`, `post_timestamp`, `content` 속성이 있다고 가정해 봅시다. 여기서 `user_id`와 `content`만 조회하고 싶다면 다음과 같이 명령어를 작성할 수 있습니다.

```Bash
aws dynamodb scan \
--table-name UserPosts \
--projection-expression "user_id, content"
```

결과:

이 명령어를 실행하면, 반환된 결과에 post_timestamp 속성은 포함되지 않고 user_id와 content만 표시됩니다.

## 🎯 `filter-expression`: 조건에 맞는 아이템만 필터링

**`filter-expression`**은 `scan` 또는 `query` 작업으로 반환되는 아이템에 추가적인 조건을 적용하여 결과를 필터링합니다. 이 필터링은 **클라이언트 측**에서 발생한다는 점을 이해하는 것이 중요합니다. 즉, DynamoDB는 일단 테이블의 모든 데이터를 읽어온 다음, 클라이언트에서 지정된 조건에 따라 결과를 걸러냅니다.

### **사용 예시**

`UserPosts` 테이블에서 `user_id`가 "john123"인 아이템만 찾고 싶다면 다음과 같이 명령어를 사용할 수 있습니다.

```Bash
aws dynamodb scan \
--table-name UserPosts \
--filter-expression "user_id = :u" \
--expression-attribute-values '{":u": {"S": "john123"}}'
```

- `--filter-expression "user_id = :u"`: 필터링 조건을 지정합니다. 여기서는 `user_id` 속성값이 `:u`라는 플레이스홀더와 동일한 아이템을 찾습니다.
    
- `--expression-attribute-values '{":u": {"S": "john123"}}'`: `:u` 플레이스홀더에 할당할 실제 값을 정의합니다. `{"S": "john123"}`은 "john123"이라는 문자열(`S`) 값임을 의미합니다.
    

결과:

이 명령어를 실행하면 UserPosts 테이블에서 user_id가 "john123"인 모든 아이템을 반환합니다.

> ⚠️ **주의**: `filter-expression`은 테이블의 모든 아이템을 읽기 때문에, 대량의 테이블에 `scan`과 함께 사용하면 **높은 읽기 용량(RCU)**을 소모하게 됩니다. 특정 파티션 키를 기준으로 효율적으로 데이터를 필터링하려면 `query` 작업을 사용해야 합니다.

---

## 📄 Pagination: 대량 데이터의 효율적인 처리

대량의 데이터를 조회할 때 발생하는 타임아웃 문제를 해결하고, 결과를 원하는 만큼만 나눠서 받을 수 있도록 도와주는 옵션들입니다.

### **1. `page-size`**

**`page-size`**는 **API 호출 횟수**를 제어하는 옵션입니다. 한 번의 CLI 호출로 전체 데이터셋을 반환하되, 백그라운드에서 DynamoDB에 여러 번의 작은 API 요청을 보내는 방식으로 작동합니다. 이는 단일 요청의 타임아웃을 방지하는 데 유용합니다.

예시:

테이블에 10,000개의 아이템이 있고 page-size를 1000으로 설정하면, CLI는 내부적으로 10번의 API 호출을 수행하여 10,000개의 아이템을 모두 가져옵니다.

```Bash
aws dynamodb scan \
--table-name UserPosts \
--page-size 1
```

이 명령어를 실행하면, CLI는 테이블에 있는 3개의 아이템을 가져오기 위해 3번의 백그라운드 API 호출을 수행하지만, 최종 결과는 한 번에 모두 출력됩니다.

### **2. `max-items`와 `NextToken`**

**`max-items`**는 **반환될 아이템의 수**를 제한하는 옵션입니다. 이 옵션을 사용하면 한 번의 호출로 지정된 개수만큼의 아이템만 가져오고, 다음 아이템들을 가져오기 위한 **`NextToken`**을 함께 반환받습니다.

**`starting-token`**은 `NextToken` 값을 사용하여 다음 페이지의 데이터를 조회할 때 사용됩니다.

사용 예시

UserPosts 테이블에서 한 번에 한 개의 아이템만 가져오고 싶다면:

**첫 번째 호출**:

```Bash
aws dynamodb scan \
--table-name UserPosts \
--max-items 1
```

- **결과**: 첫 번째 아이템이 반환되고, 결과의 하단에 **`NextToken`** 값이 출력됩니다.
    

두 번째 호출:

첫 번째 호출에서 얻은 NextToken 값을 starting-token에 넣어 다음 아이템을 조회합니다.

```Bash
aws dynamodb scan \
--table-name UserPosts \
--max-items 1 \
--starting-token "eyJDdX...NvdW50IjozfQ=="
```

이 과정을 `NextToken`이 더 이상 반환되지 않을 때까지 반복하면 테이블의 모든 아이템을 페이지별로 조회할 수 있습니다. `NextToken`이 없다는 것은 더 이상 읽을 데이터가 없다는 의미입니다.

## 📝 CLI 옵션 요약

|옵션|목적|동작 방식|주요 사용 사례|
|---|---|---|---|
|**`projection-expression`**|특정 속성만 조회|DynamoDB가 반환하는 데이터의 속성을 제한|네트워크 트래픽 및 오버헤드 절감|
|**`filter-expression`**|조건에 맞는 아이템 필터링|DynamoDB에서 모든 데이터를 읽어온 후 클라이언트에서 필터링|`query`에 사용할 수 없는 속성으로 필터링할 때 (단, 비효율적)|
|**`page-size`**|백그라운드 API 호출 제어|전체 데이터셋을 반환하지만, 내부적으로 여러 번의 작은 요청을 수행|API 타임아웃 방지, 대용량 데이터 조회 최적화|
|**`max-items`**|반환될 아이템 수 제한|한 번에 지정된 개수만큼의 아이템만 반환|데이터 페이징 처리, 웹 애플리케이션의 "다음 페이지" 기능 구현|
|**`starting-token`**|다음 페이지 데이터 조회|`NextToken` 값을 사용하여 중단되었던 지점부터 이어서 조회|`max-items`와 함께 사용|

---

이러한 CLI 옵션들은 DynamoDB 작업을 더욱 유연하고 효율적으로 만들어줍니다. 특히 대규모 데이터셋을 다룰 때, 이 옵션들을 올바르게 활용하는 것은 매우 중요합니다.