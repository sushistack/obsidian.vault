
Amazon S3에서 객체를 암호화하는 두 가지 주요 방법인 **기본 암호화(Default Encryption)**와 **버킷 정책(Bucket Policy)**을 통한 강제 암호화에 대해 알아보겠습니다. 이 두 방식은 서로 다른 우선순위를 가지며, 데이터를 안전하게 보호하기 위해 함께 사용할 수 있습니다.

---

### 1. S3 기본 암호화 (Default Encryption)

- **기본 설정:** 현재 모든 새로운 S3 버킷은 기본적으로 **`SSE-S3` 암호화**가 활성화되어 있습니다. 이는 별도의 설정을 하지 않아도 모든 새로운 객체가 자동으로 `SSE-S3`로 암호화된다는 의미입니다.
    
- **설정 변경:** 버킷의 기본 암호화 설정을 `SSE-S3` 외에 `SSE-KMS`나 `DSSE-KMS`로 변경할 수 있습니다.
    
- **작동 방식:** 버킷에 객체가 업로드될 때, 별도의 암호화 헤더가 없으면 버킷의 기본 암호화 설정에 따라 객체가 암호화됩니다.

---

### 2. 버킷 정책을 통한 강제 암호화

- **목표:** 특정 암호화 방식(`SSE-KMS` 또는 `SSE-C`)을 **강제**하여, 올바른 암호화 헤더가 없는 객체 업로드 요청을 거부하는 것입니다.
    
- **작동 방식:** 버킷 정책을 사용하여 `s3:PutObject` API 호출에 대한 `Deny` 규칙을 만듭니다. 이 규칙은 특정 조건(예: `x-amz-server-side-encryption` 헤더가 없음)을 만족할 때 요청을 거부합니다.

**버킷 정책 예시:**

`SSE-KMS`를 강제하는 버킷 정책

```JSON
{
  "Statement": [
    {
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-bucket/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    }
  ]
}
```

_이 정책은 `SSE-KMS` 암호화 헤더(`"s3:x-amz-server-side-encryption": "aws:kms"`)가 없는 모든 `PutObject` 요청을 거부합니다._

---

### 3. 우선순위: 버킷 정책 > 기본 암호화

- **평가 순서:** AWS는 요청이 들어왔을 때 **버킷 정책을 먼저 평가**하고, 그 후에 버킷의 기본 암호화 설정을 적용합니다.
    
- **핵심:** 버킷 정책을 사용하여 특정 암호화를 강제하면, 기본 암호화 설정을 덮어쓰게 됩니다. 따라서 버킷 정책은 데이터 보안에 대한 **더 강력하고 선제적인 통제 수단**입니다.
    

**결론:**

- **기본 암호화:** `SSE-S3`가 기본이지만, 필요에 따라 `SSE-KMS` 등으로 변경 가능합니다.
- **버킷 정책:** 특정 암호화 방식(예: `SSE-KMS`, `SSE-C`)을 반드시 사용하도록 **강제**할 때 유용합니다.
- **우선순위:** **버킷 정책이 기본 암호화 설정보다 항상 먼저 적용됩니다.**
