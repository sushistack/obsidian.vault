
이 문서에서는 클라이언트와 로드 밸런서 간의 통신을 암호화하는 데 사용되는 **SSL/TLS 인증서**와 여러 웹사이트를 단일 로드 밸런서에서 호스팅하면서 각각 다른 인증서를 사용할 수 있게 해주는 **SNI(Server Name Indication)** 개념에 대해 설명합니다. 이 내용은 다소 복잡할 수 있지만, 클라우드 환경에서 보안 웹 서비스를 제공하는 데 필수적인 지식입니다.

---

### SSL/TLS 인증서란 무엇인가?

**SSL (Secure Sockets Layer)**과 그 후속 버전인 **TLS (Transport Layer Security)**는 클라이언트(예: 웹 브라우저)와 서버(예: 로드 밸런서) 간에 전송되는 데이터의 **암호화(in-flight encryption)**를 가능하게 하는 보안 프로토콜입니다.

- **SSL:** Secure Sockets Layer의 약자로, 전송 연결을 암호화하는 데 사용됩니다.
- **TLS:** Transport Layer Security의 약자로, SSL의 최신 버전입니다.

오늘날에는 주로 TLS 인증서가 사용되지만, 많은 사람이 여전히 "SSL 인증서"라는 용어를 혼용하여 사용합니다. (이 문서에서도 편의상 'SSL'이라는 용어를 주로 사용하지만, 실제로는 TLS를 지칭할 수 있습니다.)

#### 1. SSL 인증서의 역할

SSL 인증서는 데이터가 네트워크를 통해 전송될 때 암호화되어 오직 발신자와 수신자만이 해독할 수 있도록 보장합니다. 이는 민감한 정보(로그인 정보, 신용카드 번호 등)가 중간에 가로채이는 것을 방지하여 보안을 강화합니다.

- **인증 기관(CA) 발행:** 공개 SSL 인증서는 Comodo, Symantec, GoDaddy, Let's Encrypt 등과 같은 신뢰할 수 있는 **인증 기관(Certificate Authority)**에 의해 발급됩니다.
- **웹사이트 보안 표시:** 웹사이트 URL 옆에 표시되는 자물쇠 아이콘(초록색 자물쇠)은 해당 사이트의 트래픽이 암호화되어 안전하다는 것을 나타냅니다. 암호화되지 않은 사이트에서는 경고 아이콘이 표시되어 보안에 취약함을 알립니다.
- **만료일 및 갱신:** SSL 인증서에는 만료일이 있으며, 인증서의 유효성을 유지하려면 정기적으로 갱신해야 합니다.

---

### 로드 밸런서와 SSL 인증서 통합

![[Pasted image 20250627160000.png]]

로드 밸런서는 SSL 인증서를 관리하고 트래픽을 암호화하는 데 중요한 역할을 합니다.

#### 1. SSL/TLS 종료(Termination)

- **HTTPS 통신:** 사용자는 HTTPS (HTTP Secure)를 통해 로드 밸런서에 연결합니다. 여기서 'S'는 SSL 인증서를 사용하여 암호화된 통신을 의미합니다.
- **로드 밸런서의 역할:** 로드 밸런서는 클라이언트로부터 암호화된 트래픽을 수신하여 **SSL/TLS Termination**을 수행합니다. 즉, 로드 밸런서에서 암호화된 트래픽을 복호화합니다.
- **백엔드 통신:** 로드 밸런서는 복호화된 트래픽을 백엔드 EC2 인스턴스로 전달합니다. 이 때 로드 밸런서와 EC2 인스턴스 간의 통신은 주로 HTTP(암호화되지 않음)로 이루어지지만, 이 트래픽은 AWS VPC(Virtual Private Cloud) 내의 **프라이빗 네트워크**를 통해 전송되므로 비교적 안전합니다.

#### 2. AWS Certificate Manager (ACM)와의 통합

- AWS는 **ACM (AWS Certificate Manager)**을 통해 SSL/TLS 서버 인증서를 관리하는 서비스를 제공합니다.
- 사용자는 ACM에서 새로운 인증서를 프로비저닝(발급)받거나, 외부에서 발급받은 기존 인증서를 ACM에 업로드하여 관리할 수 있습니다.
- 로드 밸런서에서 HTTPS 리스너를 설정할 때, 기본 인증서를 반드시 지정해야 합니다. 또한, 필요에 따라 여러 도메인을 지원하기 위한 추가 인증서 목록을 연결할 수 있습니다.

#### 3. 보안 정책 (Security Policy)

HTTPS 리스너 설정 시 특정 보안 정책을 선택하여 지원되는 SSL/TLS 프로토콜 버전(레거시 클라이언트 지원 여부 등)을 정의할 수 있습니다.

---

### SNI (Server Name Indication)의 중요성

**SNI (Server Name Indication)**는 **하나의 IP 주소와 포트를 사용하여 여러 웹사이트(각기 다른 도메인 이름을 가진)에 대해 각각 다른 SSL/TLS 인증서를 제공할 수 있게 해주는 기술**입니다.

#### 1. SNI가 해결하는 문제

과거에는 단일 웹 서버나 로드 밸런서에서 여러 HTTPS 웹사이트를 호스팅하려면 각 웹사이트마다 고유한 IP 주소가 필요했습니다. 왜냐하면 SSL 핸드셰이크(암호화 통신 설정 과정)가 시작될 때는 클라이언트가 어떤 웹사이트에 접속하려는지 서버가 알 수 없었고, 따라서 어떤 SSL 인증서를 제공해야 할지 결정할 수 없었기 때문입니다.

SNI는 클라이언트가 SSL 핸드셰이크 초기에 **접속하려는 웹사이트의 호스트 이름(도메인 이름)**을 서버에게 알려주도록 강제하는 새로운 프로토콜을 도입하여 이 문제를 해결했습니다.

#### 2. SNI의 작동 방식

```
[클라이언트]
  "저는 www.mycorp.com에 연결하고 싶습니다!" (SNI 정보 포함)
       |
       V
[Application Load Balancer (ALB) 또는 Network Load Balancer (NLB)]
       | (ALB/NLB는 여러 SSL 인증서 보유)
       |---- www.mycorp.com 인증서
       |---- domain1.example.com 인증서
       V
  ALB/NLB: "www.mycorp.com을 원하시는군요. 해당 인증서로 암호화 통신을 시작합니다."
       |
       V (ALB/NLB의 라우팅 규칙에 따라)
[대상 그룹 1: www.mycorp.com 서비스]
       |
       V
[대상 그룹 2: domain1.example.com 서비스]
```

1. 클라이언트가 로드 밸런서에 HTTPS 연결을 시도할 때, SSL 핸드셰이크 과정에서 `Server Name Indication` 확장 필드를 통해 접속하려는 호스트 이름(예: `www.mycorp.com`)을 보냅니다.
2. 로드 밸런서는 이 호스트 이름을 확인하여, 자신이 가지고 있는 여러 SSL 인증서 중에서 해당 호스트 이름에 맞는 **정확한 인증서를 선택하여 클라이언트에게 제공**합니다.
3. 인증서 교환 및 암호화 통신이 설정된 후, 로드 밸런서는 설정된 라우팅 규칙(예: 호스트 이름 기반 라우팅)에 따라 해당 트래픽을 정확한 백엔드 대상 그룹으로 전달합니다.

#### 3. SNI 지원 로드 밸런서

SNI는 비교적 최신 기술이므로, 모든 클라이언트나 로드 밸런서가 이를 지원하는 것은 아닙니다.

- **지원하는 AWS 서비스:**
    - **Application Load Balancer (ALB)**
    - **Network Load Balancer (NLB)**
    - CloudFront (콘텐츠 전송 네트워크 서비스)

- **지원하지 않는 AWS 서비스:**
    - Classic Load Balancer (CLB) - 구세대 로드 밸런서이므로 SNI를 지원하지 않습니다.

**시험 팁:** 로드 밸런서에 여러 SSL 인증서를 연결하거나 여러 호스트 이름을 지원해야 한다고 언급되면, ALB 또는 NLB를 떠올려야 합니다.

---

### 로드 밸런서별 SSL 인증서 지원 요약


| **로드 밸런서 유형**                       | **SSL 인증서 지원** | **여러 SSL 인증서 지원 (SNI 사용)**                         |
| ----------------------------------- | -------------- | -------------------------------------------------- |
| **Classic Load Balancer (CLB)**     | 예              | 아니요 (하나의 CLB당 하나의 인증서만 지원. 여러 호스트명 필요 시 여러 CLB 필요) |
| **Application Load Balancer (ALB)** | 예              | **예 (여러 리스너에 여러 인증서 지원. SNI 사용)**                  |
| **Network Load Balancer (NLB)**     | 예              | **예 (여러 리스너에 여러 인증서 지원. SNI 사용)**                  |

**결론:**

SSL/TLS 인증서는 안전한 웹 통신을 위한 필수 요소이며, 로드 밸런서는 클라이언트와 서버 간의 암호화된 연결을 관리합니다. 특히 **SNI**는 단일 로드 밸런서(ALB 또는 NLB)가 여러 도메인에 대해 각기 다른 SSL 인증서를 효율적으로 제공할 수 있게 하여, 현대 웹 아키텍처의 유연성과 확장성을 크게 향상시킵니다.



