
**CloudFormation 서비스 역할**은 CloudFormation이 사용자를 대신하여 스택 리소스를 생성, 업데이트 및 삭제할 수 있도록 허용하는 IAM 역할입니다. 이 역할을 사용하면 **최소 권한 원칙(Principle of Least Privilege)**을 효과적으로 구현할 수 있습니다.

#### 서비스 역할 사용 시나리오

일반적으로 AWS 사용자는 특정 AWS 서비스(예: S3, EC2)에 직접 접근하여 리소스를 생성, 수정할 수 있는 권한을 가집니다. 하지만 보안을 강화하기 위해, 사용자에게는 CloudFormation 스택을 생성하고 관리하는 권한만 부여하고, 실제 리소스 생성에 필요한 권한은 CloudFormation 서비스 역할에 위임할 수 있습니다.

|역할|필요한 IAM 권한|설명|
|---|---|---|
|**AWS 사용자**|`iam:PassRole`, `cloudformation:*`|CloudFormation 스택을 생성/관리하고, CloudFormation에 서비스 역할을 전달할 권한만 가집니다. S3나 EC2에 대한 직접적인 권한은 없습니다.|
|**CloudFormation 서비스 역할**|`s3:*`, `ec2:*` 등|스택 템플릿에 정의된 리소스(예: S3 버킷, EC2 인스턴스)를 생성, 업데이트, 삭제하는 데 필요한 모든 권한을 가집니다.|

이 구조는 사용자가 직접 AWS 리소스를 다루는 권한이 없더라도, CloudFormation을 통해 리소스를 배포할 수 있게 합니다.

---

### 💻 IAM 역할 생성 및 CloudFormation에 할당

#### 1. IAM 역할 생성

1. IAM 콘솔에서 '역할' 메뉴로 이동하여 새 역할을 생성합니다.
2. **신뢰할 수 있는 엔터티**: **`AWS 서비스`**를 선택하고, **`CloudFormation`**을 지정합니다.
3. **권한 정책**: 역할에 필요한 권한(예: `AmazonS3FullAccess`)을 부여합니다.
4. **역할 이름**: 역할을 식별할 수 있는 이름(예: `DemoRole-for-CFN-with-S3`)을 지정하고 생성합니다.

#### 2. CloudFormation 스택에 역할 할당

1. CloudFormation 콘솔에서 스택을 생성하거나 업데이트할 때, **`Stack details`** 단계의 **`Permissions`** 섹션으로 이동합니다.
2. **`IAM role`** 드롭다운 메뉴에서 이전에 생성한 서비스 역할을 선택합니다.
3. **`Stack operations`**가 이 역할을 사용하게 됩니다.

만약 이 역할에 EC2 인스턴스 생성 권한이 없고 S3 버킷 권한만 있다면, EC2 인스턴스를 생성하려는 스택은 실패하게 됩니다. 이는 CloudFormation이 사용자 본인의 권한이 아닌 할당된 서비스 역할의 권한을 사용하기 때문입니다.

이러한 방식은 조직 내에서 권한을 세밀하게 제어하고, 각 사용자가 필요한 최소한의 권한만을 갖도록 하는 데 매우 효과적입니다.