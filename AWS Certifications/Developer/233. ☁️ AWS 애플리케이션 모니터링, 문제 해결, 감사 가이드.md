
## 🚀 모니터링의 중요성: 왜 우리는 계속 지켜봐야 하는가?

애플리케이션을 배포하는 것만으로는 충분하지 않습니다. 우리는 이미 코드를 통해 인프라를 구축하고, AWS의 최적화된 컴포넌트들을 활용하여 안전하고 자동화된 배포를 수행하는 방법을 배웠습니다. 하지만 사용자는 우리가 얼마나 훌륭한 배포 시스템을 갖췄는지에는 관심이 없습니다. 그들은 오직 **애플리케이션이 정상적으로 작동하는지**에만 신경 씁니다.

모니터링이 중요한 이유는 다음과 같습니다:

- **성능 저하 방지:** 애플리케이션의 지연 시간이 시간이 지남에 따라 증가하는 원인을 파악하고 미리 해결할 수 있습니다.
    
- **사전 문제 해결:** 사용자가 문제를 제보하기 전에, 우리가 먼저 장애를 감지하고 해결하여 고객 경험이 저하되는 것을 막아야 합니다.
    
- **비용 및 성능 최적화:** 모니터링을 통해 애플리케이션의 성능과 비용을 지속적으로 분석하고 최적화할 수 있습니다.
    
- **장애 패턴 학습:** 장애가 발생했을 때의 패턴을 분석하여 향후 유사한 문제가 발생하는 것을 방지하고 시스템을 개선할 수 있습니다.
    

이러한 이유로 AWS에서는 애플리케이션의 상태를 종합적으로 관리하고 분석할 수 있는 다양한 모니터링 및 감사 도구를 제공합니다. 이제 이 세 가지 핵심 서비스인 **CloudWatch**, **X-Ray**, 그리고 **CloudTrail**에 대해 자세히 알아보겠습니다.

---

## 📈 CloudWatch: 메트릭, 로그, 이벤트의 중앙 집중식 관리

CloudWatch는 AWS 리소스 및 애플리케이션을 위한 모니터링 및 관찰성 서비스입니다. 이 서비스는 다음과 같은 네 가지 핵심 기능을 제공하여 시스템의 상태를 종합적으로 파악할 수 있게 합니다.

### 메트릭(Metrics)

AWS 리소스에서 제공되는 다양한 성능 데이터를 수집하고 시각화합니다. 예를 들어, EC2 인스턴스의 CPU 사용률, 네트워크 I/O, 디스크 사용량 등을 그래프로 확인할 수 있습니다.

- **EC2 인스턴스 메트릭:**
    
    - `CPUUtilization`: 인스턴스의 CPU 사용량
        
    - `NetworkIn`/`NetworkOut`: 인스턴스로 들어오고 나가는 네트워크 트래픽
        
- **Lambda 함수 메트릭:**
    
    - `Invocations`: 함수가 호출된 횟수
        
    - `Errors`: 함수 실행 중 오류가 발생한 횟수
        
    - `Duration`: 함수 실행 시간
        

### 로그(Logs)

애플리케이션, 시스템 및 AWS 서비스의 로그 파일을 수집하고, 중앙에서 관리하며, 분석할 수 있습니다. 로그는 텍스트 형태의 데이터를 수집하고 필터링하는 데 유용하며, 특정 키워드나 패턴을 검색하여 문제의 원인을 빠르게 찾을 수 있습니다.

### 이벤트(Events)

AWS 환경에서 발생하는 다양한 이벤트에 대해 실시간으로 대응할 수 있게 해줍니다. 특정 이벤트가 발생했을 때 SNS, Lambda, SQS 등 다양한 AWS 서비스로 알림을 보내거나 특정 작업을 트리거할 수 있습니다.

예시:


```JSON
{
  "source": "aws.ec2",
  "detail-type": "EC2 Instance State-change Notification",
  "detail": {
    "instance-id": "i-1234567890abcdef0",
    "state": "stopped"
  }
}
```

위 이벤트는 EC2 인스턴스가 `stopped` 상태로 변경되었음을 알립니다.

### 알람(Alarms)

메트릭, 로그, 이벤트에 대한 임계값을 설정하여 특정 조건이 충족될 경우 알림을 보내거나 자동화된 조치를 취할 수 있습니다. 예를 들어, EC2 인스턴스의 CPU 사용률이 5분 동안 80%를 초과하면 SNS 알림을 보내는 규칙을 설정할 수 있습니다.

|기능|설명|주요 용도|
|---|---|---|
|**메트릭**|성능 데이터를 수집 및 시각화|자원 사용량 모니터링|
|**로그**|로그 데이터를 중앙 집중식으로 관리|문제의 원인 분석|
|**이벤트**|AWS 환경의 변화에 실시간으로 대응|자동화된 작업 트리거|
|**알람**|특정 조건 발생 시 알림 및 조치|임계값 기반의 자동 경고|

---

## 🕵️ X-Ray: 마이크로서비스의 분산 추적과 문제 해결

X-Ray는 복잡한 마이크로서비스 아키텍처에서 발생하는 성능 문제와 오류를 시각적으로 분석하고 디버깅하는 데 특화된 서비스입니다.

특히 여러 서비스가 서로 호출하며 복잡하게 얽혀 있는 분산 애플리케이션 환경에서 매우 유용합니다.

### 분산 추적(Distributed Tracing)

X-Ray의 핵심 기능은 애플리케이션 요청이 여러 서비스와 AWS 리소스를 거치며 어떻게 처리되는지 **종단 간(end-to-end)** 추적하는 것입니다. 이를 통해 특정 호출이 지연되거나 실패하는 원인을 시각적으로 파악할 수 있습니다.

예시:

1. **사용자 요청** → API Gateway
2. **API Gateway** → Lambda 함수 호출
3. **Lambda 함수** → DynamoDB에 데이터 쓰기
4. **Lambda 함수** → S3에서 이미지 가져오기

이 모든 과정을 X-Ray를 통해 하나의 **트레이스(Trace)**로 시각화하여, 각 단계에 소요된 시간과 오류 여부를 한눈에 확인할 수 있습니다.

### 서비스 맵(Service Map)

X-Ray는 애플리케이션의 구성 요소를 시각적으로 표현하는 **서비스 맵**을 생성합니다. 이 맵은 각 서비스 간의 관계와 호출, 그리고 각 서비스의 상태(정상/경고/오류)를 보여주므로, 성능 병목 현상이나 오류가 발생하는 지점을 즉시 찾아낼 수 있습니다.

---

## CloudTrail: API 호출 감사 및 보안 모니터링

CloudTrail은 AWS 계정 내에서 발생한 모든 API 호출 및 리소스 변경 사항을 기록하는 서비스입니다.

이는 내부적인 모니터링과 보안 감사에 매우 중요한 역할을 합니다.

### 이벤트 기록

CloudTrail은 AWS 콘솔, AWS SDK, 명령줄 인터페이스(CLI) 또는 기타 AWS 서비스에 의해 수행되는 모든 작업(예: 인스턴스 시작, S3 버킷 생성, IAM 사용자 권한 변경 등)을 **이벤트**로 기록합니다.

각 이벤트에는 다음과 같은 정보가 포함됩니다:

- **누가(Who):** API를 호출한 사용자 또는 서비스
- **무엇을(What):** 호출된 API 작업(예: `RunInstances`, `CreateBucket`)
- **언제(When):** 작업이 발생한 시간
- **어디서(Where):** 요청이 발생한 IP 주소

### 감사 및 규정 준수

CloudTrail 로그는 보안 침해를 조사하거나 규정 준수 요건을 충족하는 데 필수적입니다. 계정 내에서 발생한 의심스러운 활동을 추적하고, 리소스에 대한 무단 변경이 있었는지 확인할 수 있습니다.

|서비스|주요 기능|용도|
|---|---|---|
|**CloudWatch**|메트릭, 로그, 이벤트 관리|성능 모니터링, 로그 분석|
|**X-Ray**|분산 애플리케이션 추적|문제 해결, 성능 병목 현상 파악|
|**CloudTrail**|API 호출 기록 및 감사|보안 모니터링, 규정 준수|

이 세 가지 서비스를 함께 사용하면 AWS 환경에서 발생하는 모든 상황을 완벽하게 파악하고, 신속하게 대응하며, 애플리케이션의 안정성과 보안을 지속적으로 향상시킬 수 있습니다.