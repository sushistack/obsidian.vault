
AWS λλ‹¤(Lambda)λ” μ„λ²„λ¦¬μ¤ μ• ν”λ¦¬μΌ€μ΄μ…μ ν•µμ‹¬ κµ¬μ„± μ”μ†μ…λ‹λ‹¤. λλ‹¤ ν•¨μλ¥Ό μ΄μ ν™κ²½μ— λ°°ν¬ν•  λ•, μƒλ΅μ΄ λ²„μ „μ„ ν• λ²μ— λ¨λ‘ μ μ©ν•λ” κ²ƒμ€ μ„ν—ν•  μ μμµλ‹λ‹¤. μ΄λ• **AWS CodeDeploy**λ¥Ό μ‚¬μ©ν•λ©΄ λλ‹¤ λ³„μΉ­(Alias)μ— λ€ν• νΈλν”½ μ΄λ™μ„ μλ™ν™”ν•μ—¬ μ•μ „ν•κ³  μ μ§„μ μΌλ΅ λ°°ν¬ν•  μ μμµλ‹λ‹¤. μ΄ μ•„ν‹°ν΄μ€ CodeDeployμ μ£Όμ” λ°°ν¬ μ „λµκ³Ό λ΅¤λ°± λ©”μ»¤λ‹μ¦μ— λ€ν•΄ μƒμ„Έν μ„¤λ…ν•©λ‹λ‹¤.

---

## π€ λλ‹¤ λ°°ν¬μ κΈ°λ³Έ: λ²„μ „κ³Ό λ³„μΉ­

λλ‹¤ ν•¨μλ¥Ό λ°°ν¬ν•  λ•λ” **λ²„μ „(Version)**κ³Ό **λ³„μΉ­(Alias)**μ΄λΌλ” κ°λ…μ„ μ‚¬μ©ν•©λ‹λ‹¤.

- **λ²„μ „(Version):** λλ‹¤ ν•¨μ μ½”λ“λ¥Ό λ³€κ²½ν•  λ•λ§λ‹¤ μƒμ„±λλ” λ¶λ³€(Immutable)μ μ¤λƒ…μƒ·μ…λ‹λ‹¤.
    
- **λ³„μΉ­(Alias):** νΉμ • λ²„μ „ λλ” μ—¬λ¬ λ²„μ „μ„ κ°€λ¦¬ν‚¤λ” ν¬μΈν„° μ—­ν• μ„ ν•©λ‹λ‹¤. μ΄μ ν™κ²½μ—μ„λ” λ³„μΉ­μ„ μ‚¬μ©ν•΄ νΈλν”½μ„ κ΄€λ¦¬ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, `PROD` λ³„μΉ­μ΄ `v1` λ²„μ „μ„ κ°€λ¦¬ν‚¤λ„λ΅ μ„¤μ •ν•  μ μμµλ‹λ‹¤.

μƒλ΅μ΄ κΈ°λ¥μ΄ μ¶”κ°€λ `v2` λ²„μ „μ„ λ°°ν¬ν•  λ•, `PROD` λ³„μΉ­μ νΈλν”½μ„ `v1`μ—μ„ `v2`λ΅ μ®κΈ°λ” μ‘μ—…μ΄ ν•„μ”ν•©λ‹λ‹¤. CodeDeployλ” μ΄ νΈλν”½ μ „ν™ κ³Όμ •μ„ μλ™ν™”ν•κ³  ν†µμ ν•©λ‹λ‹¤.

---

## π“ AWS CodeDeployμ λ°°ν¬ μ „λµ

![[Pasted image 20250902222833.png]]

CodeDeployλ” μ•μ „ν• λ°°ν¬λ¥Ό μ„ν•΄ λ‹¤μ–‘ν• νΈλν”½ μ „ν™ μ „λµμ„ μ κ³µν•©λ‹λ‹¤. μ΄λ” ν¬κ² μ„Έ κ°€μ§€λ΅ λ¶„λ¥ν•  μ μμµλ‹λ‹¤.

### 1. **μ„ ν• (Linear) λ°°ν¬**

μ„ ν• λ°°ν¬λ” μ§€μ •λ μ‹κ°„ κ°„κ²©μΌλ΅ νΈλν”½μ„ μΌμ • λΉ„μ¨μ”© μ¦κ°€μ‹ν‚¤λ” λ°©μ‹μ…λ‹λ‹¤. μ΄ μ „λµμ€ μ‹ κ· λ²„μ „μ— λ€ν• νΈλν”½ μ¦κ°€λ¥Ό μ²μ²ν λ¨λ‹ν„°λ§ν•λ©΄μ„ μ§„ν–‰ν•κΈ° λ•λ¬Έμ— μ•μ •μ„±μ„ λ†’μΌ μ μμµλ‹λ‹¤.

- **Linear10PercentEvery3Minutes:** 3λ¶„λ§λ‹¤ νΈλν”½μ„ 10%μ”© μ¦κ°€μ‹ν‚µλ‹λ‹¤.
    
    - **μμ‹:** `v1`μ— 100% νΈλν”½μ΄ μμ„ λ•, λ°°ν¬ μ‹μ‘ ν›„ 3λ¶„μ΄ μ§€λ‚λ©΄ `v2`μ— 10%μ νΈλν”½μ„ ν• λ‹Ήν•κ³ , 90%λ” `v1`μ— μ μ§€ν•©λ‹λ‹¤. λ‹¤μ 3λ¶„μ΄ μ§€λ‚λ©΄ `v2`μ νΈλν”½μ€ 20%λ΅ λμ–΄λ‚κ³ , `v1`μ€ 80%κ°€ λ©λ‹λ‹¤. μ΄ κ³Όμ •μ„ `v2`κ°€ 100%λ¥Ό μ°¨μ§€ν•  λ•κΉμ§€ λ°λ³µν•©λ‹λ‹¤.
        
- **Linear10PercentEvery10Minutes:** 10λ¶„λ§λ‹¤ νΈλν”½μ„ 10%μ”© μ¦κ°€μ‹ν‚µλ‹λ‹¤.
    

### 2. **μΉ΄λ‚λ¦¬ (Canary) λ°°ν¬**

μΉ΄λ‚λ¦¬ λ°°ν¬λ” λ¨Όμ € μ†μμ μ‚¬μ©μμ—κ²λ§ μ‹ κ· λ²„μ „μ„ λ…Έμ¶ν• ν›„, λ¬Έμ κ°€ μ—†λ‹¤κ³  νλ‹¨λλ©΄ ν• λ²μ— λ¨λ“  νΈλν”½μ„ μ „ν™ν•λ” λ°©μ‹μ…λ‹λ‹¤. μ‹ κ· λ²„μ „μ— λ€ν• μ΄κΈ° ν”Όλ“λ°±μ„ λΉ λ¥΄κ² μ–»μ„ μ μμ–΄ μ„ν—μ„ μµμ†ν™”ν•  μ μμµλ‹λ‹¤.

- **Canary10Percent5Minutes:** 5λ¶„ λ™μ• νΈλν”½μ 10%λ§ `v2`λ΅ μ „ν™ν•©λ‹λ‹¤.
    
    - **μμ‹:** λ°°ν¬ μ‹μ‘ ν›„ 5λ¶„ λ™μ• `v2`μ— 10%μ νΈλν”½μ΄ ν• λ‹Ήλκ³ , λ‚λ¨Έμ§€ 90%λ” `v1`μ— μ μ§€λ©λ‹λ‹¤. μ΄ 5λ¶„ λ™μ• μ΄μƒμ΄ μ—†λ‹¤κ³  νλ‹¨λλ©΄, μ¦‰μ‹ `v2`λ΅ νΈλν”½μ„ 100% μ „ν™ν•©λ‹λ‹¤.
        
- **Canary10PercentEvery30Minutes:** 30λ¶„ λ™μ• 10%μ νΈλν”½μ„ `v2`λ΅ μ „ν™ν• ν›„, λ‚λ¨Έμ§€ νΈλν”½μ„ ν• λ²μ— μ „ν™ν•©λ‹λ‹¤.

### 3. **μ¦‰μ‹ (AllAtOnce) λ°°ν¬**

μ΄ μ „λµμ€ νΈλν”½μ„ ν• λ²μ— 100% μ „ν™ν•λ” κ°€μ¥ λΉ λ¥΄κ³  λ‹¨μν• λ°©μ‹μ…λ‹λ‹¤. κ°λ° ν™κ²½μ΄λ‚ μ¶©λ¶„ν ν…μ¤νΈλ ν•¨μμ— μ ν•©ν•μ§€λ§, λ¬Έμ κ°€ λ°μƒν•λ©΄ λ¨λ“  μ‚¬μ©μμ—κ² μν–¥μ„ λ―ΈμΉ  μ μμ–΄ μ„ν—λ„κ°€ λ†’μµλ‹λ‹¤.

---

## π”„ λ΅¤λ°± (Rollback) λ©”μ»¤λ‹μ¦

CodeDeployλ” λ°°ν¬ κ³Όμ •μ—μ„ λ¬Έμ κ°€ λ°μƒν–μ„ λ• μλ™μΌλ΅ μ΄μ „ λ²„μ „μΌλ΅ λλλ¦¬λ” **λ΅¤λ°±** κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. μ΄ κΈ°λ¥μ€ `μ‚¬μ „(Pre)` λ° `μ‚¬ν›„(Post)` νΈλν”½ ν›„ν¬(Hooks)λ¥Ό μ‚¬μ©ν•μ—¬ κµ¬ν„λ©λ‹λ‹¤.

### **νΈλν”½ ν›„ν¬(Hooks)μ™€ CloudWatch μ•λ**

- **μ‚¬μ „ νΈλν”½ ν›„ν¬ (Pre-traffic Hooks):** νΈλν”½μ„ μ „ν™ν•κΈ° μ „μ— μ‹¤ν–‰λλ” λλ‹¤ ν•¨μμ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ‹ κ· λ²„μ „μ λλ‹¤ ν•¨μλ¥Ό νΈμ¶ν•μ—¬ κΈ°λ³Έ λ™μ‘μ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.
    
- **μ‚¬ν›„ νΈλν”½ ν›„ν¬ (Post-traffic Hooks):** νΈλν”½μ΄ μ„±κ³µμ μΌλ΅ μ „ν™λ ν›„μ— μ‹¤ν–‰λλ” λλ‹¤ ν•¨μμ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ‹ κ· λ²„μ „μ μ„±λ¥ λ° κ±΄κ°• μƒνƒλ¥Ό ν™•μΈν•λ” μ½”λ“λ¥Ό μ‹¤ν–‰ν•  μ μμµλ‹λ‹¤.
    

λ§μ•½ νΈλν”½ ν›„ν¬κ°€ μ‹¤ν¨ν•κ±°λ‚, μ„¤μ •λ **Amazon CloudWatch μ•λ**μ΄ λ°°ν¬ λ„μ¤‘ λ¬Έμ κ°€ λ°μƒν–λ‹¤κ³  κ°μ§€ν•λ©΄ CodeDeployλ” λ°°ν¬λ¥Ό μ¤‘λ‹¨ν•κ³  μλ™μΌλ΅ λ΅¤λ°±μ„ μ‹μ‘ν•©λ‹λ‹¤. λ΅¤λ°±μ΄ μ§„ν–‰λλ©΄ `v2`λ΅ μ΄λ™ν–λ νΈλν”½μ€ λ‹¤μ‹ `v1`μΌλ΅ 100% λλλ ¤μ§‘λ‹λ‹¤.

---

## π› οΈ SAM(Serverless Application Model)κ³Όμ μ—°λ™

AWS SAM ν”„λ μ„μ›ν¬λ” CodeDeployμ™€ ν†µν•©λμ–΄ μμ–΄ YAML νμΌμ„ ν†µν•΄ λ°°ν¬ μ „λµμ„ μ†μ‰½κ² μ •μν•  μ μμµλ‹λ‹¤. SAM ν…ν”λ¦Ώμ `Resources` μ„Ήμ…μ— `AWS::Serverless::Function`μ„ μ •μν•  λ• `AutoPublishAlias` λ° `DeploymentPreference` μ†μ„±μ„ μ¶”κ°€ν•μ—¬ CodeDeployλ¥Ό ν™μ„±ν™”ν•  μ μμµλ‹λ‹¤.

```YAML
Resources:
  MyLambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: my-function-code/
      Handler: app.handler
      Runtime: nodejs16.x
      AutoPublishAlias: Live
      DeploymentPreference:
        Type: Canary10Percent5Minutes
        Alarms:
          - !Ref MyCloudWatchAlarm
        Hooks:
          PreTraffic: !Ref PreTrafficHookFunction
          PostTraffic: !Ref PostTrafficHookFunction
```

μ΄ μ½”λ“λ” `Live`λΌλ” λ³„μΉ­μ„ μλ™μΌλ΅ μƒμ„±ν•κ³ , **μΉ΄λ‚λ¦¬10% 5λ¶„** λ°°ν¬ μ „λµμ„ μ μ©ν•©λ‹λ‹¤. λ°°ν¬ μ¤‘ `MyCloudWatchAlarm` μ•λμ„ λ¨λ‹ν„°λ§ν•λ©°, μ‚¬μ „/μ‚¬ν›„ νΈλν”½ ν›„ν¬λ΅ `PreTrafficHookFunction` λ° `PostTrafficHookFunction`μ„ μ‚¬μ©ν•λ„λ΅ μ„¤μ •ν•©λ‹λ‹¤.

---

## π“ AppSpec.yml μ£Όμ” νλΌλ―Έν„°

CodeDeployλ¥Ό μ§μ ‘ μ‚¬μ©ν•  κ²½μ°, `AppSpec.yml` νμΌμ„ ν†µν•΄ λ°°ν¬ μ„¤μ •μ„ μ •μν•©λ‹λ‹¤. λλ‹¤ λ°°ν¬λ¥Ό μ„ν• μ£Όμ” νλΌλ―Έν„°λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

|νλΌλ―Έν„°|μ„¤λ…|
|---|---|
|**Name**|λ°°ν¬ν•  λλ‹¤ ν•¨μμ μ΄λ¦„.|
|**Alias**|νΈλν”½μ„ μ „ν™ν•  λλ‹¤ λ³„μΉ­μ μ΄λ¦„. **(ν•„μ)**|
|**CurrentVersion**|ν„μ¬ νΈλν”½μ„ μ²λ¦¬ μ¤‘μΈ λλ‹¤ λ²„μ „.|
|**TargetVersion**|νΈλν”½μ„ μ΄λ™μ‹ν‚¬ λ©ν‘ λλ‹¤ λ²„μ „.|

CodeDeployλ” `CurrentVersion`μ—μ„ `TargetVersion`μΌλ΅ μ§€μ •λ λ°°ν¬ μ „λµμ— λ”°λΌ λ³„μΉ­μ νΈλν”½μ„ μ μ§„μ μΌλ΅ μ—…λ°μ΄νΈν•©λ‹λ‹¤. μ΄λ¬ν• ν†µν•©μ„ ν†µν•΄ λλ‹¤ λ°°ν¬μ μ•μ •μ„±κ³Ό μ‹ λΆ°μ„±μ„ ν¬κ² ν–¥μƒμ‹ν‚¬ μ μμµλ‹λ‹¤.