
Amazon DynamoDB 스트림은 DynamoDB 테이블에서 발생하는 **항목 수준의 모든 변경 사항(생성, 수정, 삭제)**을 순서대로 기록하는 기능입니다. 이 스트림은 데이터베이스의 변화를 실시간으로 추적하고, 이를 기반으로 다양한 애플리케이션 로직을 구현할 수 있게 해주는 핵심적인 AWS 서비스입니다.

---

## 💡 DynamoDB 스트림의 기본 개념

- **변경 기록**: DynamoDB 스트림은 테이블에서 항목이 변경될 때마다 생성되는 이벤트 레코드들의 정렬된 목록입니다.
    
- **데이터 보존 기간**: 스트림에 기록된 데이터는 **최대 24시간** 동안만 보존됩니다. 따라서 장기적인 보관이 필요하다면 AWS Kinesis Data Streams와 같은 다른 서비스에 데이터를 전달해야 합니다.
    
- **자동 관리**: DynamoDB 스트림은 Kinesis Data Streams와 유사하게 샤드(shard)로 구성되지만, 샤드 프로비저닝은 AWS가 자동으로 관리하므로 사용자는 용량 관리에 신경 쓸 필요가 없습니다.
    

---

## 🎯 주요 활용 사례

![[Pasted image 20250903221342.png]]

DynamoDB 스트림을 사용하면 데이터 변경에 실시간으로 반응하는 강력한 아키텍처를 구축할 수 있습니다.

1. **실시간 분석**: 스트림 데이터를 Amazon Redshift나 Amazon S3로 전송하여 분석 쿼리를 실행하거나 데이터 웨어하우스를 구축할 수 있습니다.
    
2. **데이터 동기화 및 복제**: DynamoDB 스트림을 사용하여 다른 DynamoDB 테이블(예: 파생 테이블)에 데이터를 복제하거나, AWS OpenSearch Service에 데이터를 전송하여 검색 기능을 제공할 수 있습니다.
    
3. **글로벌 테이블 구현**: **DynamoDB 글로벌 테이블**은 스트림을 기반으로 여러 AWS 리전 간에 데이터를 자동으로 복제하여 높은 가용성을 제공합니다.
    
4. **알림 및 메시징**: Lambda 함수를 트리거하여 데이터 변경 시 사용자에게 알림 이메일이나 SNS 메시지를 보낼 수 있습니다.
    
5. **커스텀 로직 실행**: Kinesis Client Library(KCL) 애플리케이션이나 Lambda 함수를 사용하여 스트림의 데이터를 읽고, 비즈니스 로직을 적용한 후 다른 서비스로 데이터를 전달할 수 있습니다.
    

---

## 📦 스트림 레코드의 정보 구성

스트림 레코드에는 변경된 항목에 대한 정보가 포함됩니다. 사용자는 스트림 활성화 시 어떤 정보를 포함할지 선택할 수 있습니다.

|설정 값|포함되는 정보|
|---|---|
|**`KEYS_ONLY`**|변경된 항목의 기본 키(Partition Key + Sort Key)만 포함|
|**`NEW_IMAGE`**|변경 후 항목의 전체 모습|
|**`OLD_IMAGE`**|변경 전 항목의 전체 모습|
|**`NEW_AND_OLD_IMAGES`**|변경 전과 후의 항목 전체 모습 모두 포함. 어떤 속성이 변경되었는지 비교하는 데 유용함|

---

## 🔗 DynamoDB 스트림과 Lambda 함수 연동

Lambda 함수는 DynamoDB 스트림을 처리하는 가장 일반적인 방법입니다.

- **이벤트 소스 매핑(Event Source Mapping)**: Lambda 함수가 DynamoDB 스트림을 읽을 수 있도록 연결해주는 내부 프로세스입니다.
    
- **작동 방식**:
    
    1. 이벤트 소스 매핑이 DynamoDB 스트림에서 **배치(batch)** 단위로 레코드를 가져옵니다.
        
    2. 가져온 레코드를 Lambda 함수로 전달하여 함수를 **동기적으로** 호출합니다.
        
    3. Lambda 함수는 전달받은 레코드 배치에 포함된 데이터에 대해 정의된 로직을 실행합니다.
        
- **시험 팁**: DynamoDB 스트림을 활성화하더라도, 이미 존재하는 데이터는 스트림에 기록되지 않습니다. 스트림은 활성화 시점 이후에 발생하는 변경 사항만 캡처합니다.