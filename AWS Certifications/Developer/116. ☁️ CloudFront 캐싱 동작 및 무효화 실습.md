
이번 실습에서는 CloudFront 배포의 캐싱 동작(Cache Behavior)과 캐시 무효화(Invalidation) 기능을 직접 설정하고 테스트해 보겠습니다. 이 과정을 통해 콘텐츠의 캐싱 정책을 제어하고, 원본(Origin)이 업데이트되었을 때 캐시를 강제로 갱신하는 방법을 이해할 수 있습니다.

---

### 1. 캐싱 정책 설정 및 이해 🔑

CloudFront 배포의 캐시 동작을 통해 TTL(Time To Live), 캐시 키(Cache Key), 원본 요청 정책(Origin Request Policy)을 세밀하게 제어할 수 있습니다.

1. **캐시 동작 편집:** CloudFront 배포의 `동작(Behaviors)` 탭에서 기본 동작(`/*`)을 선택하고 `편집(Edit)`을 클릭합니다.

2. **캐시 정책:** `캐시 정책(Cache policy)` 섹션에서 `정책 생성(Create policy)`을 선택하여 새로운 캐시 정책을 만들 수 있습니다.
    - **TTL 설정:** `TTL 설정`에서 최소, 최대, 기본 TTL을 설정하여 캐시 유효 기간을 제어합니다.
    - **캐시 키 설정:** `캐시 키 설정`에서 **헤더(Headers)**, **쿼리 스트링(Query strings)**, **쿠키(Cookies)** 중 어떤 요소를 캐시 키에 포함시킬지 지정합니다. 캐시 키에 포함된 요소는 원본 요청으로도 전달됩니다.

3. **원본 요청 정책:** `원본 요청 정책(Origin request policy)`은 캐시 키에는 포함되지 않지만, 원본 서버로 전달해야 하는 추가적인 헤더, 쿼리 스트링, 쿠키를 정의합니다.

> **예시:** `/images/*` 경로에 대한 별도의 캐시 동작을 생성하여, 이미지 파일에 대한 캐싱 정책을 기본 동작과 다르게 설정할 수 있습니다.

---

### 2. 캐시 무효화 실습 🔄

원본 파일이 업데이트되었을 때, CloudFront 캐시가 자동으로 갱신되지 않는 문제를 해결하기 위해 캐시 무효화를 수행합니다.

1. **원본 파일 업데이트:** S3 버킷에 있는 `index.html` 파일을 수정합니다. 예를 들어, "I really love coffee"라는 문장을 "I really love coffee every morning"으로 변경합니다.

2. **S3에 파일 업로드:** 수정한 `index.html` 파일을 S3 버킷에 다시 업로드합니다.

3. **캐시 동작 확인:**
    - S3 객체 URL을 통해 파일에 직접 접근하면 업데이트된 내용이 즉시 보입니다.
    - 하지만 CloudFront URL로 접속하면 여전히 이전 내용이 표시됩니다.
    - 이는 CloudFront가 기존 TTL(예: 1일)에 따라 이전 버전을 캐싱하고 있기 때문입니다.

4. **무효화 요청:** CloudFront 배포의 `무효화(Invalidations)` 탭으로 이동합니다.
    - `무효화 생성(Create invalidation)`을 클릭합니다.
    - **경로:** `/*` (와일드카드)를 입력하여 배포의 모든 캐시를 무효화합니다.
    - `무효화 생성`을 클릭합니다.

5. **결과 확인:** 무효화 작업이 완료된 후 CloudFront URL을 새로고침하면, S3에서 새로 가져온 "I really love coffee every morning"이 표시되는 것을 확인할 수 있습니다.

**결론:** 이 실습을 통해 캐시 무효화는 원본 콘텐츠 업데이트 시, CloudFront 캐시의 TTL 만료를 기다리지 않고 즉시 최신 콘텐츠를 배포하는 핵심적인 방법임을 확인했습니다. 이는 긴급한 콘텐츠 변경 시 유용하게 사용됩니다.