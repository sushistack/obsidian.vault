
이번 실습에서는 S3 버킷에 저장된 정적 콘텐츠를 CloudFront를 통해 전 세계 사용자에게 빠르게 배포하는 방법을 알아보겠습니다. 특히, 버킷을 공개하지 않고 CloudFront와 S3 간의 접근을 안전하게 연결하는 **OAC(Origin Access Control)** 설정에 중점을 둡니다.

---

### 1. S3 버킷 및 파일 업로드 📤

먼저, CloudFront가 배포할 콘텐츠를 저장할 S3 버킷을 생성합니다.

1. **버킷 생성:** `demo-cloudfront-stephane-v4`와 같이 고유한 이름의 버킷을 생성합니다.
2. **파일 업로드:** `index.html`, `coffee.jpeg`, `beach.jpeg` 세 파일을 버킷에 업로드합니다.
3. **접근 확인:**
    - 객체 URL을 통해 `index.html`에 접근을 시도하면 `Access Denied` 오류가 발생합니다. 이는 버킷이 비공개이기 때문입니다.

    - S3 콘솔의 `열기(Open)` 버튼을 클릭하면 사전 서명된 URL을 통해 `index.html`을 볼 수 있지만, 이미지 파일은 여전히 비공개이므로 표시되지 않습니다.


---

### 2. CloudFront 배포 생성 및 OAC 설정 ⚙️

이제 S3 버킷을 원본(Origin)으로 하는 CloudFront 배포를 생성합니다. 이때, 버킷을 공개하지 않고도 CloudFront가 버킷에 접근할 수 있도록 **OAC(Origin Access Control)**를 사용합니다.

1. **CloudFront 콘솔**로 이동합니다. (CloudFront는 글로벌 서비스이므로 리전 선택이 없습니다.)
2. `배포 생성(Create distribution)`을 클릭합니다.
3. **원본 도메인(Origin domain):** 드롭다운 목록에서 생성한 S3 버킷(`demo-cloudfront-stephane-v4`)을 선택합니다.
4. **원본 액세스(Origin access):** `원본 액세스 제어 설정(Origin access control settings, OAC)`을 선택합니다.
5. **OAC 생성:** `컨트롤 설정 생성(Create control setting)` 버튼을 클릭하여 새 OAC를 생성합니다.
6. **루트 객체 설정:** `기본 루트 객체(Default root object)`에 `index.html`을 입력합니다. (사용자가 도메인 루트 URL로 접근했을 때 표시될 파일)
7. `배포 생성(Create distribution)`을 클릭합니다.

---

### 3. S3 버킷 정책 업데이트 🔑

CloudFront 배포가 생성된 후, CloudFront가 S3 버킷의 객체를 읽을 수 있도록 버킷 정책을 업데이트해야 합니다.

1. CloudFront 배포 생성 완료 후, `원본 액세스 제어(Origin access control)` 섹션의 메시지에서 `정책 복사(Copy policy)` 버튼을 클릭합니다.
2. S3 콘솔에서 버킷의 `권한(Permissions)` 탭으로 이동합니다.
3. `버킷 정책(Bucket policy)` 섹션에서 `편집(Edit)`을 클릭하고, 복사한 정책을 붙여넣습니다.
4. 정책을 저장하면, CloudFront 서비스가 특정 배포 ID를 통해서만 버킷의 객체에 `GetObject` 요청을 보낼 수 있게 됩니다.

---

### 4. CloudFront 배포 확인 ✅

CloudFront 배포가 완전히 배포되기까지는 시간이 걸릴 수 있습니다. 배포가 `Deployed` 상태가 되면, 도메인 이름을 통해 콘텐츠에 접근합니다.

1. CloudFront 배포 목록에서 생성된 배포의 **도메인 이름(Distribution domain name)**을 복사합니다.
2. 웹 브라우저에 도메인 이름을 붙여넣습니다.
3. **결과:** "I love Coffee, Hello World" 메시지와 함께 `coffee.jpeg`와 `beach.jpeg` 이미지가 모두 정상적으로 표시됩니다.
4. URL 뒤에 `/coffee.jpeg`나 `/beach.jpeg`를 추가하여 개별 파일에 직접 접근하는 것도 가능합니다.

이 실습을 통해 CloudFront가 S3 콘텐츠를 효율적으로 배포하는 방법과 OAC를 사용하여 보안을 강화하는 과정을 직접 경험했습니다. 이제 S3 버킷을 공개하지 않고도 전 세계 사용자에게 정적 웹사이트를 안전하게 제공할 수 있습니다.