
이번 가이드에서는 Amazon API Gateway가 백엔드 서비스와 연동되는 다양한 **통합 유형(Integration Type)**에 대해 상세히 알아보겠습니다. API Gateway는 단순히 요청을 전달하는 것을 넘어, 요청과 응답을 자유롭게 변형하는 강력한 기능을 제공합니다.

---

## 🚀 1단계: 프록시 통합(Proxy Integration) vs. 비프록시 통합(Non-Proxy Integration)

API Gateway의 통합 유형은 크게 **프록시(Proxy)**와 **비프록시(Non-Proxy)**로 나뉩니다. 이 두 가지 방식은 요청/응답 처리 방식에서 명확한 차이를 보입니다.

### 🧩 비프록시 통합 (Custom/Mapping Integration)

- **특징**: API Gateway가 요청을 백엔드로 보내기 전에 **요청 데이터(헤더, 쿼리 파라미터, 바디)**를 변경하거나 **응답 데이터**를 변형할 수 있습니다.
    
- **작동 방식**: **매핑 템플릿(Mapping Templates)**을 사용하여 요청을 백엔드가 이해할 수 있는 형식으로 변환하고, 백엔드의 응답을 클라이언트가 원하는 형식으로 다시 변환합니다.
    
- **사용 예시**: REST API(JSON)를 호출하여 SOAP API(XML) 백엔드와 통신해야 할 때, 또는 쿼리 파라미터 이름을 백엔드의 요구사항에 맞게 변경해야 할 때 유용합니다.
    
- **단점**: 모든 매핑을 수동으로 설정해야 하므로 설정이 복잡하고 시간이 많이 소요됩니다.
    

### ➡️ 프록시 통합 (Proxy Integration)

![[Pasted image 20250907193831.png]]

- **특징**: API Gateway가 클라이언트의 요청을 백엔드에 **있는 그대로(as-is)** 전달하고, 백엔드의 응답을 **있는 그대로** 클라이언트에 반환합니다. 중간에서 요청/응답을 수정할 수 없습니다.
    
- **작동 방식**: API Gateway는 단순한 **프록시 역할**만 수행하며, 모든 비즈니스 로직과 데이터 형식 처리는 백엔드(예: Lambda 함수)에 위임됩니다.
    
- **사용 예시**: 대부분의 서버리스 아키텍처에서 Lambda 함수와 연동할 때 사용됩니다. Lambda 함수가 요청의 모든 정보를 직접 받아 처리하고 응답을 구성합니다.
    
- **장점**: 설정이 매우 간단하며, 유연한 백엔드 로직을 구현할 수 있습니다.

|특징|프록시 통합 (Lambda/HTTP Proxy)|비프록시 통합 (Lambda/HTTP Non-Proxy)|
|---|---|---|
|**요청/응답 변환**|불가능 (있는 그대로 전달)|가능 (매핑 템플릿 사용)|
|**설정 복잡성**|낮음 (매우 간단)|높음 (매핑 템플릿 설정 필요)|
|**주요 역할**|단순 전달자|변환 및 중개자|

---

## 🛠️ 2단계: 매핑 템플릿(Mapping Templates)과 VTL

**매핑 템플릿**은 비프록시 통합에서 요청과 응답을 변환하는 데 사용되는 도구입니다. 이 템플릿은 **Velocity Template Language(VTL)**라는 스크립팅 언어를 기반으로 합니다.

### 📝 매핑 템플릿의 기능

- **데이터 추출**: 요청의 헤더, 쿼리 파라미터, 바디, 경로 등에서 데이터를 추출합니다.
    
- **요청 변환**: 추출한 데이터를 사용하여 백엔드가 요구하는 형식으로 새로운 요청 페이로드(payload)를 생성합니다. 예를 들어, JSON 데이터를 XML 데이터로 변환할 수 있습니다.
    
- **응답 변환**: 백엔드로부터 받은 응답을 클라이언트가 이해할 수 있는 형식으로 다시 변환합니다.

### 💡 매핑 템플릿의 활용 예시

![[Pasted image 20250907193857.png]]
- **REST(JSON)와 SOAP(XML) 간 변환**: JSON 요청을 받아서 SOAP 서비스에 필요한 XML 포맷으로 변환하고, 다시 XML 응답을 JSON으로 변환합니다.

![[Pasted image 20250907194103.png]]
- **쿼리 파라미터 이름 변경**: `?name=foo`와 같은 클라이언트의 요청을 `{"myVariable": "foo"}`와 같이 백엔드 Lambda 함수가 이해하기 쉬운 JSON 객체로 변환합니다.


---

## 🌐 3단계: 다양한 통합 유형 상세 분석

### 1. Mock 통합 (MOCK Integration)

- **특징**: 요청을 백엔드로 보내지 않고, API Gateway 내부에서 미리 정의된 응답을 즉시 반환합니다.
    
- **용도**: 백엔드 개발이 완료되지 않았을 때, API Gateway의 동작을 테스트하거나 프런트엔드 개발자들이 가짜 응답을 가지고 개발을 진행할 때 유용합니다. **운영 환경에서는 사용하지 않습니다.**
    

### 2. AWS 서비스 통합 (AWS Service Integration)

- **특징**: API Gateway를 통해 직접 AWS 서비스(예: SQS, DynamoDB, SNS)를 호출합니다.
    
- **통합 방식**: 비프록시 방식으로, 매핑 템플릿을 사용하여 클라이언트의 요청을 AWS 서비스 API 호출 형식에 맞게 변환합니다.
    
- **예시**: 클라이언트가 `/message` 엔드포인트에 POST 요청을 보내면, API Gateway가 매핑 템플릿을 통해 SQS Queue에 메시지를 보내는 API 호출로 변환하여 실행합니다.
    

### 3. HTTP 통합 (HTTP Integration)

![[Pasted image 20250907193808.png]]

- **특징**: HTTP/S 엔드포인트로 요청을 전달합니다. 백엔드로는 Application Load Balancer, EC2 인스턴스, 또는 외부 웹사이트가 올 수 있습니다.
    
- **통합 방식**: **프록시**와 **비프록시** 모두 가능합니다.
    
    - **HTTP 프록시**: 요청을 있는 그대로 백엔드에 전달하고 응답을 반환합니다.
        
    - **HTTP 비프록시**: 매핑 템플릿을 사용하여 요청과 응답을 변형합니다. 또한, 클라이언트는 모르는 **API Key**와 같은 추가 HTTP 헤더를 백엔드로 보낼 수 있습니다.
        

### 4. Lambda 함수 통합 (Lambda Function Integration)

- **특징**: 요청을 Lambda 함수로 전달합니다.
    
- **통합 방식**:
    
    - **Lambda 프록시**: 클라이언트의 요청 정보(헤더, 쿼리 파라미터, 바디 등)를 하나의 JSON 객체(**이벤트 객체**)로 묶어 Lambda 함수에 전달합니다.
        
    - **Lambda 비프록시**: 매핑 템플릿을 통해 요청의 일부 데이터를 추출하여 Lambda 함수로 보냅니다. Lambda 함수의 반환값도 매핑 템플릿을 통해 클라이언트 응답으로 변환할 수 있습니다.
        
    - **참고**: 대부분의 경우, 설정이 간단하고 유연한 **Lambda 프록시 통합**이 선호됩니다.
        

|통합 유형|특징|사용 예시|
|---|---|---|
|**MOCK**|백엔드 없이 즉시 응답|프런트엔드 개발 시 목업 API 제공|
|**AWS Service**|AWS 서비스 직접 호출|SQS에 메시지 넣기, DynamoDB에 데이터 쓰기|
|**HTTP**|HTTP/S 엔드포인트와 통신|웹서버(ALB, EC2), 외부 API 호출|
|**Lambda**|Lambda 함수와 통신|서버리스 백엔드 로직 구현|