
안녕하세요! 이번 아티클에서는 **AWS Lambda 함수를 동기식으로 호출하는 방법**에 대해 자세히 알아보겠습니다. 특히, AWS CloudShell을 활용하여 CLI(Command Line Interface)를 통해 함수를 호출하고 그 결과를 확인하는 과정을 상세히 다룹니다.

### 📜 동기식 호출이란?

**동기식 호출(Synchronous Invocation)**은 호출자가 함수가 실행을 완료하고 결과를 반환할 때까지 기다리는 방식입니다. 이 방식은 UI나 CLI를 통해 직접 함수를 호출하고 결과를 즉시 확인해야 할 때 유용합니다. 만약 Lambda 함수의 실행 시간이 2분이라면, 호출자는 2분 동안 대기한 후 최종 결과를 받게 됩니다.

|특징|설명|
|---|---|
|**호출 방식**|호출자가 Lambda 함수가 완료될 때까지 기다림|
|**사용 사례**|웹 애플리케이션의 API Gateway, CLI를 통한 테스트 등|
|**결과 확인**|함수 실행 완료 후 즉시 반환된 결과를 받음|
|**장점**|실행 결과를 즉시 확인 가능하며, 디버깅에 용이함|

---

### 🖥️ CloudShell을 이용한 실습 준비

AWS CloudShell은 브라우저에서 바로 사용할 수 있는 셸 환경으로, AWS CLI가 사전 설치되어 있어 별도의 설정 없이 바로 사용할 수 있습니다. 만약 CloudShell이 지원되지 않는 리전이라면, 로컬 터미널에 AWS CLI를 설치하여 진행할 수 있습니다.

#### 1. CloudShell 실행

AWS 관리 콘솔에서 CloudShell을 실행합니다. CloudShell이 실행되면 AWS CLI가 이미 설치되어 있는지 확인할 수 있습니다.

```Bash
aws --version
```

위 명령어를 입력하면 AWS CLI 버전 정보가 출력됩니다. 이 예제에서는 **CLI V2 버전**을 기준으로 진행합니다.

#### 2. Lambda 함수 목록 확인

다음으로, 현재 리전에 배포된 Lambda 함수의 목록을 확인합니다.

```Bash
aws lambda list-functions
```

만약 로컬 터미널에서 CLI를 사용한다면, `aws configure`를 통해 리전이 설정되어 있지 않은 경우 `--region` 플래그를 추가해야 합니다.


```Bash
aws lambda list-functions --region us-west-2
```

이 명령어를 실행하면 배포된 함수들의 `FunctionName`, `FunctionArn`, `Runtime` 등의 정보를 확인할 수 있습니다. 이 정보는 다음 단계에서 동기식 호출에 필요합니다.

---

### 🚀 Lambda 함수 동기식 호출하기

이제 AWS CLI를 사용하여 Lambda 함수를 동기식으로 호출해 보겠습니다. `invoke` 명령어를 사용하며, 호출에 필요한 주요 인자들은 다음과 같습니다.

- `--function-name`: 호출할 Lambda 함수의 이름
- `--payload`: 함수에 전달할 JSON 형식의 입력 데이터
- `--cli-binary-format`: 페이로드 형식을 지정하는 옵션 (CLI v2에서 필요)
- `response.json`: 함수의 응답 결과를 저장할 파일 이름

#### 1. `invoke` 명령어 구조

아래는 동기식 호출을 위한 기본적인 CLI 명령어 형식입니다.

```Bash
aws lambda invoke \
    --function-name <함수_이름> \
    --cli-binary-format raw-in-base64-out \
    --payload '{"key1": "value1"}' \
    response.json
```

**✅ 명령어 상세 설명**

|인자|설명|
|---|---|
|`invoke`|Lambda 함수를 호출하는 CLI 명령어|
|`--function-name`|호출할 Lambda 함수의 이름 (예: `demo-lambda`)|
|`--cli-binary-format`|CLI v2에서 페이로드 형식을 지정하는 옵션. `raw-in-base64-out`을 사용하면 JSON 페이로드를 Base64로 인코딩하여 전송합니다.|
|`--payload`|함수에 전달할 JSON 형식의 입력 데이터. 단일 따옴표(`'`)로 감싸야 합니다.|
|`response.json`|함수 호출의 응답을 저장할 파일 이름. 호출 후 이 파일에 결과가 기록됩니다.|

#### 2. 실제 함수 호출 예제

이전 단계에서 확인한 함수 이름을 사용하여 `invoke` 명령어를 실행합니다. 예를 들어, 함수 이름이 `demo-lambda`이고 `{ "key": "value" }`라는 JSON 페이로드를 전달한다고 가정해 보겠습니다.

```Bash
aws lambda invoke \
    --function-name demo-lambda \
    --cli-binary-format raw-in-base64-out \
    --payload '{"key": "value"}' \
    response.json
```

---

### ✅ 호출 결과 확인

명령어가 성공적으로 실행되면, 터미널에는 다음과 같은 결과가 출력됩니다.

```JSON
{
    "StatusCode": 200,
    "ExecutedVersion": "$LATEST"
}
```

- `StatusCode`: HTTP 상태 코드로, `200`은 호출이 성공적으로 완료되었음을 의미합니다.
- `ExecutedVersion`: 실행된 Lambda 함수의 버전을 나타냅니다.

이제 함수의 실제 실행 결과는 `response.json` 파일에 저장됩니다. CloudShell에서 `cat` 명령어를 사용하여 이 파일의 내용을 확인할 수 있습니다.

```Bash
cat response.json
```

위 명령어를 실행하면 Lambda 함수가 반환한 JSON 응답을 볼 수 있습니다. 예를 들어, `{"result": 1}`과 같은 결과가 출력될 수 있습니다.

이것으로 AWS CLI를 사용한 Lambda 함수 동기식 호출 실습을 마칩니다. 동기식 호출은 Lambda 함수의 동작을 직접 테스트하고 디버깅하는 데 매우 유용한 방법입니다.
