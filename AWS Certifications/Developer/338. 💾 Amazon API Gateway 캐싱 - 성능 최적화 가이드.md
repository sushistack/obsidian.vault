
이번 가이드에서는 Amazon API Gateway의 **응답 캐싱(Response Caching)** 기능을 상세히 다루겠습니다. 캐싱은 백엔드 호출 횟수를 줄여 API의 성능을 향상시키고 비용을 절감하는 데 매우 중요한 기술입니다.

---

## 🚀 1단계: API Gateway 캐싱의 기본 원리

API Gateway에 캐싱을 활성화하면, 클라이언트의 요청이 들어왔을 때 백엔드로 직접 전달되지 않고, API Gateway가 먼저 캐시를 확인합니다.

- **캐시 히트(Cache Hit)**: 요청에 대한 응답이 캐시에 이미 저장되어 있으면, API Gateway는 백엔드 호출 없이 즉시 캐시된 결과를 클라이언트에게 반환합니다.
    
- **캐시 미스(Cache Miss)**: 캐시에 결과가 없으면, API Gateway는 백엔드(예: Lambda 함수)를 호출하여 응답을 받은 후, 해당 응답을 캐시에 저장하고 클라이언트에게 반환합니다.
    

### 💰 주요 설정 및 특징

- **캐시 용량**: 0.5GB부터 237GB까지 다양한 용량을 선택할 수 있습니다. 캐싱은 비용이 발생하므로 프로덕션 환경에서 신중하게 사용해야 합니다.
    
- **TTL(Time to Live)**: 캐시된 응답이 유효한 시간입니다. 기본값은 300초(5분)이며, 최소 0초(캐싱 비활성화)에서 최대 3,600초(1시간)까지 설정 가능합니다.
    
- **캐시 암호화**: 캐시 데이터를 암호화하여 보안을 강화할 수 있습니다.
    
- **설정 범위**: 캐싱은 **스테이지(Stage)** 레벨에서 활성화되며, 특정 **메서드(Method)**에 대해서는 개별적으로 설정을 재정의(override)할 수 있습니다.
    

---

## 🛡️ 2단계: 캐시 무효화(Invalidation) 방법

캐시된 데이터는 TTL이 만료될 때까지 유효하지만, 필요에 따라 즉시 무효화(삭제)해야 할 수도 있습니다.

### 📝 캐시 무효화 방법

1. **수동 무효화**: API Gateway 콘솔의 **스테이지** 설정에서 전체 캐시를 즉시 무효화할 수 있습니다.
    
2. **클라이언트 무효화**: 클라이언트가 요청 헤더에 `Cache-Control: max-age=0`을 포함하여 API를 호출하면, 캐시를 무효화할 수 있습니다.
    
    - **보안**: 클라이언트의 무분별한 캐시 무효화를 방지하기 위해 **IAM 권한**을 부여하여 특정 클라이언트만 무효화 요청을 보낼 수 있도록 제한해야 합니다.
        

### ⚠️ 보안 설정

- **무효화 권한 설정**: API Gateway는 `Cache-Control` 헤더를 통해 무효화 요청이 들어왔을 때, 이를 무시하거나, **403 Forbidden** 오류를 반환하거나, 또는 경고 로그만 남기도록 설정할 수 있습니다.
    
- **권한 있는 사용자만 허용**: 무효화 요청 시 **IAM 권한 부여(Require authorization)**를 설정하면, 승인된 사용자만 캐시를 무효화할 수 있어 서비스 안정성을 높일 수 있습니다.
    

---

## 🖥️ 3단계: 캐싱 설정 실습

실제로 API Gateway 콘솔에서 캐싱을 활성화하는 과정을 살펴보겠습니다.

1. **스테이지 설정으로 이동**: 캐싱을 적용할 API의 **스테이지** (예: `prod` 스테이지)를 선택합니다.
    
2. **캐시 설정 편집**: **세부 정보 편집(Edit)**을 클릭한 후, `캐시 설정(Cache Settings)` 섹션으로 이동합니다.
    
3. **캐시 활성화**: `API 캐시 활성화(Enable API Cache)`를 체크합니다.
    
4. **세부 설정**:
    
    - **캐시 용량**: 원하는 용량(예: 0.5GB)을 선택합니다.
        
    - **TTL**: 캐시 유효 시간(예: 300초)을 설정합니다.
        
    - **암호화**: `캐시 데이터 암호화(Encrypt cache data)`를 선택합니다.
        
    - **무효화 권한**: `Cache-Control 헤더가 있을 때 캐시 무효화에 인증 요구(Require authorization for cache invalidation)`를 활성화하고, 무단 요청 시 동작(예: `헤더 무시(Ignore header)`)을 설정합니다.
        
5. **저장**: 설정을 저장하면 해당 스테이지의 모든 API에 캐싱이 적용됩니다.
    

**참고**: 캐싱은 실제 요청이 반복적으로 발생해야 효과를 확인할 수 있습니다. 동일한 URL과 파라미터로 여러 번 호출할 경우, 첫 호출 이후부터는 Lambda 함수가 아닌 캐시에서 응답이 반환되어 응답 속도가 현저히 빨라지는 것을 확인할 수 있습니다.

캐싱은 API 성능과 비용 최적화를 위한 필수적인 기능으로, 특히 요청이 많은 프로덕션 환경에서 큰 가치를 발휘합니다.