
이번 가이드에서는 Amazon API Gateway의 다양한 **보안 옵션**을 상세히 살펴보겠습니다. API Gateway는 여러 계층의 보안 설정을 제공하여 API에 대한 접근을 세밀하게 제어할 수 있습니다.

---

## 🔒 1단계: IAM 권한 부여 및 리소스 정책

API Gateway의 보안은 AWS의 IAM(Identity and Access Management) 시스템과 깊이 통합되어 있습니다.

### 📜 IAM 권한 부여 (IAM Authorization)

- **메서드 요청(Method Request)**: 각 API 메서드(예: GET, POST) 설정에서 **권한 부여(Authorization)**를 **IAM**으로 설정할 수 있습니다.
    
- **작동 원리**: 이 옵션을 활성화하면, API Gateway는 요청을 보내는 주체(IAM 사용자 또는 역할)의 IAM 정책을 확인하여 해당 API를 호출할 권한이 있는지 검증합니다. 이는 주로 동일 AWS 계정 내에서 API를 보호하는 데 사용됩니다.
    

### 📄 리소스 정책 (Resource Policies)

- **개요**: 리소스 정책은 API Gateway 리소스 전체에 적용되는 JSON 기반 정책입니다. IAM 권한 부여가 개별 사용자/역할의 권한을 제어한다면, 리소스 정책은 **API 전체에 대한 접근 규칙**을 정의합니다.
    
- **주요 활용 사례**:
    
    - **교차 계정 접근(Cross-Account Access)**: 다른 AWS 계정의 IAM 사용자나 역할이 API를 호출할 수 있도록 허용합니다.
        
    - **IP 범위 제어**: 특정 IP 주소 범위에 대해서만 API 접근을 허용하거나 거부합니다.
        
    - **VPC 접근 제어**: **프라이빗 API**를 구축하여 특정 VPC(Virtual Private Cloud) 내부에서만 API에 접근할 수 있도록 제한합니다.
        

---

## 🔑 2단계: Authorizer를 통한 인증

IAM을 사용하지 않고 사용자 지정 인증 방식을 적용하려면 **Authorizer**를 사용합니다. API Gateway는 두 가지 유형의 Authorizer를 제공합니다.

### 💻 Lambda Authorizer (커스텀 인증)

- **유연성**: Lambda Authorizer는 가장 유연한 인증 방식입니다. 외부 인증 시스템(예: JWT, OAuth)과 통합하여 복잡한 인증 로직을 구현할 수 있습니다.
    
- **작동 원리**:
    
    1. 클라이언트가 API Gateway를 호출할 때 토큰(Token)을 보냅니다.
        
    2. API Gateway는 이 토큰을 **Lambda Authorizer 함수**에 전달합니다.
        
    3. Lambda 함수는 토큰의 유효성을 검증하고, 유효한 경우 요청에 대한 **IAM 정책**을 생성하여 반환합니다.
        
- **캐싱**: Authorizer 함수의 결과를 캐싱하여 불필요한 Lambda 호출을 줄일 수 있습니다. 이는 성능과 비용을 최적화하는 데 중요합니다.
    

### 👥 Cognito 사용자 풀 (Cognito User Pool)

- **간편성**: Cognito 사용자 풀은 사용자 기반의 인증을 간편하게 구현할 수 있는 완전 관리형 서비스입니다.
    
- **작동 원리**:
    
    1. API Gateway에 **Cognito 사용자 풀**을 Authorizer로 연결합니다.
        
    2. 클라이언트는 Cognito 사용자 풀에서 인증을 거쳐 JWT 토큰을 받습니다.
        
    3. 클라이언트가 이 토큰을 API Gateway에 전달하면, API Gateway가 자동으로 토큰의 유효성을 검증하고 요청을 처리합니다.
        
- **이점**: 별도의 커스텀 코드를 작성할 필요 없이 사용자 인증을 손쉽게 설정할 수 있습니다.
    

|보안 방식|설정 위치|주요 용도|
|---|---|---|
|**IAM 권한 부여**|메서드 요청|AWS 계정 내에서 API 접근 제어|
|**리소스 정책**|API 설정|교차 계정/IP/VPC 접근 제어|
|**Lambda Authorizer**|Authorizer|제3자 인증 시스템 통합, 커스텀 로직|
|**Cognito Authorizer**|Authorizer|Cognito 사용자 기반 인증|

이처럼 API Gateway는 IAM, 리소스 정책, 그리고 Authorizer를 통해 다양한 시나리오에 맞는 강력한 보안 체계를 구축할 수 있도록 지원합니다.