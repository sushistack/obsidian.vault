

람다 함수의 **버전(Versions)**과 **별칭(Aliases)**은 코드 배포를 체계적으로 관리하고, 안전하게 업데이트를 수행하는 데 필수적인 기능입니다. 이 실습에서는 간단한 함수를 통해 버전과 별칭을 생성하고, 카나리 배포(canary deployments)를 시뮬레이션하는 방법을 살펴봅니다.

---

## 1. 람다 버전 생성: 코드 고정하기 📝

버전은 특정 시점의 코드와 설정을 변경 불가능한 상태로 저장하는 스냅샷입니다.

### 1단계: `$LATEST` 버전 작성

`lambda-version-demo`라는 새 람다 함수를 생성합니다. 핸들러 함수가 "this is version one." 문자열을 반환하도록 코드를 작성하고 배포합니다.

```Python
def lambda_handler(event, context):
    return "this is version one."
```

### 2단계: 버전 1 발행

코드가 올바르게 작동하는 것을 확인한 후, **`Actions`** > **`Publish new version`**을 클릭합니다. 설명(Description)을 추가하고 **`Publish`**하면, 함수는 `Version 1`로 저장되며, 이 코드는 더 이상 수정할 수 없습니다.

### 3단계: `$LATEST` 버전 수정 및 버전 2 발행

함수의 `$LATEST` 버전으로 돌아가 코드를 "this is version two."로 수정하고 배포합니다. 이 과정을 반복하여 `Version 2`를 발행합니다.

## 2. 람다 별칭 생성: 유연한 엔드포인트 만들기 📍

별칭은 특정 버전을 가리키는 포인터 역할을 하며, 배포 관리를 유연하게 해줍니다.

### 1단계: 별칭 생성

람다 함수의 **`Aliases`** 탭으로 이동하여 다음 별칭을 생성합니다.

- **`dev`**: **`$LATEST`** 버전을 가리키도록 설정합니다. 개발 단계에서 항상 최신 코드를 테스트할 때 사용합니다.
    
- **`test`**: **`Version 2`**를 가리키도록 설정합니다. 테스트 환경의 안정적인 코드를 나타냅니다.
    
- **`prod`**: **`Version 1`**을 가리키도록 설정합니다. 현재 운영 환경에서 사용되는 안정적인 코드를 나타냅니다.

### 2단계: 별칭 테스트

각 별칭을 선택하고 함수를 테스트하여 올바른 버전의 코드가 반환되는지 확인합니다.

- **`prod`** 별칭 테스트: "this is version one." 반환
    
- **`test`** 별칭 테스트: "this is version two." 반환
    

---

## 3. 카나리 배포(Canary Deployment) 시뮬레이션 🚀

별칭의 가장 강력한 기능 중 하나는 트래픽을 여러 버전으로 분산하여 카나리 배포를 수행하는 것입니다.

### 1단계: 가중치(Weighted) 별칭 설정

`prod` 별칭을 편집합니다. `Version 1`에서 `Version 2`로 안전하게 업데이트하기 위해 다음과 같이 가중치를 설정합니다.

|버전|가중치|
|---|---|
|**Version 1**|50%|
|**Version 2**|50%|

### 2단계: 분산된 트래픽 확인

`prod` 별칭을 반복해서 테스트합니다. 함수가 50%의 확률로 `Version 1`을, 50%의 확률로 `Version 2`를 반환하는 것을 확인할 수 있습니다. 이렇게 하면 소량의 실제 트래픽을 새로운 버전에 보내 문제가 없는지 검증할 수 있습니다.

### 3단계: 업데이트 완료

새로운 버전(`Version 2`)이 안정적이라고 판단되면, `prod` 별칭을 다시 편집하여 트래픽의 **100%**를 `Version 2`로 전환합니다. 이렇게 하면 모든 사용자 트래픽이 새롭고 안정적인 버전으로 안전하게 이동합니다.

이 실습을 통해 버전과 별칭을 사용하여 람다 함수의 배포를 정교하게 관리하고, 위험을 최소화하면서 새로운 기능을 출시하는 방법을 이해할 수 있습니다.