
![[Pasted image 20250913165007.png]]

AWS Step Functions는 복잡한 분산 애플리케이션의 워크플로우를 **시각적 상태 머신(visual state machine)**으로 모델링하고 오케스트레이션하는 서비스입니다. 이를 통해 여러 AWS 서비스들을 연결하여 데이터 처리, 주문 처리 등 다양한 비즈니스 프로세스를 쉽게 구축할 수 있습니다. 개발자는 복잡한 코딩 없이 JSON 기반의 상태 정의 언어(ASL)를 사용하여 워크플로우의 흐름을 정의합니다.

---

## 1. ⚙️ Step Functions의 핵심 개념: 상태 머신과 상태

Step Functions는 **상태(States)**들의 집합인 **상태 머신(State Machine)**으로 워크플로우를 정의합니다. 각 상태는 특정 작업을 수행하거나 워크플로우의 흐름을 제어하는 역할을 합니다.

### 상태(State)의 종류

Step Functions에는 다양한 종류의 상태가 있어 복잡한 워크플로우를 구현할 수 있습니다.

|상태 이름|유형|설명|
|---|---|---|
|**Task**|작업|Lambda 함수, ECS/EKS 작업, DynamoDB 작업, SQS 메시지 발행 등 특정 작업을 수행합니다.|
|**Choice**|조건 분기|입력 데이터에 따라 다른 상태로 분기합니다. `if-else` 로직을 구현할 때 사용합니다.|
|**Wait**|지연|지정된 시간 동안 워크플로우 실행을 일시 중지합니다.|
|**Parallel**|병렬 실행|여러 작업을 동시에 병렬로 실행합니다.|
|**Map**|동적 반복|입력 배열의 각 항목에 대해 동일한 단계를 반복 실행합니다.|
|**Pass**|데이터 통과|입력을 그대로 출력으로 전달하거나, 고정된 데이터를 주입합니다.|
|**Succeed/Fail**|종료|워크플로우 실행을 성공 또는 실패 상태로 즉시 종료합니다.|

---

## 2. 🧩 Task 상태: AWS 서비스 통합

**Task 상태**는 Step Functions 워크플로우의 가장 중요한 부분으로, 실제 비즈니스 로직을 수행하는 AWS 서비스들을 호출합니다. Step Functions는 다양한 AWS 서비스와 직접 통합되어 있어 간단한 JSON 정의만으로 서비스를 연동할 수 있습니다.

### Lambda 함수 호출 예시

Lambda 함수를 호출하는 Task 상태는 JSON으로 다음과 같이 정의됩니다.

```JSON
{
  "Type": "Task",
  "Resource": "arn:aws:states:::lambda:invoke",
  "Parameters": {
    "FunctionName": "MyLambdaFunction",
    "Payload": {
      "input": "data"
    }
  },
  "Next": "NextState",
  "TimeoutSeconds": 300
}
```

- `Type: "Task"`: 이 상태가 작업을 수행함을 나타냅니다.
- `Resource`: 호출할 AWS 리소스의 ARN을 지정합니다. 여기서는 Lambda 함수 호출 API를 사용합니다.
- `Parameters`: 호출할 함수의 이름과 입력 페이로드를 정의합니다.
- `Next`: 이 작업이 성공한 후 다음으로 이동할 상태의 이름을 지정합니다.
- `TimeoutSeconds`: 작업이 타임아웃될 시간을 지정합니다.

---

## 3. 🚀 워크플로우 실행 및 시각화

![[Pasted image 20250913165448.png]]

Step Functions의 가장 큰 장점 중 하나는 **시각적 워크플로우**입니다. JSON으로 정의한 워크플로우는 AWS 콘솔에서 자동으로 시각화되어 복잡한 로직을 한눈에 파악할 수 있게 해줍니다.

**워크플로우 예시:**

1. `SubmitJob`: 작업을 제출합니다.
2. `Wait for X seconds`: 지정된 시간만큼 기다립니다.
3. `GetJobStatus`: 작업의 현재 상태를 확인합니다.
4. `Choice`: 작업 완료 여부에 따라 분기합니다.
    - **작업 미완료**: 다시 `Wait` 상태로 돌아가 반복합니다.
    - **작업 완료**: `Succeed` 또는 `Fail` 상태로 이동합니다.

Step Functions는 실행 중인 워크플로우의 상태를 실시간으로 추적하고 시각적으로 보여주므로, 문제가 발생한 지점을 쉽게 파악하고 디버깅할 수 있습니다. 이처럼 Step Functions는 복잡한 비즈니스 로직을 코드 한 덩어리로 작성하는 대신, 여러 AWS 서비스들을 연결하는 **오케스트레이터(Orchestrator)** 역할을 수행합니다.