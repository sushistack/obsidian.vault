
이번 강의에서는 Amazon Route 53의 헬스 체크 기능을 직접 생성하고, 그 동작 원리를 확인하는 실습을 진행합니다. 이전에 생성한 EC2 인스턴스들을 사용하여 헬스 체크를 구성하고, 장애 상황을 의도적으로 만들어 헬스 체크가 어떻게 반응하는지 살펴봅니다.

---

### 1. 엔드포인트 헬스 체크 생성 🚀

세 개의 EC2 인스턴스(버지니아 북부, 싱가포르, 프랑크푸르트) 각각에 대한 헬스 체크를 생성합니다.

1. **Route 53 콘솔 접속**: AWS Management Console에서 Route 53 서비스로 이동합니다.
2. **헬스 체크 메뉴**: 왼쪽 탐색 창에서 **헬스 체크(Health checks)**를 클릭합니다.
3. **헬스 체크 생성 시작**: **헬스 체크 생성(Create health check)** 버튼을 클릭합니다.
4. **첫 번째 헬스 체크 (미국 동부 - 버지니아 북부)**:
    - **이름**: `US East 1`
    - **모니터링 대상**: `엔드포인트(Endpoint)`
    - **엔드포인트 유형**: `IP 주소(IP address)` 선택
    - **IP 주소**: 버지니아 북부(`us-east-1`) 리전 EC2 인스턴스의 **퍼블릭 IPv4 주소**를 입력합니다.
    - **포트**: `80`
    - **경로(Path)**: `/`
    - **다음(Next)** 클릭 후, 고급 구성은 기본값으로 두고 **헬스 체크 생성(Create health check)**을 클릭합니다.
5. **두 번째 헬스 체크 (아시아 태평양 - 싱가포르)**:
    - 위와 동일한 방법으로 싱가포르(`ap-southeast-1`) EC2 인스턴스에 대한 헬스 체크를 생성합니다.
    - **이름**: `AP Southeast 1`
6. **세 번째 헬스 체크 (유럽 - 프랑크푸르트)**:
    - 위와 동일한 방법으로 프랑크푸르트(`eu-central-1`) EC2 인스턴스에 대한 헬스 체크를 생성합니다.
    - **이름**: `EU Central 1`

헬스 체크가 모두 생성되면, Route 53 헬스 체커들이 엔드포인트를 모니터링하기 시작하며, 잠시 후 모두 "정상(Healthy)" 상태로 표시될 것입니다.

### 2. 의도적인 장애 발생 및 상태 확인 🚨

싱가포르 리전의 EC2 인스턴스에 대한 헬스 체크가 "비정상(Unhealthy)" 상태로 변경되는 것을 확인하기 위해, 해당 인스턴스의 트래픽을 차단해 보겠습니다.

1. **EC2 콘솔 접속**: 싱가포르(`ap-southeast-1`) 리전으로 이동합니다.
2. **인스턴스 선택**: 해당 EC2 인스턴스를 선택하고, 아래 `보안(Security)` 탭에서 연결된 **보안 그룹**을 클릭합니다.
3. **인바운드 규칙 삭제**: 보안 그룹의 `인바운드 규칙(Inbound rules)` 탭에서, `HTTP (80 포트)`를 허용하는 규칙을 찾아 **삭제(Delete)**합니다.
4. **헬스 체크 상태 변화 확인**: 다시 Route 53의 **헬스 체크(Health checks)** 페이지로 돌아옵니다.
    - 몇 초 또는 몇 분 후, `AP Southeast 1` 헬스 체크의 상태가 **"비정상(Unhealthy)"**으로 변경되는 것을 확인할 수 있습니다.
    - **상세 정보 확인**: 해당 헬스 체크를 클릭하면 마지막으로 실패한 검사(`View last failed check`) 정보를 볼 수 있으며, 연결 시간 초과(`Connection timeout`)나 방화벽에 의해 요청이 차단되었다는 오류 메시지를 확인할 수 있습니다.

### 3. 계산된 헬스 체크 생성 ➕

이번에는 이전에 생성한 세 개의 헬스 체크를 조합하는 **계산된(Calculated) 헬스 체크**를 생성해 보겠습니다.

1. **헬스 체크 생성 시작**: **헬스 체크 생성(Create health check)** 버튼을 클릭합니다.
2. **이름**: `Calculated`
3. **모니터링 대상**: `다른 헬스 체크 상태(Status of other health checks)`를 선택합니다.
4. **자식 헬스 체크 지정**: 모니터링할 헬스 체크 목록에 이전에 생성한 `US East 1`, `AP Southeast 1`, `EU Central 1` 헬스 체크를 모두 추가합니다.
5. **조건 설정**:
    - **보고 규칙**: `정상으로 보고할 최소 헬스 체크 수(Report healthy when at least)` 옵션을 설정하여, 몇 개의 자식 헬스 체크가 정상이어야 전체가 정상으로 판단될지 정의할 수 있습니다.
    - 기본적으로 "모두(All)" 정상이어야 전체가 정상으로 판단되도록 설정합니다.
6. **다음(Next)** 클릭 후, **헬스 체크 생성(Create health check)**을 클릭합니다.
7. **상태 확인**: `AP Southeast 1` 헬스 체크가 현재 비정상 상태이므로, 새로 생성한 `Calculated` 헬스 체크도 자동으로 "비정상(Unhealthy)" 상태로 표시될 것입니다.

### 4. CloudWatch 알람을 사용한 헬스 체크 (설명) ☁️

- **개념**: Route 53 헬스 체커는 공개 IP에만 접근할 수 있으므로, VPC 내부의 **프라이빗 리소스**는 직접 모니터링할 수 없습니다.
    
- **해결 방법**:
    
    1. **CloudWatch 지표**: EC2 인스턴스의 CPU 사용량과 같은 CloudWatch 지표를 모니터링합니다.
        
    2. **CloudWatch 알람**: 이 지표가 특정 임계값(예: CPU 사용량 80% 초과)을 넘으면 알람이 발생하도록 CloudWatch 알람을 생성합니다.
        
    3. **헬스 체크 연동**: Route 53 헬스 체크 생성 시, `CloudWatch 알람 상태(State of a CloudWatch Alarm)`를 모니터링하도록 설정하고, 해당 알람을 지정합니다.
        
    
    - 이렇게 하면 알람이 `ALARM` 상태일 때 헬스 체크는 `Unhealthy`로 간주됩니다.
        

---

### 5. 결론 💡

이 실습을 통해 Route 53의 **엔드포인트 헬스 체크**를 구성하는 방법을 배웠습니다. 또한, 헬스 체크가 실제 장애 상황에 반응하는 것을 확인하고, 여러 헬스 체크를 조합하는 **계산된 헬스 체크**의 활용법을 이해했습니다. 다음 강의에서는 이 헬스 체크를 다른 라우팅 정책과 결합하여 자동 장애 조치(Failover)를 구현해 보겠습니다.

---

궁금한 점이 있으시면 언제든지 질문해주세요.