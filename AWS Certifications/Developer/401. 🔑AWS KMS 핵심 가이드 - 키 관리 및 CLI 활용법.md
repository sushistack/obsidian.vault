
AWS Key Management Service(KMS)λ” AWS μ„λΉ„μ¤μ™€ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ λ°μ΄ν„°λ¥Ό **μ•μ „ν•κ² μ•”νΈν™”ν•κ³  κ΄€λ¦¬**ν•  μ μκ² ν•΄μ£Όλ” ν•µμ‹¬ μ„λΉ„μ¤μ…λ‹λ‹¤. μ΄ κ°€μ΄λ“μ—μ„λ” KMSμ μ£Όμ” κΈ°λ¥κ³Ό μ‚¬μ© μ‚¬λ΅€λ¥Ό μ‚΄ν΄λ³΄κ³ , CLI(λ…λ Ήμ¤„ μΈν„°νμ΄μ¤)λ¥Ό ν™μ©ν• λ°μ΄ν„° μ•”νΈν™” λ° λ³µνΈν™” μ‹¤μµ κ³Όμ •μ„ μƒμ„Έν μ•λ‚΄ν•©λ‹λ‹¤.

---

## π”AWS KMS ν‚¤ μΆ…λ¥ λ° κ΄€λ¦¬

AWS KMSλ” ν¬κ² λ‘ κ°€μ§€ μ ν•μ ν‚¤λ¥Ό μ κ³µν•©λ‹λ‹¤.

### 1. AWS κ΄€λ¦¬ν• ν‚¤ (AWS managed keys)

μ΄ ν‚¤λ“¤μ€ AWS μ„λΉ„μ¤μ— μν•΄ μƒμ„±, κ΄€λ¦¬ λ° μ‚¬μ©λ©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, **EBS λ³Όλ¥¨**μ΄λ‚ **S3 λ²„ν‚·**μ— λ€ν• μ•”νΈν™”λ¥Ό ν™μ„±ν™”ν•λ©΄, ν•΄λ‹Ή μ„λΉ„μ¤μ— μ—°κ²°λ AWS κ΄€λ¦¬ν• ν‚¤κ°€ μλ™μΌλ΅ μƒμ„±λ©λ‹λ‹¤. μ΄ ν‚¤λ“¤μ€ AWSκ°€ μ •μ±…μ„ κ΄€λ¦¬ν•λ―€λ΅ μ‚¬μ©μκ°€ μ§μ ‘ μμ •ν•  μ μ—†μµλ‹λ‹¤.

|νΉμ§•|μ„¤λ…|
|---|---|
|**κ΄€λ¦¬ μ£Όμ²΄**|AWS μ„λΉ„μ¤|
|**μ •μ±… μ μ–΄**|AWSκ°€ κ΄€λ¦¬ λ° μ μ–΄|
|**μ‚¬μ© μ‚¬λ΅€**|EBS, S3, RDS λ“± AWS μ„λΉ„μ¤μ μ•”νΈν™” κΈ°λ¥κ³Ό μ—°λ™|

AWS κ΄€λ¦¬ν• ν‚¤μ μ •μ±…μ„ μ‚΄ν΄λ³΄λ©΄, νΉμ • AWS μ„λΉ„μ¤λ§ ν•΄λ‹Ή ν‚¤μ— μ ‘κ·Όν•  μ μλ„λ΅ `ViaService` μ΅°κ±΄μ΄ μ„¤μ •λμ–΄ μλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, EBS ν‚¤μ κ²½μ° `ec2.amazonaws.com` μ„λΉ„μ¤λ§ μ ‘κ·Όμ΄ ν—μ©λ©λ‹λ‹¤.

### 2. κ³ κ° κ΄€λ¦¬ν• ν‚¤ (Customer managed keys)

μ΄ ν‚¤λ“¤μ€ μ‚¬μ©μκ°€ μ§μ ‘ μƒμ„±ν•κ³  κ΄€λ¦¬ν•λ” ν‚¤μ…λ‹λ‹¤. λ³΄μ• μ •μ±…, ν‚¤ μν™(rotation), λ³„μΉ­(alias) λ“±μ„ **μμ λ΅­κ² μ»¤μ¤ν„°λ§μ΄μ§•**ν•  μ μμµλ‹λ‹¤. μμ²΄ ν‚¤λ¥Ό μƒμ„±ν•λ©΄ λ” μ„Έλ°€ν• λ³΄μ• μ μ–΄κ°€ κ°€λ¥ν•μ§€λ§, **μ›” $1**μ λΉ„μ©μ΄ λ°μƒν•©λ‹λ‹¤.

κ³ κ° κ΄€λ¦¬ν• ν‚¤λ¥Ό μƒμ„±ν•  λ• λ‹¤μκ³Ό κ°™μ€ μµμ…μ„ μ„ νƒν•  μ μμµλ‹λ‹¤.

- **ν‚¤ μ ν•**:
    
    - **λ€μΉ­ ν‚¤ (Symmetric)**: μ•”νΈν™”μ™€ λ³µνΈν™”μ— λ™μΌν• ν‚¤λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤. λ€λ¶€λ¶„μ KMS μ‚¬μ© μ‚¬λ΅€μ— μ ν•©ν•λ©°, `Encrypt` λ° `Decrypt` μ‘μ—…μ— μ‚¬μ©λ©λ‹λ‹¤.
        
    - **λΉ„λ€μΉ­ ν‚¤ (Asymmetric)**: κ³µκ° ν‚¤μ™€ λΉ„κ³µκ° ν‚¤ μμ„ μ‚¬μ©ν•©λ‹λ‹¤. μ•”νΈν™”/λ³µνΈν™” λλ” μ„λ…/ν™•μΈ μ‘μ—…μ— μ‚¬μ©λ©λ‹λ‹¤.
        
- **ν‚¤ μ›λ³Έ (Key Origin)**:
    
    - **KMS**: KMSκ°€ ν‚¤λ¥Ό μ§μ ‘ μƒμ„±ν•κ³  κ΄€λ¦¬ν•©λ‹λ‹¤. κ°€μ¥ μΌλ°μ μΈ μµμ…μ…λ‹λ‹¤.
        
    - **External**: μ‚¬μ©μκ°€ μ™Έλ¶€μ—μ„ μƒμ„±ν• ν‚¤λ¥Ό κ°€μ Έμ™€ KMSμ— μ €μ¥ν•©λ‹λ‹¤.
        
    - **Custom Key Store**: AWS CloudHSMκ³Ό κ°™μ€ μ „μ© ν•λ“μ›¨μ–΄ λ³΄μ• λ¨λ“μ„ μ‚¬μ©ν•©λ‹λ‹¤. (μ΄λ² κ°€μ΄λ“μ λ²”μ„λ¥Ό λ²—μ–΄λ‚¨)
        
- **λ¦¬μ „ (Regionality)**:
    
    - **λ‹¨μΌ λ¦¬μ „ ν‚¤ (Single-region key)**: νΉμ • AWS λ¦¬μ „ λ‚΄μ—μ„λ§ μ ν¨ν•©λ‹λ‹¤.
        
    - **λ‹¤μ¤‘ λ¦¬μ „ ν‚¤ (Multi-region key)**: μ—¬λ¬ λ¦¬μ „μ—μ„ λ™μΌν• ν‚¤λ¥Ό λ³µμ ν•μ—¬ μ‚¬μ©ν•  μ μμ–΄ μ¬ν•΄ λ³µκµ¬λ‚ κΈ€λ΅λ² μ• ν”λ¦¬μΌ€μ΄μ…μ— μ μ©ν•©λ‹λ‹¤.


---

## β™οΈKMS ν‚¤ κ΄€λ¦¬ κΈ°λ¥

κ³ κ° κ΄€λ¦¬ν• ν‚¤λ” λ‹¤μ–‘ν• κ΄€λ¦¬ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

### 1. ν‚¤ μ •μ±… (Key Policy)

ν‚¤ μ •μ±…μ€ λ„κ°€ μ΄ ν‚¤λ¥Ό μ‚¬μ©ν•κ±°λ‚ κ΄€λ¦¬ν•  μ μλ”μ§€ μ •μν•λ” IAM μ •μ±…κ³Ό μ μ‚¬ν• λ¬Έμ„μ…λ‹λ‹¤. κΈ°λ³Έ μ •μ±…μ€ IAM μ‚¬μ©μκ°€ μ μ ν• IAM κ¶ν•μ„ κ°€μ§€κ³  μμ„ λ• ν‚¤μ— μ ‘κ·Όν•  μ μλ„λ΅ ν—μ©ν•©λ‹λ‹¤. ν•„μ”μ— λ”°λΌ νΉμ • μ‚¬μ©μλ‚ μ—­ν• μ„ λ…μ‹ν•μ—¬ **μ•΅μ„Έμ¤ μ μ–΄λ¥Ό κ°•ν™”**ν•  μ μμµλ‹λ‹¤.

### 2. ν‚¤ μν™ (Key Rotation)

ν‚¤ μν™μ€ μ§€μ •λ μ£ΌκΈ°(κΈ°λ³Έ 1λ…„)λ§λ‹¤ μƒλ΅μ΄ μ•”νΈν™” ν‚¤λ¥Ό μλ™μΌλ΅ μƒμ„±ν•λ” κΈ°λ¥μ…λ‹λ‹¤. μ΄ κΈ°λ¥μ„ ν™μ„±ν™”ν•λ©΄, KMSλ” μƒλ΅μ΄ ν‚¤λ¥Ό μƒμ„±ν•κ³  μ΄μ „ ν‚¤λ” λ³΄μ΅΄ν•©λ‹λ‹¤. μ΄λ΅μ¨ **λ³΄μ• μ·¨μ•½μ  λ°μƒ κ°€λ¥μ„±μ„ μ¤„μΌ μ μμµλ‹λ‹¤.**

### 3. λ³„μΉ­ (Alias)

ν‚¤ λ³„μΉ­μ€ `alias/tutorial`κ³Ό κ°™μ΄ ν‚¤λ¥Ό μ‹λ³„ν•κΈ° μ‰¬μ΄ μ΄λ¦„μ„ λ¶€μ—¬ν•λ” κΈ°λ¥μ…λ‹λ‹¤. ν‚¤ IDλ‚ ARN(Amazon Resource Name) λ€μ‹  λ³„μΉ­μ„ μ‚¬μ©ν•μ—¬ λ” κ°„νΈν•κ² ν‚¤λ¥Ό μ°Έμ΅°ν•  μ μμµλ‹λ‹¤.

---

## π’»CLIλ¥Ό μ΄μ©ν• λ°μ΄ν„° μ•”νΈν™” λ° λ³µνΈν™”

μ΄μ  KMS CLIλ¥Ό μ‚¬μ©ν•μ—¬ μ‹¤μ  νμΌμ„ μ•”νΈν™”ν•κ³  λ³µνΈν™”ν•λ” κ³Όμ •μ„ μ‚΄ν΄λ³΄κ² μµλ‹λ‹¤. μ΄ μ‹¤μµμ„ ν†µν•΄ KMSκ°€ λ°μ΄ν„°λ¥Ό μ–΄λ–»κ² μ²λ¦¬ν•λ”μ§€ μ§μ ‘ μ΄ν•΄ν•  μ μμµλ‹λ‹¤.

### λ‹¨κ³„ 1: ν‰λ¬Έ νμΌ μƒμ„±

λ¨Όμ €, μ•”νΈν™”ν•  ν…μ¤νΈ νμΌ(`ExampleSecretFile.txt`)μ„ μƒμ„±ν•©λ‹λ‹¤.

```Bash
echo "SuperSecretPassword" > ExampleSecretFile.txt
```

### λ‹¨κ³„ 2: νμΌ μ•”νΈν™”

`aws kms encrypt` λ…λ Ήμ„ μ‚¬μ©ν•μ—¬ νμΌμ„ μ•”νΈν™”ν•©λ‹λ‹¤.

- `--key-id`: μ•μ„ μƒμ„±ν• κ³ κ° κ΄€λ¦¬ν• ν‚¤μ λ³„μΉ­(μ: `alias/tutorial`)μ„ μ‚¬μ©ν•©λ‹λ‹¤.
    
- `--plaintext`: μ•”νΈν™”ν•  νμΌμ κ²½λ΅λ¥Ό μ§€μ •ν•©λ‹λ‹¤.
    
- `--output`: μ•”νΈν™”λ λ°μ΄ν„°μ μ¶λ ¥ ν•μ‹μ„ `text`λ΅ μ§€μ •ν•©λ‹λ‹¤.
    
- `--query`: μ‘λ‹µμ—μ„ `CiphertextBlob` κ°’λ§ μ¶”μ¶ν•©λ‹λ‹¤.


```Bash
aws kms encrypt \
    --key-id alias/tutorial \
    --plaintext fileb://ExampleSecretFile.txt \
    --output text \
    --query CiphertextBlob > ExampleSecretFileEncrypted.base64
```

μ„ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄ μ•”νΈν™”λ λ°μ΄ν„°κ°€ `ExampleSecretFileEncrypted.base64`λΌλ” μ΄λ¦„μ νμΌμ— Base64 ν•μ‹μΌλ΅ μ €μ¥λ©λ‹λ‹¤. μ΄ νμΌμ€ μ‚¬λμ΄ μ½μ„ μ μλ” λ¬Έμμ—΄λ΅ κµ¬μ„±λμ–΄ μμµλ‹λ‹¤.

### λ‹¨κ³„ 3: Base64 λ””μ½”λ”© λ° λ°”μ΄λ„λ¦¬ νμΌ μƒμ„±

μ•”νΈν™”λ Base64 νμΌμ„ μ‹¤μ  λ°”μ΄λ„λ¦¬ λ°μ΄ν„°λ΅ λ³€ν™ν•©λ‹λ‹¤. `base64` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

```Bash
base64 -D -i ExampleSecretFileEncrypted.base64 > ExampleSecretFileEncrypted
```

μ΄μ  `ExampleSecretFileEncrypted`λΌλ” λ°”μ΄λ„λ¦¬ νμΌμ΄ μƒμ„±λ©λ‹λ‹¤. μ΄ νμΌμ„ ν…μ¤νΈ νΈμ§‘κΈ°λ΅ μ—΄μ–΄λ³΄λ©΄ μ•μ•„λ³Ό μ μ—†λ” **λ‚μ(gibberish)**λ΅ λ³΄μ…λ‹λ‹¤. μ΄κ²ƒμ΄ λ°”λ΅ μ•”νΈν™”λ νμΌμ μ‹¤μ  λ¨μµμ…λ‹λ‹¤.

### λ‹¨κ³„ 4: νμΌ λ³µνΈν™”

`aws kms decrypt` λ…λ Ήμ„ μ‚¬μ©ν•μ—¬ λ°”μ΄λ„λ¦¬ νμΌμ„ μ›λμ ν‰λ¬ΈμΌλ΅ λ³µνΈν™”ν•©λ‹λ‹¤.

- `--ciphertext-blob`: λ³µνΈν™”ν•  λ°”μ΄λ„λ¦¬ νμΌμ κ²½λ΅λ¥Ό μ§€μ •ν•©λ‹λ‹¤.
    
- `--output`: μ¶λ ¥ ν•μ‹μ„ `text`λ΅ μ§€μ •ν•©λ‹λ‹¤.
    
- `--query`: μ‘λ‹µμ—μ„ `Plaintext` κ°’λ§ μ¶”μ¶ν•©λ‹λ‹¤.
    

**μ°Έκ³ **: KMSλ” μ•”νΈν™”λ λ°μ΄ν„° λΈ”λ΅ λ‚΄μ— ν¬ν•¨λ ν‚¤ μ •λ³΄λ¥Ό μλ™μΌλ΅ μΈμ‹ν•μ—¬ λ³µνΈν™”μ— μ‚¬μ©ν•λ―€λ΅, λ³µνΈν™” λ…λ Ήμ— `--key-id`λ¥Ό λ³„λ„λ΅ μ§€μ •ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.

```Bash
aws kms decrypt \
    --ciphertext-blob fileb://ExampleSecretFileEncrypted \
    --output text \
    --query Plaintext > ExampleSecretFileDecrypted.base64
```

μ΄ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄ `ExampleSecretFileDecrypted.base64` νμΌμ— λ³µνΈν™”λ λ°μ΄ν„°κ°€ λ‹¤μ‹ Base64 ν•μ‹μΌλ΅ μ €μ¥λ©λ‹λ‹¤.

### λ‹¨κ³„ 5: μµμΆ… λ³µνΈν™” λ° ν‰λ¬Έ ν™•μΈ

λ§μ§€λ§‰μΌλ΅, λ³µνΈν™”λ Base64 νμΌμ„ λ‹¤μ‹ λ””μ½”λ”©ν•μ—¬ μ›λμ ν…μ¤νΈλ¥Ό ν™•μΈν•©λ‹λ‹¤.

```Bash
base64 -D -i ExampleSecretFileDecrypted.base64 > ExampleSecretFileDecrypted.txt
```

μ΄μ  `ExampleSecretFileDecrypted.txt` νμΌμ„ μ—΄μ–΄λ³΄λ©΄, μ²μ μ…λ ¥ν–λ "SuperSecretPassword"κ°€ λ‚νƒ€λ‚λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

μ΄ κ³Όμ •μ„ ν†µν•΄ KMSμ **μ•”νΈν™”(`Encrypt`)**μ™€ **λ³µνΈν™”(`Decrypt`)** μ‘μ—…μ΄ μ–΄λ–»κ² μ΄λ£¨μ–΄μ§€λ”μ§€ λ…ν™•ν•κ² μ΄ν•΄ν•  μ μμµλ‹λ‹¤.

---

## πκ²°λ΅ 

AWS KMSλ” λ°μ΄ν„°λ¥Ό λ³΄νΈν•κΈ° μ„ν• κ°•λ ¥ν•κ³  μ μ—°ν• μ†”λ£¨μ…μ…λ‹λ‹¤. AWS κ΄€λ¦¬ν• ν‚¤λ” AWS μ„λΉ„μ¤μ™€μ μ—°λ™μ„ ν†µν•΄ κ°„νΈν• μ•”νΈν™”λ¥Ό μ κ³µν•λ©°, κ³ κ° κ΄€λ¦¬ν• ν‚¤λ” μ‚¬μ©μκ°€ μ§μ ‘ λ³΄μ• μ •μ±…μ„ μ„Έλ°€ν•κ² μ μ–΄ν•  μ μλ” μ μ—°μ„±μ„ μ κ³µν•©λ‹λ‹¤.

CLIλ¥Ό ν™μ©ν• μ‹¤μµμ„ ν†µν•΄ KMSκ°€ ν‰λ¬Έ λ°μ΄ν„°λ¥Ό μ•”νΈν™”λ λ°”μ΄λ„λ¦¬ λ°μ΄ν„°λ΅ λ³€ν™ν•κ³ , μ΄λ¥Ό λ‹¤μ‹ μ›λλ€λ΅ λ³µμ›ν•λ” κ³Όμ •μ„ μ§μ ‘ κ²½ν—ν•΄ λ³΄μ•μµλ‹λ‹¤. μ΄λ¬ν• κΈ°λ³Έ μ›λ¦¬λ¥Ό μ΄ν•΄ν•λ©΄ KMSλ¥Ό ν™μ©ν• λ°μ΄ν„° λ³΄μ• μ•„ν‚¤ν…μ²λ¥Ό λ”μ± ν¨κ³Όμ μΌλ΅ μ„¤κ³„ν•  μ μμµλ‹λ‹¤.