 
Amazon CloudFront는 CDN(콘텐츠 전송 네트워크)으로서, 전 세계에 분산된 엣지 로케이션(Edge Location)을 활용해 콘텐츠를 캐싱하고 사용자에게 빠르게 전송합니다. 효율적인 캐싱 전략은 성능 향상과 비용 절감에 직결되므로, 캐싱 원리를 깊이 이해하는 것이 중요합니다.

---

### 1. 캐시 작동 메커니즘 🔄

CloudFront의 캐싱은 캐시 키(Cache Key)와 유효 기간(TTL, Time To Live)을 중심으로 작동합니다.

- **요청 발생:** 사용자의 요청이 가장 가까운 엣지 로케이션에 도달합니다.

- **캐시 확인:** 엣지 로케이션은 **캐시 키**를 사용하여 요청된 객체가 캐시에 존재하는지 확인합니다.
    - **Cache Hit:** 캐시에 객체가 있고, TTL이 만료되지 않았다면 캐시된 객체를 즉시 반환합니다.
    - **Cache Miss:** 캐시에 객체가 없거나 TTL이 만료되었다면, 엣지 로케이션은 **원본 서버(Origin)**로 요청을 전달합니다.

- **콘텐츠 캐싱:** 원본 서버의 응답을 받은 엣지 로케이션은 해당 콘텐츠를 캐시에 저장한 후 사용자에게 전달합니다.

높은 **캐시 히트율(Cache Hit Ratio)**은 원본 서버로 가는 요청을 줄여 비용과 부하를 최소화하므로, 최적의 캐시 정책을 설정하는 것이 중요합니다.

---

### 2. CloudFront 캐시 키와 정책 🔑

**캐시 키**는 캐시에 저장된 객체를 식별하는 고유한 값입니다. 어떤 요청이 동일한 콘텐츠로 간주되어 캐시를 재사용할 수 있는지 결정합니다.

#### 기본 캐시 키

별도의 설정이 없을 경우, 캐시 키는 **호스트 이름(Host Name)**과 **URL의 리소스 경로**로 구성됩니다.

- **예시:** `mywebsite.com/content/image.jpg`
    - `mywebsite.com` (호스트)
    - `/content/image.jpg` (리소스 경로)
    - 이 두 요소가 동일한 모든 요청은 동일한 캐시 객체를 공유합니다.
#### 캐시 정책(Cache Policy)

사용자, 장치, 언어 등 다양한 조건에 따라 다른 콘텐츠를 제공해야 할 경우, 캐시 키에 더 많은 정보를 포함시켜야 합니다. **캐시 정책**은 캐시 키를 구성하는 방법을 정의합니다.

- **포함 가능한 요소:**
    - **HTTP 헤더:** `Accept-Language`, `User-Agent` 등 특정 헤더를 캐시 키에 포함시킬 수 있습니다.
    - **쿠키(Cookies):** 사용자 세션 정보가 담긴 쿠키를 캐시 키에 포함시켜 개인화된 캐싱을 가능하게 합니다.
    - **쿼리 스트링(Query Strings):** `?size=large`와 같은 URL 파라미터를 캐시 키에 포함시킬 수 있습니다.

- **주의사항:** 캐시 정책에 포함된 모든 요소는 **원본 서버로 전달**됩니다. 따라서, 캐시 키에 포함되는 요소가 많을수록 캐시 히트율은 낮아집니다.

---

### 3. 캐시 정책 vs. 원본 요청 정책 📄

CloudFront는 **캐시 정책(Cache Policy)**과 **원본 요청 정책(Origin Request Policy)**을 분리하여 캐싱과 원본 서버 요청을 세밀하게 제어할 수 있게 합니다.

|           | 캐시 정책 (Cache Policy)                     | 원본 요청 정책 (Origin Request Policy)                 |
| --------- | ---------------------------------------- | ------------------------------------------------ |
| **주요 목적** | **캐시 키를 정의**하여 캐싱 동작을 제어                 | **캐시와 무관하게** 원본 서버로 전달할 정보 정의                    |
| **포함 요소** | 캐시 키에 포함될 `헤더`, `쿠키`, `쿼리 스트링`           | 캐시 키에는 포함되지 않지만, 원본이 필요로 하는 `헤더`, `쿠키`, `쿼리 스트링` |
| **영향**    | 캐시 히트율에 직접적인 영향                          | 캐시 히트율에 영향 없음. 원본 서버의 요청 처리 방식에만 영향              |
| **예시**    | `Accept-Language` 헤더를 캐시 키에 포함시켜 언어별로 캐싱 | `Authorization` 헤더를 원본에만 전달하여 API 호출에 사용         |

- **시너지 효과:** 캐시 정책을 통해 캐싱에 필요한 최소한의 정보만 캐시 키에 포함시켜 캐시 효율을 높입니다. 동시에 원본 요청 정책을 통해 원본 서버가 요청을 올바르게 처리하는 데 필요한 추가 정보를 전달하여, 캐시 히트율을 손상시키지 않고도 유연한 애플리케이션 로직을 구현할 수 있습니다

이러한 정책들을 잘 활용하면, CloudFront를 통해 정적 콘텐츠는 물론, 동적 콘텐츠의 일부까지도 효율적으로 캐싱하여 사용자 경험을 크게 개선할 수 있습니다.