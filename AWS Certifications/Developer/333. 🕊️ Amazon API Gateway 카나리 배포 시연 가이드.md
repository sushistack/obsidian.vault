
μ΄λ² κ°€μ΄λ“μ—μ„λ” Amazon API Gatewayμ **μΉ΄λ‚λ¦¬ λ°°ν¬(Canary Deployment)** κΈ°λ¥μ„ μ§μ ‘ μ‹μ—°ν•λ©° κ·Έ μ‘λ™ μ›λ¦¬λ¥Ό μƒμ„Έν μ„¤λ…ν•©λ‹λ‹¤. κΈ°μ΅΄ APIμ μ•μ •μ„±μ„ μ μ§€ν•λ©΄μ„ μƒλ΅μ΄ λ²„μ „μ„ μ μ§„μ μΌλ΅ λ°°ν¬ν•λ” κ³Όμ •μ„ λ‹¨κ³„λ³„λ΅ λ”°λΌν•΄ λ³΄μ„Έμ”.

---

## π€ 1λ‹¨κ³„: μ΄κΈ° ν™κ²½ μ„¤μ • λ° API λ°°ν¬

λ¨Όμ €, μΉ΄λ‚λ¦¬ λ°°ν¬λ¥Ό ν…μ¤νΈν•κΈ° μ„ν• μ΄κΈ° API ν™κ²½μ„ μ„¤μ •ν•©λ‹λ‹¤.

1. **μƒ λ¦¬μ†μ¤ μƒμ„±**: API Gateway μ½μ†”μ—μ„ `canary-demo`λΌλ” μƒλ΅μ΄ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    
2. **GET λ©”μ„λ“ μ¶”κ°€**: `/canary-demo` λ¦¬μ†μ¤μ— **GET** λ©”μ„λ“λ¥Ό μ¶”κ°€ν•κ³ , **ν†µν•© μ ν•**μΌλ΅ Lambda ν•¨μμ™€ **ν”„λ΅μ‹ ν†µν•©**μ„ μ„ νƒν•©λ‹λ‹¤.
    
3. **Lambda λ²„μ „ 1 μ—°κ²°**: μ΄μ „ κ°€μ΄λ“μ—μ„ μƒμ„±ν–λ `api-gateway-stage-variables-get` ν•¨μλ¥Ό μ—°κ²°ν•λ, **λ²„μ „ 1**μ„ νΈμ¶ν•λ„λ΅ ARN λμ— `:1`μ„ μ¶”κ°€ν•©λ‹λ‹¤.
    
    - μμ‹: `arn:aws:lambda:REGION:ACCOUNT_ID:function:api-gateway-stage-variables-get:1`
        
4. **API λ°°ν¬**: APIλ¥Ό `canary`λΌλ” μƒλ΅μ΄ μ¤ν…μ΄μ§€μ— λ°°ν¬ν•©λ‹λ‹¤.
    
5. **ν…μ¤νΈ ν™•μΈ**: λ°°ν¬λ APIμ URL(μ: `/canary/canary-demo`)μ„ μ›Ή λΈλΌμ°μ €μ—μ„ νΈμ¶ν•μ—¬ `"Hello from Lambda v1"` λ©”μ‹μ§€λ¥Ό ν™•μΈν•©λ‹λ‹¤.

---

## π¦ 2λ‹¨κ³„: μΉ΄λ‚λ¦¬ λ°°ν¬ μ„¤μ • λ° μ—…λ°μ΄νΈ

μ΄μ  μΉ΄λ‚λ¦¬ λ°°ν¬λ¥Ό ν™μ„±ν™”ν•κ³  μƒλ΅μ΄ λ²„μ „μ„ λ°°ν¬ν•  μ¤€λΉ„λ¥Ό ν•©λ‹λ‹¤.

1. **μΉ΄λ‚λ¦¬ μƒμ„±**: `canary` μ¤ν…μ΄μ§€ μ„¤μ •μΌλ΅ μ΄λ™ν•μ—¬ **μΉ΄λ‚λ¦¬(Canary)** νƒ­μ„ μ„ νƒν•κ³  **μƒμ„±(Create)**μ„ ν΄λ¦­ν•©λ‹λ‹¤.
    
2. **νΈλν”½ λ¶„λ°°μ¨ μ„¤μ •**: μΉ΄λ‚λ¦¬λ΅ λ³΄λ‚Ό μ”μ²­μ **λΉ„μ¨(Distribution)**μ„ μ„¤μ •ν•©λ‹λ‹¤. λ°λ¨λ¥Ό μ„ν•΄ **50%**λ΅ μ„¤μ •ν•©λ‹λ‹¤. μ‹¤μ  μ΄μ ν™κ²½μ—μ„λ” 1~10%μ™€ κ°™μ΄ λ‚®μ€ λΉ„μ¨μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ μΌλ°μ μ…λ‹λ‹¤.
    
3. **Lambda λ²„μ „ 2λ΅ μ—…λ°μ΄νΈ**: λ¦¬μ†μ¤ μ„¤μ •μΌλ΅ λμ•„μ™€ `canary-demo` GET λ©”μ„λ“μ **ν†µν•© μ”μ²­(Integration Request)**μ„ μμ •ν•©λ‹λ‹¤. Lambda ν•¨μμ ARN λμ— μλ” `:1`μ„ `:2`λ΅ λ³€κ²½ν•μ—¬ **λ²„μ „ 2**λ¥Ό νΈμ¶ν•λ„λ΅ ν•©λ‹λ‹¤.
    
4. **μΉ΄λ‚λ¦¬ λ°°ν¬ μ‹¤ν–‰**: **API λ°°ν¬**λ¥Ό ν΄λ¦­ν•κ³  **μ¤ν…μ΄μ§€**λ΅ `canary`λ¥Ό μ„ νƒν•©λ‹λ‹¤. μ΄ λ³€κ²½ μ‚¬ν•­μ€ **μΉ΄λ‚λ¦¬ μ¤ν…μ΄μ§€**μ—λ§ λ°°ν¬λ©λ‹λ‹¤.

---

## π 3λ‹¨κ³„: μΉ΄λ‚λ¦¬ λ°°ν¬ λ™μ‘ ν™•μΈ

μ΄μ  APIλ¥Ό νΈμ¶ν•μ—¬ νΈλν”½μ΄ `v1`κ³Ό `v2`λ΅ λ‚λ‰μ–΄μ§€λ” κ²ƒμ„ ν™•μΈν•©λ‹λ‹¤.

- **URL νΈμ¶**: λΈλΌμ°μ €μ—μ„ `/canary/canary-demo` URLμ„ μ—¬λ¬ λ² μƒλ΅κ³ μΉ¨ν•©λ‹λ‹¤.
    
- **λ™μ‘ ν™•μΈ**: μƒλ΅κ³ μΉ¨ν•  λ•λ§λ‹¤ μ‘λ‹µμ΄ `"Hello from Lambda v1"`κ³Ό `"Hello from Lambda v2"`λ΅ λ²κ°μ•„ λ‚νƒ€λ‚λ” κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤. μ΄λ” 50%μ νΈλν”½μ΄ κΈ°μ΅΄ `v1`μΌλ΅, λ‚λ¨Έμ§€ 50%κ°€ μƒλ΅ λ°°ν¬λ `v2`λ΅ λΌμ°ν…λκ³  μμμ„ μλ―Έν•©λ‹λ‹¤.
    

μ΄λ¬ν• λ°©μ‹μΌλ΅ μƒλ΅μ΄ λ²„μ „μ APIκ°€ μμƒλ€λ΅ μ‘λ™ν•λ”μ§€, μ¤λ¥κ°€ λ°μƒν•λ”μ§€ λ“±μ„ μ‹¤μ  νΈλν”½μ„ ν†µν•΄ μ•μ „ν•κ² κ²€μ¦ν•  μ μμµλ‹λ‹¤.

---

## π¤ 4λ‹¨κ³„: μΉ΄λ‚λ¦¬ λ°°ν¬ μΉκ²©(Promotion)

μƒλ΅μ΄ `v2` λ²„μ „μ΄ μ¶©λ¶„ν ν…μ¤νΈλμ–΄ μ•μ •μ μ΄λΌκ³  νλ‹¨λλ©΄, μΉ΄λ‚λ¦¬ λ²„μ „μ„ **μΉκ²©**ν•μ—¬ λ¨λ“  νΈλν”½μ„ μƒλ΅μ΄ λ²„μ „μΌλ΅ μ „ν™ν•©λ‹λ‹¤.

1. **μΉ΄λ‚λ¦¬ μΉκ²©**: `canary` μ¤ν…μ΄μ§€μ **μΉ΄λ‚λ¦¬** νƒ­μ—μ„ **μΉκ²©(Promote)** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
    
2. **λ™μ‘ ν™•μΈ**: μ μ‹ ν›„ λ‹¤μ‹ URLμ„ μƒλ΅κ³ μΉ¨ν•λ©΄ μ΄μ  μ‘λ‹µμ΄ `"Hello from Lambda v2"`λ§ λ‚νƒ€λ‚λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.
    

**μΉκ²©**μ€ μΉ΄λ‚λ¦¬ μ¤ν…μ΄μ§€μ μ„¤μ •μ„ κΈ°μ΅΄ μ¤ν…μ΄μ§€λ΅ λ³‘ν•©ν•λ” μ‘μ—…μ…λ‹λ‹¤. μ΄μ  λ¨λ“  μ”μ²­μ΄ `v2`λ΅ λΌμ°ν…λλ©°, API λ°°ν¬κ°€ μ„±κ³µμ μΌλ΅ μ™„λ£λ κ²ƒμ…λ‹λ‹¤.

### π“ μΉ΄λ‚λ¦¬ λ°°ν¬μ μ „μ²΄ νλ¦„

1. **λ¦¬μ†μ¤ μμ •**: μƒλ΅μ΄ API λ΅μ§μ„ λ°μν•λ„λ΅ λ©”μ„λ“λ¥Ό μμ •ν•©λ‹λ‹¤.
    
2. **μΉ΄λ‚λ¦¬ μƒμ„±**: μ¤ν…μ΄μ§€μ— μΉ΄λ‚λ¦¬ λ°°ν¬λ¥Ό μƒμ„±ν•κ³  νΈλν”½ λΉ„μ¨μ„ μ„¤μ •ν•©λ‹λ‹¤.
    
3. **μΉ΄λ‚λ¦¬μ— λ°°ν¬**: μμ •ν• λ‚΄μ©μ„ μΉ΄λ‚λ¦¬ μ¤ν…μ΄μ§€μ— λ°°ν¬ν•©λ‹λ‹¤.
    
4. **ν…μ¤νΈ λ° λ¨λ‹ν„°λ§**: μ‹¤μ  νΈλν”½μ„ ν†µν•΄ μƒλ΅μ΄ λ²„μ „μ μ•μ •μ„±μ„ κ²€μ¦ν•©λ‹λ‹¤.
    
5. **μΉκ²©**: λ¬Έμ κ°€ μ—†μΌλ©΄ μΉ΄λ‚λ¦¬λ¥Ό μΉκ²©μ‹μΌ μƒλ΅μ΄ λ²„μ „μ„ μ •μ‹ λ°°ν¬ν•©λ‹λ‹¤.