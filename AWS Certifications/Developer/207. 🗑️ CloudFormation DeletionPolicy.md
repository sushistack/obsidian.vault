

**`DeletionPolicy`**는 CloudFormation 템플릿의 리소스에 적용할 수 있는 속성으로, 스택이 삭제되거나 리소스가 템플릿에서 제거될 때 해당 리소스의 동작을 제어합니다. 이 정책을 통해 중요한 데이터를 보존하거나 백업할 수 있습니다.

|정책 값|설명|예외 및 주의사항|
|---|---|---|
|**`Delete`**|**(기본값)** 스택이 삭제되거나 리소스가 템플릿에서 제거되면 해당 리소스도 함께 삭제됩니다.|**S3 버킷:** 버킷이 비어있지 않으면 삭제가 실패합니다. 수동으로 버킷을 비우거나, 다른 방법을 통해 버킷 내 객체를 먼저 삭제해야 합니다.|
|**`Retain`**|스택이 삭제되거나 리소스가 템플릿에서 제거되더라도 해당 리소스를 **유지**합니다. CloudFormation은 리소스를 삭제하지 않고 관리 대상에서만 제외합니다.|리소스는 수동으로 삭제해야 합니다.|
|**`Snapshot`**|리소스를 삭제하기 전에 **최종 스냅샷**을 생성합니다. 스냅샷 생성 후 리소스는 삭제됩니다.|EBS 볼륨, RDS DB 인스턴스 등 스냅샷 기능을 지원하는 일부 리소스에만 적용할 수 있습니다.|

---

### 💻 실습 예시

`DeletionPolicy.yaml` 템플릿을 사용하여 `DeletionPolicy`의 동작을 확인합니다.

1. **템플릿 구성**:
    - **EBS 볼륨**: `DeletionPolicy: Snapshot`
    - **EC2 보안 그룹**: `DeletionPolicy: Retain`

2. **스택 생성**: 두 리소스가 포함된 `DeletionPolicyDemo` 스택을 생성합니다.

3. **스택 삭제**:
    
    - **보안 그룹**: `DeletionPolicy`가 **`Retain`**으로 설정되었기 때문에, 스택이 삭제될 때 해당 보안 그룹은 **`DELETE_SKIPPED`** 상태가 되며 삭제되지 않고 AWS 계정에 그대로 남아있습니다.

    - **EBS 볼륨**: `DeletionPolicy`가 **`Snapshot`**으로 설정되었기 때문에, 볼륨 자체는 삭제되었지만 삭제 직전에 최종 스냅샷이 생성됩니다. 이 스냅샷은 EBS 콘솔에서 확인할 수 있습니다.


이러한 정책들을 적절히 활용하면 CloudFormation을 통한 인프라 관리의 안정성과 데이터 보존 능력을 크게 향상시킬 수 있습니다.