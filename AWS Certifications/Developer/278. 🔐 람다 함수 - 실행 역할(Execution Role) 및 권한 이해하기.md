
람다(Lambda) 함수가 AWS 서비스 및 리소스와 상호작용하려면 적절한 권한이 필요합니다. 이러한 권한은 **IAM 역할(IAM Role)**을 통해 부여되며, 람다 함수에 연결된 역할은 함수가 실행되는 동안 임시 자격 증명을 제공합니다.

---

## 1. 람다 실행 역할(Lambda Execution Role)

**람다 실행 역할**은 람다 함수가 **다른 AWS 서비스에 액세스**하기 위해 사용됩니다. 이 역할은 AWS Lambda 서비스에 대한 신뢰 정책(Trust Policy)을 가지고 있으며, 특정 AWS 서비스에 대한 접근 권한을 정의하는 권한 정책(Permissions Policy)을 포함합니다.

### 주요 역할 및 관리형 정책(Managed Policy)

AWS는 자주 사용되는 시나리오를 위해 몇 가지 기본 관리형 정책을 제공합니다.

|정책 이름|역할|
|---|---|
|`AWSLambdaBasicExecutionRole`|**가장 기본 역할.** CloudWatch Logs에 로그를 업로드할 수 있는 권한을 제공합니다. 모든 람다 함수에 필수적으로 필요합니다.|
|`AWSLambdaKinesisExecutionRole`|Amazon Kinesis Streams에서 데이터를 읽을 수 있는 권한을 제공합니다.|
|`AWSLambdaDynamoDBExecutionRole`|Amazon DynamoDB Streams에서 데이터를 읽을 수 있는 권한을 제공합니다.|
|`AWSLambdaSQSQueueExecutionRole`|Amazon SQS 큐에서 메시지를 읽고 삭제할 수 있는 권한을 제공합니다.|
|`AWSLambdaVPCAccessExecutionRole`|람다 함수가 VPC(Virtual Private Cloud) 내의 리소스에 액세스할 수 있도록 VPC 네트워크 인터페이스를 생성하는 권한을 제공합니다.|
|`AWSXRayDaemonWriteAccess`|AWS X-Ray에 트레이스 데이터를 기록할 수 있는 권한을 제공합니다.|

💡 모범 사례:

각 람다 함수마다 고유한 실행 역할을 생성하는 것이 가장 좋은 보안 모범 사례입니다. 이를 통해 필요한 최소한의 권한(Least Privilege)만 부여하여 보안 위험을 줄일 수 있습니다.

---

## 2. 리소스 기반 정책(Resource-based Policy)

**리소스 기반 정책**은 다른 AWS 계정이나 서비스가 **내 람다 함수를 호출**할 수 있도록 허용하는 데 사용됩니다. 이는 람다 함수 자체에 연결되는 정책으로, 특정 서비스(예: S3, API Gateway)가 함수를 트리거할 수 있는 권한을 부여합니다.

### IAM 역할 정책 vs. 리소스 기반 정책

|구분|IAM 역할 정책|리소스 기반 정책|
|---|---|---|
|**적용 대상**|**IAM 주체(Principal)** (예: IAM 사용자, 역할)|**AWS 리소스** (예: 람다 함수)|
|**권한 부여 방향**|**주체 → 다른 서비스** (예: 람다가 S3 버킷에 파일을 쓰는 권한)|**다른 서비스/계정 → 이 리소스** (예: S3가 람다를 호출하는 권한)|
|**주요 사용 사례**|람다 함수가 SQS, DynamoDB, S3 등 **다른 AWS 서비스를 호출**할 때|S3, API Gateway, EventBridge 등 **다른 AWS 서비스가 람다 함수를 트리거**할 때|

### 작동 방식

AWS 서비스가 람다 함수를 호출하려 할 때, 람다는 호출 주체가 `lambda:InvokeFunction` 권한을 가지고 있는지 확인합니다. 이 권한은 다음 두 가지 방법 중 하나로 부여될 수 있습니다.

1. **호출 주체(Principal)의 IAM 정책:** 호출을 수행하는 IAM 사용자 또는 역할에 람다 함수 호출 권한이 명시적으로 부여된 경우.
    
2. **람다 함수의 리소스 기반 정책:** 람다 함수에 연결된 정책이 특정 서비스나 계정의 호출을 허용하는 경우.

일반적으로 AWS 콘솔에서 S3 버킷에 이벤트 알림을 설정하거나 API Gateway를 람다 함수에 연결할 때, 필요한 리소스 기반 정책은 콘솔에 의해 **자동으로 추가**됩니다. 이를 통해 사용자는 직접 IAM 설정을 하지 않고도 서비스 간의 연동을 쉽게 구성할 수 있습니다.