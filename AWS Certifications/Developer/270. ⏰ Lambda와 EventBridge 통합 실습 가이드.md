
Lambda 함수를 EventBridge(이전 CloudWatch Events)와 통합하는 방법을 알아보겠습니다. 이 통합은 주기적인 작업이나 특정 AWS 이벤트에 반응하는 자동화된 워크플로우를 구축하는 데 필수적입니다.

---

### 1. 🛠️ Lambda 함수 생성

먼저 EventBridge 규칙에 의해 호출될 Lambda 함수를 생성합니다.

1. Lambda 콘솔에서 **'함수 생성(Create function)'**을 클릭합니다.
    
2. **함수 이름**을 `lambda-demo-eventbridge`로 지정합니다.
    
3. **런타임**은 `Python 3.9`를 선택하고 함수를 생성합니다.

함수 코드는 EventBridge로부터 전달받은 이벤트를 CloudWatch Logs에 출력하도록 수정합니다. 이 코드는 EventBridge가 어떤 형태의 페이로드를 전달하는지 확인하는 데 유용합니다.

```Python
import json

def lambda_handler(event, context):
    print("Received Event:", json.dumps(event, indent=2))
    return {
        'statusCode': 200,
        'body': json.dumps('EventBridge invoked the function!')
    }
```

위 코드를 함수에 붙여넣고 **'배포(Deploy)'** 버튼을 눌러 변경 사항을 저장합니다.

---

### 2. 🗓️ EventBridge 규칙 생성

이제 매분마다 Lambda 함수를 호출할 EventBridge 규칙을 생성합니다.

1. EventBridge 콘솔로 이동하여 **'규칙(Rules)'** 탭에서 **'규칙 생성(Create rule)'**을 클릭합니다.
    
2. **이름**을 `InvokeLambdaEveryMinute`로 지정하고, **이벤트 버스(Event bus)**는 `default`를 선택합니다.
    
3. **규칙 유형**은 **`일정(Schedule)`**을 선택합니다.
    
4. **일정 패턴**에서 `고정 비율(Fixed rate)`을 선택하고, **간격**을 `1분(1 minute)`으로 설정합니다.
    
5. **대상(Targets)** 섹션에서 **`Lambda 함수`**를 선택하고, 드롭다운 메뉴에서 방금 생성한 `lambda-demo-eventbridge` 함수를 지정합니다.
    
6. **다음(Next)** 버튼을 눌러 생성 과정을 완료합니다.

규칙을 생성하면, EventBridge는 자동으로 Lambda 함수에 대한 호출 권한을 리소스 기반 정책으로 추가합니다.

---

### 3. 🛡️ 권한 및 트리거 확인

EventBridge 규칙이 Lambda 함수를 호출할 수 있는지 확인합니다.

1. `lambda-demo-eventbridge` 함수의 **'구성(Configuration)'** 탭으로 이동합니다.
    
2. 좌측 메뉴의 **'트리거(Triggers)'**를 보면 `EventBridge` 트리거가 추가된 것을 확인할 수 있습니다.
    
3. '권한(Permissions)' 탭의 **'리소스 기반 정책 설명(Resource-based policy statements)'**을 보면, EventBridge가 이 Lambda 함수를 호출할 수 있도록 허용하는 정책이 자동으로 추가된 것을 볼 수 있습니다.

이 정책은 특정 EventBridge 규칙(SourceArn)만 Lambda 함수를 호출할 수 있도록 제한합니다.

---

### 4. 🔍 CloudWatch Logs를 통한 이벤트 확인

규칙이 활성화되면 1분마다 함수가 실행되고 로그를 남깁니다.

1. Lambda 함수 콘솔의 **'모니터링(Monitor)'** 탭으로 이동합니다.
    
2. **'CloudWatch 로그 보기(View CloudWatch logs)'**를 클릭합니다.
    
3. 로그 그룹 내에서 가장 최근 로그 스트림을 확인하면, 매분마다 Lambda 함수가 호출된 로그를 볼 수 있습니다.

로그에는 EventBridge가 전달한 이벤트 페이로드가 포함되어 있습니다. 이벤트 페이로드는 `detail-type`, `source`, `time`, `resources` 등의 정보를 포함하며, 이를 통해 함수는 호출된 이벤트의 세부 정보를 파악할 수 있습니다.

### 5. 🛑 규칙 비활성화

실습 완료 후 불필요한 비용 발생을 막기 위해 EventBridge 규칙을 비활성화하거나 삭제하는 것이 좋습니다.

- EventBridge 콘솔에서 생성한 규칙을 선택하고 **'비활성화(Disable)'** 또는 **'삭제(Delete)'**합니다.