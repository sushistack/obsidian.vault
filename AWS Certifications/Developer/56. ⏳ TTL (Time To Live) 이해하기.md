
이번 강의에서는 DNS 레코드의 핵심 개념 중 하나인 TTL(Time To Live)에 대해 자세히 알아보고, 실제 실습을 통해 TTL이 어떻게 작동하는지 확인해 보겠습니다.

---

### 1. DNS 레코드 TTL (Time To Live)이란? 🤔

![[Pasted image 20250720222641.png]]

- **정의**: **TTL**은 <mark class="hltr-red">DNS 레코드가 DNS 리졸버(예: 로컬 DNS 서버, 사용자의 컴퓨터 또는 웹 브라우저 캐시)에 캐시될 수 있는 시간</mark>을 나타냅니다. 이 시간이 지나면 캐시된 정보는 무효화되고, 새로운 DNS 쿼리가 발생해야 합니다.
    
- **작동 방식**:
    1. 클라이언트가 `myapp.example.com`과 같은 도메인에 대해 DNS 쿼리를 보냅니다.
    2. Route 53은 해당 도메인의 IP 주소와 함께 TTL 값(예: 300초)을 응답합니다.
    3. 클라이언트(또는 클라이언트의 로컬 DNS 리졸버)는 이 IP 주소와 TTL 값을 **캐시**합니다.
    4. TTL 시간(300초) 동안, 클라이언트는 동일한 도메인에 다시 접근할 때 DNS 시스템에 재쿼리하지 않고, **캐시된 정보를 사용**합니다.
    5. TTL 시간이 만료되면, 클라이언트는 다시 DNS 시스템에 쿼리를 보내 최신 정보를 얻습니다.

- **목적**: DNS 시스템에 대한 불필요한 쿼리를 줄여 **부하를 감소**시키고 **응답 속도를 향상**시킵니다. DNS 레코드가 자주 변경되지 않는다는 가정하에 설계되었습니다.
    

#### 1.1 TTL 설정에 따른 영향

|TTL 설정|특징|장점|단점|
|---|---|---|---|
|**높은 TTL**(예: 24시간)|레코드가 클라이언트에 오래 캐시됩니다.|Route 53으로 들어오는 DNS 쿼리 트래픽 감소 (비용 절감), 웹사이트 로딩 속도 향상 (캐시 히트율 증가)|레코드 변경 시 모든 클라이언트의 캐시가 만료될 때까지 **오래된 정보**를 제공할 수 있습니다. 변경 사항 반영에 오랜 시간(예: 24시간)이 걸립니다.|
|**낮은 TTL**(예: 60초)|레코드가 클라이언트에 짧게 캐시되고 자주 갱신됩니다.|레코드 변경 시 **빠르게 반영**됩니다. 데이터가 최신 상태로 유지될 가능성이 높습니다.|Route 53으로 들어오는 DNS 쿼리 트래픽 증가 (비용 증가), DNS 확인에 따른 웹사이트 로딩 지연 가능성|

- **레코드 변경 시 전략**: 레코드 값을 변경할 계획이 있다면, 변경 전에 TTL을 일시적으로 낮은 값(예: 60초)으로 줄였다가, 변경 사항이 전파된 후 다시 원래의 높은 값으로 되돌리는 전략을 사용할 수 있습니다.
- **필수 여부**: TTL은 다음 강의에서 살펴볼 Alias 레코드를 제외한 모든 레코드에 **필수적으로 설정**해야 합니다.

---

### 2. Route 53 콘솔에서 TTL 설정 및 확인 실습 🧪

TTL의 작동 방식을 이해하기 위해 EC2 인스턴스를 대상으로 A 레코드를 생성하고, 그 값을 변경하면서 TTL의 영향을 확인해 보겠습니다.

#### 2.1 A 레코드 생성 (TTL 120초)

1. **Route 53 콘솔 접속**: AWS Management Console에서 Route 53 서비스로 이동합니다.
2. **호스트 존 선택**: 이전에 등록한 도메인(예: `yourchosendomain.com`)의 퍼블릭 호스트 존으로 이동합니다.
3. **레코드 생성**: **레코드 생성(Create record)** 버튼을 클릭합니다.
4. **레코드 세부 정보 입력**:
    - **레코드 이름**: `demo` (FQDN은 `demo.yourchosendomain.com`이 됩니다.)
    - **레코드 유형**: `A`
    - **값**: 이전에 프랑크푸르트(`eu-central-1`) 리전에 생성한 **EC2 인스턴스의 퍼블릭 IPv4 주소**를 복사하여 붙여넣습니다. (예: `1.2.3.4`)
    - **TTL**: `2분` (초 단위로 `120`초).
    - **라우팅 정책**: `단순 라우팅(Simple routing)`
5. **레코드 생성**: **레코드 생성(Create records)** 버튼을 클릭합니다.

#### 2.2 웹 브라우저 및 Cloud Shell에서 레코드 작동 확인

1. **웹 브라우저 확인**: Chrome과 같은 웹 브라우저를 열고 `http://demo.yourchosendomain.com`으로 접속합니다.
    - 프랑크푸르트 EC2 인스턴스의 "Hello World from AZ `eu-central-1b`!" 메시지가 표시되는지 확인합니다.

2. **Cloud Shell에서 DNS 쿼리 확인**:
    
    - AWS Cloud Shell을 열고 다음 명령어를 실행합니다.

	```Bash
	$ dig demo.yourchosendomain.com
	```

    - `ANSWER SECTION`에서 해당 도메인의 IP 주소와 함께 TTL 값이 표시됩니다. 처음 쿼리할 때는 `120`에 가까운 숫자가 보일 것입니다.
        
    - 같은 `dig` 명령어를 다시 실행해 보면, TTL 값이 줄어들어 있는 것을 볼 수 있습니다. 이는 캐시된 레코드의 남은 유효 시간을 나타냅니다.
        

#### 2.3 레코드 값 변경 및 TTL 영향 관찰

1. **Route 53에서 레코드 값 변경**:
    
    - Route 53 호스트 존에서 방금 생성한 `demo.yourchosendomain.com` 레코드를 선택하고 **레코드 편집(Edit record)**을 클릭합니다.
    - **값(Value)**을 이전에 싱가포르(`ap-southeast-1`) 리전에 생성한 **다른 EC2 인스턴스의 퍼블릭 IPv4 주소**로 변경합니다. (예: `9.10.11.12`)
    - **저장(Save)** 버튼을 클릭합니다.
        
2. **캐싱 효과 확인**:
    
    - **Cloud Shell**: `dig demo.yourchosendomain.com` 명령어를 반복해서 실행합니다. 변경된 IP 주소로 즉시 바뀌지 않고, **이전 IP 주소가 계속 표시**될 것입니다. 이는 로컬 DNS 리졸버(Cloud Shell 환경의 리졸버)에 TTL 기간 동안 이전 IP가 캐시되어 있기 때문입니다. TTL이 만료될 때까지 기다려야 합니다.
        
    - **웹 브라우저 (Chrome)**: `http://demo.yourchosendomain.com` 페이지를 새로고침합니다. 마찬가지로 **이전 EC2 인스턴스(프랑크푸르트)**의 메시지가 계속 표시될 것입니다.
        
3. **TTL 만료 후 변경 사항 확인**:
    
    - 약 2분(TTL 120초)이 지난 후, Cloud Shell에서 `dig` 명령어를 다시 실행하거나 웹 브라우저를 새로고침합니다.
        
    - 이제 **새로운 IP 주소**(`ap-southeast-1` 인스턴스)로 트래픽이 라우팅되어 "Hello World from AZ `ap-southeast-1b`!" 메시지가 표시되는 것을 확인할 수 있습니다.
        
    - Cloud Shell의 `dig` 명령어 결과에서도 새로운 IP 주소와 함께 초기 TTL 120초가 다시 표시될 것입니다.
        

---

### 4. 결론 💡

이 실습을 통해 **TTL이 DNS 캐싱에 미치는 영향**을 명확하게 이해할 수 있습니다. TTL이 높으면 DNS 쿼리 수가 줄어들어 비용과 성능에 유리하지만, 레코드 변경 시 반영되는 데 시간이 오래 걸립니다. 반대로 TTL이 낮으면 변경 사항이 빠르게 전파되지만, DNS 쿼리 수가 많아져 비용이 증가할 수 있습니다. 따라서 애플리케이션의 요구사항(데이터 변경 빈도, 성능 민감도)에 따라 적절한 TTL 값을 설정하는 것이 중요합니다.
