
이번 아티클에서는 **AWS SAM(Serverless Application Model)**을 사용하여 **개발(dev)**, **운영(prod)**과 같은 다양한 환경에 서버리스 애플리케이션을 효율적으로 배포하고 관리하는 방법에 대해 알아보겠습니다. `samconfig.toml` 파일을 활용하면 배포 명령어를 간결하게 유지하면서도 환경별로 다른 설정을 적용할 수 있습니다.

---

### 1️⃣ 다중 환경 관리의 필요성

소프트웨어 개발 과정에서 코드와 인프라를 여러 환경(예: 개발, 테스트, 운영)에 배포하는 것은 필수적입니다. 각 환경은 다음과 같은 이유로 서로 다른 구성을 가질 수 있습니다.

- **리소스 이름:** 개발 환경에서는 `my-app-dev-stack`, 운영 환경에서는 `my-app-prod-stack`처럼 스택 이름을 다르게 지정해야 합니다.
    
- **AWS 리전:** 개발은 특정 리전(`ap-northeast-2`)에서, 운영은 다른 리전(`us-east-1`)에서 실행될 수 있습니다.
    
- **파라미터 오버라이드:** 환경에 따라 Lambda 함수 메모리, DynamoDB 용량, S3 버킷 이름 등 **SAM 템플릿의 파라미터 값을 다르게 설정**해야 합니다.
    

SAM은 `samconfig.toml` 파일을 통해 이러한 환경별 설정을 중앙에서 관리하고, CLI 명령어를 통해 쉽게 적용할 수 있도록 지원합니다.

---

### 2️⃣ `samconfig.toml` 파일 구조

![[Pasted image 20250911185318.png]]

`samconfig.toml` 파일은 **TOML** 형식으로 작성되며, 각 환경에 대한 배포(deploy) 및 동기화(sync) 파라미터를 정의합니다. 파일의 구조는 다음과 같습니다.


```TOML
[default.deploy.parameters]
# 기본 배포 설정

[dev.deploy.parameters]
stack_name = "sam-app-dev"
s3_bucket = "sam-app-dev-bucket-12345"
s3_prefix = "sam-app-dev"
region = "ap-northeast-2"
confirm_changeset = true
capabilities = "CAPABILITY_IAM"
parameter_overrides = "Environment=development"

[prod.deploy.parameters]
stack_name = "sam-app-prod"
s3_bucket = "sam-app-prod-bucket-12345"
s3_prefix = "sam-app-prod"
region = "us-east-1"
confirm_changeset = true
capabilities = "CAPABILITY_IAM"
parameter_overrides = "Environment=production"
```

#### **주요 속성 설명**

|속성 이름|설명|
|---|---|
|**`[환경.배포유형.parameters]`**|각 환경별 설정 블록의 헤딩입니다. `dev`, `prod`와 같이 환경 이름을 지정하고, 배포 관련 파라미터는 `deploy.parameters` 아래에 정의합니다.|
|**`stack_name`**|배포될 CloudFormation 스택의 이름입니다. 환경별로 고유해야 합니다.|
|**`s3_bucket`**|SAM 템플릿과 코드 아티팩트를 업로드할 S3 버킷입니다. 환경별로 다른 버킷을 사용할 수 있습니다.|
|**`region`**|리소스를 배포할 AWS 리전입니다.|
|**`parameter_overrides`**|SAM 템플릿에 정의된 파라미터(`Parameters` 섹션)의 기본값을 재정의(override)합니다. 예시에서는 `Environment` 파라미터에 `development` 또는 `production` 값을 전달합니다.|

---

### 3️⃣ `sam deploy` 명령어와 `samconfig.toml` 연동하기

`samconfig.toml` 파일을 설정하면, `sam deploy` 명령어에 `--config-env` 옵션을 추가하여 특정 환경의 설정을 로드할 수 있습니다.

#### **개발 환경에 배포**

```Bash
sam deploy --config-env dev
```

- 이 명령을 실행하면, SAM CLI는 `samconfig.toml` 파일에서 **`[dev.deploy.parameters]`** 섹션을 찾아 해당 설정을 기반으로 배포를 시작합니다.
    
- `sam-app-dev`라는 이름의 스택이 `ap-northeast-2` 리전에 생성되고, `Environment` 파라미터에는 `development`가 전달됩니다.
    

#### **운영 환경에 배포**

```Bash
sam deploy --config-env prod
```

- 마찬가지로, 이 명령은 **`[prod.deploy.parameters]`** 섹션의 설정을 사용하여 운영 환경에 배포를 진행합니다.
    
- `sam-app-prod`라는 이름의 스택이 `us-east-1` 리전에 배포되며, `Environment` 파라미터는 `production`으로 설정됩니다.
    

이처럼 `samconfig.toml` 파일을 사용하면, 복잡한 배포 명령어를 매번 입력할 필요 없이 간결하고 명확하게 환경별 배포를 자동화할 수 있습니다. 이는 특히 CI/CD 파이프라인에서 환경을 전환할 때 매우 유용합니다.