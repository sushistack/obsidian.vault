
Amazon S3의 복제 기능을 직접 실습하며 CRR(Cross-Region Replication)을 설정하고, 복제가 어떻게 작동하는지 확인해 보겠습니다.

### 1단계: 원본 및 대상 버킷 생성 🏞️

복제를 설정하려면 최소 두 개의 버킷이 필요합니다. 하나는 원본 버킷(Source Bucket)이고, 다른 하나는 대상 버킷(Target Bucket)입니다.

1. **원본 버킷 생성:**
    
    - 버킷 이름: `s3-stephane-bucket-origin-v2`
    - 리전: `eu-west-1`
    - **버전 관리(Versioning) 활성화**

2. **대상 버킷 생성:**
    
    - 버킷 이름: `s3-stephane-bucket-replica-v2`
    - 리전: `us-east-1` (CRR을 위해 원본과 다른 리전 선택)
    - **버전 관리(Versioning) 활성화**

> **중요:** 복제는 반드시 **버전 관리**가 활성화된 버킷에서만 작동합니다.

### 2단계: 복제 규칙 생성 및 설정 ⚙️

원본 버킷에서 복제 규칙을 만들어 대상 버킷으로 데이터가 복제되도록 설정합니다.

1. **원본 버킷**(`s3-stephane-bucket-origin-v2`)으로 이동합니다.
2. `관리(Management)` 탭을 클릭합니다.
3. `복제 규칙(Replication rules)` 섹션에서 `복제 규칙 생성(Create replication rule)`을 클릭합니다.
4. **복제 규칙 설정:**
    
    - **복제 규칙 이름:** `DemoReplicationRule`
    - **상태:** `활성화(Enabled)`
    - **원본 버킷:** 현재 버킷을 선택합니다.
    - **규칙 범위:** `버킷의 모든 객체에 적용(Apply to all objects in the bucket)`을 선택합니다.
    - **대상:** `이 계정에 있는 버킷(Bucket in this account)`을 선택하고, **대상 버킷 이름**(`s3-stephane-bucket-replica-v2`)을 입력합니다.
    - **IAM 역할:** `새 역할 생성(Create new role)`을 선택하여 S3가 객체를 읽고 쓰는 권한을 자동으로 부여하도록 합니다.

5. **기존 객체 복제 여부:**
    
    - 규칙을 생성할 때, `기존 객체를 복제하시겠습니까?(Do you want to replicate existing objects?)`라는 메시지가 나타납니다.
    - 복제 규칙은 생성 시점 이후의 **새로운 객체**만 복제합니다. 이미 존재하는 객체는 복제되지 않습니다. 기존 객체 복제가 필요하다면 **S3 배치 복제**를 사용해야 합니다.
    - 여기서는 `아니요(No)`를 선택하고 규칙을 저장합니다.

### 3단계: 복제 확인하기 ✅

이제 원본 버킷에 새로운 파일을 업로드하여 복제가 정상적으로 작동하는지 확인합니다.

1. **원본 버킷**(`s3-stephane-bucket-origin-v2`)에 `coffee.jpg` 파일을 업로드합니다.
2. 몇 초 후에 **대상 버킷**(`s3-stephane-bucket-replica-v2`)을 새로고침하면 `coffee.jpg` 파일이 복제되어 있는 것을 확인할 수 있습니다.
3. 두 버킷에서 `버전 표시(Show versions)`를 활성화하면, 원본과 대상 버킷의 `coffee.jpg` 파일이 **동일한 버전 ID**를 가지는 것을 볼 수 있습니다.

### 4단계: 삭제 마커 복제 설정 및 확인 🗑️

객체 삭제 시 삭제 마커가 복제되도록 설정할 수 있습니다.

1. `관리(Management)` 탭으로 돌아가서 생성한 복제 규칙을 `편집(Edit)`합니다.
2. `삭제 마커 복제(Delete marker replication)` 옵션을 **활성화(Enable)**하고 저장합니다.
3. **원본 버킷**에서 `coffee.jpg` 파일을 **삭제**합니다. (버전 관리 활성화 상태에서는 삭제 마커가 생성됩니다.)
4. 몇 초 후 **대상 버킷**을 확인하면, `coffee.jpg`의 **삭제 마커**가 복제되어 객체 목록에서 보이지 않게 됩니다.

> **주의:** 버전 ID를 명시하여 객체를 영구 삭제(Permanent Delete)하는 경우, 이 작업은 복제되지 않습니다. 이는 악의적인 영구 삭제가 다른 버킷으로 전파되는 것을 막기 위함입니다.
