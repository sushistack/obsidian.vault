
CloudFormation 기능(Capabilities)은 템플릿에 IAM 리소스나 매크로와 같은 민감하거나 복잡한 요소가 포함될 때, 이를 명시적으로 인정하고 허용하기 위한 보안 메커니즘입니다. 콘솔에서는 체크박스 형태로, AWS CLI나 API에서는 추가적인 인수로 제공됩니다.

#### 1. `CAPABILITY_IAM` & `CAPABILITY_NAMED_IAM`

이 두 기능은 CloudFormation 템플릿이 **IAM 리소스** (사용자, 역할, 그룹, 정책 등)를 생성하거나 업데이트할 때 사용됩니다. IAM 리소스는 민감한 권한을 부여할 수 있기 때문에, CloudFormation은 사용자가 이를 명시적으로 인지하도록 요구합니다.

|기능|설명|사용 예시|
|---|---|---|
|**`CAPABILITY_IAM`**|**이름이 지정되지 않은 IAM 리소스**를 포함한 템플릿을 배포할 때 사용됩니다.|템플릿이 IAM 정책을 생성하지만, 정책 이름이 템플릿 내에서 고정되어 있지 않을 때.|
|**`CAPABILITY_NAMED_IAM`**|템플릿이 **이름이 지정된(custom name)** IAM 리소스를 생성하거나 업데이트할 때 사용됩니다.|`MyCustomRoleName`과 같이 역할을 명시적으로 명명하는 경우. 보안 측면에서 더 강력한 확인 절차를 거칩니다.|

#### 2. `CAPABILITY_AUTO_EXPAND`

이 기능은 템플릿에 **매크로**나 **중첩 스택(Nested Stacks)**이 포함되어, 배포 전에 템플릿 내용이 동적으로 변경될 수 있음을 인정할 때 사용됩니다.

- **매크로**: 템플릿에서 반복되는 부분을 줄이거나, 사용자 정의 변환을 수행하는 데 사용됩니다.
- **중첩 스택**: 스택 내부에 또 다른 스택을 포함하여 대규모 애플리케이션의 구조를 모듈화하는 데 사용됩니다.

#### 3. `InsufficientCapabilitiesException` 오류

템플릿에 IAM 리소스나 매크로 등이 포함되었음에도 불구하고 `Capabilities`를 지정하지 않으면, `InsufficientCapabilitiesException` 오류가 발생하며 스택 생성이 실패합니다. 이 경우, 해당 기능을 명시적으로 승인한 후 다시 배포해야 합니다.