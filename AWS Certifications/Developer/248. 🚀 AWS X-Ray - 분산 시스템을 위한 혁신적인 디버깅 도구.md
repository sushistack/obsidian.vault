## AWS X-Ray란?

**AWS X-Ray**는 분산 애플리케이션의 요청 흐름을 시각적으로 분석하고 디버깅하는 데 사용되는 서비스입니다. 마이크로서비스 아키텍처와 같이 복잡하게 얽힌 시스템에서 문제가 발생했을 때, 전통적인 로그 분석 방식은 매우 비효율적입니다. X-Ray는 각 서비스 간의 상호작용을 추적하고 시각적인 **서비스 맵(Service Map)**을 제공하여, 성능 병목 현상과 오류의 원인을 손쉽게 파악할 수 있도록 도와줍니다.

## 🔍 X-Ray의 주요 장점

X-Ray는 단순한 로그 수집을 넘어, 다음과 같은 강력한 이점을 제공합니다.

- **성능 문제 해결**: 애플리케이션의 지연 시간(Latency)을 추적하고, 어떤 서비스가 응답 시간을 늦추는지 식별합니다.

- **종속성 파악**: 수많은 마이크로서비스들이 어떻게 서로 통신하는지 시각적으로 보여주어 전체 아키텍처의 의존성을 명확하게 이해할 수 있습니다.

- **오류 및 예외 발견**: 요청의 실패 원인과 예외가 발생한 지점을 정확하게 찾아냅니다.

- **SLA 준수 여부 확인**: 각 요청의 처리 시간을 모니터링하여 설정된 SLA(서비스 수준 협약)를 충족하는지 여부를 판단합니다.

- **다양한 AWS 서비스 및 환경 지원**: Lambda, ECS, Elastic Beanstalk, API Gateway, EC2뿐만 아니라 온프레미스 서버에서도 사용할 수 있습니다.

![[Pasted image 20250824210540.png]]

위 이미지와 같은 서비스 맵을 통해 어떤 노드(서비스)에서 오류(빨간색/주황색)가 발생하는지 한눈에 파악할 수 있습니다.

---

## 🛠️ X-Ray의 작동 원리

X-Ray는 **트레이싱(Tracing)**이라는 개념을 사용합니다. 하나의 사용자 요청이 시스템을 통과할 때, 각 구성 요소(애플리케이션 서버, 로드 밸런서, 데이터베이스 등)는 요청에 대한 정보를 **세그먼트(Segment)**라는 단위로 기록합니다. 이 세그먼트들이 모여 하나의 **트레이스(Trace)**를 형성하고, X-Ray는 이 트레이스 데이터를 종합하여 서비스 맵과 상세 분석 정보를 제공합니다.

### X-Ray 활성화 방법

X-Ray를 사용하기 위해서는 크게 두 가지 단계가 필요합니다.

|단계|설명|
|---|---|
|**1. 애플리케이션 코드 수정**|애플리케이션 코드에 X-Ray SDK를 임포트하고, AWS 서비스 호출, HTTP/HTTPS 요청, 데이터베이스 호출을 캡처하도록 코드를 수정해야 합니다. (Node.js, Python, Java, Go, .Net 지원)|
|**2. X-Ray 데몬 설치 또는 통합 활성화**|**EC2 또는 온프레미스 서버**의 경우, 별도의 X-Ray **데몬(daemon)**을 설치하여 실행해야 합니다. 데몬은 애플리케이션의 트레이스 데이터를 수집하여 X-Ray 서비스로 전송하는 역할을 합니다. **Lambda와 같이 X-Ray 통합을 지원하는 AWS 서비스**는 별도로 데몬을 설치할 필요 없이, 활성 추적(Active Tracing) 옵션만 활성화하면 됩니다.|

### X-Ray 데몬이란?

![[Pasted image 20250824210651.png]]

X-Ray 데몬은 애플리케이션이 생성하는 트레이스 데이터를 수집하고, 이를 일괄적으로 X-Ray 서비스에 전송하는 작은 프로그램입니다. UDP 패킷을 사용하여 애플리케이션으로부터 트레이스 데이터를 수신하며, Linux, Windows, Mac 운영체제에서 모두 실행 가능합니다.

---

## ⚠️ X-Ray 사용 시 흔한 문제 해결

X-Ray가 제대로 작동하지 않을 때, 다음 사항을 확인해야 합니다.

- **IAM 권한**: 애플리케이션이 실행되는 인스턴스 또는 Lambda 함수의 IAM 역할에 X-Ray에 데이터를 전송할 수 있는 적절한 정책(`xray:PutTraceSegments`)이 부여되었는지 확인합니다.

- **X-Ray 데몬 실행 여부**: EC2 인스턴스에서 X-Ray가 작동하지 않는다면, X-Ray 데몬이 설치 및 실행 중인지 확인합니다. 로컬 환경에서는 데몬을 실행했지만, 배포 환경에서 잊어버리는 경우가 흔합니다.

- **X-Ray SDK 활성화**: 애플리케이션 코드에 X-Ray SDK가 올바르게 임포트되고, 트레이싱이 활성화되었는지 확인합니다.