
**SQS**는 AWS에서 가장 오래된 서비스 중 하나로, 분산된 애플리케이션 간에 메시지를 주고받는 데 사용되는 완전 관리형 메시지 큐 서비스입니다. 이를 통해 애플리케이션 컴포넌트 간의 결합도를 낮추고 시스템의 안정성 및 확장성을 높일 수 있습니다. SQS의 핵심 역할은 **프로듀서(Producer)와 컨슈머(Consumer)** 사이의 버퍼 역할을 수행하는 것입니다.

- **프로듀서(Producer)**: SQS 큐에 메시지를 보내는 애플리케이션입니다.
- **컨슈머(Consumer)**: 큐에서 메시지를 가져와 처리하는 애플리케이션입니다.

---

### 📝 SQS 표준 큐 특징

SQS 표준 큐는 다음과 같은 중요한 특징을 가집니다.

- **무제한 처리량**: 메시지 송수신에 대한 처리량(throughput) 제한이 없습니다. 초당 원하는 만큼의 메시지를 보내고 받을 수 있습니다.

- **메시지 크기**: 하나의 메시지는 최대 **256KB**까지 가능합니다.

- **메시지 보존 기간**: 메시지는 큐에 기본 **4일** 동안 보존되며, 최대 **14일**까지 설정할 수 있습니다. 이 기간이 지나면 메시지는 자동으로 삭제됩니다.

- **낮은 지연 시간**: 메시지 게시 및 수신에 대한 지연 시간이 **10ms 미만**으로 매우 낮습니다.

- **메시지 전달 보장**: 최소 한 번(at least once) 메시지가 전달됩니다. 즉, 드물게 메시지가 중복 전달될 수 있으므로 컨슈머는 이를 처리할 수 있어야 합니다.

- **최선 노력 정렬**: 메시지 순서가 보장되지 않습니다. 메시지는 보낸 순서와 다르게 수신될 수 있습니다.


---

### 💻 SQS 작동 방식

#### 1. 프로듀서

프로듀서는 AWS SDK의 `SendMessage` API를 사용하여 SQS 큐에 메시지를 보냅니다. 메시지에는 주문 ID, 고객 ID, 주소 등 원하는 정보가 포함될 수 있습니다.

#### 2. 컨슈머

![[Pasted image 20250816213404.png]]

컨슈머는 EC2 인스턴스, 온프레미스 서버, 또는 AWS Lambda 함수에서 실행되는 애플리케이션입니다. 컨슈머는 `ReceiveMessage` API를 통해 큐에 메시지가 있는지 주기적으로 **폴링(polling)**합니다.

- **메시지 처리**: 컨슈머는 최대 **10개**의 메시지를 한 번에 받을 수 있습니다.

- **메시지 삭제**: 메시지 처리가 완료되면, 컨슈머는 `DeleteMessage` API를 호출하여 큐에서 해당 메시지를 삭제합니다. 이 과정을 통해 다른 컨슈머가 같은 메시지를 처리하는 것을 방지합니다.

#### 3. 수평 확장 (Horizontal Scaling)

![[Pasted image 20250816213346.png]]

메시지 처리량을 높여야 할 경우, 컨슈머를 추가하여 수평 확장할 수 있습니다. 이는 **오토 스케일링 그룹(ASG)**과 통합하여 매우 효과적으로 구현할 수 있습니다.

- **SQS 큐와 ASG 연동**: CloudWatch를 통해 SQS 큐의 메시지 수(`ApproximateNumberOfMessages`)를 모니터링하고, 메시지 수가 특정 임계값을 초과하면 ASG가 자동으로 EC2 인스턴스를 추가하여 컨슈머 수를 늘릴 수 있습니다. 이는 웹사이트의 갑작스러운 주문 폭주와 같은 상황에 이상적으로 대응합니다.
    

---

### 🏗️ SQS 기반 분산 아키텍처

SQS는 애플리케이션 티어(계층) 간의 결합도를 낮추는 데 탁월합니다. 예를 들어, 동영상 처리 애플리케이션을 만들 때, 요청을 받는 **프론트엔드**와 실제 동영상을 인코딩하는 **백엔드**를 분리할 수 있습니다.

- **프론트엔드**: 사용자 요청을 받아 SQS 큐에 메시지를 보내고 즉시 사용자에게 응답합니다.

- **백엔드**: SQS 큐에서 메시지를 가져와 실제 동영상 처리 작업을 수행합니다. 이 백엔드는 동영상 처리에 최적화된(예: GPU가 탑재된) 인스턴스를 사용하여 오토 스케일링 그룹으로 구성할 수 있습니다.


이러한 아키텍처는 각 티어를 독립적으로 확장하고, 워크로드에 최적화된 리소스를 사용할 수 있게 하여 시스템의 효율성과 안정성을 극대화합니다.

---

### 🔒 SQS 보안

SQS는 다양한 보안 기능을 제공합니다.

- **전송 중 암호화 (Encryption in-flight)**: HTTPS API를 사용하여 메시지를 주고받을 때 자동으로 암호화됩니다.

- **저장 중 암호화 (Encryption at-rest)**: **KMS(Key Management Service)**를 사용하여 큐에 저장된 메시지를 암호화할 수 있습니다.

- **접근 제어**: **IAM 정책** 및 **SQS 접근 정책(Access Policies)**을 사용하여 SQS API에 대한 접근을 제어할 수 있습니다. SQS 접근 정책은 S3 버킷 정책과 유사하며, 다른 계정이나 서비스(예: SNS)가 SQS 큐에 메시지를 보낼 수 있도록 허용하는 데 유용합니다.