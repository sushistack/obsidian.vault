이번 가이드에서는 Amazon API Gateway의 중요한 관리 기능인 **로깅**, **모니터링**, 그리고 **오류 유형**에 대해 상세히 알아보겠습니다. 이 기능들을 통해 API의 성능을 추적하고, 문제를 디버깅하며, 안정성을 높일 수 있습니다.

---

## 📜 1단계: CloudWatch를 활용한 로깅 및 추적

### 📝 CloudWatch Logs

![[Pasted image 20250907194607.png]]

API Gateway는 CloudWatch Logs와 통합되어 모든 API 요청과 응답에 대한 상세한 로그를 기록할 수 있습니다.

- **로그 레벨**: **INFO**, **DEBUG**, **ERROR** 등 다양한 로그 레벨을 설정할 수 있습니다. `DEBUG` 레벨은 요청/응답 바디를 포함한 가장 많은 정보를 제공하지만, **민감한 데이터가 노출될 수 있으므로 주의해야 합니다.**
    
- **설정**: 로깅은 **스테이지(Stage)** 단위로 활성화되며, 각 API별로 설정을 재정의할 수 있습니다.
    

### 🔍 AWS X-Ray

API Gateway에 **X-Ray**를 활성화하면 요청이 API Gateway를 통과하여 백엔드 서비스(예: Lambda, EC2)에 도달하고 다시 클라이언트에게 돌아오는 전체 경로를 시각적으로 추적할 수 있습니다. 이는 지연 시간의 병목 구간을 파악하고 분산 시스템의 문제를 해결하는 데 매우 유용합니다.

---

## 📊 2단계: CloudWatch 지표(Metrics)로 성능 모니터링

API Gateway는 CloudWatch Metrics를 통해 다양한 성능 지표를 제공합니다. 주요 지표는 다음과 같습니다.

### ⏳ 지연 시간(Latency)

- **`IntegrationLatency`**: API Gateway가 백엔드에 요청을 전달하고 응답을 받는 데 걸리는 시간입니다. 이는 **백엔드 서비스의 응답 속도**를 측정하는 지표입니다.
    
- **`Latency`**: 클라이언트가 API Gateway에 요청을 보내고 최종 응답을 받기까지 걸리는 전체 시간입니다. `IntegrationLatency` 외에 인증, 캐싱, 매핑 등 API Gateway 내부 처리 시간이 포함됩니다.
    

**참고**: API Gateway의 요청 타임아웃은 **최대 29초**입니다. `Latency` 또는 `IntegrationLatency`가 29초를 초과하면 API Gateway는 `504 Integration Failure` 오류를 반환합니다.

### 💾 캐시 효율성

- **`CacheHitCount`**: 캐시에서 응답이 반환된 횟수입니다.
    
- CacheMissCount: 캐시가 비어 백엔드를 호출한 횟수입니다.
    
    캐시 히트 수가 높을수록 API 캐시가 효율적으로 작동하고 있음을 나타냅니다.
    

### 🚨 오류 지표

- **`4XXError`**: 클라이언트 측 오류(Client-side errors)를 나타냅니다. 잘못된 요청 형식, 권한 부족, 또는 할당량 초과와 같은 클라이언트 문제로 인해 발생합니다.
    
- **`5XXError`**: 서버 측 오류(Server-side errors)를 나타냅니다. 백엔드 서비스의 문제(예: Lambda 오류, 타임아웃)로 인해 발생합니다.
    

---

## 🚫 3단계: 스로틀링(Throttling) 및 오류 코드 이해하기

### 🛑 스로틀링

API Gateway는 과도한 트래픽으로부터 API와 백엔드를 보호하기 위해 **스로틀링**을 적용합니다.

- **기본 계정 한도**: 기본적으로 AWS 계정의 모든 API는 총 **10,000 rps(초당 요청 수)**의 소프트 한도가 있습니다. 한 API에 트래픽이 집중되면 다른 API도 영향을 받을 수 있습니다.
    
- **오류 코드**: 스로틀링이 발생하면 클라이언트는 **`429 Too Many Requests`** 오류를 받습니다. 이는 클라이언트 측 오류로, 지수 백오프(exponential backoff)와 같은 재시도 전략을 사용하여 처리해야 합니다.
    
- **제한 설정**: API의 스테이지나 메서드에 개별적으로 스로틀링 제한을 설정하여 특정 API가 전체 계정의 할당량을 모두 소진하는 것을 방지할 수 있습니다.
    

### ❌ 주요 오류 코드 유형

API Gateway는 클라이언트와 백엔드에서 발생하는 다양한 오류에 대해 표준 HTTP 오류 코드를 반환합니다.

#### **클라이언트 오류 (`4XX`)**

- **`400 Bad Request`**: 요청 형식이 잘못되었습니다.
    
- **`403 Forbidden`**: API 키가 없거나 권한이 부족하여 접근이 거부되었습니다.
    
- **`429 Too Many Requests`**: API의 할당량 또는 스로틀링 한도를 초과했습니다.
    

#### **서버 오류 (`5XX`)**

- **`502 Bad Gateway`**: Lambda 프록시 통합에서 Lambda 함수의 응답 형식이 잘못되었을 때 발생합니다.
    
- **`504 Integration Failure`**: API Gateway가 백엔드로부터 응답을 받기 전에 타임아웃(29초)이 발생했습니다.
    
- **`503 Service Unavailable`**: 백엔드 서비스(예: Lambda 함수)가 일시적으로 사용 불가능한 상태입니다.