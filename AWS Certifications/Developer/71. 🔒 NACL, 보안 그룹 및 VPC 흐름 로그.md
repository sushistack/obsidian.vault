
이번 강의에서는 VPC 내에서 리소스의 보안을 강화 하는 두 가지 주요 방화벽 메커니즘인 <mark class="hltr-red">네트워크 ACL(Network ACL)</mark>과 <mark class="hltr-red">보안 그룹(Security Group)</mark>, 그리고 네트워크 트래픽을 모니터링하는 <mark class="hltr-red">VPC 흐름 로그(VPC Flow Logs)</mark>에 대해 알아봅니다.

---

### 1. NACL vs. 보안 그룹: 두 가지 보안 방화벽 🛡️

| 구분                                  | 네트워크 ACL (NACL)                                                      | 보안 그룹 (Security Group)                                                   |
| ----------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------ |
| **적용 범위**                           | 서브넷(Subnet) 레벨                                                       | 인스턴스(Instance) 또는 ENI(Elastic Network Interface) 레벨                      |
| **규칙 유형**                           | **허용(ALLOW)** 및 **거부(DENY)** 규칙 모두 지원                                | **허용(ALLOW)** 규칙만 지원 (거부 규칙은 명시적으로 만들 수 없음)                              |
| **상태 저장  <br>(Stateful/Stateless)** | **상태 비저장(Stateless)**  <br>인바운드 트래픽과 아웃바운드 트래픽에 대해 각각 명시적 규칙이 필요합니다. | **상태 저장(Stateful)**  <br>인바운드 트래픽을 허용하면, 이에 대한 응답 아웃바운드 트래픽은 자동으로 허용됩니다. |
| **규칙 처리 순서**                        | 규칙 번호에 따라 낮은 번호부터 높은 번호 순으로 처리됩니다.                                   | 모든 규칙을 평가한 후 최종적으로 허용 여부를 결정합니다.                                         |
| **기본 규칙**                           | 기본 NACL은 모든 인바운드/아웃바운드 트래픽을 허용합니다.                                   | 기본 보안 그룹은 모든 아웃바운드 트래픽을 허용하고, 인바운드 트래픽은 동일한 보안 그룹 내에서만 허용합니다.            |

#### NACL과 보안 그룹의 작동 방식

1. **인바운드 트래픽**: 인터넷에서 EC2 인스턴스로 들어오는 트래픽은 먼저 **NACL**을 통과한 후, **보안 그룹**을 통과해야 인스턴스에 도달할 수 있습니다.
    
2. **아웃바운드 트래픽**: EC2 인스턴스에서 인터넷으로 나가는 트래픽은 먼저 **보안 그룹**을 통과한 후, **NACL**을 통과해야 서브넷 밖으로 나갈 수 있습니다.
    

> **참고**: NACL은 서브넷에 대한 `첫 번째 방어선` 역할을 하며, 보안 그룹은 개별 인스턴스에 대한 `두 번째 방어선`역할을 수행합니다.

### 2. VPC 흐름 로그 (VPC Flow Logs) 📝

- **개념**: VPC, 서브넷, 또는 ENI에서 오가는 모든 IP 트래픽에 대한 상세 정보를 캡처하는 기능입니다.
- **주요 역할**:
    
    - **모니터링**: 네트워크 트래픽 흐름을 모니터링하여 사용 패턴을 파악합니다.
    - **문제 해결**: 연결 문제(Connectivity issues)를 진단하는 데 결정적인 정보를 제공합니다. 예를 들어, 특정 포트의 통신이 차단되었을 때, `거부(DENY)` 로그를 통해 차단 원인을 파악할 수 있습니다.
    - **보안 분석**: VPC 내의 의심스러운 트래픽이나 비정상적인 액세스 시도를 탐지하는 데 활용됩니다.

- **포함 정보**:

    - **트래픽 허용/거부 여부**: `ACCEPT` 또는 `REJECT`
    - **소스/대상 IP 주소**
    - **소스/대상 포트**
    - **프로토콜**
        
- **활용처**: 캡처된 VPC 흐름 로그 데이터는 Amazon S3, Amazon CloudWatch Logs, 또는 Amazon Kinesis Data Firehose로 전송하여 저장 및 분석할 수 있습니다.

### 3. 결론 💡

- **NACL**과 **보안 그룹**은 AWS VPC 네트워크 보안의 핵심이며, 상호 보완적으로 작동합니다. NACL은 서브넷 레벨에서, 보안 그룹은 인스턴스 레벨에서 방화벽 역할을 수행합니다.
    
- **VPC 흐름 로그**는 이 두 방화벽을 통과하는 모든 네트워크 트래픽에 대한 상세 정보를 기록하여, 네트워크 모니터링, 문제 해결, 그리고 보안 감사에 필수적인 도구입니다.
    

이 세 가지 개념은 AWS에서 안전하고 효율적인 네트워크 인프라를 구축하는 데 있어 반드시 이해해야 할 중요한 요소입니다.
