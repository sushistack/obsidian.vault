
## 🏗️ CodeBuild란 무엇인가?

**AWS CodeBuild**는 소스 코드를 컴파일하고, 테스트를 실행하며, 소프트웨어 패키지를 생성하는 완전 관리형 **빌드 서비스**입니다. 복잡한 빌드 서버를 직접 관리할 필요 없이, AWS 클라우드 환경에서 확장 가능하고 효율적인 빌드 작업을 수행할 수 있습니다.

### 🔍 CodeBuild의 핵심 기능

- **소스 코드 지원**: GitHub, Bitbucket, AWS CodeCommit, Amazon S3 등 다양한 소스 코드 저장소와 통합됩니다.
    
- **빌드 환경**: Java, Python, Node.js 등 여러 프로그래밍 언어 및 프레임워크에 대한 **사전 구축된 빌드 환경(Docker 이미지)**을 제공합니다. 사용자가 직접 Docker 이미지를 제공하여 커스텀 환경을 만들 수도 있습니다.
    
- **로그 및 모니터링**: 빌드 로그는 **Amazon S3**와 **CloudWatch Logs**에 저장되어 손쉽게 빌드 과정을 추적하고 디버깅할 수 있습니다.
    
- **메트릭 및 알람**: **CloudWatch Metrics**를 통해 빌드 통계(예: 빌드 시간, 성공/실패 횟수)를 확인할 수 있으며, **CloudWatch Alarms**를 설정하여 빌드 실패 시 알림을 받을 수 있습니다.
    

---

## 📝 buildspec.yml: 빌드 명령의 설계도

CodeBuild는 소스 코드의 루트 디렉터리에 위치한 **`buildspec.yml`** 파일을 통해 빌드 및 테스트 명령어를 실행합니다. 이 파일은 빌드 과정의 모든 단계를 명시하는 중요한 역할을 합니다.

### `buildspec.yml` 파일의 주요 구성 요소

|블록|설명|
|---|---|
|**`version`**|`buildspec.yml` 파일의 버전을 명시합니다.|
|**`env`**|**환경 변수**를 설정합니다. 평문으로 정의하거나 **SSM 파라미터 스토어** 또는 **시크릿 매니저(Secrets Manager)**에서 보안이 중요한 값을 가져올 수 있습니다.|
|**`phases`**|빌드 라이프사이클의 각 단계를 정의합니다. <br>🔹 **`install`**: 빌드에 필요한 종속성 설치<br>🔹 **`pre_build`**: 빌드 실행 전 명령어<br>🔹 **`build`**: 실제 빌드 명령어<br>🔹 **`post_build`**: 빌드 완료 후 마무리 작업 (예: 패키징)|
|**`artifacts`**|빌드 후 생성되는 **산출물(아티팩트)**을 정의합니다. 지정된 파일들은 빌드 완료 후 S3 버킷에 저장됩니다.|
|**`cache`**|빌드 간에 재사용할 파일을 캐시하여 빌드 시간을 단축시킵니다. 일반적으로 종속성 파일(예: `node_modules`)을 캐시하는 데 사용됩니다.|

### `buildspec.yml` 예시 코드

```YAML
version: 0.2

env:
  variables:
    # 환경 변수 설정
    JAVA_HOME: "/usr/lib/jvm/java-8-openjdk-amd64"

phases:
  install:
    commands:
      - echo "Installing dependencies..."
      - # 필요한 설치 명령어 입력
  pre_build:
    commands:
      - echo "Running pre-build checks..."
      - # pre-build 명령어 입력
  build:
    commands:
      - echo "Starting build..."
      - # 빌드 명령어 입력
  post_build:
    commands:
      - echo "Zipping artifacts..."
      - zip -r my-app.zip .

artifacts:
  files:
    - '**/*'
  discard-paths: yes
  base-directory: 'dist'

cache:
  paths:
    - '/root/.m2/**/*'
```

---

## 🔄 CodeBuild의 내부 작동 원리

![[Pasted image 20250908233523.png]]

CodeBuild는 다음과 같은 과정을 통해 빌드 작업을 수행합니다.

1. **소스 코드 가져오기**: CodeBuild가 지정된 소스 코드 저장소(예: GitHub)에서 코드를 가져옵니다. 이때 `buildspec.yml` 파일도 함께 가져옵니다.
    
2. **빌드 환경 컨테이너**: CodeBuild는 작업을 위한 **Docker 컨테이너**를 실행합니다. 이 컨테이너는 AWS가 제공하는 사전 구축된 이미지이거나 사용자가 직접 지정한 이미지입니다.
    
3. **명령어 실행**: 컨테이너 내부에서 `buildspec.yml` 파일에 정의된 `phases`의 명령어들이 순차적으로 실행됩니다.
    
4. **로그 및 아티팩트 생성**: 명령어 실행 중 발생하는 모든 로그는 CloudWatch Logs 및 S3에 저장됩니다. `artifacts` 블록에 명시된 파일들은 빌드 완료 후 S3 버킷으로 추출됩니다. 이 최종 아티팩트가 CodeDeploy와 같은 다음 단계로 전달됩니다.
    

---

## 🧩 CodePipeline과의 관계

**CodeBuild**는 그 자체로 독립적인 빌드 서비스이지만, **CodePipeline**과 함께 사용될 때 강력한 시너지를 발휘합니다.

- **CodePipeline**은 전체 CI/CD 파이프라인의 **오케스트레이터(Orchestrator)** 역할을 합니다.
    
- **CodeBuild**는 CodePipeline의 한 단계인 **빌드 스테이지(Build Stage)**에서 특정 빌드 작업을 수행하는 **실행자(Executor)** 역할을 합니다.
    

CodePipeline은 S3를 통해 CodeBuild에 소스 아티팩트를 전달하고, CodeBuild는 빌드 완료 후 S3에 빌드 아티팩트를 저장하여 CodePipeline이 다음 스테이지로 전달할 수 있게 합니다.

---

## 💡 유의사항 및 팁

- **`buildspec.yml`의 위치**: 시험에서 중요한 포인트이므로, 이 파일은 반드시 소스 코드 리포지토리의 **루트 디렉터리**에 위치해야 함을 기억하세요.
    
- **보안**: 민감한 정보(API 키, 데이터베이스 비밀번호 등)는 절대로 `buildspec.yml`에 평문으로 작성해서는 안 됩니다. 반드시 **SSM 파라미터 스토어**나 **Secrets Manager**를 사용해야 합니다.
    
- **최적화**: **캐시** 기능을 활용하면 빌드 시간을 크게 단축할 수 있습니다. 특히 Node.js의 `node_modules`와 같은 종속성 폴더를 캐시하는 것이 매우 효과적입니다.