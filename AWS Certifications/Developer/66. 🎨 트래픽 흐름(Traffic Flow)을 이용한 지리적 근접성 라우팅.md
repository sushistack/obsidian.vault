

이번 강의에서는 복잡한 라우팅 정책을 시각적으로 쉽게 관리할 수 있는 **트래픽 흐름(Traffic Flow)** 기능에 대해 알아보고, 이를 활용하여 **지리적 근접성 라우팅(Geoproximity Routing)**을 실제로 구현해 보겠습니다.

---

### 1. 트래픽 흐름(Traffic Flow)이란? 🤔

- **개념**: Route 53의 복잡한 라우팅 정책(가중치 기반, 장애 조치, 지리적 근접성 등)을 시각적인 편집기(Visual Editor)를 통해 손쉽게 생성, 관리, 배포할 수 있는 기능입니다.
    
- **주요 특징**:
    
    - **시각적 UI**: 마우스 클릭과 드래그앤드롭만으로 복잡한 라우팅 의사결정 트리를 구축할 수 있습니다.
    - **정책 관리**: 생성된 라우팅 정책은 **트래픽 정책(Traffic Policy)**으로 저장되며, 버전 관리가 가능합니다.
    - **재사용성**: 하나의 트래픽 정책을 여러 호스팅 존(Hosted Zone)에 재사용할 수 있습니다.
    - **유료 서비스**: 트래픽 정책을 레코드로 배포하면 **매월 50달러**의 비용이 발생합니다. 실습 후에는 반드시 삭제해야 합니다.

### 2. 트래픽 흐름을 이용한 지리적 근접성 라우팅 실습 🧪

이전에 생성한 세 개의 EC2 인스턴스를 활용하여 사용자의 위치와 리소스의 바이어스에 따라 트래픽이 어떻게 라우팅되는지 확인해 보겠습니다.

#### 2.1. 트래픽 정책 생성

1. **Route 53 콘솔 접속**: 왼쪽 탐색 창에서 **트래픽 정책(Traffic policies)**을 클릭합니다.
2. **새 정책 생성**: **트래픽 정책 생성(Create traffic policy)**을 클릭합니다.
3. **정책 이름**: `DemoGeoPolicy`로 입력하고 **다음(Next)** 클릭.
4. **A 레코드 선택**: 시작 지점 레코드 유형으로 `A`를 선택합니다.
5. **지리적 근접성 규칙 추가**:
    - `A` 레코드의 연결(Connect) 버튼을 클릭하고 **지리적 근접성 규칙(Geoproximity rule)**을 선택합니다.
    - **지도 보기(Show Map)**를 클릭하여 시각적으로 확인합니다.
6. **첫 번째 엔드포인트 (미국 동부)**:
    - **엔드포인트 위치**: `미국 동부(버지니아 북부)` 또는 `us-east-1` 선택.
    - **바이어스(Bias)**: 기본값인 `0`으로 둡니다.
    - **엔드포인트 연결**: 연결 버튼을 클릭하고 `새 엔드포인트(New endpoint)`를 선택합니다.
    - **엔드포인트 값**: 버지니아 북부 EC2 인스턴스의 IP 주소를 입력합니다.
7. **두 번째 엔드포인트 (싱가포르)**:
    - `지리적 근접성 규칙(Geoproximity rule)`에서 `다른 지리적 근접성 위치 추가(Add another geoproximity location)` 클릭.
    - **엔드포인트 위치**: `아시아 태평양(싱가포르)` 또는 `ap-southeast-1` 선택.
    - **바이어스**: `0`으로 둡니다.
    - **엔드포인트 연결**: 싱가포르 EC2 인스턴스의 IP 주소를 입력합니다.
8. **세 번째 엔드포인트 (프랑크푸르트)**:
    - `다른 지리적 근접성 위치 추가(Add another geoproximity location)` 클릭.
    - **엔드포인트 위치**: `유럽(프랑크푸르트)` 또는 `eu-central-1` 선택.
    - **바이어스**: `0`으로 둡니다.
    - **엔드포인트 연결**: 프랑크푸르트 EC2 인스턴스의 IP 주소를 입력합니다.
9. **정책 생성**: 설정이 완료되면 **트래픽 정책 생성(Create traffic policy)**을 클릭합니다.

#### 2.2. 트래픽 정책 배포 (호스팅 존에 적용)

1. **정책 배포**: 생성된 `DemoGeoPolicy`를 선택하고 `정책 레코드 생성(Create policy record)`을 클릭합니다.
2. **정책 레코드 설정**:
    - **호스팅 존**: 정책을 적용할 호스팅 존(`yourchosendomain.com`)을 선택합니다.
    - **레코드 이름**: `proximity` (FQDN: `proximity.yourchosendomain.com`)
    - **TTL**: 기본값 유지.
3. **비용 확인**: 트래픽 정책 레코드는 매월 50달러의 비용이 청구됩니다. 실습 후에는 반드시 삭제해야 합니다.
4. **레코드 생성**: **정책 레코드 생성(Create policy record)**을 클릭합니다.

#### 2.3. 작동 확인 (VPN 사용)

1. **초기 위치 (예: 유럽)**:
    - 웹 브라우저에서 `http://proximity.yourchosendomain.com`에 접속합니다.
    - 가장 가까운 프랑크푸르트(`eu-central-1c`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.
2. **위치 변경 (VPN을 브라질/미주로)**:
    
    - VPN을 사용하여 위치를 브라질로 변경합니다.
        
    - 웹 브라우저를 새로고침하면, 지리적으로 가장 가까운 버지니아 북부(`us-east-1a`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.
        
3. **위치 변경 (VPN을 태국/아시아로)**:
    
    - VPN을 사용하여 위치를 태국으로 변경합니다.
        
    - 웹 브라우저를 새로고침하면, 가장 가까운 싱가포르(`ap-southeast-1b`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.
        

### 3. 트래픽 흐름의 장점 ✨

- **시각화**: 지리적 근접성 라우팅의 경우, `Show Map` 기능을 통해 바이어스 값 변경에 따른 라우팅 영역 변화를 눈으로 직접 확인할 수 있습니다.
    
- **유연한 관리**: 복잡한 라우팅 규칙을 한 곳에서 중앙 집중적으로 관리하고 버전 관리할 수 있습니다.
    
- **쉬운 수정**: 정책을 수정하고 새로운 버전으로 배포하면, 해당 정책을 사용하는 모든 레코드에 일괄적으로 변경 사항이 적용됩니다.
    

### 4. 실습 완료 후 정리 🗑️

**정책 레코드에 대해 비용이 청구되므로, 실습 후에는 반드시 생성한 `proximity` 레코드를 삭제해야 합니다.** 레코드를 삭제하면 해당 트래픽 정책에 대한 비용 청구도 중단됩니다.

---

궁금한 점이 있으시면 언제든지 질문해주세요.