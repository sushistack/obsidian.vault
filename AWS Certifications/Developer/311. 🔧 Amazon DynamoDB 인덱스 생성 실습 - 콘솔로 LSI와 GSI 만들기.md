
DynamoDB에서 보조 인덱스(Secondary Indexes)는 데이터를 더 유연하고 효율적으로 쿼리할 수 있도록 도와주는 필수적인 도구입니다. 앞서 이론적으로 살펴보았던 **로컬 보조 인덱스(LSI)**와 **글로벌 보조 인덱스(GSI)**를 DynamoDB 콘솔을 통해 직접 생성하고 그 차이점을 실습해보겠습니다.

---

## 🏗️ 테이블 생성 및 LSI 추가하기

LSI는 테이블 생성 시에만 만들 수 있기 때문에, 테이블을 생성하는 과정에서 인덱스를 함께 정의해야 합니다.

### **1. 테이블 기본 설정**

1. **테이블 생성**: DynamoDB 콘솔에서 새로운 테이블을 생성합니다. 테이블 이름을 `demo_indexes`로 지정합니다.
    
2. **기본 키 설정**:
    
    - **파티션 키**: `user_id` (문자열)
        
    - **정렬 키**: `game_timestamp` (문자열)
        
3. **용량 설정**: `프로비저닝됨(Provisioned)` 용량 모드를 선택하고, RCU와 WCU를 각각 1로 설정합니다.
    

### **2. 로컬 보조 인덱스(LSI) 정의**

테이블 생성 페이지 하단의 '보조 인덱스' 섹션에서 인덱스를 추가할 수 있습니다.

1. **인덱스 유형 선택**: '로컬 인덱스'를 선택합니다.
    
2. **정렬 키 지정**: LSI는 기본 테이블과 동일한 파티션 키를 사용하므로, 정렬 키만 다르게 지정할 수 있습니다. 여기서는 `game_id`를 정렬 키로 지정합니다.
    
3. **속성 투영(Projection)**:
    
    - **All**: 기본 테이블의 모든 속성을 인덱스로 투영합니다.
        
    - **Only Keys**: 인덱스 키 속성만 투영합니다.
        
    - **Include**: 키 외에 특정 속성들을 투영합니다.
        
    - 실습에서는 'All'을 선택하여 모든 속성을 투영합니다.
        

이 과정을 거치면, `demo_indexes` 테이블과 함께 `game_id`를 정렬 키로 사용하는 LSI가 동시에 생성됩니다.

---

## 🔍 인덱스를 활용한 쿼리 실습

테이블이 생성되면, '항목(Items)' 탭의 '쿼리(Query)' 기능을 통해 기본 테이블과 인덱스를 쿼리할 수 있습니다.

1. **쿼리 대상 선택**: 쿼리 드롭다운 메뉴를 열면 기본 테이블(`demo_indexes`)과 방금 생성한 로컬 인덱스(`game_id_index`)가 모두 표시됩니다.
    
2. **기본 테이블 쿼리**: `demo_indexes`를 선택하면, **파티션 키(`user_id`)**와 **정렬 키(`game_timestamp`)**를 기반으로 쿼리할 수 있습니다.
    
3. **LSI 쿼리**: `game_id_index`를 선택하면, **파티션 키(`user_id`)**와 **새로운 정렬 키(`game_id`)**를 기반으로 쿼리할 수 있습니다.
    

이를 통해 **LSI는 기본 테이블의 파티션 키를 유지하면서 다른 정렬 키를 통해 다양한 쿼리를 가능하게 함**을 직접 확인할 수 있습니다.

---

## ➕ 글로벌 보조 인덱스(GSI) 추가하기

GSI는 테이블 생성 이후에도 추가할 수 있습니다.

### **1. GSI 생성**

1. **인덱스 탭 이동**: 테이블 상세 페이지에서 '인덱스(Indexes)' 탭으로 이동합니다.
    
2. **인덱스 생성**: '인덱스 생성(Create index)' 버튼을 클릭합니다.
    
3. **GSI 키 정의**: GSI는 기본 테이블과 독립적인 기본 키를 가집니다.
    
    - **파티션 키**: `game_id` (문자열)
        
    - **정렬 키**: `game_timestamp` (문자열)
        
4. **용량 설정**: GSI는 기본 테이블과 별도로 용량을 프로비저닝해야 합니다. '용량 설정'에서 `복사(Copy from base table)` 옵션을 선택하여 기본 테이블과 동일한 용량(RCU 1, WCU 1)을 할당합니다.
    
5. **인덱스 생성**: '인덱스 생성'을 클릭하면 GSI가 생성됩니다.
    

### **2. GSI 쿼리 실습**

GSI가 생성된 후 다시 '항목' 탭으로 돌아가면 쿼리 대상 목록에 새로 추가된 GSI가 보입니다.

- `game_id-game_timestamp-index`를 선택하고, **새로운 파티션 키(`game_id`)**를 기반으로 쿼리를 실행할 수 있습니다.
    

이를 통해 **GSI는 기본 테이블과 완전히 독립적인 키 구조로 쿼리할 수 있는 새로운 접근 방식을 제공함**을 알 수 있습니다.

### **⚠️ 중요한 용량 단위(RCU/WCU) 주의사항**

- **LSI**: 기본 테이블의 용량을 공유하므로, 별도의 용량 관리가 필요 없습니다.
    
- **GSI**: 별도로 프로비저닝된 용량을 사용합니다. 만약 GSI의 쓰기 용량이 부족하여 스로틀링이 발생하면, **해당 GSI에 데이터를 기록하는 기본 테이블의 쓰기 작업도 함께 스로틀링**됩니다. 이 점은 DynamoDB 설계 시 매우 중요한 고려사항입니다.
    

이번 실습을 통해 DynamoDB의 인덱스들이 어떻게 작동하는지 시각적으로 확인했습니다. LSI와 GSI의 차이점을 명확히 이해하고, 여러분의 애플리케이션 요구사항에 맞는 인덱스를 올바르게 설계하는 것이 매우 중요합니다.