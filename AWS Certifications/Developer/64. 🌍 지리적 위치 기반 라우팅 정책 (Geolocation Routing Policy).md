
이번 강의에서는 사용자의 실제 지리적 위치에 따라 트래픽을 라우팅하는 **지리적 위치 기반 라우팅 정책(Geolocation Routing Policy)**에 대해 자세히 알아봅니다. 이전에 다룬 지연 시간 기반 라우팅 정책과는 다른 접근 방식을 사용합니다.

---

### 1. 지리적 위치 기반 라우팅 정책이란? 🤔

![[Pasted image 20250726223407.png]]

- **개념**: 사용자의 DNS 쿼리 발생 <mark class="hltr-red">위치를 기반으로 트래픽을 특정 리소스로 라우팅</mark>하는 정책입니다.
    
- **작동 방식**:
    - Route 53은 사용자의 IP 주소를 분석하여 사용자의 위치(대륙, 국가, 미국 내 주 등)를 파악합니다.
    - 미리 정의된 규칙에 따라, 사용자의 위치와 가장 정확하게 일치하는 레코드를 찾아 해당 리소스의 IP 주소를 반환합니다.
    - **예시**:
        - 아시아 지역 사용자는 `ap-southeast-1` EC2 인스턴스로 라우팅됩니다.
        - 미국 사용자는 `us-east-1` EC2 인스턴스로 라우팅됩니다.
        - 위 규칙에 해당하지 않는 사용자는 `default` 레코드로 라우팅됩니다.

- **지연 시간 기반 라우팅과의 차이점**:
    
    - **지연 시간 기반**은 사용자와 리소스 간의 <mark class="hltr-red">실제 네트워크 지연 시간</mark>을 측정하여 가장 빠른 리소스로 라우팅합니다. 위치가 가까워도 네트워크 상황에 따라 다른 곳으로 라우팅될 수 있습니다.

    - **지리적 위치 기반**은 사용자의 **물리적 위치**에 따라 라우팅합니다. 네트워크 지연과는 무관하게 설정된 규칙에 따라 정적으로 라우팅됩니다. 즉, 캐나다 사용자가 미국 리소스로 라우팅되도록 설정해도 지연 시간이 더 낮을 수 있는 다른 리소스가 있다면 그곳으로 라우팅되지 않고, 오직 설정된 규칙에 따라 미국 리소스로만 라우팅됩니다.
        
- **주요 특징**:
    - **세분화된 위치 설정**: 대륙, 국가, 또는 미국 내 주 단위로 위치를 지정할 수 있습니다.
    - **기본(Default) 레코드 필수**: 위치 규칙에 일치하는 않는 사용자를 위한 <mark class="hltr-red">기본(Default)</mark> 레코드를 반드시 생성해야 합니다.
    - **헬스 체크 연동**: 헬스 체크를 연결하여 비정상 리소스로 트래픽이 라우팅되는 것을 방지할 수 있습니다.

### 2. 지리적 위치 기반 라우팅 정책의 활용 사례 💡

- **웹사이트 현지화(Website Localization)**: 사용자 위치에 따라 다른 언어 또는 콘텐츠를 제공하는 웹사이트에 유용합니다. (예: 독일 사용자는 독일어 페이지로, 프랑스 사용자는 프랑스어 페이지로)
    
- **콘텐츠 제한(Content Restriction)**: 특정 국가나 지역에서만 콘텐츠에 접근할 수 있도록 제한할 때 사용합니다. (예: 저작권 문제)
    
- **부하 분산**: 특정 지역의 사용자 트래픽을 해당 지역에 가까운 리소스로 분산하여 네트워크 비용을 절감하고 성능을 향상시킵니다.

### 3. 지리적 위치 기반 라우팅 실습 🧪

이전에 생성한 세 개의 EC2 인스턴스를 사용하여 사용자의 위치에 따라 각기 다른 리전으로 트래픽이 라우팅되는 것을 확인해 보겠습니다.

#### 3.1 지리적 위치 기반 레코드 세트 생성

1. **Route 53 콘솔 접속**: 이전에 등록한 도메인(`yourchosendomain.com`)의 호스트 존으로 이동합니다.
2. **레코드 생성**: `레코드 생성(Create record)` 클릭.
3. **첫 번째 레코드 (아시아 대륙)**:
    - **레코드 이름**: `geo` (FQDN: `geo.yourchosendomain.com`)
    - **레코드 유형**: `A`
    - **값**: 싱가포르(`ap-southeast-1`) EC2 인스턴스의 IP 주소를 입력.
    - **라우팅 정책**: `지리적 위치(Geolocation)` 선택.
    - **위치**: `아시아(Asia)` 선택.
    - **레코드 ID**: `Asia`
    - **다른 레코드 추가(Add another record)** 클릭.

4. **두 번째 레코드 (미국)**:
    - **레코드 이름**: `geo` (주 레코드와 동일)
    - **레코드 유형**: `A`
    - **값**: 버지니아 북부(`us-east-1`) EC2 인스턴스의 IP 주소를 입력.
    - **라우팅 정책**: `지리적 위치(Geolocation)`
    - **위치**: `국가(Country)`에서 `미국(United States)` 선택.
    - **레코드 ID**: `US`
    - **다른 레코드 추가(Add another record)** 클릭.
5. **세 번째 레코드 (기본 - Default)**:
    - **레코드 이름**: `geo` (주 레코드와 동일)
    - **레코드 유형**: `A`
    - **값**: 프랑크푸르트(`eu-central-1`) EC2 인스턴스의 IP 주소를 입력.
    - **라우팅 정책**: `지리적 위치(Geolocation)`
    - **위치**: `기본(Default)` 선택.
    - **레코드 ID**: `Default EU`
6. **레코드 생성**: 설정이 완료되면 `레코드 생성(Create records)`을 클릭합니다.

#### 3.2 지리적 위치 기반 라우팅 작동 확인 (VPN 사용)

1. **초기 위치 (예: 유럽)**:
    - 웹 브라우저에서 `http://geo.yourchosendomain.com`에 접속합니다.
    - 미국이나 아시아에 속하지 않는 위치이므로, 기본 레코드로 설정한 프랑크푸르트(`eu-central-1c`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.

2. **위치 변경 (VPN을 인도/아시아로)**:
    - VPN을 사용하여 위치를 아시아 대륙의 한 국가(예: 인도)로 변경합니다.
    - 웹 브라우저를 새로고침하면, 아시아 대륙에 대한 규칙에 따라 싱가포르(`ap-southeast-1b`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.
    - **참고**: 만약 접속이 되지 않는다면, 싱가포르 EC2 인스턴스의 보안 그룹 인바운드 규칙에 HTTP (80 포트)가 허용되어 있는지 확인해야 합니다.

3. **위치 변경 (VPN을 미국으로)**:
    - VPN을 사용하여 위치를 미국으로 변경합니다.
    - 웹 브라우저를 새로고침하면, 미국에 대한 규칙에 따라 버지니아 북부(`us-east-1a`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.

4. **위치 변경 (VPN을 멕시코/기타 지역으로)**:
    - VPN을 사용하여 위치를 멕시코로 변경합니다.
    - 멕시코는 미국이나 아시아에 포함되지 않으므로, 다시 기본 레코드인 프랑크푸르트(`eu-central-1c`) 리전의 EC2 인스턴스에서 응답이 올 것입니다.

### 4. 결론 💡

**지리적 위치 기반 라우팅 정책**은 사용자의 실제 위치를 기준으로 트래픽을 라우팅하는 강력한 기능입니다. 이를 통해 콘텐츠 현지화, 지역별 서비스 제공, 그리고 사용자 위치 기반의 콘텐츠 제한 등 다양한 시나리오를 효과적으로 구현할 수 있습니다.
