
Amazon Cognito Identity Pools(Federated Identities)는 외부 사용자가 AWS 서비스(예: S3, DynamoDB)에 안전하게 접근할 수 있도록 **임시 AWS 자격 증명**을 제공하는 서비스입니다. 이는 Cognito User Pools와는 다른 역할을 수행하며, 사용자에게 AWS 리소스에 대한 접근 권한을 부여하는 데 초점을 맞춥니다.

---

## 1. 🤝 Cognito Identity Pools의 작동 원리

![[Pasted image 20250913164519.png]]

Cognito Identity Pools의 핵심은 **외부 사용자(웹/모바일 앱 사용자)의 신분을 AWS 자격 증명으로 교환**하는 데 있습니다. 사용자가 직접 IAM 사용자 계정을 갖는 대신, Identity Pool을 통해 임시 자격 증명을 발급받아 AWS 서비스에 접근합니다.

### 지원하는 로그인 방식

Cognito Identity Pools는 다양한 로그인 제공업체를 통해 사용자의 신원을 확인합니다.

- **공용 제공업체**: Google, Facebook, Apple, Login with Amazon 등
    
- **Cognito User Pools**: CUP를 통해 이미 로그인된 사용자
    
- **OIDC/SAML**: OpenID Connect 또는 SAML을 지원하는 모든 IdP
    
- **개발자 인증**: 커스텀 인증 서버를 통해 신원을 확인합니다.
    
- **비인증(게스트) 사용자**: 로그인이 필요 없는 게스트 사용자에게도 제한적인 AWS 자격 증명을 부여할 수 있습니다.
    

### 동작 과정

1. **로그인 및 토큰 획득**: 사용자가 Cognito User Pool 또는 Google과 같은 외부 제공업체를 통해 로그인하고 **토큰**을 획득합니다.
    
2. **자격 증명 교환**: 애플리케이션은 획득한 토큰을 Cognito Identity Pool로 보냅니다.
    
3. **STS(Security Token Service) 연동**: Identity Pool은 토큰의 유효성을 검증한 후, **AWS STS 서비스**와 통신하여 사용자를 위한 임시 AWS 자격 증명을 요청합니다.
    
4. **AWS 리소스 접근**: 애플리케이션은 발급받은 임시 자격 증명을 사용하여 S3 버킷이나 DynamoDB 테이블과 같은 AWS 리소스에 직접 접근합니다.
    

---

## 2. 👩‍💼 사용자별 IAM 역할 및 세분화된 정책

Cognito Identity Pools는 사용자 유형에 따라 서로 다른 IAM 역할을 적용할 수 있습니다.

- **기본 IAM 역할**: **인증된 사용자(Authenticated users)**와 **게스트 사용자(Guest users)**를 위한 기본 IAM 역할을 설정할 수 있습니다.
    
- **규칙 기반 역할 선택**: 사용자의 ID나 기타 속성에 따라 특정 IAM 역할을 동적으로 할당하는 규칙을 정의할 수 있습니다.
    

### 세분화된 정책(Fine-grained Control)

Identity Pools는 **정책 변수(Policy Variables)**를 사용하여 사용자별로 접근 권한을 세분화할 수 있습니다. 이는 특히 사용자마다 고유한 데이터에만 접근을 허용해야 하는 경우에 유용합니다.

|서비스|정책 예시|설명|
|---|---|---|
|**S3**|`s3:GetObject` `resource:arn:aws:s3:::<버킷이름>/${cognito-identity.amazonaws.com:sub}/*`|사용자의 `sub`(사용자 ID)와 동일한 접두사를 가진 S3 객체에만 접근을 허용합니다.|
|**DynamoDB**|`dynamodb:getItem` `resource:arn:aws:dynamodb:…` `condition:dynamodb:LeadingKeys: ${cognito-identity.amazonaws.com:sub}`|DynamoDB 테이블의 파티션 키가 사용자의 `sub`와 일치하는 항목에만 접근을 허용합니다.|

위와 같은 정책 변수를 활용하면, 단일 IAM 정책으로 모든 사용자에게 **개인화된 보안(Row-based security)**을 적용할 수 있습니다.

---

## 3. 🧩 Cognito User Pools와 Identity Pools의 연계

![[Pasted image 20250913164601.png]]

Cognito User Pools는 **사용자 데이터베이스** 역할을 하고, Identity Pools는 **자격 증명 교환기** 역할을 합니다. 두 서비스를 함께 사용하면 사용자를 한 곳에서 관리하면서도 AWS 리소스에 대한 안전한 접근을 제공할 수 있습니다.

### 연계 동작 방식

1. 사용자는 **Cognito User Pool**을 통해 로그인하고 JWT(JSON Web Token)를 발급받습니다.
    
2. 애플리케이션은 이 JWT를 **Cognito Identity Pool**로 보냅니다.
    
3. Identity Pool은 JWT를 검증하고 AWS STS를 통해 임시 자격 증명을 발급합니다.
    
4. 사용자는 이 임시 자격 증명으로 AWS 서비스에 접근합니다.
    

이러한 구조를 통해, 개발자는 복잡한 인증 및 권한 관리 로직을 AWS에 맡기고, 애플리케이션 개발에 집중할 수 있습니다.