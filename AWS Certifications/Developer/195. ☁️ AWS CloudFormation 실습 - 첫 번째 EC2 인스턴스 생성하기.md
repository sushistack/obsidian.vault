
### 🚀 CloudFormation 소개 및 실습 환경 설정

이번 실습에서는 **AWS CloudFormation**을 사용하여 인프라를 코드로 관리하는(Infrastructure as Code, IaC) 방법을 알아봅니다. CloudFormation은 YAML 또는 JSON 형식의 템플릿 파일을 이용해 AWS 리소스를 자동으로 생성, 업데이트, 삭제하는 서비스입니다.

가장 먼저 실습을 위해 **US East (N. Virginia), `us-east-1` 리전**을 선택합니다. 모든 템플릿은 이 리전에 맞게 설계되었으므로, 특히 리전별로 다른 **AMI ID**와 같은 문제를 방지하기 위해 이 리전을 사용합니다.

---

### 📝 샘플 템플릿 살펴보기: Application Composer

CloudFormation 콘솔로 이동하여 '스택 생성'을 클릭한 후, '샘플 템플릿 사용' 옵션을 선택합니다. 이 중 'Multi-AZ-Simple-WordPress-blog' 같은 템플릿을 선택하고, '애플리케이션 컴포저에서 보기'를 클릭합니다.

Application Composer는 CloudFormation 템플릿을 시각화하고 편집할 수 있는 도구입니다.

- **코드 (Template)**: 템플릿의 소스 코드(YAML 또는 JSON)를 볼 수 있습니다. 가독성이 뛰어난 **YAML** 형식으로 코드를 확인합니다. 이 템플릿은 단순한 EC2 인스턴스 외에도 복잡한 애플리케이션 아키텍처를 정의하고 있습니다.

- **캔버스 (Canvas)**: 템플릿에 정의된 리소스들이 시각적으로 표현됩니다. **WebServerSecurityGroup**, **LaunchConfig**, **DatabaseInstance** 등 다양한 구성 요소들이 어떻게 연결되어 있는지 한눈에 파악할 수 있습니다. 각 컴포넌트를 클릭하면 해당 리소스의 설정을 확인할 수 있습니다.


이 과정을 통해 우리는 CloudFormation 템플릿 코드가 실제 AWS 리소스로 어떻게 시각화되는지 이해할 수 있습니다.

---

### 🖥️ 첫 번째 스택 생성: `0-just-ec2.yaml`

이제 직접 작성된 템플릿을 사용하여 스택을 생성해 보겠습니다. 실습 파일 중 `0-just-ec2.yaml` 파일을 엽니다.

#### 📁 `0-just-ec2.yaml` 템플릿 분석

이 YAML 파일은 최소한의 요소를 포함하여 EC2 인스턴스 하나를 생성하도록 정의되어 있습니다.

|섹션|설명|내용|
|---|---|---|
|**Resources**|CloudFormation 템플릿에서 반드시 포함되어야 하는 섹션. 실제 생성할 AWS 리소스를 정의합니다.|**MyInstance**: 생성할 EC2 인스턴스의 논리적 이름.|
|**Type**|생성할 리소스의 종류를 지정합니다.|`AWS::EC2::Instance`: AWS EC2 인스턴스를 생성하겠다는 의미.|
|**Properties**|리소스에 대한 상세 설정을 정의합니다.|**AvailabilityZone**: `us-east-1a` <br> **ImageId**: 특정 AMI ID <br> **InstanceType**: `t2.micro`|

이 템플릿은 콘솔에서 수동으로 설정하는 대신, 코드를 통해 EC2 인스턴스의 속성(가용 영역, AMI, 인스턴스 타입)을 명확하게 정의합니다.

#### 💻 스택 생성 단계

1. **템플릿 업로드**: CloudFormation 콘솔에서 '스택 생성'을 클릭하고, '템플릿 파일 업로드'를 선택한 후 `0-just-ec2.yaml` 파일을 업로드합니다.

2. **스택 이름 지정**: 스택 이름을 `EC2InstanceDemo`로 지정합니다.

3. **옵션 설정**: 이 실습에서는 태그, 권한 등 추가 설정 없이 '다음'을 클릭합니다. 업로드된 템플릿은 자동으로 AWS S3에 저장되어 CloudFormation이 참조하게 됩니다.

4. **스택 제출**: 모든 설정을 확인한 후 '제출'을 클릭하면 스택 생성이 시작됩니다.

---

### ✅ 스택 생성 및 리소스 확인

스택이 제출되면 '이벤트' 탭에서 스택 생성 진행 상황을 실시간으로 확인할 수 있습니다.

- **`CREATE_IN_PROGRESS`**: 스택 생성 중
- **`CREATE_COMPLETE`**: 스택 생성 완료

잠시 후 `MyInstance` 리소스가 `CREATE_COMPLETE` 상태로 바뀌면서 EC2 인스턴스 생성이 완료됩니다.

#### 🔎 생성된 EC2 인스턴스 확인

'리소스' 탭에서 생성된 리소스의 '물리적 ID(Physical ID)'를 클릭하면 EC2 콘솔로 바로 연결됩니다.

- **인스턴스 타입**: `t2.micro` (템플릿에 명시된 대로)
- **가용 영역**: `us-east-1a` (템플릿에 명시된 대로)
- **AMI**: 템플릿에 지정된 AMI ID와 일치하는 Amazon Linux 2023 이미지 사용
- **태그**: CloudFormation에 의해 자동으로 태그가 추가됩니다. `aws:cloudformation:stack-name`, `aws:cloudformation:stack-id`, `aws:cloudformation:logical-id`와 같은 태그를 통해 스택과의 연관성을 확인할 수 있습니다.


이를 통해 CloudFormation이 템플릿에 정의된 대로 정확하게 리소스를 생성했음을 확인할 수 있습니다. 인프라를 코드로 관리하면 수작업으로 인한 실수를 줄이고, 일관되고 반복 가능한 환경을 구축할 수 있습니다.


|CloudFormation 스택 정보|설명|
|---|---|
|**스택 정보**|스택의 생성 시간, 상태 등 기본 정보|
|**이벤트**|스택 생성/업데이트 과정의 모든 로그|
|**리소스**|스택을 통해 생성된 모든 AWS 리소스 목록|
|**템플릿**|업로드한 템플릿 파일의 내용|
