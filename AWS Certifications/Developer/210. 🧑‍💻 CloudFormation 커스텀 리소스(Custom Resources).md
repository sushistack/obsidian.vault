

**커스텀 리소스**는 CloudFormation이 기본적으로 지원하지 않는 리소스나 외부 시스템에 대한 프로비저닝 로직을 정의할 수 있게 해주는 기능입니다. 이를 통해 AWS 리소스 외에 온프레미스(on-premises)나 서드파티 리소스를 CloudFormation 스택에 통합할 수 있습니다.

#### 커스텀 리소스의 주요 사용 사례

- **미지원 리소스 프로비저닝**: CloudFormation이 아직 지원하지 않는 새로운 AWS 서비스 리소스를 생성합니다.

- **외부 리소스 관리**: AWS 외부의 리소스(예: GitHub 리포지토리, 사내 시스템)를 CloudFormation으로 관리합니다.

- **커스텀 로직 실행**: 스택의 생성, 업데이트, 삭제 단계에서 특정 스크립트나 API 호출을 실행합니다.


#### 커스텀 리소스의 작동 방식

커스텀 리소스는 **Lambda 함수**나 **SNS 토픽**과 같은 서비스에 의해 구동됩니다. 가장 일반적인 방식은 Lambda 함수를 사용하는 것입니다.

- **타입 정의**: 템플릿에서 리소스 타입을 `Custom::MyCustomResourceType`와 같이 정의합니다.

- **`ServiceToken`**: 커스텀 리소스는 `ServiceToken` 속성을 통해 리소스를 처리할 Lambda 함수의 ARN(Amazon Resource Name)을 참조합니다. CloudFormation은 스택 이벤트(생성, 업데이트, 삭제)가 발생하면 이 Lambda 함수를 호출합니다.

- **`Lambda` 함수**: 호출된 Lambda 함수는 필요한 로직(예: 외부 API 호출)을 수행하고, 성공 또는 실패 상태를 CloudFormation에 응답합니다.

---

### 🧺 S3 버킷 비우기 예시

![[Pasted image 20250816212400.png]]

**S3 버킷은 비어 있지 않으면 CloudFormation에서 삭제할 수 없습니다.** 이는 시험에서 자주 출제되는 문제입니다. 이 문제를 해결하기 위해 커스텀 리소스를 활용할 수 있습니다.

1. **스택 삭제 요청**: 사용자가 CloudFormation 스택 삭제를 요청합니다.

2. **커스텀 리소스 호출**: CloudFormation은 S3 버킷을 관리하는 커스텀 리소스를 먼저 삭제하려고 시도합니다. 이 커스텀 리소스는 **Lambda 함수**를 트리거합니다.

3. **Lambda 실행**: 호출된 Lambda 함수는 API 호출을 통해 해당 S3 버킷에 있는 모든 객체를 **먼저 삭제**합니다.

4. **성공 신호**: Lambda 함수가 작업을 완료하고 CloudFormation에 성공 신호를 보냅니다.

5. **버킷 삭제**: 이제 버킷이 비었으므로, CloudFormation은 S3 버킷을 성공적으로 삭제합니다.

이 과정을 통해 CloudFormation은 기본적으로 불가능한 '비어 있지 않은 S3 버킷 삭제'를 안전하게 수행할 수 있습니다.