

AWS Lambdaλ” μ„λ²„λ¦¬μ¤ μ• ν”λ¦¬μΌ€μ΄μ…μ ν•µμ‹¬μ΄μ§€λ§, μ½”λ“ λ‚΄μ— λ―Όκ°ν• μ •λ³΄(μ: λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈ)λ¥Ό μ§μ ‘ μ €μ¥ν•λ” κ²ƒμ€ λ³΄μ•μƒ λ§¤μ° μ„ν—ν•©λ‹λ‹¤. μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ **KMS(Key Management Service)**λ¥Ό ν™μ©ν•μ—¬ Lambdaμ ν™κ²½ λ³€μλ¥Ό μ•μ „ν•κ² μ•”νΈν™”ν•κ³  κ΄€λ¦¬ν•λ” λ°©λ²•μ„ μƒμ„Έν μ„¤λ…ν•κ² μµλ‹λ‹¤.

---

## 1. π” λ¬Έμ μ : λ―Όκ° μ •λ³΄ κ΄€λ¦¬

Lambdaμ—μ„ λ―Όκ°ν• μ •λ³΄λ¥Ό λ‹¤λ£¨λ” μ„Έ κ°€μ§€ λ°©μ‹κ³Ό κ·Έ λ¬Έμ μ μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

### 1. μ½”λ“ λ‚΄μ— ν•λ“μ½”λ”©

- **λ°©μ‹**: μ½”λ“ λ‚΄μ— `DB_PASSWORD = "supersecret"`μ™€ κ°™μ΄ μ§μ ‘ κ°’μ„ μ…λ ¥ν•©λ‹λ‹¤.
    
- **λ¬Έμ μ **: μ½”λ“κ°€ λ…Έμ¶λ  κ²½μ°, λ―Όκ° μ •λ³΄κ°€ κ·Έλ€λ΅ μ μ¶λ©λ‹λ‹¤. μ΄λ” κ°€μ¥ ν”Όν•΄μ•Ό ν•  λ°©μ‹μ…λ‹λ‹¤.

### 2. ν™κ²½ λ³€μ μ‚¬μ© (μ•”νΈν™” X)

- **λ°©μ‹**: ν™κ²½ λ³€μλ¥Ό μ‚¬μ©ν•λ©΄ μ½”λ“λ¥Ό κΉ”λ”ν•κ² λ¶„λ¦¬ν•  μ μμµλ‹λ‹¤. `os.environ['DB_PASSWORD']`μ™€ κ°™μ΄ ν™κ²½ λ³€μλ¥Ό λ¶λ¬μ™€ μ‚¬μ©ν•©λ‹λ‹¤.
    
- **λ¬Έμ μ **: Lambda μ½μ†”μ ν™κ²½ λ³€μ μ„Ήμ…μ—μ„ λ„κµ¬λ‚ **ν‰λ¬ΈμΌλ΅ κ°’μ„ λ³Ό μ μμµλ‹λ‹¤.** μ½μ†” μ ‘κ·Ό κ¶ν•μ΄ μλ” μ‚¬μ©μλ” μ‰½κ² μ •λ³΄λ¥Ό νƒμ·¨ν•  μ μμµλ‹λ‹¤.
    

### 3. β… ν•΄κ²°μ±…: ν™κ²½ λ³€μ μ•”νΈν™” (KMS μ—°λ™)

Lambdaλ” ν™κ²½ λ³€μλ¥Ό **KMS ν‚¤λ΅ μ•”νΈν™”ν•μ—¬ μ €μ¥**ν•λ” κΈ°λ¥μ„ κΈ°λ³ΈμΌλ΅ μ κ³µν•©λ‹λ‹¤. μ΄ κΈ°λ¥μ„ μ‚¬μ©ν•λ©΄ λ―Όκ°ν• μ •λ³΄κ°€ μ•μ „ν•κ² λ³΄νΈλ©λ‹λ‹¤.

---

## 2. π” KMSλ¥Ό μ‚¬μ©ν• ν™κ²½ λ³€μ μ•”νΈν™”

Lambda μ½μ†”μ—μ„ ν™κ²½ λ³€μλ¥Ό μ•”νΈν™”ν•λ” κ³Όμ •μ€ λ§¤μ° κ°„λ‹¨ν•©λ‹λ‹¤.

1. **ν™κ²½ λ³€μ μƒμ„±**: `DB_PASSWORD`λΌλ” ν™κ²½ λ³€μλ¥Ό μƒμ„±ν•κ³ , κ°’μ— `supersecret`λ¥Ό μ…λ ¥ν•©λ‹λ‹¤.
    
2. **μ•”νΈν™” μ„¤μ •**: ν™κ²½ λ³€μ μ„Ήμ… ν•λ‹¨μ **"Encryption configuration"**μ—μ„ `Enable helpers for encryption in transit`μ„ ν™μ„±ν™”ν•©λ‹λ‹¤.
    
3. **KMS ν‚¤ μ„ νƒ**: λ“λ΅­λ‹¤μ΄ λ©”λ‰΄μ—μ„ λ―Έλ¦¬ μƒμ„±ν•΄λ‘” **KMS κ³ κ° κ΄€λ¦¬ν• ν‚¤**λ¥Ό μ„ νƒν•©λ‹λ‹¤.
    
4. **μ•”νΈν™”**: μ•”νΈν™”ν•  ν™κ²½ λ³€μ μ†μ **`Encrypt`** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
    

μ΄μ  `DB_PASSWORD` κ°’μ€ μ•”νΈν™”λ λ¬Έμμ—΄λ΅ λ³€κ²½λμ–΄ μ½μ†”μ—μ„λ„ ν‰λ¬ΈμΌλ΅ λ³΄μ΄μ§€ μ•μµλ‹λ‹¤.

---

## 3. π§© Lambda μ½”λ“ μμ •: λ³µνΈν™” λ΅μ§ μ¶”κ°€

ν™κ²½ λ³€μκ°€ μ•”νΈν™”λμ—μΌλ―€λ΅, Lambda ν•¨μλ” μ΄ κ°’μ„ μ§μ ‘ μ‚¬μ©ν•  μ μ—†μµλ‹λ‹¤. `decrypt` API νΈμ¶μ„ ν†µν•΄ κ°’μ„ λ³µνΈν™”ν•λ” λ΅μ§μ΄ ν•„μ”ν•©λ‹λ‹¤.

```Python
import os
import boto3
import base64
from botocore.exceptions import ClientError

# KMS ν΄λΌμ΄μ–ΈνΈ μƒμ„±
kms_client = boto3.client('kms')

def decrypt_secret(encrypted_data):
    """
    KMSλ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ ν™κ²½ λ³€μλ¥Ό λ³µνΈν™”
    """
    try:
        response = kms_client.decrypt(
            CiphertextBlob=base64.b64decode(encrypted_data.encode('utf-8'))
        )
        return response['Plaintext'].decode('utf-8')
    except ClientError as e:
        print(f"Error decrypting secret: {e}")
        return None

def lambda_handler(event, context):
    # μ•”νΈν™”λ ν™κ²½ λ³€μ κ°’ κ°€μ Έμ¤κΈ°
    encrypted_password = os.environ['DB_PASSWORD']
    
    # ν™κ²½ λ³€μ λ³µνΈν™”
    decrypted_password = decrypt_secret(encrypted_password)

    print(f"Encrypted value: {encrypted_password}")
    print(f"Decrypted value: {decrypted_password}")
    
    if decrypted_password == "supersecret":
        return {
            'statusCode': 200,
            'body': 'Great, decryption successful!'
        }
    else:
        return {
            'statusCode': 400,
            'body': 'Decryption failed!'
        }
```

**[μ½”λ“ μ„¤λ…]**

- `os.environ['DB_PASSWORD']`: μ•”νΈν™”λ κ°’μ„ ν™κ²½ λ³€μμ—μ„ λ¶λ¬μµλ‹λ‹¤.
- `base64.b64decode()`: ν™κ²½ λ³€μλ” Base64λ΅ μΈμ½”λ”©λμ–΄ μμΌλ―€λ΅, λ³µνΈν™” μ „μ— λ””μ½”λ”©ν•©λ‹λ‹¤.
- `kms_client.decrypt()`: KMS `Decrypt` APIλ¥Ό νΈμ¶ν•μ—¬ κ°’μ„ λ³µνΈν™”ν•©λ‹λ‹¤.
- `response['Plaintext'].decode('utf-8')`: λ³µνΈν™”λ κ²°κ³Όλ” λ°”μ΄νΈ(bytes) ν•νƒμ΄λ―€λ΅, UTF-8λ΅ λ””μ½”λ”©ν•μ—¬ ν‰λ¬Έ λ¬Έμμ—΄λ΅ λ³€ν™ν•©λ‹λ‹¤.

---

## 4. β™οΈ κ¶ν• μ„¤μ •: Lambda μ‹¤ν–‰ μ—­ν•  μμ •

Lambda ν•¨μκ°€ KMSλ¥Ό νΈμ¶ν•λ ¤λ©΄ ν•΄λ‹Ή ν•¨μμ— μ—°κ²°λ **IAM μ‹¤ν–‰ μ—­ν• **μ— `kms:Decrypt` κ¶ν•μ΄ λ¶€μ—¬λμ–΄μ•Ό ν•©λ‹λ‹¤.

**β… κ¶ν• μ¶”κ°€ κ³Όμ •**

1. **Lambda ν•¨μ μ—­ν•  μ°ΎκΈ°**: Lambda ν•¨μ μ„¤μ •μ "Permissions" νƒ­μ—μ„ μ‹¤ν–‰ μ—­ν• (Execution Role) λ§ν¬λ¥Ό ν΄λ¦­ν•©λ‹λ‹¤.
    
2. **μ •μ±… νΈμ§‘**: μ—­ν•  νμ΄μ§€μ—μ„ "Add permissions" > "Create inline policy"λ¥Ό μ„ νƒν•©λ‹λ‹¤.
    
3. **μ •μ±… μ„¤μ •**:
    - **μ„λΉ„μ¤**: KMS   
    - **μ‘μ—…(Actions)**: `Decrypt`
    - **λ¦¬μ†μ¤(Resources)**: ν™κ²½ λ³€μ μ•”νΈν™”μ— μ‚¬μ©λ **KMS ν‚¤μ ARN**μ„ μ§€μ •ν•©λ‹λ‹¤.

4. **μ •μ±… μ €μ¥**: μ •μ±… μ΄λ¦„μ„ μ§€μ •ν•κ³  μ €μ¥ν•©λ‹λ‹¤.
    

μ΄μ  Lambda ν•¨μλ” KMS ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ ν™κ²½ λ³€μλ¥Ό μ„±κ³µμ μΌλ΅ λ³µνΈν™”ν•  μ μκ² λ©λ‹λ‹¤.

---

## 5. β… κ²°κ³Ό ν™•μΈ

μ½”λ“λ¥Ό λ°°ν¬ν•κ³  ν…μ¤νΈ μ΄λ²¤νΈλ¥Ό μ‹¤ν–‰ν•λ©΄, λ΅κ·Έμ—μ„ λ‹¤μκ³Ό κ°™μ€ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.

|λ΅κ·Έ λ‚΄μ©|μ„¤λ…|
|---|---|
|**`Encrypted value: AQ...`**|μ•”νΈν™”λ ν™κ²½ λ³€μ κ°’ (Base64 μΈμ½”λ”©λ λ¬Έμμ—΄)|
|**`Decrypted value: supersecret`**|μ„±κ³µμ μΌλ΅ λ³µνΈν™”λ ν‰λ¬Έ κ°’|

μ΄ μ‹¤μµμ„ ν†µν•΄, Lambdaμ ν™κ²½ λ³€μλ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•κ³ , ν•¨μκ°€ ν•„μ”ν•  λ•λ§ λ³µνΈν™”ν•μ—¬ μ‚¬μ©ν•λ” μ•μ „ν• ν¨ν„΄μ„ κµ¬μ¶•ν•  μ μμµλ‹λ‹¤. μ΄λ” μ„λ²„λ¦¬μ¤ μ•„ν‚¤ν…μ²μ λ³΄μ•μ„ κ°•ν™”ν•λ” μ¤‘μ”ν• λ°©λ²•μ…λ‹λ‹¤.