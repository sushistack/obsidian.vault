
## 🏗️ 사전 준비: Elastic Beanstalk 환경 생성

CodePipeline 실습을 위해 먼저 AWS **Elastic Beanstalk** 환경을 두 개 생성해야 합니다. 하나는 개발(Dev) 환경, 다른 하나는 운영(Prod) 환경으로 사용합니다.

1. **애플리케이션 생성**: Elastic Beanstalk 서비스에서 `my-first-web-app`이라는 애플리케이션을 생성합니다.
    
2. **개발 환경(Dev) 생성**:
    
    - **환경 이름**: `dev` 또는 `env`
        
    - **플랫폼**: `Node.js` (최신 버전)
        
    - **애플리케이션 코드**: `Sample application` 선택
        
    - **인스턴스 유형**: `Single instance` (단일 인스턴스)
        
    - **추가 옵션**: 키 페어(Key Pair) 등은 기본값으로 유지하고 다음 단계로 진행합니다.
        
3. **운영 환경(Prod) 생성**:
    
    - 동일한 애플리케이션(`my-first-web-app`) 내에서 새로운 환경을 생성합니다.
        
    - **환경 이름**: `prod`
        
    - 나머지 설정은 위와 동일하게 `Node.js`, `Sample application`, `Single instance`로 설정합니다.


두 환경이 모두 성공적으로 배포되면, CodePipeline을 이용해 이 두 환경에 자동으로 코드를 배포할 준비가 완료됩니다.

---

## 🚀 CodePipeline 구축: GitHub와 Beanstalk 연결

이제 GitHub 리포지토리의 코드를 Elastic Beanstalk 환경에 자동으로 배포하는 **CodePipeline**을 생성합니다.

### 1. 파이프라인 생성 및 역할 설정

- **CodePipeline** 서비스로 이동하여 `MyFirstPipeline`이라는 이름으로 새로운 파이프라인을 생성합니다.
    
- **서비스 역할(Service Role)**: `New service role`을 선택하여 CodePipeline이 다른 AWS 서비스에 접근할 수 있도록 새로운 IAM 역할을 생성합니다.
    

### 2. 소스 스테이지 구성 (GitHub V2)

- **소스 공급자(Source provider)**: `GitHub (Version 2)`를 선택합니다.
    
- **GitHub 연결(Connection)**: `Connect to GitHub`를 클릭하여 새로운 연결을 생성합니다.
    
    - 연결 이름: `MyGitHubConnection`
        
    - GitHub 계정 로그인 후, AWS Connector에 대한 접근을 **승인**합니다.
        
- **리포지토리(Repository)**: 이전에 생성한 `my-nodejs-app` 리포지토리를 선택합니다.
    
- **브랜치(Branch)**: `main` 브랜치를 선택합니다.
    
- **변경 감지(Trigger)**: `CodePipeline default`를 사용하면 GitHub에 변경사항이 푸시될 때마다 파이프라인이 자동으로 실행됩니다.
    

### 3. 빌드 스테이지 건너뛰기

- 이 실습에서는 간단한 HTML 파일을 배포하기 때문에 **빌드 스테이지**를 건너뜁니다.
    
- `Skip build stage`를 선택하고 다음 단계로 넘어갑니다.
    

### 4. 배포 스테이지 구성 (Elastic Beanstalk)

- **배포 공급자(Deploy provider)**: `AWS Elastic Beanstalk`를 선택합니다.
    
- **리전(Region)**: Elastic Beanstalk 환경이 있는 리전을 선택합니다.
    
- **애플리케이션 이름(Application name)**: `my-first-web-app`
    
- **환경 이름(Environment name)**: 첫 번째 배포 환경인 `env`를 선택합니다.
    
- 파이프라인 생성을 완료합니다.
    

### 5. IAM 권한 추가

- 파이프라인이 정상적으로 동작하려면 Beanstalk에 대한 추가 권한이 필요할 수 있습니다.
    
- `MyFirstPipeline`의 **Settings** 탭으로 이동하여 `Service Role`을 클릭합니다.
    
- 해당 역할에 **AmazonElasticBeanstalkFullAccess** 또는 **AWSElasticBeanstalkAdministratorAccess** 정책을 추가하여 배포 권한을 부여합니다.
    

---

## 🏃‍♀️ CodePipeline 실행: CI/CD 자동화 경험하기

이제 GitHub의 코드 변경이 Elastic Beanstalk 환경에 자동으로 배포되는 과정을 직접 확인합니다.

### 1. 첫 번째 배포: 개발 환경(env)

- 파이프라인이 생성되면 자동으로 첫 번째 실행이 시작됩니다.
    
- **Source** 스테이지가 GitHub에서 코드를 가져옵니다. `index.html` 파일의 배경색은 **파란색(blue)**으로 설정되어 있습니다.
    
- **Deploy** 스테이지가 `env` 환경에 코드를 배포합니다.
    
- 배포가 완료되면 `env` 환경의 URL에 접속하여 웹 페이지의 배경이 **파란색**으로 바뀌었는지 확인합니다.
    

### 2. 파이프라인 수정: 운영 환경(prod) 추가 및 수동 승인

- `MyFirstPipeline`의 **Edit** 버튼을 클릭하여 파이프라인을 수정합니다.
    
- **Deploy to prod**라는 새로운 스테이지를 추가합니다.
    
    - **첫 번째 액션 그룹**: **Manual Approval**(수동 승인) 액션을 추가합니다. 이는 개발 환경 배포 후 운영 환경에 배포하기 전에 수동으로 확인하는 단계입니다.
        
    - **두 번째 액션 그룹**: `AWS Elastic Beanstalk` 배포 액션을 추가합니다.
        
        - **환경 이름**: `prod`를 선택합니다.
            
- 파이프라인을 저장합니다.
    

### 3. 두 번째 배포: 전체 CI/CD 워크플로우

- GitHub로 이동하여 `my-nodejs-app` 리포지토리의 `index.html` 파일을 수정합니다.
    
- `<body style="background-color: blue;">`를 `<body style="background-color: red;">`로 변경하고 커밋합니다.
    
- 이 커밋으로 인해 파이프라인이 자동으로 다시 시작됩니다.
    
- **Source** → **Deploy(env)** 스테이지가 차례로 실행됩니다. `env` 환경에 접속하여 배경색이 **빨간색**으로 변경된 것을 확인합니다.
    
- 이제 `Deploy to prod` 스테이지에서 **Manual Approval** 액션이 멈춥니다.
    
- **Review** 버튼을 클릭하여 변경 사항을 확인하고 `Approve`를 선택합니다.
    
- 승인이 완료되면 `prod` 환경에 배포가 자동으로 시작됩니다.
    
- 배포가 완료되면 `prod` 환경의 URL에 접속하여 배경색이 **빨간색**으로 변경된 것을 확인할 수 있습니다.

---

## ♻️ 정리 및 후속 조치

이번 실습을 통해 GitHub의 코드 변경이 Elastic Beanstalk 환경에 자동으로 반영되는 완벽한 CI/CD 파이프라인을 경험했습니다.

|스테이지|설명|
|---|---|
|**Source**|GitHub 리포지토리의 `main` 브랜치 변경사항을 감지|
|**Deploy**|`env` 환경에 변경사항을 자동으로 배포|
|**Manual Approval**|운영 환경 배포 전 수동 승인 대기|
|**Deploy to prod**|승인 후 `prod` 환경에 배포|

**⚠️ 중요**: 이 실습에 사용된 Elastic Beanstalk 환경은 EC2 인스턴스를 사용하므로, 불필요한 비용이 청구되지 않도록 실습 완료 후 반드시 두 환경을 모두 **삭제**해야 합니다.