****
## 💡 고가용성 환경의 필요성

이전 실습에서는 단일 인스턴스(Single Instance) 환경을 통해 Elastic Beanstalk의 기본 동작을 알아보았습니다. 이번에는 실제 운영 환경에 적합한 **고가용성(High Availability, HA)** 환경을 구축하여 트래픽 증가에 유연하게 대응하고 장애에 대비하는 방법을 살펴보겠습니다.

고가용성 환경은 **로드 밸런서(Load Balancer)**와 **오토 스케일링 그룹(Auto Scaling Group)**을 활용하여 여러 EC2 인스턴스에 트래픽을 분산하고, 필요에 따라 인스턴스를 자동으로 확장/축소하는 구조입니다.


---

## ⚙️ 고가용성 환경 생성 단계

기존 `MyApplication`에 새로운 `MyApplication-prod` 환경을 생성하는 과정을 단계별로 요약합니다.

### 1. 환경 생성 시작

- Elastic Beanstalk 콘솔에서 `MyApplication`을 선택한 후, **'환경 생성(Create new environment)'**을 클릭합니다.
- 환경 유형은 동일하게 **'웹 서버 환경(Web server environment)'**을 선택합니다.
- 환경 이름을 `MyApplication-prod`로 지정하여 프로덕션 환경임을 명시합니다.

### 2. 플랫폼 및 코드 선택

- **플랫폼(Platform)**: 기존과 동일하게 **Node.js**를 선택합니다.
- **애플리케이션 코드**: **'샘플 애플리케이션(Sample application)'**을 사용하여 배포합니다.
### 3. 사전 설정 선택

- 이번에는 **'고가용성(High Availability)'**을 선택합니다. 이 설정은 Elastic Beanstalk이 로드 밸런서와 오토 스케일링 그룹을 자동으로 구성하도록 지시합니다.

### 4. IAM 역할 재사용

- 이전 실습에서 생성한 **IAM 역할**(`elasticbeanstalk-service-role` 및 `aws-elasticbeanstalk-ec2-role`)을 그대로 재사용합니다.

### 5. 추가 구성 (선택 사항)

고가용성 환경에서는 다양한 고급 설정을 할 수 있습니다. `Skip to review`를 선택하면 자동으로 최적의 설정이 적용되지만, 필요에 따라 다음과 같은 항목을 직접 조정할 수 있습니다.

|설정 항목|주요 구성 내용|
|---|---|
|**네트워킹**|VPC 및 서브넷을 지정하여 인스턴스 및 로드 밸런서가 배포될 위치를 설정합니다.|
|**인스턴스**|EC2 인스턴스의 유형(예: t3.micro), 보안 그룹 등을 설정합니다.|
|**용량(Capacity)**|**오토 스케일링 그룹**의 최소/최대 인스턴스 개수(예: 1~4개) 및 스케일링 정책을 설정합니다.|
|**로드 밸런서**|**Application Load Balancer(ALB)** 또는 **Network Load Balancer(NLB)** 유형을 선택하고, 리스너와 규칙을 정의합니다.|
|**모니터링**|**CloudWatch**를 통한 상세 모니터링 및 헬스 리포팅(Enhanced health reporting) 설정을 할 수 있습니다.|


---

## 🚀 배포 후 리소스 변화 확인

`Submit`을 클릭하여 환경을 생성하면 약 10분 정도의 시간이 소요됩니다. 배포가 완료되면, Elastic Beanstalk가 단일 인스턴스 환경과 다르게 어떤 AWS 리소스들을 생성했는지 확인할 수 있습니다.

### 1. 로드 밸런서 (Load Balancer)

- **EC2 콘솔 -> 로드 밸런서**에서 새로운 **ALB(Application Load Balancer)**가 생성된 것을 볼 수 있습니다.
- 이 로드 밸런서는 여러 가용 영역(Availability Zone)에 걸쳐 배포되며, 자동으로 생성된 **타겟 그룹(Target Group)**에 EC2 인스턴스를 연결합니다.

### 2. 오토 스케일링 그룹 (Auto Scaling Group)

- **EC2 콘솔 -> 오토 스케일링 그룹**에서 `MyApplication-prod`용 ASG가 생성된 것을 볼 수 있습니다.
- 이 ASG는 설정된 최소/최대 용량(예: 1~4)에 맞춰 EC2 인스턴스를 관리합니다.
- 기본적으로 CPU 사용률 등 특정 지표에 따라 인스턴스를 자동으로 확장하거나 축소하는 **스케일링 정책**이 설정되어 있습니다.
    

### 3. 보안 그룹 (Security Group)

- **로드 밸런서 보안 그룹**: 외부 트래픽(예: HTTP 포트 80)을 허용하며, 이 트래픽을 EC2 인스턴스 보안 그룹으로 전달합니다.
- **EC2 인스턴스 보안 그룹**: 로드 밸런서 보안 그룹에서 오는 트래픽만 허용하여, 인스턴스가 외부로부터 직접적인 접근을 받지 않도록 보호합니다.

### 4. 애플리케이션 접속

- `MyApplication-prod` 환경의 **도메인 주소**를 통해 접속하면, `dev` 환경과 동일한 샘플 애플리케이션이 표시됩니다.
- 그러나 이번에는 단일 인스턴스가 아닌, 로드 밸런서 뒤의 오토 스케일링 그룹에서 관리되는 여러 인스턴스 중 하나에 접속하게 됩니다.

---

## ✅ 요약 및 결론

Elastic Beanstalk는 개발자가 **"고가용성 환경으로 코드를 실행하고 싶다"**는 요구사항만 전달하면, 복잡한 인프라(로드 밸런서, 오토 스케일링 등)를 자동으로 구성해 줍니다. 이는 개발자가 인프라 관리 부담 없이 오직 애플리케이션 개발에만 집중할 수 있게 하는 Elastic Beanstalk의 강력한 장점입니다. 이제 우리는 `dev`와 `prod` 두 개의 환경을 통해 Elastic Beanstalk의 유연한 환경 관리 기능을 직접 경험해 보았습니다.