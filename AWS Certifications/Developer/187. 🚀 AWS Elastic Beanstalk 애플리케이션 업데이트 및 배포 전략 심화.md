
---

## 💡 애플리케이션 업데이트 배포 정책 설정

Elastic Beanstalk 환경의 **`구성(Configuration)`** 메뉴에서 **`업데이트, 모니터링 및 로깅(Updates, monitoring, and logging)`**을 편집하여 애플리케이션 배포 정책을 설정할 수 있습니다.

|배포 정책|설명|설정 옵션|
|---|---|---|
|**All at once**|모든 인스턴스를 한 번에 업데이트합니다. 가장 빠르지만, 다운타임이 발생합니다.|없음 (고정)|
|**Rolling**|지정된 배치 크기(고정 개수 또는 백분율)만큼 인스턴스를 순차적으로 업데이트합니다.|**배치 크기(Batch size)**<br>- `고정(Fixed)`: 특정 개수<br>- `백분율(Percentage)`: 전체의 백분율|
|**Rolling with additional batch**|새로운 인스턴스를 추가한 후 롤링 업데이트를 진행하여 서비스 용량 감소를 방지합니다.|**배치 크기(Batch size)**<br>- `고정(Fixed)`<br>- `백분율(Percentage)`|
|**Immutable**|기존 인스턴스는 그대로 두고, 새로운 인스턴스 세트에 업데이트 버전을 배포한 후 전환합니다.|없음 (고정)|
|**Traffic splitting**|새로운 버전으로 트래픽의 일부(백분율)를 먼저 분할하여 보내고, 문제가 없으면 전체 트래픽을 전환합니다.|**트래픽 분할(Traffic Split)**<br>- `트래픽 비율(Traffic percentage)`<br>- `평가 기간(Evaluation period)`|

---

## 🔄 Immutable(변경 불가능) 배포 실습: 배경색 변경

`Immutable` 배포 방식을 사용하여 애플리케이션의 배경색을 변경하는 실습 과정입니다. 이 배포 방식은 프로덕션 환경에 적합한 무중단 배포를 제공합니다.

### 1. 🎨 애플리케이션 코드 수정

- **`nodejs.zip`** 샘플 애플리케이션을 다운로드합니다.
- `index.html` 파일에서 배경색(`background-color`)을 기존의 초록색(green)에서 **파란색(blue)**으로 변경합니다.
- 변경된 코드를 다시 `.zip` 파일로 압축하여 새 버전으로 준비합니다.

### 2. 🚀 Immutable 배포 실행

- Elastic Beanstalk 콘솔에서 `MyApplication-prod` 환경을 선택합니다.
- **`업로드 및 배포(Upload and deploy)`** 버튼을 클릭합니다.
- 준비된 **파란색 버전**의 `.zip` 파일을 업로드하고, 버전 레이블을 `MyApplication-Blue`로 지정합니다.
- **`배포 정책(Deployment preferences)`**이 `Immutable`로 설정된 것을 확인하고 **`제출(Submit)`**합니다.

### 3. 📝 이벤트 로그를 통한 Immutable 배포 과정 확인

Immutable 배포가 진행되는 동안 Elastic Beanstalk의 이벤트 로그를 통해 다음과 같은 단계가 진행되는 것을 볼 수 있습니다.

1. **임시 ASG 생성**: 기존 환경의 EC2 인스턴스를 유지한 채, 새로운 버전을 배포할 **임시 오토 스케일링 그룹(Temporary Auto Scaling Group)**이 생성됩니다.
2. **새 인스턴스 시작**: 임시 ASG에 새로운 EC2 인스턴스가 하나씩 시작되고, `MyApplication-Blue` 버전이 배포됩니다.
3. **상태 확인**: 새로운 인스턴스가 모두 헬스 체크를 통과하는지 확인합니다.
4. **인스턴스 교체**: 새로운 인스턴스들이 기존의 영구 오토 스케일링 그룹에 통합되고, 기존 인스턴스들은 로드 밸런서에서 제외됩니다.
5. **기존 리소스 정리**: 기존 인스턴스와 임시 오토 스케일링 그룹이 모두 종료됩니다.

### 4. ✅ 배포 결과 확인

- 배포가 완료되면, `MyApplication-prod` 환경의 도메인에 접속하여 웹 페이지의 배경색이 파란색으로 변경된 것을 확인할 수 있습니다.


---

## 🔗 환경 URL 스와핑(Swapping) 기능

`환경 URL 스와핑`은 Elastic Beanstalk에서 **Blue/Green 배포** 전략을 구현하는 데 사용되는 유용한 기능입니다.

### 1. 🔄 스와핑의 동작 원리

- 두 개의 환경(예: `dev`와 `prod`)의 **도메인 URL을 서로 교체**하는 기능입니다.
    
- 예를 들어, `MyApplication-prod` 환경의 도메인이 `prod.ap-northeast-2.elasticbeanstalk.com`이고, `MyApplication-dev`의 도메인이 `dev.ap-northeast-2.elasticbeanstalk.com`이라면, 스와핑 후에는 각각의 도메인이 상대방의 환경을 가리키게 됩니다.


### 2. 💡 Blue/Green 배포 활용 예시

1. **새로운 환경 복제**: 현재 운영 중인 `prod` 환경을 복제하여 `prod-v2`와 같은 새로운 환경을 생성합니다.
2. **새 버전 배포 및 테스트**: `prod-v2` 환경에 새로운 애플리케이션 버전을 배포하고, 실제 운영 환경과 동일한 조건에서 충분히 테스트합니다.
3. **URL 스와핑**: 테스트가 완료되면, `prod` 환경과 `prod-v2` 환경의 도메인을 교체합니다.
4. **리소스 정리**: 모든 트래픽이 `prod-v2`로 성공적으로 전환되면, 기존의 `prod` 환경을 삭제합니다.

### 3. ✅ 스와핑 실습 결과 확인

- `MyApplication-prod`와 `MyApplication-dev`의 도메인을 서로 교체하면, 이전에 파란색 배경을 표시하던 `prod` URL이 초록색 배경을, 초록색 배경을 표시하던 `dev` URL이 파란색 배경을 표시하게 됩니다.
    
- 이는 DNS 업데이트를 통해 두 환경의 트래픽이 서로 교체되었음을 의미합니다.
- 이 기능을 통해, 위험 부담 없이 새로운 환경을 완전히 검증한 후 운영 환경으로 전환할 수 있습니다.