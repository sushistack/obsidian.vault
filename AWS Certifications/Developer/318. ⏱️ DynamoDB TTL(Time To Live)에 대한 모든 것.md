
Amazon DynamoDB의 **TTL(Time To Live)**은 특정 시점이 지나면 테이블의 데이터를 자동으로 삭제하는 기능입니다. 이 기능은 만료된 데이터를 효율적으로 관리하여 스토리지 비용을 절감하고, 규정 준수 요건을 충족하는 데 큰 도움을 줍니다. 이번 아티클에서는 DynamoDB TTL이 어떻게 동작하는지, 그리고 어떻게 설정하고 활용할 수 있는지 자세히 알아보겠습니다.

---

## 💡 TTL의 기본 원리 및 특징

TTL은 설정한 타임스탬프(Unix Epoch 형식)가 현재 시간보다 작아지면 해당 아이템을 자동으로 삭제하는 프로세스입니다. 이 기능은 데이터를 관리하는 데 있어 몇 가지 중요한 특징을 가지고 있습니다.

![[Pasted image 20250906194749.png]]

### 💰 비용 효율성

- **WCU(Write Capacity Unit) 소비 없음**: TTL에 의해 아이템이 삭제될 때 **WCU가 소모되지 않습니다**. 이는 직접 `DeleteItem` 작업을 호출하는 것과 달리, 추가적인 비용 없이 데이터를 정리할 수 있다는 것을 의미합니다.
    
- **스토리지 최적화**: 만료된 데이터를 자동으로 제거함으로써, 불필요한 스토리지 공간을 차지하는 것을 방지하고 결과적으로 비용을 절감할 수 있습니다.
    

### ⚙️ 삭제 프로세스

TTL에 의한 삭제는 즉시 일어나지 않습니다. DynamoDB 내부의 백그라운드 프로세스가 현재 시간을 기준으로 만료된 아이템을 식별하고 삭제하는 작업을 수행합니다. 이 과정은 다음과 같이 두 단계로 이루어집니다.

1. **스캔 및 마킹**: DynamoDB가 테이블을 주기적으로 스캔하여 TTL 속성값이 현재 시간보다 작은 아이템을 만료된 것으로 마킹합니다.
    
2. **삭제**: 마킹된 아이템들을 테이블에서 삭제합니다. 이 과정은 일반적으로 만료 후 **수 시간에서 최대 48시간 이내**에 완료됩니다.
    

> ⚠️ **중요**: 만료되었지만 아직 삭제되지 않은 아이템은 `GetItem`, `Query`, `Scan`과 같은 읽기 작업에서 **여전히 검색됩니다**. 만약 애플리케이션에서 즉각적인 데이터 일관성이 중요하다면, 클라이언트 측에서 직접 필터링 로직을 추가해야 합니다.

### 🔗 보조 인덱스 및 스트림

- **인덱스 동기화**: TTL에 의해 아이템이 삭제되면, 해당 아이템은 **로컬 보조 인덱스(LSI)** 및 **글로벌 보조 인덱스(GSI)**에서도 자동으로 삭제됩니다. 따라서 인덱스 데이터를 수동으로 정리할 필요가 없습니다.
    
- **DynamoDB Streams**: TTL로 인해 삭제된 각 아이템은 **DynamoDB Streams**에 `DELETE` 이벤트 레코드로 기록됩니다. 이 스트림을 통해 삭제된 데이터를 복구하거나, 다른 시스템에 동기화하는 등의 후속 작업을 수행할 수 있습니다.

---

## 🛠️ TTL 설정 및 사용 방법

DynamoDB 테이블에서 TTL을 설정하는 과정은 매우 간단합니다. 테이블 생성 시 또는 기존 테이블의 설정을 변경하여 활성화할 수 있습니다.

### 📝 TTL 속성 준비

TTL을 사용하려면 테이블의 모든 아이템에 **TTL 속성(attribute)**을 추가해야 합니다. 이 속성의 값은 **숫자 타입(Number)**이어야 하며, 데이터의 만료 시간을 **Unix Epoch 타임스탬프** 형식으로 지정해야 합니다.

예시:

만약 현재 시각이 2025년 9월 6일 오후 8시이고, 아이템을 한 시간 뒤에 만료시키고 싶다면, expire_on 속성 값은 2025년 9월 6일 오후 9시에 해당하는 Unix Epoch 타임스탬프가 되어야 합니다.

|사용자 ID|이름|expire_on (TTL 속성)|
|---|---|---|
|`john_123`|John|`1757235086`|
|`alice_456`|Alice|`1757238686`|

> 💻 **Tip**: Unix Epoch 타임스탬프 변환이 필요하다면 **"Epoch Converter"** 같은 온라인 도구를 활용할 수 있습니다.

### ⚙️ TTL 활성화 단계

1. **테이블 선택**: DynamoDB 콘솔에서 TTL을 설정하려는 테이블을 선택합니다.
    
2. **설정 탭**: 테이블 상세 페이지에서 `추가 설정(Additional settings)` 탭으로 이동합니다.
    
3. **TTL 활성화**: `Time To Live` 섹션에서 `활성화(Enable)` 버튼을 클릭합니다.
    
4. **속성 이름 지정**: TTL에 사용할 속성 이름을 입력합니다. 위 예시에서는 `expire_on`이 됩니다.
    
5. **저장**: 설정을 저장하면 TTL이 즉시 활성화됩니다.
    

---

## 📈 활용 사례

TTL은 다음과 같은 다양한 상황에서 유용하게 활용될 수 있습니다.

- **세션 데이터 관리**: 사용자의 로그인 세션 정보를 저장하고, 세션 만료 시 자동으로 데이터를 삭제할 때.
    
- **로그 및 이벤트 데이터**: 일정 기간이 지나면 더 이상 필요 없는 로그 기록, 알림, 이벤트 데이터 등을 정리할 때.
    
- **임시 데이터 저장**: 장바구니, 인증 토큰, 일회성 비밀번호(OTP)와 같이 일정 시간 후에 유효하지 않게 되는 데이터를 보관할 때.
    
- **규정 준수**: GDPR(General Data Protection Regulation)과 같이 개인정보를 특정 기간만 보관해야 하는 규제 요건을 충족할 때.
    

---

## 📊 모니터링

TTL에 의한 삭제 작업은 **Amazon CloudWatch**를 통해 모니터링할 수 있습니다. DynamoDB 테이블의 `ConsumedWriteCapacityUnits`와 `DeletedItemCount`와 같은 지표를 확인하여 TTL이 정상적으로 작동하고 있는지, 얼마나 많은 아이템이 삭제되었는지 파악할 수 있습니다. 이는 시스템의 상태를 확인하고, 예상치 못한 데이터 삭제를 방지하는 데 필수적입니다.

---

## 🤔 마무리

DynamoDB TTL은 불필요한 데이터를 자동으로 정리하여 비용을 절감하고, 데이터 관리의 효율성을 높이는 강력한 기능입니다. 올바르게 설정하면 애플리케이션의 복잡성을 줄이고, 데이터 수명 주기를 효과적으로 관리할 수 있습니다. TTL의 비동기적 삭제 특성을 이해하고 클라이언트 측 로직을 함께 고려한다면, 더욱 안정적이고 효율적인 시스템을 구축할 수 있을 것입니다.

혹시 TTL에 대해 더 궁금한 점이 있으신가요?