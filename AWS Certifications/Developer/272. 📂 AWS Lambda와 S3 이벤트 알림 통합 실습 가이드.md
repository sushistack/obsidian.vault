이번 아티클에서는 **AWS S3 이벤트 알림(S3 Event Notifications)**을 사용하여 Lambda 함수를 자동으로 트리거하는 방법에 대해 자세히 알아보겠습니다. 이 통합은 S3 버킷에 객체가 생성, 삭제 또는 수정될 때 특정 작업을 자동으로 수행하는 데 매우 유용합니다.

### 📜 S3 이벤트 알림이란?

S3 이벤트 알림은 S3 버킷에서 발생하는 다양한 활동(예: 객체 생성, 삭제, 복원 등)을 감지하고, 이를 지정된 대상(Destination)으로 알리는 기능입니다.

- **주요 이벤트**: `s3:ObjectCreated`, `s3:ObjectRemoved`, `s3:ObjectRestore` 등
    
- **필터링**: 접두사(Prefix) 및 접미사(Suffix)를 사용하여 특정 경로 또는 파일 확장자를 가진 객체에 대해서만 알림을 설정할 수 있습니다.

S3는 이벤트 알림을 **SQS**, **SNS**, 또는 **Lambda 함수**로 보낼 수 있으며, 이 중에서 Lambda 함수로 직접 전송하는 방식은 **비동기 호출**로 작동합니다.

---

### 🛠️ Lambda와 S3 통합 실습

이제 S3에 객체가 업로드될 때마다 Lambda 함수가 자동으로 실행되도록 통합하는 과정을 단계별로 진행해 보겠습니다.

#### 1. Lambda 함수 생성

먼저 S3 이벤트를 처리할 Lambda 함수를 생성합니다.

1. Lambda 콘솔에서 **'함수 생성(Create function)'**을 클릭합니다.
    
2. **함수 이름**을 `Lambda-S3`로 지정하고, **런타임**은 `Python 3.8`을 선택합니다.
    
3. 함수 코드를 다음과 같이 수정하여 S3 이벤트 페이로드를 CloudWatch Logs에 출력하도록 설정합니다.

```Python
import json

def lambda_handler(event, context):
    print("Received S3 Event:", json.dumps(event, indent=2))
    return {
        'statusCode': 200,
        'body': json.dumps('Event received!')
    }
```

위 코드를 함수에 붙여넣고 **'배포(Deploy)'** 버튼을 눌러 변경 사항을 저장합니다.

---

#### 2. S3 버킷 생성

다음으로, 이벤트 알림을 보낼 S3 버킷을 생성합니다.

1. S3 콘솔로 이동하여 **'버킷 생성(Create bucket)'**을 클릭합니다.
    
2. **버킷 이름**을 `demo-s3-events-stephane`로 지정합니다.
    
3. **리전**이 Lambda 함수와 동일한지(예: `Ireland`) 확인합니다.
    
4. 기타 설정을 기본값으로 두고 버킷을 생성합니다.

---

#### 3. S3 이벤트 알림 설정

이제 S3 버킷에 이벤트 알림 규칙을 추가하여 Lambda 함수를 연결합니다.

1. 생성한 S3 버킷의 **'속성(Properties)'** 탭으로 이동합니다.
    
2. 아래로 스크롤하여 **'이벤트 알림(Event notifications)'** 섹션을 찾고 **'이벤트 알림 생성(Create event notification)'**을 클릭합니다.
    
3. **일반 설정**에서 이벤트 알림 이름을 `invoke-Lambda`로 지정합니다.
    
4. **이벤트 유형(Event types)**에서 `All object create events`를 선택합니다.
    
5. **대상(Destination)** 섹션에서 `Lambda function`을 선택하고, 드롭다운 메뉴에서 `Lambda-S3` 함수를 지정합니다.
    
6. **'변경 내용 저장(Save changes)'**을 클릭하여 설정을 완료합니다.

---

#### 4. 권한 및 트리거 확인

이벤트 알림을 설정하면 S3가 Lambda 함수를 호출할 수 있도록 자동으로 권한이 추가됩니다.

1. `Lambda-S3` 함수의 **'구성(Configuration)'** 탭으로 이동합니다.
    
2. **'트리거(Triggers)'**를 보면 S3 버킷이 트리거로 추가된 것을 확인할 수 있습니다.
    
3. **'권한(Permissions)'** 탭의 **'리소스 기반 정책 설명(Resource-based policy statements)'**을 보면 S3 버킷이 `lambda:InvokeFunction` 권한을 가지고 있다는 정책이 추가된 것을 볼 수 있습니다. 이 정책은 오직 해당 S3 버킷만 Lambda 함수를 호출하도록 허용합니다.

---

#### 5. 통합 테스트 및 이벤트 페이로드 확인

이제 모든 설정이 완료되었으므로, S3에 파일을 업로드하여 통합이 제대로 작동하는지 확인합니다.

1. S3 버킷의 **'객체(Objects)'** 탭으로 이동하여 `Add files`를 클릭하고 아무 파일이나 업로드합니다.
    
2. 업로드가 완료되면, Lambda 함수가 자동으로 실행됩니다.
    
3. Lambda 함수 콘솔의 **'모니터링(Monitor)'** 탭으로 이동한 후, **'CloudWatch 로그 보기(View logs in CloudWatch)'**를 클릭합니다.
    
4. 가장 최근의 로그 스트림을 확인하면 S3 이벤트에 대한 상세 정보가 출력된 것을 볼 수 있습니다.

**S3 이벤트 페이로드의 주요 정보**

|JSON 경로|설명|
|---|---|
|`eventSource`|`aws:s3`|
|`eventName`|`ObjectCreated:Put` 등 발생한 이벤트 유형|
|`s3.bucket.name`|이벤트가 발생한 S3 버킷 이름|
|`s3.object.key`|업로드된 객체의 파일 경로 및 이름|
|`s3.object.size`|객체 크기(바이트)|
|`s3.object.eTag`|객체의 ETag|

이 페이로드에는 파일 경로, 버킷 이름 등 함수가 작업을 수행하는 데 필요한 모든 정보가 포함되어 있습니다. 함수 코드는 이 정보를 바탕으로 S3 API를 통해 실제 객체에 접근하여 추가적인 처리를 수행할 수 있습니다.