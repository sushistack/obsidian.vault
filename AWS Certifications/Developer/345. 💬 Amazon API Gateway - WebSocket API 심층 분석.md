
μ΄λ² κ°€μ΄λ“μ—μ„λ” Amazon API Gatewayμ **WebSocket API**μ— λ€ν•΄ μƒμ„Έν μ•μ•„λ³΄κ² μµλ‹λ‹¤. WebSocket APIλ” RESTful APIμ™€ λ‹¬λ¦¬, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ **μ–‘λ°©ν–¥ ν†µμ‹ **μ„ κ°€λ¥ν•κ² ν•μ—¬ μ‹¤μ‹κ°„ μ• ν”λ¦¬μΌ€μ΄μ…μ„ κµ¬μ¶•ν•λ” λ° ν•„μμ μΈ κΈ°μ μ…λ‹λ‹¤.

---

## π”„ 1λ‹¨κ³„: WebSocketμ κΈ°λ³Έ μ›λ¦¬ - μ–‘λ°©ν–¥ ν†µμ‹ 

**WebSocket**μ€ ν΄λΌμ΄μ–ΈνΈ(μ: μ›Ή λΈλΌμ°μ €)μ™€ μ„λ²„ κ°„μ— λ‹¨ ν• λ²μ μ—°κ²°(handshake)μ„ ν†µν•΄ **μ§€μ†μ μΈ μ—°κ²°(Persistent Connection)**μ„ μλ¦½ν•©λ‹λ‹¤. μ΄ μ—°κ²°μ΄ μ μ§€λλ” λ™μ•, μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ μ”μ²­ μ—†μ΄λ„ λ°μ΄ν„°λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ **ν‘Έμ‹(Push)**ν•  μ μμµλ‹λ‹¤.

### π’΅ μ£Όμ” νΉμ§•

- **μ–‘λ°©ν–¥(Two-way)**: ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ μƒλ€λ°©μ—κ² μ–Έμ λ“ μ§€ λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό μ μμµλ‹λ‹¤.
    
- **μƒνƒ μ μ§€(Stateful)**: ν• λ² μ—°κ²°λλ©΄ μƒνƒκ°€ μ μ§€λλ―€λ΅, λ§¤λ² μƒλ΅μ΄ μ—°κ²°μ„ μλ¦½ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.
    
- **μ‹¤μ‹κ°„ μ• ν”λ¦¬μΌ€μ΄μ…**: μ±„ν… μ• ν”λ¦¬μΌ€μ΄μ…, ν‘μ—… ν”λ«νΌ, λ©€ν‹°ν”λ μ΄μ–΄ κ²μ„, κΈμµ κ±°λ ν”λ«νΌ λ“± μ‹¤μ‹κ°„ μƒνΈμ‘μ©μ΄ μ¤‘μ”ν• μ• ν”λ¦¬μΌ€μ΄μ…μ— μ ν•©ν•©λ‹λ‹¤.

---

## π”— 2λ‹¨κ³„: WebSocket APIμ μ—°κ²° λ° λ©”μ‹μ§€ νλ¦„

![[Pasted image 20250907195635.png]]

WebSocket APIλ” REST APIμ™€ λ‹¬λ¦¬, μ—°κ²° μƒλ…μ£ΌκΈ°(Connect, Send, Disconnect)μ— λ”°λΌ λ‹¤λ¥Έ λ°±μ—”λ“ λ΅μ§μ„ νΈμ¶ν•©λ‹λ‹¤.

### 1. **μ—°κ²°(Connection)**

- **`onConnect`**: ν΄λΌμ΄μ–ΈνΈκ°€ `wss://`λ΅ μ‹μ‘ν•λ” WebSocket URLμ— μ ‘κ·Όν•λ©΄, API Gatewayλ” **`onConnect`** λΌμ°νΈλ¥Ό νΈμ¶ν•©λ‹λ‹¤.
    
- **μ‘λ™**: μ΄ λΌμ°νΈμ— μ—°κ²°λ Lambda ν•¨μκ°€ νΈμ¶λλ©°, API Gatewayλ” μ΄ μ—°κ²°μ— λ€ν• κ³ μ ν• **μ—°κ²° ID(Connection ID)**λ¥Ό μƒμ„±ν•μ—¬ Lambda ν•¨μμ— μ „λ‹¬ν•©λ‹λ‹¤. κ°λ°μλ” μ΄ μ—°κ²° IDλ¥Ό DynamoDBμ™€ κ°™μ€ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•μ—¬ μ—°κ²° μƒνƒλ¥Ό κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

### 2. **λ©”μ‹μ§€ μ „μ†΅(Sending Messages)**

- **`sendMessage`**: ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°λ μƒνƒμ—μ„ μ„λ²„λ΅ λ°μ΄ν„°λ¥Ό λ³΄λ‚΄λ©΄, API Gatewayλ” μ •μλ **λΌμ°ν… κ·μΉ™**μ— λ”°λΌ ν•΄λ‹Ή λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•©λ‹λ‹¤.
    
- **μ‘λ™**: λ©”μ‹μ§€ μ „μ†΅ μ‹μ—λ„ λ™μΌν• **μ—°κ²° ID**κ°€ μ μ§€λλ©°, λ°±μ—”λ“ Lambda ν•¨μλ” μ΄ IDλ¥Ό μ‚¬μ©ν•μ—¬ νΉμ • μ‚¬μ©μμ— λ€ν• μ •λ³΄λ¥Ό μ΅°νν•κ±°λ‚ λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•  μ μμµλ‹λ‹¤.

### 3. **μ—°κ²° μΆ…λ£(Disconnection)**

- **`onDisconnect`**: ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμΌλ©΄, API Gatewayλ” **`onDisconnect`** λΌμ°νΈλ¥Ό νΈμ¶ν•©λ‹λ‹¤.
    
- **μ‘λ™**: μ΄ λΌμ°νΈμ— μ—°κ²°λ Lambda ν•¨μκ°€ νΈμ¶λμ–΄, λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ—°κ²° IDλ¥Ό μ‚­μ ν•λ” λ“±μ μ •λ¦¬ μ‘μ—…μ„ μν–‰ν•  μ μμµλ‹λ‹¤.

---

## π“¤ 3λ‹¨κ³„: μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ°μ΄ν„° μ „μ†΅ν•κΈ°

![[Pasted image 20250907195621.png]]

WebSocketμ ν•µμ‹¬ κΈ°λ¥μΈ μ„λ²„ ν‘Έμ‹(Server Push)λ” API Gatewayμ νΉλ³„ν• **μ—°κ²° μ½λ°± URL**μ„ ν†µν•΄ κµ¬ν„λ©λ‹λ‹¤.

### π“ μ‘λ™ μ›λ¦¬

1. **μ—°κ²° μ½λ°± URL**: API Gatewayλ” `https://.../connections/connectionId` ν•μ‹μ κ³ μ ν• μ½λ°± URLμ„ μ κ³µν•©λ‹λ‹¤.
    
2. **ν‘Έμ‹ μ”μ²­**: λ°±μ—”λ“(μ: Lambda ν•¨μ)λ” μ΄ URLμ— **IAM SigV4λ΅ μ„λ…λ `POST` μ”μ²­**μ„ λ³΄λƒ…λ‹λ‹¤.
    
3. **λ©”μ‹μ§€ μ „μ†΅**: μ΄ μ”μ²­μ΄ API Gatewayμ— λ„λ‹¬ν•λ©΄, API Gatewayλ” μ”μ²­ λ°”λ””μ— ν¬ν•¨λ λ°μ΄ν„°λ¥Ό ν•΄λ‹Ή **`connectionId`**λ¥Ό κ°€μ§„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ‹¤μ‹κ°„μΌλ΅ μ „μ†΅ν•©λ‹λ‹¤.

### β΅οΈ κΈ°νƒ€ μ—°κ²° κ΄€λ¦¬ μ‘μ—…

- **`GET /connections/{connectionId}`**: νΉμ • ν΄λΌμ΄μ–ΈνΈμ μ—°κ²° μƒνƒλ¥Ό ν™•μΈν•©λ‹λ‹¤.
    
- **`DELETE /connections/{connectionId}`**: μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈμ™€μ WebSocket μ—°κ²°μ„ κ°•μ λ΅ λμµλ‹λ‹¤.

---

## π—ΊοΈ 4λ‹¨κ³„: WebSocket API λΌμ°ν…

![[Pasted image 20250907195656.png]]

WebSocket APIλ” λ“¤μ–΄μ¤λ” λ©”μ‹μ§€μ λ‚΄μ©μ— λ”°λΌ λ‹¤λ¥Έ λ°±μ—”λ“λ΅ μ”μ²­μ„ μ „λ‹¬ν•λ” **λΌμ°ν…(Routing)** κΈ°λ¥μ„ μ‚¬μ©ν•©λ‹λ‹¤.

### π”‘ λΌμ°ν… κ·μΉ™

1. **λΌμ°ν… ν‚¤(Route Key)**: λ“¤μ–΄μ¤λ” λ©”μ‹μ§€(JSON ν”„λ μ„)μ νΉμ • ν•„λ“(μ: `action`)λ¥Ό λΌμ°ν… ν‚¤λ΅ μ„¤μ •ν•©λ‹λ‹¤.
    
2. **λΌμ°ν… ν…μ΄λΈ”**: API Gatewayμ— `connect`, `disconnect`, `default`μ™€ κ°™μ€ ν•„μ λΌμ°νΈμ™€ ν•¨κ» `join`, `sendMessage`μ™€ κ°™μ€ μ‚¬μ©μ μ •μ λΌμ°νΈλ¥Ό μ •μν•©λ‹λ‹¤.
    
3. **λΌμ°ν… ν‘ν„μ‹(Route Selection Expression)**: `$request.body.action`κ³Ό κ°™μ€ ν‘ν„μ‹μ„ μ‚¬μ©ν•μ—¬ λ©”μ‹μ§€ λ°”λ””μ—μ„ λΌμ°ν… ν‚¤λ¥Ό μ¶”μ¶ν•©λ‹λ‹¤.

### π“ λΌμ°ν… μμ‹

ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¤μκ³Ό κ°™μ€ JSON λ©”μ‹μ§€λ¥Ό λ³΄λƒλ‹¤κ³  κ°€μ •ν•΄ λ΄…μ‹λ‹¤.

```JSON
{
  "action": "join",
  "data": { "room": "room123" }
}
```

API Gatewayκ°€ `$request.body.action`μ„ λΌμ°ν… ν‘ν„μ‹μΌλ΅ μ‚¬μ©ν•λ©΄, `"join"`μ΄λΌλ” κ°’μ΄ μ¶”μ¶λ©λ‹λ‹¤. μ΄ κ°’μ€ λΌμ°ν… ν…μ΄λΈ”μ—μ„ `join` λΌμ°νΈμ™€ μΌμΉν•λ©°, API Gatewayλ” `join` λΌμ°νΈμ— μ—°κ²°λ Lambda ν•¨μλ¥Ό νΈμ¶ν•κ² λ©λ‹λ‹¤. μΌμΉν•λ” λΌμ°νΈκ°€ μ—†μΌλ©΄ **`default`** λΌμ°νΈλ΅ μ”μ²­μ΄ μ „λ‹¬λ©λ‹λ‹¤.

**μ‹ν— κ΄€μ  μ”μ•½**: WebSocket APIλ” **μ–‘λ°©ν–¥ ν†µμ‹ **μ„ μ„ν• κ²ƒμ΄λ©°, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ ν• λ²μ μ—°κ²°μ„ ν†µν•΄ μ§€μ†μ μΌλ΅ ν†µμ‹ ν•©λ‹λ‹¤. λ©”μ‹μ§€λ” **λΌμ°ν… κ·μΉ™**μ— λ”°λΌ νΉμ • λ°±μ—”λ“λ΅ μ „λ‹¬λ©λ‹λ‹¤.