
## ⏳ 롱 폴링(Long Polling)

![[Pasted image 20250817204339.png]]

**롱 폴링(Long Polling)**은 컨슈머가 SQS 큐에서 메시지를 요청할 때, 큐에 메시지가 없더라도 즉시 응답을 받지 않고 일정 시간 동안 메시지가 도착하기를 기다리는 방식입니다.

### 숏 폴링(Short Polling)과의 차이점

|특징|숏 폴링 (기본값)|롱 폴링|
|---|---|---|
|**대기 시간**|0초 (즉시 응답)|1 ~ 20초 (대기)|
|**API 호출 횟수**|메시지가 없어도 지속적으로 호출|메시지가 도착할 때까지 대기하므로 호출 횟수 감소|
|**비용 및 효율성**|비용 증가, 비효율적|API 호출 감소로 비용 절감, 효율적|
|**지연 시간**|메시지가 도착해도 다음 호출까지 대기|메시지 도착 즉시 수신 가능하여 지연 시간 감소|

### 롱 폴링 설정 방법

- **큐 레벨:** SQS 큐의 **`Receive message wait time`**을 0초보다 긴 값(최대 20초)으로 설정합니다. 이 큐에서 메시지를 받는 모든 컨슈머에 적용됩니다.
    
- **API 호출 레벨:** `ReceiveMessage` API 호출 시 **`ReceiveMessageWaitTimeSeconds`** 파라미터를 설정하여 개별 API 호출에만 롱 폴링을 적용할 수 있습니다.
    

**권장 사항:** 비용 효율성 및 낮은 지연 시간 때문에 SQS 사용 시 **롱 폴링을 활성화하는 것이 강력히 권장**됩니다.

---

## 📂 SQS 확장 클라이언트 (SQS Extended Client)

SQS 메시지의 최대 크기는 **256KB**입니다. 이보다 큰 메시지(예: 대용량 동영상 파일, 데이터 셋)를 보내려면 **SQS 확장 클라이언트** 라이브러리(자바용)를 사용해야 합니다.

![[Pasted image 20250817204359.png]]

### 동작 원리

1. **대용량 파일 업로드:** 생산자는 SQS 확장 클라이언트를 사용하여 대용량 메시지를 **S3 버킷**에 업로드합니다.
    
2. **포인터 메시지 전송:** SQS 큐에는 실제 대용량 메시지 대신, S3 객체를 가리키는 **작은 메타데이터(포인터)**만 담긴 메시지를 전송합니다.
    
3. **메시지 수신:** 소비자는 SQS 확장 클라이언트를 통해 SQS 큐에서 포인터 메시지를 수신합니다.
    
4. **S3에서 데이터 로드:** 소비자는 포인터 메시지를 사용하여 S3 버킷에서 실제 대용량 데이터를 다운로드하여 처리합니다.
    

이 패턴은 SQS의 메시지 크기 제한을 우회하여 사실상 **무제한 크기의 메시지**를 처리할 수 있게 합니다.

---

## ⌨️ SQS 개발자용 핵심 API

|API 호출|설명|
|---|---|
|`CreateQueue`|큐를 생성합니다. `MessageRetentionPeriod`를 통해 메시지 보존 기간을 설정할 수 있습니다.|
|`DeleteQueue`|큐와 해당 큐의 모든 메시지를 한 번에 삭제합니다.|
|`PurgeQueue`|큐 자체는 남겨두고 큐 내의 모든 메시지만 삭제합니다.|
|`SendMessage`|큐에 메시지를 전송합니다. `DelaySeconds` 파라미터를 사용해 메시지별 지연 시간을 설정할 수 있습니다.|
|`ReceiveMessage`|큐에서 메시지를 가져옵니다. `MaxNumberOfMessages`를 1~10 사이로 설정하여 한 번에 여러 메시지를 받을 수 있습니다.|
|`DeleteMessage`|컨슈머가 메시지 처리를 완료한 후 큐에서 메시지를 삭제합니다.|
|`ChangeMessageVisibility`|메시지 가시성 제한 시간을 연장하여 메시지 처리 시간을 확보합니다.|
|**배치 API**|`SendMessageBatch`, `DeleteMessageBatch`, `ChangeMessageVisibilityBatch`를 사용하면 한 번의 API 호출로 여러 메시지에 대한 작업을 수행하여 비용을 절감할 수 있습니다.|