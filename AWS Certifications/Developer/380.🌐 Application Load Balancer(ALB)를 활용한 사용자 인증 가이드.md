
이 글에서는 Application Load Balancer(ALB)를 사용하여 사용자를 인증하는 방법에 대해 설명합니다. ALB를 통해 인증 작업을 처리함으로써 애플리케이션은 비즈니스 로직에만 집중할 수 있게 됩니다.

---

## 1. 🛡️ ALB 인증의 장점과 동작 원리

ALB를 사용하여 사용자를 인증하면, 애플리케이션 코드를 수정하지 않고도 보안을 강화할 수 있습니다. 사용자가 HTTPS 리스너를 통해 ALB에 접근하면, ALB는 설정된 인증 규칙에 따라 사용자를 인증하고, 인증이 완료된 요청만 백엔드(EC2, ECS, Lambda 등)로 전달합니다.

### 미인증 사용자에 대한 동작

ALB는 미인증 사용자의 요청에 대해 다음 세 가지 옵션을 제공합니다.

- **Authenticate(인증 요청)**: 기본 옵션으로, 사용자에게 인증을 요구합니다.
    
- **Deny(거부)**: 요청을 완전히 거부합니다.
    
- **Allow(허용)**: 인증 없이 요청을 허용합니다. 로그인 페이지와 같이 인증이 필요 없는 페이지에 유용합니다.

---

## 2. 🔑 ALB 인증 방식: Cognito vs. OIDC

ALB는 두 가지 주요 인증 방식을 지원합니다.

### 방법 1: Cognito User Pools 연동

![[Pasted image 20250913164328.png]]

Cognito User Pools를 사용하면 소셜 로그인(Google, Facebook 등)이나 SAML/AD와 같은 기업용 인증을 손쉽게 구현할 수 있습니다.

#### 동작 과정

1. 사용자가 `GET /api/data`와 같은 요청을 보냅니다.
    
2. ALB의 **`authenticate-cognito`** 액션이 트리거됩니다.
    
3. Cognito가 사용자를 인증합니다.
    
4. 인증이 완료되면, 사용자 정보가 담긴 **페이로드**가 원래 요청과 함께 백엔드(예: Amazon ECS)로 전달됩니다.
    
5. 백엔드 애플리케이션은 이 정보를 활용하여 사용자 맞춤형 응답을 생성합니다.
    

#### 설정 단계

1. Cognito User Pool, 클라이언트, 도메인을 생성합니다.
    
2. 필요한 경우 소셜/기업용 IdP를 Cognito와 연동합니다.
    
3. Cognito 클라이언트의 리디렉션 URL을 설정합니다.
    
4. ALB에서 **HTTPS 리스너**를 설정하고, `authenticate-cognito` 규칙을 추가한 후 Cognito User Pool과 앱 클라이언트를 연결합니다.
    

---

### 방법 2: OpenID Connect(OIDC) 연동

![[Pasted image 20250913164341.png]]

OIDC는 개방형 표준으로, Cognito를 사용하지 않고도 OIDC를 지원하는 모든 IdP(Identity Provider)와 직접 연동할 수 있습니다.

#### 동작 과정

1. 사용자가 요청을 보냅니다.
    
2. ALB는 사용자에게 인증을 위해 IdP의 **인증 엔드포인트(Authentication Endpoint)**로 리디렉션합니다.
    
3. IdP는 인증 후 **인증 코드(Authorization Code)**를 ALB에 반환합니다.
    
4. ALB는 이 코드를 **토큰 엔드포인트(Token Endpoint)**로 보내 **ID 토큰**과 **액세스 토큰**으로 교환합니다.
    
5. ALB는 액세스 토큰을 사용하여 **사용자 정보 엔드포인트(User Info Endpoint)**에서 **사용자 클레임(User Claims)**을 가져옵니다.
    
6. 사용자 클레임이 포함된 요청이 백엔드로 전달됩니다.
    

#### 설정 단계

Cognito 연동보다 더 많은 정보를 직접 설정해야 합니다.

- IdP의 인증 엔드포인트, 토큰 엔드포인트, 사용자 정보 엔드포인트 URL을 지정합니다.
    
- 클라이언트 ID와 클라이언트 시크릿을 입력합니다.
    
- 올바른 리디렉션 URL을 설정하여 ALB와 IdP 간의 통신을 보장합니다.
    

---

## 3. 📝 요약: Cognito vs. OIDC

|특징|Cognito User Pools|OIDC|
|---|---|---|
|**통합 용이성**|설정이 간편하며 Cognito와 AWS 서비스 간의 긴밀한 통합을 제공합니다.|Cognito 외의 다양한 IdP와 직접 통합할 수 있지만, 설정할 항목이 더 많습니다.|
|**사용 시나리오**|소셜 로그인, 기업용 SAML/AD 등과 연동 시 특히 유용합니다.|Cognito를 사용하지 않는 OIDC 호환 IdP를 사용하려는 경우에 적합합니다.|
|**동작 방식**|Cognito가 인증을 처리하고 사용자 정보를 전달합니다.|ALB가 여러 엔드포인트(Auth, Token, User Info)와 통신하여 인증을 완료합니다.|