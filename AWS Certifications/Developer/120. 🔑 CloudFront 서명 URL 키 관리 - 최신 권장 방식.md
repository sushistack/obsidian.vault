
Amazon CloudFront 서명 URL 및 서명 쿠키를 생성하려면 **키 페어(Key Pair)**가 필요합니다. 이 키 페어는 요청의 서명을 생성하고 검증하는 데 사용됩니다. AWS는 두 가지 키 관리 방식을 제공하며, 최신 방식인 **신뢰할 수 있는 키 그룹(Trusted Key Groups)**을 사용하는 것이 권장됩니다.

---

### 1. 최신 권장 방식: 신뢰할 수 있는 키 그룹(Trusted Key Groups) 🚀

이 방식은 보안성과 관리 편의성이 뛰어나, 현재 CloudFront 서명 URL/쿠키를 생성하는 표준 방법으로 자리 잡았습니다.

#### 작동 원리:

1. **키 페어 생성:** 개발자가 로컬에서 **RSA-2048 비트**의 비공개 키(Private Key)와 공개 키(Public Key) 쌍을 생성합니다.

2. **공개 키 업로드:** CloudFront 콘솔에서 **`공개 키(Public Keys)`**를 생성하고, 로컬에서 생성한 **공개 키**를 업로드합니다.

3. **키 그룹 생성:** 업로드한 공개 키를 하나 이상의 **`키 그룹(Key Groups)`**에 추가합니다.

4. **CloudFront 배포 연결:** CloudFront 배포의 `동작(Behaviors)` 탭에서 `신뢰할 수 있는 서명자(Trusted Signers)`를 `신뢰할 수 있는 키 그룹(Trusted Key Groups)`으로 설정하고, 생성한 키 그룹을 지정합니다.

5. **서명:** 애플리케이션(예: EC2 인스턴스)은 **비공개 키**를 사용하여 서명된 URL을 생성합니다. CloudFront는 업로드된 **공개 키**로 서명을 검증합니다.

| |장점|단점|
|---|---|---|
|**관리**|IAM API를 통해 키 생성, 교체, 삭제를 자동화할 수 있어 관리 용이|없음|
|**보안**|비공개 키가 AWS 외부에 안전하게 보관됨|없음|
|**권한**|IAM 사용자가 적절한 권한을 통해 관리 가능|없음|

---

### 2. 이전 방식: CloudFront 키 페어 (CloudFront Key Pair) 🚧

이전에는 CloudFront 키 페어를 사용했지만, 현재는 권장되지 않습니다.

#### 작동 원리:

1. **루트 계정 사용:** AWS 루트 계정으로 로그인해야만 `보안 자격 증명(Security Credentials)` 섹션에서 키 페어를 생성할 수 있습니다.

2. **키 페어 생성:** 콘솔에서 키 페어를 생성하면, CloudFront가 자동으로 비공개 키와 공개 키를 생성해 제공합니다.

3. **키 사용:** 다운로드한 비공개 키를 애플리케이션에서 사용하여 서명 URL을 생성합니다.

| |장점|단점|
|---|---|---|
|**관리**|없음|**API를 지원하지 않아** 자동화 불가. 키 교체/삭제가 번거로움|
|**보안**|없음|**루트 계정**을 사용해야 하므로 보안에 취약함|
|**권한**|없음|IAM 사용자가 키를 관리할 수 없음|

---

### 3. 키 페어 생성 실습 🖥️

1. **온라인 RSA 키 생성:** 로컬에서 2048비트 RSA 키를 생성하는 웹사이트(예: `openssl` 명령 대체)를 사용합니다.

2. **공개 키 업로드:** CloudFront 콘솔의 `공개 키` 메뉴로 이동하여 `공개 키 생성(Create public key)`을 클릭합니다. 여기에 생성한 공개 키 내용을 붙여넣고 키 이름을 지정합니다.

3. **키 그룹 생성:** `키 그룹(Key Groups)` 메뉴로 이동하여 `키 그룹 생성(Create key group)`을 클릭합니다. 방금 생성한 공개 키를 이 그룹에 추가합니다.

이후 CloudFront 배포의 캐시 동작에서 이 키 그룹을 `신뢰할 수 있는 서명자`로 지정하면, 애플리케이션은 로컬의 비공개 키를 사용하여 유효한 서명 URL을 생성할 수 있습니다.