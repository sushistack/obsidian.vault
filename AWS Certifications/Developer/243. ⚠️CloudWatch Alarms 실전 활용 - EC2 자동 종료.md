
## CloudWatch Alarms의 역할: 자동화된 인스턴스 관리

CloudWatch Alarms는 단순한 알림을 넘어, 특정 지표가 임계값을 초과할 경우 사전 정의된 액션을 자동으로 수행할 수 있습니다. 이번 실습에서는 EC2 인스턴스의 CPU 사용률이 비정상적으로 높아질 때 인스턴스를 자동으로 종료하는 알람을 구성해 보겠습니다. 이는 애플리케이션에 치명적인 오류가 발생했을 때 불필요한 비용을 절감하거나, 오작동하는 인스턴스를 격리하는 데 유용합니다.

## 🛠️ 단계별 알람 생성 가이드

### 1단계: EC2 인스턴스 시작

먼저, 모니터링할 EC2 인스턴스를 생성합니다.

1. EC2 콘솔에서 **t2.micro** 인스턴스를 시작합니다.
2. 인스턴스가 `running` 상태가 될 때까지 기다립니다.

### 2단계: CloudWatch 알람 설정

인스턴스가 준비되면, 해당 인스턴스의 CPU 사용률을 모니터링하는 알람을 만듭니다.

1. CloudWatch 콘솔에서 **`Alarms`** > **`Create alarm`**으로 이동합니다.
2. **`Select metric`**을 클릭하여 EC2 지표를 찾습니다.
3. `EC2` > `Per-Instance Metrics`로 이동한 후, 방금 시작한 EC2 인스턴스의 ID를 검색하여 **`CPUUtilization`** 지표를 선택합니다.
    
4. **조건 설정**:
    
    - **기간(Period)**: `5 minutes` (기본 모니터링은 5분 단위로 지표를 수집)
    - **임계값(Threshold)**: `Static` > `>`(Greater than) `95`
    - **Data points to alarm**: `3 out of 3` (3개의 연속된 데이터 포인트가 임계값을 초과해야 알람이 트리거)
    - 이는 CPU 사용률이 15분(`5분 * 3`) 동안 연속으로 95%를 초과할 경우 알람을 울리겠다는 의미입니다.

5. **액션 설정**: `Next`를 클릭한 후, `Configure actions` 단계에서 **`EC2 action`**을 선택합니다.

    - **State**: `In alarm`
    - **EC2 action**: `Terminate
 `
1. **알람 이름 설정**: `Next`를 클릭하고 알람의 이름을 지정합니다. (예: `Terminate-EC2-on-High-CPU`)

### 3단계: 알람 동작 수동 테스트

알람은 실제 조건이 충족될 때까지 기다려야 하지만, **AWS CLI**를 사용하여 강제로 알람 상태를 변경하여 액션이 제대로 동작하는지 테스트할 수 있습니다.

1. **CLI 명령어 입력**: 터미널에서 아래와 같이 `set-alarm-state` 명령어를 입력합니다.
    
```Bash
aws cloudwatch set-alarm-state \
--alarm-name "Terminate-EC2-on-High-CPU" \
--state-value "ALARM" \
--state-reason "Testing alarm action"
```
    
2. **알람 상태 확인**: CloudWatch 콘솔에서 알람의 상태가 `INSUFFICIENT_DATA`에서 `ALARM`으로 변경되었는지 확인합니다.
    
3. **EC2 인스턴스 상태 확인**: 잠시 후 EC2 콘솔로 이동하여 해당 인스턴스의 상태가 `shutting-down`으로 바뀌고 결국 `terminated` 되는 것을 확인할 수 있습니다.

## 📝 테스트 결과 및 결론

위 실습을 통해 우리는 다음과 같은 사실을 확인했습니다.

- CloudWatch 지표(CPU 사용률)를 기반으로 알람을 설정할 수 있습니다.

- 알람이 `ALARM` 상태로 전환될 때 EC2 인스턴스를 종료하는 액션을 성공적으로 수행했습니다.

- `set-alarm-state` CLI 명령어를 통해 실제 조건을 기다리지 않고도 알람의 동작을 즉시 테스트할 수 있습니다.


이와 같은 자동화는 시스템의 안정성을 높이고, 예측 불가능한 장애 상황에 대한 대응 시간을 단축시키는 데 큰 도움을 줍니다.