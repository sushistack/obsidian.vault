
S3 버킷에서 SSE-KMS(Server-Side Encryption with KMS)를 사용하여 데이터를 암호화할 때, KMS API 호출 횟수가 급격히 증가하여 비용이 많이 발생할 수 있습니다. AWS는 이러한 문제를 해결하기 위해 **S3 버킷 키(Bucket Keys)**라는 새로운 기능을 도입했습니다. 이 가이드에서는 S3 버킷 키의 원리와 이점, 그리고 콘솔에서 설정하는 방법을 자세히 설명합니다.

---

## 1. 🔍 문제점: SSE-KMS와 KMS API 호출

기존 SSE-KMS 암호화 방식은 객체 하나를 업로드할 때마다 KMS에 `GenerateDataKey` API를 호출하여 데이터 키(DEK)를 생성합니다. 대량의 객체를 S3에 업로드하는 경우, 이로 인해 수많은 KMS API 호출이 발생하여 다음과 같은 문제가 생길 수 있습니다.

- **높은 비용**: KMS API 호출은 비용이 발생하므로, 업로드/다운로드 횟수가 많아질수록 KMS 요금이 크게 증가합니다.
    
- **스로틀링**: 과도한 API 호출로 인해 KMS 할당량(Request Quotas)을 초과하면 `ThrottlingException` 오류가 발생하여 서비스에 지연이 발생할 수 있습니다.

---

## 2. 🔑 S3 버킷 키의 원리

![[Pasted image 20250914192122.png]]

S3 버킷 키는 이러한 문제를 해결하기 위해 도입된 기능입니다. 핵심 원리는 다음과 같습니다.

1. **새로운 계층의 키**: S3 버킷 키를 활성화하면, KMS는 각 객체에 대한 데이터 키(DEK)를 생성하는 대신, **버킷 전체에 적용되는 데이터 키**인 **S3 버킷 키**를 생성합니다.
    
2. **KMS 호출 최소화**: 이 S3 버킷 키는 일정 기간 동안 S3 버킷 내의 여러 객체를 암호화하는 데 재사용됩니다.
    
3. **Envelope Encryption 활용**: S3 버킷 키는 개별 객체에 대한 데이터 키를 클라이언트 측에서 생성하고 암호화하는 **Envelope Encryption**을 활용합니다. 이 과정에서 KMS에 대한 직접적인 API 호출 횟수를 획기적으로 줄입니다.
    

결과적으로, S3 버킷 키는 각 객체 업로드 시마다 KMS에 API를 호출하는 대신, 버킷 수준에서 KMS를 한 번만 호출하고 내부적으로 여러 번 재사용함으로써 KMS 호출 횟수를 최대 **99%까지 줄여** 비용을 절감합니다.

|기존 방식|S3 버킷 키 방식|
|---|---|
|**객체당 KMS API 호출**|**버킷당 KMS API 호출**|
|객체 업로드 → `GenerateDataKey` 호출|버킷 키 생성 → 여러 객체 암호화|
|객체 다운로드 → `Decrypt` 호출|S3 버킷 키를 활용한 복호화|
|**비용**: 호출 횟수에 비례하여 증가|**비용**: KMS 호출 횟수 감소로 절감|

---

## 3. 🛠️ S3 버킷 키 설정 방법

S3 버킷 키는 S3 버킷 생성 또는 기존 버킷의 암호화 설정에서 활성화할 수 있습니다. 현재는 S3 버킷 키가 **기본값으로 활성화**되어 있습니다.

### 1. S3 버킷 생성 시 설정

1. AWS Management Console에서 S3로 이동합니다.
    
2. **`Create bucket`**을 클릭합니다.
    
3. 버킷 이름, 리전 등 기본 설정을 마친 후, **`Default encryption`** 섹션으로 이동합니다.
    
4. `Server-Side encryption with AWS Key Management Service (SSE-KMS)`를 선택합니다.
    
5. **`Bucket Key`** 옵션이 **`Enabled`**로 설정되어 있는지 확인합니다. 기본값으로 활성화되어 있으며, 비용 절감을 위해 이 상태를 유지하는 것이 좋습니다.
    

### 2. 기존 버킷 설정 변경

1. 기존 S3 버킷의 **`Properties`** 탭으로 이동합니다.
    
2. **`Default encryption`** 섹션에서 `Edit`을 클릭합니다.
    
3. `Bucket Key` 옵션을 `Enabled`로 변경하고 저장합니다.

---

## 4. ✨ 결론

S3 버킷 키는 SSE-KMS를 사용하는 대규모 워크로드의 **비용 효율성과 성능**을 크게 향상시키는 중요한 기능입니다. 보안 수준을 그대로 유지하면서 KMS API 호출 횟수를 대폭 줄여 비용을 절감할 수 있으며, KMS 할당량 초과로 인한 서비스 문제를 예방하는 효과도 있습니다.

이 기능은 특히 `CloudTrail` 로그에서 KMS 관련 이벤트가 줄어들고, 월간 AWS 요금 청구서에서 KMS 비용이 현저히 낮아지는 것을 통해 그 효과를 직접 확인할 수 있습니다. S3를 대규모로 사용한다면, S3 버킷 키의 활성화 여부를 반드시 확인하는 것이 좋습니다.