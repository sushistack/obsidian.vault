
---

## 💡 Elastic Beanstalk 배포 옵션 개요

AWS Elastic Beanstalk는 애플리케이션 업데이트 시 다양한 배포 전략을 제공하여, 애플리케이션의 가용성, 배포 속도, 비용 등 여러 요구사항에 맞춰 선택할 수 있습니다. 각 배포 방식은 장단점이 명확하므로, 개발 환경인지 프로덕션 환경인지에 따라 적절한 전략을 선택하는 것이 중요합니다.

|배포 방식|주요 특징|장점|단점|
|---|---|---|---|
|**All at Once**|모든 인스턴스를 한 번에 업데이트|가장 빠름|**다운타임 발생**|
|**Rolling**|인스턴스를 배치 단위로 업데이트|다운타임 없음 (부분적으로)|배포 중 용량 감소, 시간이 오래 걸릴 수 있음|
|**Rolling with Additional Batch**|새 인스턴스를 추가하여 배치 업데이트|용량 감소 없이 배포 가능|약간의 추가 비용 발생, 시간이 오래 걸림|
|**Immutable**|새 ASG에 새 인스턴스를 생성 후 전환|다운타임 없이 안정적, 빠른 롤백|가장 긴 배포 시간, 두 배의 비용 발생|
|**Traffic Splitting (Canary)**|새 환경에 소량의 트래픽을 먼저 보냄|자동 롤백 기능, 무중단 배포|상대적으로 복잡하고 비용이 발생|
|**Blue/Green**|완전히 새로운 환경을 생성 후 URL 스왑|무중단, 완벽한 롤백, 안전성|수동 작업 필요, 비용 발생|

---

## 🔄 주요 배포 방식 상세 설명

### 1. 🔀 All at Once (한 번에 모두)

![[Pasted image 20250812210759.png]]

가장 빠르지만, 가장 단순한 배포 방식입니다.

- **작동 방식**: 모든 EC2 인스턴스에서 기존 애플리케이션(v1)을 중단한 후, 동시에 새로운 버전(v2)을 배포합니다.
    
- **특징**:
    - **빠른 배포 시간**: 모든 인스턴스를 동시에 업데이트하기 때문에 가장 신속합니다.
    - **다운타임 발생**: 배포 과정에서 모든 인스턴스가 서비스를 중단하므로 다운타임이 발생합니다.
    - **비용**: 추가 인스턴스가 필요하지 않으므로 추가 비용이 없습니다.

- **적합한 상황**: 다운타임이 허용되는 개발/테스트 환경.
    

### 2. 롤링 (Rolling)

![[Pasted image 20250812210813.png]]

일부 인스턴스만 업데이트하여 다운타임을 최소화하는 방식입니다.

- **작동 방식**:
    1. 전체 인스턴스를 미리 정의된 **배치(Batch)** 단위로 나눕니다.
    2. 첫 번째 배치에 속한 인스턴스의 애플리케이션을 v1에서 v2로 업데이트합니다. 이 과정에서 해당 인스턴스들은 서비스를 중단합니다.
    3. 첫 번째 배치가 정상 상태(Healthy)가 되면, 다음 배치로 넘어가 동일한 과정을 반복합니다.
    
- **특징**:
    - **부분적 다운타임**: 한 번에 전체 인스턴스가 중단되지 않으므로 서비스 중단 시간을 줄일 수 있습니다.
    - **용량 감소**: 배포 중에는 일부 인스턴스만 서비스를 제공하므로, 전체 서비스 용량이 감소합니다.
    - **비용**: 추가 인스턴스가 필요하지 않아 비용이 발생하지 않습니다.
    - **배포 시간**: 인스턴스 개수와 배치 크기에 따라 배포 시간이 길어질 수 있습니다.

### 3. 롤링 with Additional Batch (추가 배치 롤링)

![[Pasted image 20250812210827.png]]

롤링 배포의 용량 감소 문제를 해결하기 위한 방식입니다.

- **작동 방식**:
    
    1. 기존 인스턴스(v1)를 그대로 둔 채로, 새로운 배치(Batch)에 사용할 **추가 인스턴스**를 생성하고 v2를 배포합니다.
    2. 추가 인스턴스가 정상 상태가 되면, 기존 인스턴스 배치(v1)를 하나씩 v2로 업데이트합니다.
    3. 모든 인스턴스 업데이트가 완료되면, 처음에 생성했던 추가 인스턴스를 종료하여 원래 용량으로 되돌립니다.

- **특징**:
    - **무중단 배포**: 배포 중에도 항상 최대 용량을 유지하므로 서비스 중단이 없습니다.
    - **비용**: 배포 기간 동안 추가 인스턴스를 사용하므로 소량의 추가 비용이 발생합니다.
    - **배포 시간**: 롤링 배포와 마찬가지로 시간이 오래 걸릴 수 있습니다.

- **적합한 상황**: 용량 감소가 허용되지 않는 운영(Prod) 환경.

### 4. Immutable (변경 불가능)

![[Pasted image 20250812210842.png]]

가장 안전한 배포 방식 중 하나로, 기존 인스턴스를 건드리지 않습니다.

- **작동 방식**:
    1. 새로운 **임시 오토 스케일링 그룹(Temporary ASG)**을 생성합니다.
    2. 이 임시 ASG에 새로운 EC2 인스턴스를 띄우고 v2 애플리케이션을 배포합니다.
    3. 새로운 인스턴스들이 모두 정상 상태가 되면, 트래픽을 완전히 새로운 인스턴스로 전환합니다.
    4. 기존 인스턴스(v1)들을 모두 종료합니다.

- **특징**:
    - **무중단 배포**: 기존 인스턴스를 유지한 채로 새로운 인스턴스에 배포하므로 다운타임이 전혀 없습니다.
    - **빠른 롤백**: 배포 실패 시, 임시 ASG를 종료하고 기존 인스턴스를 유지하면 되므로 롤백이 매우 빠르고 안전합니다.
    - **비용**: 배포 기간 동안 인스턴스 수가 두 배로 증가하므로 비용이 가장 많이 듭니다.

- **적합한 상황**: 롤백이 매우 중요하고 안정성을 최우선으로 하는 운영(Prod) 환경.

### 5. Blue/Green (블루/그린)

![[Pasted image 20250812210921.png]]

Elastic Beanstalk 내에서 직접 지원하는 기능은 아니지만, 환경 복제 및 URL 스왑을 통해 구현할 수 있는 전략입니다.

- **작동 방식**:
    1. 현재 운영 중인 환경(Blue)을 그대로 복제하여 새로운 환경(Green)을 생성합니다.
    2. Green 환경에 v2 애플리케이션을 배포하고 충분한 테스트를 진행합니다.
    3. 모든 검증이 끝나면, **DNS CNAME 스왑** 기능을 사용하여 Blue 환경과 Green 환경의 URL을 즉시 교체합니다.
    4. 트래픽이 완전히 Green 환경으로 전환되면 Blue 환경을 종료합니다.

- **특징**:
    - **무중단 배포**: 새로운 환경에서 모든 테스트를 마친 후 한 번에 전환하므로 다운타임이 없습니다.
    - **안전한 롤백**: 문제가 발생하면 URL을 다시 Blue 환경으로 교체하기만 하면 되므로 매우 안전합니다.
    - **수동 작업**: 다른 배포 방식과 달리, 환경 복제 및 URL 스왑 과정이 수동으로 이루어집니다.

- **적합한 상황**: 신규 버전의 대규모 변경사항을 충분히 검증하고 싶을 때.

### 6. 🚦 Traffic Splitting (트래픽 분할)

![[Pasted image 20250812210953.png]]

카나리 테스트(Canary Testing)에 사용되는 배포 방식입니다.

- **작동 방식**:
    1. 새로운 애플리케이션(v2)을 배포할 새로운 EC2 인스턴스 그룹을 생성합니다.
    2. 로드 밸런서를 통해 전체 트래픽의 **일부(예: 10%)**만 새로운 인스턴스 그룹으로 보냅니다.
    3. 설정된 시간 동안 새로운 버전의 헬스 상태를 모니터링합니다.
    4. **자동화된 롤백**: 문제가 발생하면, 트래픽을 다시 기존 인스턴스 그룹으로 되돌리고 새로운 인스턴스 그룹을 종료합니다.
    5. 문제가 없으면, 모든 트래픽을 새로운 인스턴스 그룹으로 전환하고 기존 인스턴스 그룹을 종료합니다.

- **특징**:
    - **카나리 테스트**: 소량의 트래픽으로 실제 환경에서 새로운 버전을 테스트할 수 있습니다.
    - **자동 롤백**: 배포 실패 시 자동 롤백이 가능하여 매우 안전합니다.
    - **무중단 배포**: 다운타임 없이 배포가 이루어집니다.

- **적합한 상황**: 실제 사용자 트래픽을 통해 신규 버전을 점진적으로 테스트하고 싶을 때.