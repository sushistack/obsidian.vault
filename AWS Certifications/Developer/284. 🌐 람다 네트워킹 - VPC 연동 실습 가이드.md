
람다 함수를 VPC에 배포하는 실습을 단계별로 안내해 드리겠습니다. 이 과정을 통해 람다 함수가 VPC 내 리소스와 어떻게 통신하는지 직접 확인하고, 필요한 권한 설정 방법을 이해할 수 있습니다.

---

## 1. 사전 준비: 보안 그룹 생성

먼저, 람다 함수에 할당할 보안 그룹을 생성합니다.

1. **EC2 콘솔**로 이동하여 **`Security Groups`** 메뉴를 선택합니다.
    
2. **`Create security group`**을 클릭합니다.
    
3. **`Security group name`**에 `Lambda-SG`를 입력합니다.
    
4. **`VPC`**를 선택하고, **`Create security group`**을 클릭하여 생성합니다.
    
5. 이 보안 그룹은 람다 함수가 VPC 내부의 다른 리소스와 통신할 때 사용됩니다.

---

## 2. 람다 함수 VPC 설정 ⚙️

새로운 람다 함수(`lambda-vpc-demo`)를 생성한 후, VPC 설정을 적용합니다.

1. 람다 함수의 **`Configuration`** 탭으로 이동합니다.
    
2. 왼쪽 메뉴에서 **`VPC`**를 선택하고 **`Edit`** 버튼을 클릭합니다.
    
3. **`VPC`** 드롭다운에서 함수를 배포할 VPC를 선택합니다.
    
4. **`Subnets`**에서 VPC 내의 서브넷을 선택합니다. **⚠️주의:** 람다 함수는 퍼블릭 서브넷에 배포해도 인터넷 접근이 불가능합니다. 인터넷 연결이 필요하다면 프라이빗 서브넷에 NAT 게이트웨이를 구성해야 합니다.
    
5. **`Security groups`**에서 위에서 생성한 **`Lambda-SG`**를 선택합니다.
    
6. **`Save`**를 클릭합니다. 이 단계에서 권한 부족 오류가 발생합니다.

---

## 3. IAM 권한 추가: ENI 관리 🔑

람다 함수가 VPC에 속하려면 EC2의 네트워크 인터페이스(ENI)를 생성할 권한이 필요합니다. 이 권한은 람다 함수의 실행 역할에 추가해야 합니다.

1. 람다 함수 콘솔에서 **`Configuration`** 탭 > **`Permissions`** 메뉴로 이동합니다.
    
2. **`Role name`** 링크를 클릭하여 IAM 콘솔의 역할 페이지로 이동합니다.
    
3. **`Add permissions`** > **`Attach policies`**를 클릭합니다.
    
4. 검색창에 `Lambda`를 입력하고 **`AWSLambdaVPCAccessExecutionRole`** 정책을 찾아 연결합니다.
    
5. 이 정책은 `ec2:CreateNetworkInterface`, `ec2:DeleteNetworkInterface` 등 ENI를 관리하는 데 필요한 권한을 부여합니다.

---

## 4. VPC 배포 및 결과 확인 ✅

IAM 권한을 추가한 후, 다시 람다 함수의 VPC 설정 페이지로 돌아와 **`Save`**를 클릭합니다.

- 람다 함수가 VPC에 배포되는 데 몇 분 정도 소요될 수 있습니다.
    
- 배포가 완료되면 람다 함수를 테스트하여 정상 동작을 확인합니다.

이제 **EC2 콘솔**의 **`Network Interfaces`** 메뉴로 이동합니다. 람다 함수가 배포된 서브넷의 개수만큼 새로운 **ENI가 생성된 것**을 확인할 수 있습니다. 이 ENI들이 람다 함수가 VPC 내에서 통신할 수 있는 통로 역할을 합니다.

이 실습을 통해 람다 함수를 VPC 내에 배포하고, VPC 리소스에 접근하기 위해 필요한 IAM 권한과 네트워크 구성의 중요성을 직접 확인할 수 있습니다.