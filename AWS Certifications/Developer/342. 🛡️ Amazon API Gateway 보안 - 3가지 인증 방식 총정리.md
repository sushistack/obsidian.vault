
이번 가이드에서는 Amazon API Gateway의 핵심 보안 기능인 **인증(Authentication)** 및 **권한 부여(Authorization)** 방식 3가지를 상세히 분석합니다. API를 안전하게 보호하고 고객에게 신뢰성 있는 서비스를 제공하는 데 필수적인 내용입니다.

---

## 🔒 1단계: IAM 권한 부여 (IAM Permissions)

**IAM(Identity and Access Management)** 권한 부여는 API Gateway를 보호하는 가장 기본적인 방법입니다. AWS 계정 내에서 API에 접근하는 주체(예: IAM 사용자, 역할, EC2 인스턴스)를 제어하는 데 최적화되어 있습니다.

![[Pasted image 20250907194839.png]]

### ⚙️ 작동 방식

1. **IAM 정책 생성**: API Gateway에 대한 `invoke` 권한을 포함하는 IAM 정책을 생성합니다.
    
2. **IAM 엔티티에 연결**: 이 정책을 IAM 사용자, 역할, 또는 다른 AWS 서비스에 연결합니다.
    
3. **SigV4를 사용한 인증**: 클라이언트는 요청에 **Signature Version 4 (SigV4)**를 사용하여 IAM 자격 증명(credentials)을 서명하고 HTTP 헤더에 포함시킵니다.
    
4. **API Gateway의 권한 확인**: API Gateway는 이 서명을 확인하여 IAM에 접근이 허용되었는지 확인한 후 백엔드로 요청을 전달합니다.

### 📄 리소스 정책(Resource Policies)

**리소스 정책**은 API Gateway 자체에 연결되는 JSON 정책입니다. IAM 권한 부여와 함께 사용되어 교차 계정 접근, 특정 IP 주소 허용/차단, VPC Endpoint를 통한 접근 제어 등 세밀한 보안 규칙을 설정할 수 있습니다.

---

## 👤 2단계: Cognito 사용자 풀 (Cognito User Pools)

**Cognito 사용자 풀**은 사용자의 가입, 로그인, 인증을 관리하는 완전 관리형 서비스입니다. API Gateway와 직접 통합되어 사용자 기반 API 보호를 간편하게 구현할 수 있습니다.

![[Pasted image 20250907194855.png]]

### ⚙️ 작동 방식

1. **사용자 인증**: 클라이언트는 먼저 Cognito 사용자 풀에 로그인하여 **JWT(JSON Web Token)** 토큰을 받습니다.
    
2. **API Gateway 호출**: 클라이언트는 이 JWT 토큰을 요청의 `Authorization` 헤더에 담아 API Gateway를 호출합니다.
    
3. **토큰 검증**: API Gateway는 Cognito 사용자 풀과 직접 연동하여 받은 토큰의 유효성을 검증합니다.
    
4. **권한 부여**: 토큰이 유효하면 API Gateway는 백엔드(예: Lambda)로 요청을 전달합니다.

### 💡 주요 이점

- **간편한 구현**: 별도의 사용자 지정 인증 코드를 작성할 필요가 없습니다.
    
- **사용자 관리**: Cognito가 사용자 등록, 암호 재설정 등 복잡한 사용자 생명주기를 대신 관리해줍니다.

---

## ✍️ 3단계: Lambda Authorizer (커스텀 인증)

**Lambda Authorizer**(이전 명칭: Custom Authorizer)는 가장 유연한 인증 방식이며, 외부 인증 시스템(예: OAuth, 제3자 로그인 서비스)을 사용할 때 주로 활용됩니다.

![[Pasted image 20250907194909.png]]
### ⚙️ 작동 방식

1. **외부 인증**: 클라이언트는 API Gateway 외부의 인증 시스템(예: Auth0)에서 토큰을 획득합니다.
    
2. **API Gateway 호출**: 클라이언트는 이 토큰을 요청 헤더에 담아 API Gateway를 호출합니다.
    
3. **Lambda Authorizer 호출**: API Gateway는 토큰을 받으면, 미리 설정된 **Lambda Authorizer 함수**를 호출합니다.
    
4. **사용자 지정 로직 실행**: Lambda Authorizer 함수는 전달받은 토큰의 유효성을 검증(예: 제3자 서비스에 확인 요청)하고, 유효한 경우 요청을 처리할 수 있는 **IAM 정책**을 반환합니다.
    
5. **정책 캐싱**: Lambda 함수가 반환한 IAM 정책은 **캐시**되어 동일한 요청에 대한 재호출을 방지합니다.
    
6. **권한 부여**: API Gateway는 이 정책에 따라 요청의 백엔드 접근을 허용하거나 거부합니다.

### 💡 주요 이점

- **최고의 유연성**: 어떤 외부 인증 시스템이든 통합할 수 있습니다.
    
- **커스텀 정책**: 특정 사용자, 그룹, 또는 조건에 따라 세밀한 IAM 정책을 동적으로 생성하여 반환할 수 있습니다.

---

## 📊 4단계: 인증 방식별 비교 요약

|특징|IAM 권한 부여|Cognito 사용자 풀|Lambda Authorizer|
|---|---|---|---|
|**적합한 상황**|AWS 계정 내에서 접근하는 내부 API (EC2, Lambda)|사용자 인증이 필요한 웹/모바일 애플리케이션|제3자 인증 시스템(OAuth, JWT 등) 사용 시|
|**인증 방식**|AWS SigV4 서명|JWT 토큰|커스텀 토큰 또는 요청 파라미터|
|**구현 난이도**|낮음 (정책 설정)|낮음 (Cognito 연동)|높음 (Lambda 코드 작성)|
|**주요 이점**|AWS 환경에 최적화, 강력한 보안|완전 관리형 사용자 풀, 간편한 구현|최고의 유연성, 외부 시스템 연동 가능|
|**비용**|없음 (IAM 자체는 무료)|Cognito 비용 + Lambda 호출 비용|Lambda 호출 비용|