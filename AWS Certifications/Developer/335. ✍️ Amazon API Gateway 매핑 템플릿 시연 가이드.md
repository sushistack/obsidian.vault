
μ΄λ² κ°€μ΄λ“μ—μ„λ” Amazon API Gatewayμ **λ§¤ν•‘ ν…ν”λ¦Ώ(Mapping Templates)**μ„ μ§μ ‘ μ„¤μ •ν•κ³  ν…μ¤νΈν•λ” κ³Όμ •μ„ μƒμ„Έν μ•μ•„λ³΄κ² μµλ‹λ‹¤. λ§¤ν•‘ ν…ν”λ¦Ώμ„ μ‚¬μ©ν•λ©΄ λ°±μ—”λ“ μ„λΉ„μ¤μ μ½”λ“λ¥Ό μμ •ν•μ§€ μ•κ³ λ„ μ”μ²­κ³Ό μ‘λ‹µμ λ°μ΄ν„°λ¥Ό μμ λ΅­κ² λ³€ν•ν•  μ μμµλ‹λ‹¤.

---

## π’» 1λ‹¨κ³„: Lambda ν•¨μ μƒμ„± λ° λΉ„ν”„λ΅μ‹ ν†µν•© μ„¤μ •

λ¨Όμ € API Gatewayμ™€ μ—°λ™ν•  Lambda ν•¨μλ¥Ό μƒμ„±ν•©λ‹λ‹¤. μ΄λ² μ‹¤μµμ—μ„λ” **ν”„λ΅μ‹ ν†µν•©**μ„ μ‚¬μ©ν•μ§€ μ•κ³ , μ¤μ§ Lambda ν•¨μκ°€ λ°ν™ν•λ” κ°’λ§μ„ API Gatewayλ΅ μ „λ‹¬ν•  κ²ƒμ…λ‹λ‹¤.

1. **μƒ ν•¨μ μƒμ„±**: `api-gateway-mapping-get`λΌλ” μ΄λ¦„μΌλ΅ Lambda ν•¨μλ¥Ό μƒμ„±ν•κ³ , λ°νƒ€μ„μ€ Python 3.11μ„ μ„ νƒν•©λ‹λ‹¤.
    
2. **ν•¨μ μ½”λ“ μ‘μ„±**: λ‹¤μ μ½”λ“λ¥Ό λ¶™μ—¬λ„£κ³  **λ°°ν¬(Deploy)**ν•©λ‹λ‹¤. μ΄ ν•¨μλ” κ°„λ‹¨ν• JSON κ°μ²΄λ§ λ°ν™ν•©λ‹λ‹¤.

```Python
import json

def lambda_handler(event, context):
    return {
        "example": "hello world"
    }
```

**μ°Έκ³ **: ν”„λ΅μ‹ ν†µν•©μ„ μ‚¬μ©ν•μ§€ μ•κΈ° λ•λ¬Έμ—, `statusCode`λ‚ `headers`λ¥Ό λ…μ‹μ μΌλ΅ λ°ν™ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤. Lambdaκ°€ λ°ν™ν•λ” JSON κ°μ²΄κ°€ κ·Έλ€λ΅ API Gatewayλ΅ μ „λ‹¬λ©λ‹λ‹¤.

---

## π“ 2λ‹¨κ³„: API Gateway λ¦¬μ†μ¤ λ° λ©”μ„λ“ μƒμ„±

μ΄μ  API Gatewayμ—μ„ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•κ³ , λ°©κΈ λ§λ“  Lambda ν•¨μμ™€ **λΉ„ν”„λ΅μ‹(Non-Proxy)** λ°©μ‹μΌλ΅ μ—°λ™ν•©λ‹λ‹¤.

1. **μƒ λ¦¬μ†μ¤ μƒμ„±**: API Gateway μ½μ†”μ—μ„ `mapping`μ΄λΌλ” μ΄λ¦„μ μƒλ΅μ΄ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    
2. **GET λ©”μ„λ“ μ¶”κ°€**: `/mapping` λ¦¬μ†μ¤μ— **GET** λ©”μ„λ“λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.
    
3. **ν†µν•© μ ν• μ„ νƒ**:
    
    - **ν†µν•© μ ν•**: **Lambda ν•¨μ**
        
    - **Lambda ν”„λ΅μ‹ ν†µν•© μ‚¬μ©(Use Lambda Proxy Integration)**: **λ°λ“μ‹ μ²΄ν¬ ν•΄μ **ν•©λ‹λ‹¤.
        
    - **Lambda ν•¨μ**: μƒμ„±ν• Lambda ν•¨μμ ARNμ„ μ…λ ¥ν•κ±°λ‚ ν•¨μ μ΄λ¦„μ„ κ²€μƒ‰ν•μ—¬ μ„ νƒν•©λ‹λ‹¤.

---

## π¨ 3λ‹¨κ³„: ν†µν•© μ‘λ‹µ λ§¤ν•‘ ν…ν”λ¦Ώ μ„¤μ •

μ΄ λ‹¨κ³„κ°€ μ΄λ² μ‹¤μµμ ν•µμ‹¬μ…λ‹λ‹¤. Lambda ν•¨μκ°€ λ°ν™ν•λ” κ°’μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚΄κΈ° μ „μ— λ³€ν•ν•κΈ° μ„ν• λ§¤ν•‘ ν…ν”λ¦Ώμ„ μ„¤μ •ν•©λ‹λ‹¤.

1. **ν†µν•© μ‘λ‹µ(Integration Response)μΌλ΅ μ΄λ™**: `/mapping` GET λ©”μ„λ“ μ„¤μ • νμ΄μ§€μ—μ„ **ν†µν•© μ‘λ‹µ(Integration Response)**μ„ ν΄λ¦­ν•©λ‹λ‹¤.
    
2. **λ§¤ν•‘ ν…ν”λ¦Ώ μ¶”κ°€**: **λ§¤ν•‘ ν…ν”λ¦Ώ(Mapping Templates)** μ„Ήμ…μ—μ„ `application/json` νƒ€μ…μ ν…ν”λ¦Ώμ„ μ¶”κ°€ν•©λ‹λ‹¤.
    
3. **ν…ν”λ¦Ώ λ°”λ”” μ‘μ„±**: λ‹¤μ μ½”λ“λ¥Ό **ν…ν”λ¦Ώ λ°”λ””(Template Body)**μ— λ¶™μ—¬λ„£μµλ‹λ‹¤. μ΄ μ½”λ“λ” Velocity Template Language(VTL)λ΅ μ‘μ„±λμ—μµλ‹λ‹¤.

```JSON
{
  "my key": "my value",
  "renamed key": "$input.json('$.example')"
}
```

- `"my key": "my value"`: μ΄ λ¶€λ¶„μ€ λ¨λ“  μ‘λ‹µμ— κ³ μ •μ μΌλ΅ ν¬ν•¨λ©λ‹λ‹¤.
    
- `"$input.json('$.example')"`: **`$input`** λ³€μλ” λ°±μ—”λ“(Lambda)λ΅λ¶€ν„° λ°›μ€ μ‘λ‹µμ„ μλ―Έν•©λ‹λ‹¤. `json()` ν•¨μλ” JSON κ²½λ΅λ¥Ό μ‚¬μ©ν•μ—¬ μ‘λ‹µ λ°”λ””μ—μ„ νΉμ • ν‚¤μ κ°’μ„ μ¶”μ¶ν•©λ‹λ‹¤. μ—¬κΈ°μ„λ” `$.example` κ²½λ΅λ¥Ό ν†µν•΄ "hello world" κ°’μ„ κ°€μ Έμµλ‹λ‹¤.

---

## β… 4λ‹¨κ³„: κ²°κ³Ό ν™•μΈ λ° μ‘λ™ μ›λ¦¬ μ΄ν•΄

μ΄μ  API Gatewayμ ν…μ¤νΈ κΈ°λ¥μ„ ν†µν•΄ λ§¤ν•‘ ν…ν”λ¦Ώμ΄ μ λ€λ΅ μ‘λ™ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

1. **ν…μ¤νΈ μ‹¤ν–‰**: `/mapping` GET λ©”μ„λ“ νμ΄μ§€λ΅ λμ•„μ™€ **ν…μ¤νΈ(Test)** νƒ­μ„ ν΄λ¦­ν•κ³ , λ³„λ„μ μ„¤μ • μ—†μ΄ **ν…μ¤νΈ(Test)** λ²„νΌμ„ λ„λ¦…λ‹λ‹¤.
    
2. **μ‘λ‹µ κ²°κ³Ό**: μ‘λ‹µ λ°”λ””λ¥Ό ν™•μΈν•λ©΄ λ‹¤μκ³Ό κ°™μ€ μµμΆ… μ‘λ‹µμ„ λ³Ό μ μμµλ‹λ‹¤.

|ν…μ¤νΈ μ „ (Lambda μ‘λ‹µ)|ν…μ¤νΈ ν›„ (API Gateway μµμΆ… μ‘λ‹µ)|
|---|---|
|`{"example": "hello world"}`|`{"my key": "my value", "renamed key": "hello world"}`|

### π” μ‘λ™ μ›λ¦¬

1. ν΄λΌμ΄μ–ΈνΈκ°€ API Gatewayμ `/mapping` GET λ©”μ„λ“λ¥Ό νΈμ¶ν•©λ‹λ‹¤.
    
2. API Gatewayλ” λΉ„ν”„λ΅μ‹ ν†µν•©μ„ ν†µν•΄ `api-gateway-mapping-get` Lambda ν•¨μλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.
    
3. Lambda ν•¨μλ” `{"example": "hello world"}`λ¥Ό λ°ν™ν•©λ‹λ‹¤.
    
4. API Gatewayλ” μ΄ μ‘λ‹µμ„ λ°›μ•„ λ―Έλ¦¬ μ„¤μ •λ λ§¤ν•‘ ν…ν”λ¦Ώμ„ μ μ©ν•©λ‹λ‹¤.
    
5. λ§¤ν•‘ ν…ν”λ¦Ώμ€ VTL μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰ν•μ—¬ μ‘λ‹µμ `example` ν‚¤ κ°’μ„ μ¶”μ¶ν•κ³ , μƒλ΅μ΄ JSON κµ¬μ΅°μ— μ‚½μ…ν•©λ‹λ‹¤.
    
6. μµμΆ…μ μΌλ΅ λ³€ν•λ JSON μ‘λ‹µμ΄ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬λ©λ‹λ‹¤.

μ΄μ²λΌ λ§¤ν•‘ ν…ν”λ¦Ώμ„ μ‚¬μ©ν•λ©΄, λ°±μ—”λ“ μ„λΉ„μ¤μ λ΅μ§μ„ κ·Έλ€λ΅ μ μ§€ν•λ©΄μ„ APIλ¥Ό νΈμ¶ν•λ” ν΄λΌμ΄μ–ΈνΈμ μ”κµ¬μ‚¬ν•­μ— λ§κ² μ‘λ‹µ ν•μ‹μ„ μμ λ΅­κ² μ΅°μ‘ν•  μ μμµλ‹λ‹¤. λ™μΌν• λ°©μ‹μΌλ΅ **ν†µν•© μ”μ²­(Integration Request)**μ—λ„ λ§¤ν•‘ ν…ν”λ¦Ώμ„ μ μ©ν•μ—¬, ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ λ°±μ—”λ“κ°€ μ΄ν•΄ν•λ” ν•μ‹μΌλ΅ λ³€ν™ν•  μ μμµλ‹λ‹¤.