

이번 문서에서는 AWS의 가장 최신 로드 밸런서 유형인 **게이트웨이 로드 밸런서(GWLB)**에 대해 알아보겠습니다. GWLB는 다른 로드 밸런서와는 달리, 네트워크 트래픽을 특정 가상 어플라이언스(Virtual Appliance)로 전달하여 보안 및 검사를 강화하는 데 특화되어 있습니다.

---

### 게이트웨이 로드 밸런서(GWLB)란 무엇인가?

![[Pasted image 20250627151047.png]]

**GWLB**는 AWS에서 타사 네트워크 가상 어플라이언스(Third-party Network Virtual Appliance)를 배포하고, 확장하며, 관리하는 데 사용됩니다. 여기서 '가상 어플라이언스'는 방화벽(Firewall), 침입 탐지/방지 시스템(IDS/IPS), 딥 패킷 검사(Deep Packet Inspection, DPI) 시스템 등과 같이 네트워크 트래픽을 검사하거나 조작하는 소프트웨어 기반의 솔루션을 의미합니다.

**GWLB를 사용하는 주요 목적:**

- **네트워크 트래픽 검사:** 모든 네트워크 트래픽을 애플리케이션에 도달하기 전에 방화벽이나 IDS/IPS와 같은 보안 어플라이언스를 통과시키고 싶을 때 사용됩니다.
- **네트워크 수준 페이로드 수정:** 네트워크 계층에서 트래픽의 페이로드를 수정해야 할 때 활용됩니다.

---

### GWLB의 작동 방식 (시각적 설명)

일반적인 시나리오에서는 사용자의 트래픽이 로드 밸런서(예: ALB)를 통해 애플리케이션으로 직접 전달됩니다. 하지만 GWLB를 사용하면 이 흐름이 달라집니다.

```
[사용자 트래픽]
       |
       V
[VPC 라우팅 테이블 수정] (GWLB로 트래픽 리디렉션)
       |
       V
[게이트웨이 로드 밸런서 (GWLB)]
       |
       |--- 트래픽 분산 ---> [가상 어플라이언스 대상 그룹]
       |                         (예: 방화벽, IDS/IPS EC2 인스턴스)
       |                         - 트래픽 분석 및 처리
       |                         - 문제가 없으면 GWLB로 다시 전달
       |                         - 문제가 있으면 트래픽 드롭
       V
[게이트웨이 로드 밸런서 (GWLB)] (처리된 트래픽 재수신)
       |
       V
[애플리케이션] (트래픽이 어플라이언스를 거쳤음을 인지하지 못함 - 투명성)
```

**상세 작동 단계:**

1. **VPC 라우팅 테이블 업데이트:** GWLB를 설정하면 VPC의 라우팅 테이블이 업데이트되어, 특정 서브넷 또는 전체 VPC로 들어오거나 나가는 모든 트래픽이 먼저 GWLB를 통과하도록 지시합니다. (이 과정은 네트워크 수준에서 이루어지며, 다소 고급 설정에 해당합니다.)

2. **GWLB로 트래픽 전달:** 사용자로부터 들어오는 모든 트래픽은 가장 먼저 GWLB를 거칩니다.

3. **가상 어플라이언스로 분산:** GWLB는 이 트래픽을 미리 정의된 **가상 어플라이언스 대상 그룹**으로 분산합니다. 이 대상 그룹에는 방화벽이나 IDS/IPS와 같은 타사 가상 어플라이언스가 포함된 EC2 인스턴스들이 있습니다.

4. **어플라이언스 검사 및 처리:** 가상 어플라이언스는 트래픽을 수신하여 분석하고 필요한 작업을 수행합니다 (예: 악성 트래픽 차단, 페이로드 수정).

5. **GWLB로 회신:** 어플라이언스가 트래픽에 문제가 없다고 판단하면, 처리된 트래픽을 다시 GWLB로 돌려보냅니다.

6. **애플리케이션으로 최종 전달:** GWLB는 어플라이언스로부터 받은 트래픽을 최종 목적지인 애플리케이션으로 전달합니다.

7. **투명성:** 애플리케이션 입장에서는 트래픽이 가상 어플라이언스를 거쳐 왔다는 사실을 인지하지 못합니다. 모든 과정이 네트워크 수준에서 투명하게 처리됩니다.

이러한 방식으로 GWLB는 네트워크 트래픽을 분석하고 필터링하는 강력한 기능을 제공하며, 잠재적으로 악성 트래픽을 애플리케이션에 도달하기 전에 차단할 수 있습니다.

---

### GWLB의 핵심 개념 및 특징

GWLB는 다른 로드 밸런서와는 다른 독특한 방식으로 작동합니다.

#### 1. 작동 계층 (Layer 3)

- GWLB는 **Layer 3(네트워크 계층)**, 즉 **IP 패킷** 수준에서 작동합니다. 이는 지금까지 살펴본 ALB(Layer 7)나 NLB(Layer 4)보다 더 낮은 수준입니다.

#### 2. 이중 기능: 투명한 네트워크 게이트웨이 & 로드 밸런서

GWLB는 다음과 같은 두 가지 핵심 기능을 동시에 수행합니다.

- **투명한 네트워크 게이트웨이:** VPC 내의 모든 트래픽이 단일 진입점과 단일 출구(GWLB)를 통해 흐르도록 보장합니다. 이는 트래픽이 어플라이언스를 거치도록 강제하는 '네트워크 스티어링(Network Steering)' 역할을 합니다.
- **로드 밸런서:** 이 게이트웨이를 통과하는 트래픽을 여러 가상 어플라이언스로 구성된 대상 그룹에 분산합니다.

#### 3. GENEVE 프로토콜 지원 (포트 6081)

- GWLB와 대상 어플라이언스 간의 통신은 **GENEVE (Generic Network Virtualization Encapsulation) 프로토콜**을 사용하며, 일반적으로 **포트 6081**을 통해 이루어집니다. 시험에서 GENEVE 프로토콜이나 포트 6081이 언급된다면, 즉시 GWLB를 떠올려야 합니다.

#### 4. 대상 그룹(Target Groups)

![[Pasted image 20250627151059.png]]

GWLB의 대상 그룹에는 다음과 같은 유형의 타사 가상 어플라이언스가 포함될 수 있습니다.

- **EC2 인스턴스:** AWS EC2 인스턴스로 배포된 가상 어플라이언스를 인스턴스 ID로 등록합니다.
- **IP 주소:** 프라이빗 IP 주소만 등록할 수 있습니다. 이는 온프레미스 데이터센터나 다른 네트워크에 있는 자체 가상 어플라이언스를 GWLB 뒤에 배치할 때 유용합니다.

---

### 요약

GWLB는 특정 네트워크 보안 및 트래픽 검사 요구 사항을 충족하기 위한 특수 목적 로드 밸런서입니다. 모든 네트워크 트래픽이 방화벽, IDS/IPS와 같은 가상 어플라이언스를 투명하게 통과하도록 보장하여 네트워크의 보안 태세를 강화합니다.

GWLB의 핵심은 트래픽이 **GWLB -> 가상 어플라이언스 -> GWLB -> 애플리케이션**의 경로를 거치도록 하는 독특한 흐름과 **Layer 3에서 GENEVE 프로토콜**을 사용하는 점입니다.
