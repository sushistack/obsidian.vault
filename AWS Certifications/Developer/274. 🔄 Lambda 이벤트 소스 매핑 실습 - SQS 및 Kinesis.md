
μ΄λ² μ•„ν‹°ν΄μ—μ„λ” Lambdaμ **μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘(Event Source Mapping)** κΈ°λ¥μ„ μ§μ ‘ μ‹¤μµν•΄ λ³΄κ² μµλ‹λ‹¤. SQS νλ¥Ό ν™μ©ν•μ—¬ λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•κ³ , Kinesis μ¤νΈλ¦Όμ μ„¤μ • μµμ…μ„ κ°„λµν•κ² μ‚΄ν΄λ³΄λ” κ³Όμ •κΉμ§€ λ‹¤λ£Ήλ‹λ‹¤.

---
### 1. π› οΈ Lambda ν•¨μ λ° SQS ν μƒμ„±

λ¨Όμ €, μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘μ„ ν…μ¤νΈν•  Lambda ν•¨μμ™€ SQS νλ¥Ό μƒμ„±ν•©λ‹λ‹¤.

1. **Lambda ν•¨μ μƒμ„±**: Lambda μ½μ†”μ—μ„ `lambda-SQS`λΌλ” μ΄λ¦„μ ν•¨μλ¥Ό μƒμ„±ν•κ³  λ°νƒ€μ„μ€ `Python 3.8`μ„ μ„ νƒν•©λ‹λ‹¤.
    
2. **SQS ν μƒμ„±**: SQS μ½μ†”μ—μ„ **ν‘μ¤€ ν(Standard queue)**λ¥Ό μƒμ„±ν•κ³  μ΄λ¦„μ„ `lambda-demo-SQS`λ΅ μ§€μ •ν•©λ‹λ‹¤.

---

### 2. π”— Lambdaμ— SQS νΈλ¦¬κ±° μ¶”κ°€ (μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘)

μ΄μ  Lambda ν•¨μμ— SQS νλ¥Ό μ΄λ²¤νΈ μ†μ¤λ΅ μ—°κ²°ν•©λ‹λ‹¤.

1. `lambda-SQS` ν•¨μ μ½μ†”μ—μ„ **'νΈλ¦¬κ±° μ¶”κ°€(Add trigger)'**λ¥Ό ν΄λ¦­ν•©λ‹λ‹¤.
    
2. **μ†μ¤ μ„ νƒ**μ—μ„ `SQS`λ¥Ό μ„ νƒν•©λ‹λ‹¤.
    
3. **SQS ν** λ“λ΅­λ‹¤μ΄μ—μ„ `lambda-demo-SQS`λ¥Ό μ„ νƒν•©λ‹λ‹¤.
    
4. **λ°°μΉ ν¬κΈ°(Batch size)**λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. μ΄λ” ν• λ²μ— μ²λ¦¬ν•  λ©”μ‹μ§€ μμ΄λ©°, 1λ¶€ν„° 10κΉμ§€ κ°€λ¥ν•©λ‹λ‹¤.
    
5. `νΈλ¦¬κ±° ν™μ„±ν™”`λ¥Ό μ²΄ν¬ν•κ³  **'μ¶”κ°€(Add)'**λ¥Ό ν΄λ¦­ν•©λ‹λ‹¤.

μ΄ κ³Όμ •μ—μ„ **'μ‹¤ν–‰ μ—­ν• μ— κ¶ν•μ΄ λ¶€μ΅±ν•λ‹¤'**λ” μ¤λ¥κ°€ λ°μƒν•  μ μμµλ‹λ‹¤. Lambda ν•¨μλ” SQS νμ—μ„ λ©”μ‹μ§€λ¥Ό μ½μ–΄μ¤κΈ° μ„ν•΄ IAM κ¶ν•μ΄ ν•„μ”ν•κΈ° λ•λ¬Έμ…λ‹λ‹¤.

---

### 3. π›΅οΈ IAM κ¶ν• μ„¤μ •

Lambda ν•¨μκ°€ SQS νλ¥Ό ν΄λ§ν•  μ μλ„λ΅ IAM μ—­ν• μ— κ¶ν•μ„ μ¶”κ°€ν•΄μ•Ό ν•©λ‹λ‹¤.

1. `lambda-SQS` ν•¨μμ **'κµ¬μ„±(Configuration)'** νƒ­μΌλ΅ μ΄λ™ν• λ’¤, **'κ¶ν•(Permissions)'** μ„Ήμ…μ—μ„ **μ‹¤ν–‰ μ—­ν• (Execution role)** μ΄λ¦„μ„ ν΄λ¦­ν•©λ‹λ‹¤.
    
2. IAM μ½μ†”λ΅ μ΄λ™ν•λ©΄, 'κ¶ν• μ¶”κ°€(Add permissions)' -> **'μ •μ±… μ—°κ²°(Attach policies)'**μ„ ν΄λ¦­ν•©λ‹λ‹¤.
    
3. `AWSLambdaSQSQueueExecutionRole` μ •μ±…μ„ κ²€μƒ‰ν•μ—¬ μ—°κ²°ν•©λ‹λ‹¤. μ΄ μ •μ±…μ€ Lambda ν•¨μκ°€ SQS νμ— μ ‘κ·Όν•μ—¬ λ©”μ‹μ§€λ¥Ό μ½μ„ μ μλ” μµμ†ν•μ κ¶ν•μ„ λ¶€μ—¬ν•©λ‹λ‹¤.
    
4. λ‹¤μ‹ Lambda ν•¨μμ νΈλ¦¬κ±° μ„¤μ • νμ΄μ§€λ΅ λμ•„κ°€μ„ **'μ¶”κ°€(Add)'**λ¥Ό ν΄λ¦­ν•λ©΄ μ •μƒμ μΌλ΅ νΈλ¦¬κ±°κ°€ μ¶”κ°€λ©λ‹λ‹¤.

---

### 4. π“ Lambda ν•¨μ μ½”λ“ λ° λ©”μ‹μ§€ μ „μ†΅ ν…μ¤νΈ

μ΄μ  Lambda ν•¨μκ°€ SQS λ©”μ‹μ§€λ¥Ό μ–΄λ–»κ² μ²λ¦¬ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

1. `lambda-SQS` ν•¨μμ μ½”λ“ νΈμ§‘κΈ°μ—μ„ λ‹¤μ μ½”λ“λ¥Ό μ…λ ¥ν•μ—¬ μ΄λ²¤νΈλ¥Ό λ΅κΉ…ν•λ„λ΅ μμ •ν•©λ‹λ‹¤.


```Python
import json

def lambda_handler(event, context):
    print("Received SQS event:", json.dumps(event, indent=2))
    return {
        'statusCode': 200,
        'body': json.dumps('Success')
    }
```

2. **'λ°°ν¬(Deploy)'**λ¥Ό ν΄λ¦­ν•μ—¬ ν•¨μλ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.
    
3. SQS μ½μ†”λ΅ μ΄λ™ν•μ—¬ `lambda-demo-SQS` νλ¥Ό μ„ νƒν• ν›„ **'λ©”μ‹μ§€ μ „μ†΅ λ° μμ‹ (Send and receive messages)'** νƒ­μ—μ„ λ©”μ‹μ§€λ¥Ό λ³΄λƒ…λ‹λ‹¤.
    
    - **λ©”μ‹μ§€ λ³Έλ¬Έ**: `Hello World`
        
    - **λ©”μ‹μ§€ μ†μ„±**: `foo` = `bar`
    
4. **'λ©”μ‹μ§€ μ „μ†΅(Send message)'**μ„ ν΄λ¦­ν•©λ‹λ‹¤.

Lambdaμ μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘μ΄ λ©”μ‹μ§€λ¥Ό ν΄λ§ν•μ—¬ ν•¨μλ¥Ό νΈμ¶ν•©λ‹λ‹¤.

---

### 5. π” κ²°κ³Ό ν™•μΈ λ° μ •λ¦¬

ν†µν•©μ΄ μ„±κ³µν–λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

1. Lambda ν•¨μμ **'λ¨λ‹ν„°λ§(Monitor)'** νƒ­μ—μ„ **'CloudWatch λ΅κ·Έ λ³΄κΈ°(View logs in CloudWatch)'**λ¥Ό ν΄λ¦­ν•©λ‹λ‹¤.
    
2. λ΅κ·Έ μ¤νΈλ¦Όμ„ μ—΄μ–΄λ³΄λ©΄, SQS λ©”μ‹μ§€κ°€ μ΄λ²¤νΈ νμ΄λ΅λ“λ΅ μ „λ‹¬λ κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. νμ΄λ΅λ“μ—λ” λ©”μ‹μ§€ λ³Έλ¬Έ(`body`)κ³Ό μ†μ„±(`messageAttributes`)μ΄ λ¨λ‘ ν¬ν•¨λ©λ‹λ‹¤.
    
3. SQS μ½μ†”λ΅ λμ•„μ™€ `lambda-demo-SQS` νλ¥Ό ν™•μΈν•λ©΄, Lambdaκ°€ λ©”μ‹μ§€λ¥Ό μ„±κ³µμ μΌλ΅ μ²λ¦¬ν–κΈ° λ•λ¬Έμ— 'μ‚¬μ© κ°€λ¥ν• λ©”μ‹μ§€(Messages available)'κ°€ `0`μ΄ λ κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤.

**β οΈ μ¤‘μ”**: SQS μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘μ€ μ§€μ†μ μΌλ΅ νλ¥Ό ν΄λ§ν•λ―€λ΅, λ¶ν•„μ”ν• λΉ„μ©μ΄ λ°μƒν•  μ μμµλ‹λ‹¤. μ‹¤μµμ΄ λλ‚λ©΄ λ°λ“μ‹ Lambda ν•¨μμ **νΈλ¦¬κ±°λ¥Ό λΉ„ν™μ„±ν™”**ν•κ±°λ‚ μ‚­μ ν•΄μ•Ό ν•©λ‹λ‹¤.

### 6. π Kinesis μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘ μµμ… (μ°Έκ³ )

SQS μ™Έμ— λ λ‹¤λ¥Έ μ΄λ²¤νΈ μ†μ¤ λ§¤ν•‘μΈ **Kinesis**λ” λ”μ± λ‹¤μ–‘ν• μ„¤μ • μµμ…μ„ μ κ³µν•©λ‹λ‹¤.

- **λ°°μΉ ν¬κΈ°(Batch size)**: ν• λ²μ— μ½μ„ λ μ½”λ“ μ.
    
- **μ‹μ‘ μ„μΉ(Starting position)**: μ¤νΈλ¦Όμ—μ„ λ°μ΄ν„°λ¥Ό μ½κΈ° μ‹μ‘ν•  μ§€μ (μµμ‹ , κ°€μ¥ μ¤λλ, νΉμ • μ‹κ°„).
    
- **μµλ€ λ³‘λ ¬ μ²λ¦¬(Maximum concurrency)**: μƒ¤λ“λ‹Ή λ™μ‹μ— μ²λ¦¬ν•  μ μλ” λ°°μΉμ μ (μµλ€ 10).
    
- **μ¤λ¥ μ‹ λ°°μΉ λ¶„ν• (Split batch on error)**: Lambda νƒ€μ„μ•„μ›ƒ μ¤λ¥ λ°μƒ μ‹ λ°°μΉλ¥Ό λ¶„ν• ν•μ—¬ μ¬μ‹λ„.

μ΄λ¬ν• μµμ…λ“¤μ€ Kinesis μ¤νΈλ¦Όμ νΉμ„±μ„ κ³ λ ¤ν•μ—¬ μ²λ¦¬λ‰, μ§€μ—° μ‹κ°„, μμ„ λ³΄μ¥ λ“±μ„ μ •λ°€ν•κ² μ μ–΄ν•  μ μκ² ν•©λ‹λ‹¤.