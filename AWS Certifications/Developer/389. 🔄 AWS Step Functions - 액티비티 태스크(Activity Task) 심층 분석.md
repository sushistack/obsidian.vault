
AWS Step Functions의 **액티비티 태스크(Activity Task)**는 워크플로우를 외부에서 실행되는 태스크와 연동하는 메커니즘입니다. 이는 `태스크 토큰 대기` 패턴과 유사하지만, **작업 전달 방식**에 있어 중요한 차이가 있습니다.

---

## 1. ⚙️ 액티비티 태스크의 동작 원리: 폴링(Polling) 방식

![[Pasted image 20250913165919.png]]

액티비티 태스크의 핵심은 **폴링(Polling)** 기반의 통신입니다. `액티비티 워커(Activity Worker)`라고 불리는 외부 애플리케이션(EC2 인스턴스, 온프레미스 서버 등)이 Step Functions에 직접 연결되어, 수행할 작업이 있는지 지속적으로 요청합니다.

### 워크플로우

1. **작업자(Worker) 대기**: 액티비티 워커는 `GetActivityTask` API를 호출하여 Step Functions에 새로운 작업이 있는지 묻습니다.
    
2. **작업 전달**: Step Functions는 대기 중인 작업이 있으면 해당 작업의 **입력 데이터**와 **태스크 토큰**을 작업자에게 반환합니다.
    
3. **작업 수행**: 작업자는 받은 데이터로 작업을 처리합니다.
    
4. **결과 반환**: 작업이 완료되면 `SendTaskSuccess` 또는 `SendTaskFailure` API를 호출하여 결과를 Step Functions에 다시 보냅니다.


---

## 2. 🆚 `액티비티 태스크` vs. `태스크 토큰 대기`

두 메커니즘은 모두 외부 시스템과의 통합을 위해 사용되지만, 통신 방식에서 큰 차이가 있습니다.

|특징|**액티비티 태스크(Activity Task)**|**`태스크 토큰 대기` 패턴**|
|---|---|---|
|**통신 방식**|**폴링(Pull)**: 워커가 Step Functions에 직접 작업을 요청(Pull)합니다.|**푸시(Push)**: Step Functions가 외부 시스템(SQS 큐 등)에 이벤트를 푸시(Push)합니다.|
|**네트워크 구성**|워커가 Step Functions 엔드포인트에 접근할 수만 있으면 됩니다.|Step Functions가 외부 시스템(예: SQS)으로 메시지를 보낼 수 있어야 합니다.|
|**유연성**|워커가 언제든지 작업을 가져갈 수 있어, 필요에 따라 워커를 확장할 수 있습니다.|외부 시스템과의 API 또는 메시지 큐 연동이 필요합니다.|

---

## 3. ⏳ 타임아웃 및 하트비트(Heartbeat) 관리

액티비티 태스크는 작업자의 상태를 확인하기 위해 `TimeoutSeconds`와 `HeartbeatSeconds`라는 두 가지 설정을 사용합니다.

- **`TimeoutSeconds`**: 작업이 시작된 후 `SendTaskSuccess` 또는 `SendTaskFailure` 응답이 오지 않을 경우, 해당 작업을 실패로 간주하는 최대 시간입니다.
    
- **`HeartbeatSeconds`**: 작업자가 작업이 아직 진행 중임을 알리기 위해 `SendTaskHeartbeat` API를 호출하는 주기입니다. Step Functions는 이 주기 내에 하트비트를 받지 못하면 작업을 실패로 간주합니다.
    

이 두 설정을 활용하면, 장시간 실행되는 작업을 안정적으로 처리할 수 있습니다. 예를 들어, `TimeoutSeconds`를 길게 설정하고 `HeartbeatSeconds`를 짧게 설정하면, 워크플로우를 최대 1년까지 일시 정지 상태로 유지할 수 있습니다.