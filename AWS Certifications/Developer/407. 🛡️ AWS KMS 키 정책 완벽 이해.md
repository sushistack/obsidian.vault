
AWS KMS 키 정책(Key Policy)은 KMS 키에 대한 접근을 제어하는 핵심 보안 메커니즘입니다. 키 정책은 IAM 정책과 유사한 구조를 가지지만, KMS 키 자체에 직접 연결된다는 점에서 차이가 있습니다. 이 가이드에서는 키 정책의 기본 개념과 함께, 다양한 주체(Principal)에게 권한을 부여하는 방법에 대해 자세히 알아보겠습니다.

---

## 🔑 키 정책의 기본 개념

KMS 키 정책은 누가 KMS 키를 사용하거나 관리할 수 있는지 정의하는 **리소스 기반 정책**입니다. IAM 사용자가 KMS 키를 사용하려면, 다음과 같은 두 가지 조건이 모두 충족되어야 합니다.

1. **IAM 정책**: IAM 사용자에게 `kms:Decrypt`와 같은 KMS 작업(`Action`)을 허용하는 IAM 정책이 있어야 합니다.
    
2. **KMS 키 정책**: 해당 IAM 사용자가 KMS 키 정책에서 허용된 주체(`Principal`)여야 합니다.
    

만약 두 정책 중 하나라도 권한이 없다면 KMS 키에 접근할 수 없습니다.

### 기본 키 정책 (Default Key Policy)

AWS 콘솔에서 KMS 키를 생성할 때 **기본 키 정책**이 자동으로 생성됩니다. 이 정책은 다음과 같은 내용을 포함합니다.

- **계정의 루트 사용자**: 계정의 모든 권한을 가진 루트 사용자는 이 키를 관리할 수 있습니다.
    
- **IAM 권한 위임**: `Principal`을 `AWS: <Your Account ID>`로 지정하여 계정 내 모든 IAM 사용자, 역할, 그룹에게 **IAM 정책을 통해** KMS 키에 대한 권한을 위임할 수 있습니다. 즉, IAM 정책만으로도 키 사용 권한을 부여할 수 있도록 허용하는 역할을 합니다.

---

## 🙋‍♂️ 키 정책에 명시적으로 허용할 수 있는 주체(Principal) 유형

키 정책은 특정 주체(Principal)에게 직접 권한을 부여하여 IAM 정책 없이도 KMS 키를 사용할 수 있게 할 수 있습니다. 이는 특히 다른 AWS 계정과의 키 공유 시 매우 중요합니다.

### 1. AWS 계정 및 루트 사용자

계정 번호를 지정하여 해당 계정의 모든 IAM 주체에게 키 접근 권한을 부여합니다.

```JSON
"Principal": {
    "AWS": "arn:aws:iam::123456789012:root"
}
```

- **효과**: 이 정책은 계정의 모든 IAM 주체(사용자, 역할 등)가 이 키를 사용하도록 허용합니다. 하지만 최종 권한은 각 주체에게 연결된 **IAM 정책에 의해 결정**됩니다.
    

### 2. 특정 IAM 사용자 또는 역할

특정 IAM 사용자나 역할의 ARN을 직접 명시하여 정확한 주체에게 권한을 부여합니다.

```JSON
"Principal": {
    "AWS": "arn:aws:iam::123456789012:user/Alice"
}
```

- **효과**: `user/Alice`는 별도의 IAM 정책 없이도 이 키 정책에 명시된 KMS 작업을 수행할 수 있습니다.
    

### 3. IAM 역할 세션 및 페더레이션 사용자

IAM 역할 세션(예: `sts:AssumeRole`로 생성된 임시 자격 증명) 또는 페더레이션 사용자(`Federated User`)에게 권한을 부여할 수 있습니다.

```JSON
"Principal": {
    "Federated": "arn:aws:iam::123456789012:saml-provider/MySAMLProvider"
}
```

- **효과**: `Federated`는 SAML, Cognito 등을 통해 로그인한 사용자의 세션에 권한을 부여할 때 유용합니다.
    

### 4. AWS 서비스

S3, Lambda, EC2 등 특정 AWS 서비스가 사용자를 대신하여 KMS를 호출하도록 허용할 수 있습니다.

```JSON
"Principal": {
    "Service": "ec2.amazonaws.com"
}
```

- **효과**: 이 정책은 EC2 서비스(예: EBS 볼륨 암호화)가 이 키를 사용하도록 허용합니다. 이 방식은 AWS 관리형 키 정책에서 자주 볼 수 있습니다.
    

### 5. 와일드카드 (`*`)

모든 주체에게 권한을 부여할 때 사용합니다. 보안상 가장 위험하므로 신중하게 사용해야 합니다.

```JSON
"Principal": {
    "AWS": "*"
}
```

- **효과**: 이 정책은 전 세계 모든 AWS 계정 및 사용자가 이 키에 접근하도록 허용합니다. 추가적인 조건(`Condition`)이 없다면 공개적으로 노출되므로 주의해야 합니다.
    

---

## 📝 키 정책 예시

다음은 특정 IAM 역할에 `Encrypt` 및 `Decrypt` 권한을 부여하는 KMS 키 정책 예시입니다.

```JSON
{
  "Version": "2012-10-17",
  "Id": "key-console-policy-3",
  "Statement": [
    {
      "Sid": "Enable IAM user permissions",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:root"
      },
      "Action": "kms:*",
      "Resource": "*"
    },
    {
      "Sid": "Allow encrypt and decrypt",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:role/MyLambdaRole"
      },
      "Action": [
        "kms:Encrypt",
        "kms:Decrypt"
      ],
      "Resource": "*"
    }
  ]
}
```

- **`Statement`**: 이 정책은 두 개의 규칙으로 구성됩니다.
- **`Sid`**: 각 규칙을 식별하는 이름입니다.
- **`Statement[0]`**: 계정의 루트 사용자에게 모든 KMS 권한을 부여합니다. 이는 IAM 정책을 통한 권한 위임을 가능하게 합니다.
- **`Statement[1]`**: `MyLambdaRole`이라는 IAM 역할에게 이 키에 대한 `Encrypt`와 `Decrypt` 작업만 허용합니다.

이처럼 KMS 키 정책은 **IAM 정책과 함께 작동**하여 KMS 키에 대한 정교한 접근 제어를 가능하게 합니다.