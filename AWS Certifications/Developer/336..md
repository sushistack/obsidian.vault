# 

이번 가이드에서는 **Amazon API Gateway**가 **OpenAPI 사양(Specification)**과 어떻게 긴밀하게 통합되는지 살펴보고, 특히 이 통합을 활용한 **요청 유효성 검사(Request Validation)** 기능에 대해 상세히 알아보겠습니다. OpenAPI를 사용하면 API를 코드로서 정의하고, 이를 통해 다양한 이점을 얻을 수 있습니다.

---

## 📝 1단계: OpenAPI 사양과 API Gateway의 연동

**OpenAPI 사양**은 RESTful API를 정의하기 위한 표준 언어 중 하나로, YAML 또는 JSON 형식으로 작성됩니다. API Gateway는 이 사양을 가져오고 내보내는 기능을 제공하여 API 관리를 효율화합니다.

- **가져오기(Import)**: OpenAPI 사양 파일을 사용하여 API Gateway에 새로운 API를 자동으로 생성할 수 있습니다. 이 사양에는 메서드, 요청, 응답, 심지어 AWS 전용 확장(예: Lambda 통합 설정)까지 모두 포함될 수 있습니다.
    
- **내보내기(Export)**: API Gateway에 이미 존재하는 API를 OpenAPI 사양 파일로 내보낼 수 있습니다. 이렇게 내보낸 파일은 API의 **공식 문서** 역할을 하거나, **클라이언트 SDK**를 자동으로 생성하는 데 사용될 수 있습니다.
    

이러한 양방향 연동을 통해 API의 정의와 구현을 일관되게 관리하고, 개발 프로세스를 자동화할 수 있습니다.

---

## 🛡️ 2단계: OpenAPI 기반 요청 유효성 검사

OpenAPI 사양의 가장 강력한 활용 사례 중 하나는 **요청 유효성 검사**입니다. API Gateway는 백엔드로 요청을 보내기 전에, 요청이 미리 정의된 스키마에 부합하는지 자동으로 검증합니다.

### ❓ 왜 필요한가?

- **백엔드 부하 감소**: 잘못된 형식의 요청은 백엔드 서비스(예: Lambda 함수)까지 도달하지 못하고 API Gateway에서 **400 Bad Request** 오류로 즉시 거부됩니다. 이는 백엔드가 유효성 검사 로직을 처리하는 부담을 덜어줍니다.
    
- **안정성 향상**: 백엔드는 항상 유효한 형식의 데이터만 받게 되므로, 잘못된 입력값으로 인한 오류 발생 가능성이 줄어듭니다.
    
- **개발 편의성**: API Gateway가 기본적인 유효성 검사를 대신 처리해주므로, 백엔드 개발자는 비즈니스 로직에 더 집중할 수 있습니다.
    

### 🕵️‍♂️ 검사 항목

API Gateway는 OpenAPI 사양에 정의된 모델을 기반으로 다음 항목들을 검사할 수 있습니다.

- **요청 파라미터**: URI 경로, 쿼리 스트링, 헤더에 특정 파라미터가 포함되어 있는지, 비어있지 않은지 등을 검사합니다.
    
- **요청 페이로드(Body)**: 요청 바디의 JSON/XML 데이터가 사전에 정의된 **스키마 모델**을 준수하는지 검사합니다.
    

---

## 📜 3단계: 유효성 검사 설정 방법

OpenAPI 사양 파일(YAML 또는 JSON)에 API Gateway 전용 확장(`x-amazon-apigateway-request-validator`)을 추가하여 요청 유효성 검사를 설정합니다.

### 📜 OpenAPI 스키마 예시

다음은 특정 메서드에 대해 유효성 검사를 활성화하는 OpenAPI 스키마 예시입니다.

YAML

```
paths:
  /validation:
    post:
      x-amazon-apigateway-request-validator: 'all-params-and-body'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
```

- `x-amazon-apigateway-request-validator`: 이 확장 속성을 사용하여 유효성 검사기의 이름을 지정합니다. 위 예시에서는 `all-params-and-body`라는 이름의 유효성 검사기를 사용합니다.
    
- `schema`: `requestBody`에 포함된 `schema`는 **요청 바디의 JSON 구조**를 정의합니다. 이 스키마에 따라 `name`이라는 문자열 속성이 필수적으로 포함되어야 함을 명시합니다.
    

API Gateway 콘솔에서 `request validator`를 정의하고, 이를 각 메서드에 연결하여 어떤 종류의 유효성 검사를 수행할지 세밀하게 제어할 수 있습니다. 이처럼 OpenAPI와 API Gateway의 통합은 API의 정의와 구현을 일치시키고, API의 신뢰성을 크게 향상시키는 강력한 방법입니다.