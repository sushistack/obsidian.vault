
## 🏗️ 데드-레터 큐(DLQ) 생성 및 설정

### 1. DLQ 생성

- **DLQ 이름:** `DemoQueueDLQ`
- **메시지 보존 기간:** **14일**로 설정하여 실패 메시지를 충분히 분석할 시간을 확보합니다.
- **큐 유형:** 소스 큐(`DemoQueue`)가 `Standard` 큐이므로, DLQ도 **`Standard` 큐**로 생성합니다.
### 2. 소스 큐 설정

- **소스 큐 이름:** `DemoQueue`
- **가시성 제한 시간:** 데모를 위해 **5초**로 짧게 설정합니다. 이는 컨슈머가 메시지를 가져간 후 5초가 지나면 메시지가 다시 큐에 나타나게 함으로써 메시지 재수신 과정을 빠르게 진행하기 위함입니다.
- **DLQ 연결:** `Redrive and dead-letter queue` 설정에서 `Enabled`를 선택하고, **`DemoQueueDLQ`**를 DLQ로 지정합니다.
- **`MaximumReceives`:** **3**으로 설정합니다. 이로써 메시지가 세 번 이상 수신되면 DLQ로 이동하게 됩니다.

---

## 🧪 DLQ 동작 실습

### 1. '독약 메시지(Poison Pill)' 전송

- **메시지 내용:** `hello world, poison pill`
- **전송:** `DemoQueue`에 해당 메시지를 전송합니다. 이 메시지는 컨슈머가 처리하지 못하고 계속 재시도하는 상황을 시뮬레이션합니다.

### 2. 메시지 재수신 및 DLQ 이동 확인

- **첫 번째 수신:** `DemoQueue`에서 메시지를 **`Poll for messages`**로 가져옵니다. `Receive Count`는 **1**이 됩니다.
- **두 번째 수신:** 5초가 지나면 가시성 제한 시간이 만료되어 메시지가 다시 큐에 나타납니다. 다시 `Poll for messages`를 실행하면 메시지를 다시 수신하며, `Receive Count`는 **2**가 됩니다.
    
- **세 번째 수신:** 5초 후 다시 메시지를 수신하며, `Receive Count`는 **3**이 됩니다.
    
- **DLQ로 이동:** 세 번째 수신 후, `MaximumReceives` 임계값(3)을 초과했으므로 메시지는 `DemoQueue`에서 사라지고 **`DemoQueueDLQ`**로 이동합니다. `DemoQueue`를 다시 폴링하면 메시지가 보이지 않습니다.
    

### 3. DLQ에서 메시지 확인

- **`DemoQueueDLQ`** 탭으로 이동하여 메시지를 **`Poll for messages`**로 가져옵니다.
    
- 소스 큐에서 사라졌던 `hello world, poison pill` 메시지가 DLQ에 들어와 있는 것을 확인할 수 있습니다.
    

---

## 🔄 DLQ Re-drive to Source (소스 큐로 재전송)

`DLQ Redrive`는 DLQ의 메시지를 소스 큐로 다시 보내어 재처리할 수 있도록 하는 유용한 기능입니다.

### 1. 재전송 시작

- `DemoQueueDLQ` 큐 페이지에서 오른쪽 상단의 **`Start DLQ redrive`**를 클릭합니다.
    
- **`Source queue`**로 `DemoQueue`가 올바르게 설정되어 있는지 확인하고, `DLQ redrive`를 시작합니다.
    

### 2. 재전송 결과 확인

- `DLQ redrive task`가 성공적으로 완료되면, **`DemoQueue`**로 돌아갑니다.
    
- **`Send and receive messages`**에서 `Poll for messages`를 실행하면, DLQ에 있었던 메시지가 다시 소스 큐에 나타난 것을 확인할 수 있습니다.
    

이 실습은 DLQ가 메시지 처리 실패 시 **자동으로 불량 메시지를 격리**하고, 문제가 해결된 후에는 **쉽게 메시지를 재처리**할 수 있도록 돕는 강력한 도구임을 보여줍니다.