
## 📝 지표 필터(Metric Filter)란?

**CloudWatch Logs 지표 필터**는 로그 데이터 내에서 특정 패턴(예: 오류 코드 `400`)을 찾아내고, 이 패턴이 감지될 때마다 CloudWatch의 **지표(Metric)** 값을 증가시키는 기능입니다. 이 지표를 활용하면 시스템의 중요한 이벤트 발생 횟수를 추적하고, 특정 임계값을 초과할 경우 알림을 받을 수 있습니다.

---

## 🛠️ 지표 필터 생성 단계별 가이드

엔진엑스(Engine X) 액세스 로그에서 `400` 오류 코드를 감지하고 지표로 만드는 과정을 예시로 설명합니다.

### 1단계: 로그 필터 패턴 정의

1. CloudWatch 콘솔에서 `로그 그룹` > `지표 필터`로 이동하거나, 특정 로그 스트림에서 `Create metric filter`를 클릭합니다.
    
2. **Filter Pattern** 입력란에 찾고자 하는 키워드나 패턴을 입력합니다.
    
    - **예시**: `400`
        
3. `Test pattern`을 클릭하여 패턴이 로그에서 얼마나 많이 일치하는지 확인합니다. 이 기능을 통해 패턴이 올바르게 작동하는지 미리 검증할 수 있습니다.
    

### 2단계: 지표 필터 설정

필터 패턴이 정상적으로 작동하는 것을 확인했다면 다음 단계로 넘어갑니다.

1. **Metric Filter Name**을 지정합니다. (예: `MetricFilter400Code`)
2. **Metric Namespace**를 지정합니다. 이는 지표를 그룹화하는 데 사용됩니다. (예: `MetricFilters`)
3. **Metric Name**을 지정합니다. 이는 생성될 지표의 이름입니다. (예: `MyDemoFilter`)
4. **Metric Value**를 `1`로 설정합니다. 이는 패턴이 일치할 때마다 지표 값이 `1`씩 증가함을 의미합니다.
5. **Default Value**를 `0`으로 설정합니다. 이는 패턴이 일치하는 이벤트가 없을 때 지표 값이 `0`임을 의미합니다.

### 3단계: 지표 필터 생성 완료

설정을 마치고 `Create metric filter`를 클릭하면, 지정된 지표 필터가 생성됩니다.

🚨 **중요**: 지표 필터는 생성 시점 이후에 발생하는 로그 이벤트에만 적용됩니다. 이전 데이터는 지표로 변환되지 않습니다.

---

## 🔔 지표를 기반으로 한 경보(Alarm) 설정

생성된 지표 필터는 단순히 데이터를 수집하는 것에 그치지 않고, **CloudWatch 경보**와 연동하여 자동 알림을 구성할 수 있습니다.

### 1단계: 지표 확인 및 경보 생성

1. CloudWatch 콘솔의 **`지표`** 페이지로 이동하여 방금 생성한 `MetricFilters` 네임스페이스를 확인합니다.

2. `MyDemoFilter` 지표를 선택하고 **`Create alarm`**을 클릭합니다.

### 2단계: 경보 조건 설정

1. **지표**를 선택하고, **통계(Statistic)**와 **기간(Period)**을 설정합니다.
    
2. **임계값(Threshold)**을 설정합니다.
    
    - **예시**: `> 50` (50보다 클 경우 경보를 울림)
    - 이는 1분 동안 `400` 오류 코드가 50회 이상 발생하면 비정상적인 상황으로 간주하고 알림을 보내는 것을 의미합니다.

### 3단계: 알림 설정 및 경보 생성

1. **알림(Notification)** 섹션에서 `In alarm` 상태일 때 알림을 받을 **SNS(Simple Notification Service)** 토픽을 선택합니다.
2. **경보 이름**을 지정합니다. (예: `DemoMetricFilterAlarm`)
3. `Create alarm`을 클릭하여 경보를 생성합니다.

이제 로그 필터와 연결된 CloudWatch 경보가 활성화되었습니다. 만약 지정된 임계값을 초과하는 이벤트가 발생하면, 즉시 알림이 발송되어 문제를 빠르게 인지하고 대응할 수 있습니다.

|기능|설명|
|---|---|
|**지표 필터**|로그 패턴을 감지하여 지표로 변환|
|**지표**|수치형 데이터로 문제 발생 횟수 추적|
|**경보**|지표가 특정 임계값 초과 시 알림을 트리거|
|**알림**|SNS를 통해 이메일, SMS 등으로 알림을 발송|