
AWS Secrets Manager는 API 키, 데이터베이스 자격 증명 등 애플리케이션에 필요한 비밀 정보를 안전하게 저장, 관리, 검색하는 서비스입니다. SSM 파라미터 스토어와 유사하지만, 특히 **비밀 정보의 자동 순환(rotation)** 기능에 특화되어 있어 더욱 강력한 보안 솔루션을 제공합니다.

---

## 1. ⚙️ Secrets Manager의 주요 특징

### 1. 비밀 정보 자동 순환 (Automated Secret Rotation)

Secrets Manager의 가장 중요한 기능은 비밀 정보를 **자동으로 순환**시킬 수 있다는 점입니다.

- **주기 설정**: 비밀 정보가 자동으로 변경되는 주기를 설정할 수 있습니다(예: 30일 또는 60일마다).
    
- **Lambda 통합**: 비밀 정보 순환은 사용자가 직접 작성한 **AWS Lambda 함수**를 통해 실행됩니다. 이 함수는 Secrets Manager의 호출에 응답하여, 데이터베이스에 새로운 비밀번호를 생성하거나 API 키를 갱신하는 등의 작업을 수행합니다.
    
- **장점**: 수동으로 비밀번호를 변경하는 번거로움을 없애고, 보안 침해 위험을 줄여줍니다.

### 2. RDS와의 강력한 통합

Secrets Manager는 Amazon RDS(Aurora, MySQL, PostgreSQL 등)와 기본적으로 통합되어 있습니다. 이를 통해 Secrets Manager에 저장된 데이터베이스 자격 증명을 자동으로 데이터베이스에 적용하고, 순환 기능을 통해 비밀번호를 변경할 수 있습니다.

### 3. 유연한 비밀 정보 저장 방식

Secrets Manager는 다양한 유형의 비밀 정보를 저장할 수 있습니다.

- **데이터베이스 자격 증명**: 사용자 이름과 비밀번호를 별도 필드에 입력하여 RDS와 같은 데이터베이스와 연결할 수 있습니다.
    
- **키-값 페어**: API 키, OAuth 토큰 등 다양한 형식의 비밀 정보를 여러 개의 **키-값 페어**로 저장할 수 있습니다. 이는 하나의 비밀 정보 항목에 여러 개의 비밀값을 포함할 수 있어 파라미터 스토어보다 유연합니다.
    
- **일반 텍스트**: JSON 또는 XML과 같은 형식의 일반 텍스트를 저장할 수도 있습니다.

### 4. 비용

Secrets Manager는 저장하는 비밀 정보의 수와 API 호출 횟수에 따라 요금이 부과됩니다.

- **비밀 정보**: 비밀 정보 1개당 월 $0.40의 비용이 발생합니다.
    
- **API 호출**: 10,000건의 API 호출당 $0.05의 비용이 부과됩니다.
    
- **무료 티어**: 30일간의 무료 체험이 제공됩니다.

---

## 2. 🛡️ 비밀 정보 생성 및 암호화

Secrets Manager는 모든 비밀 정보를 **AWS KMS**를 사용하여 암호화하여 저장합니다.

### 단계 1: 비밀 정보 유형 선택

- **자격 증명 유형**: RDS, Redshift, DocumentDB 등 특정 AWS 데이터베이스 유형에 대한 자격 증명을 선택합니다.
    
- **기타 비밀 정보**: API 키와 같이 일반적인 키-값 페어 또는 일반 텍스트를 저장할 때 사용합니다.
    

### 단계 2: 값 입력 및 KMS 암호화

선택한 유형에 따라 값을 입력하고, 비밀 정보 암호화에 사용할 KMS 키를 선택합니다. 기본 KMS 키를 사용하거나, 직접 생성한 고객 관리형 KMS 키를 선택할 수 있습니다.

### 단계 3: 이름 및 설명 지정

비밀 정보의 이름과 설명을 지정합니다. 이 이름은 애플리케이션에서 API를 통해 비밀 정보를 검색하는 데 사용됩니다.

### 단계 4: 자동 순환 설정

원하는 경우, 이 단계에서 자동 순환을 활성화하고 순환 주기를 설정합니다. 이 기능을 활성화하면, 순환 작업을 수행할 Lambda 함수를 지정해야 합니다.

---

## 3. 💻 애플리케이션에서 비밀 정보 검색

애플리케이션은 AWS SDK를 사용하여 Secrets Manager API를 호출하고, 비밀 정보의 값을 검색할 수 있습니다. 예를 들어, Python에서는 `get_secret_value` 함수를 사용하여 비밀 정보를 가져옵니다.

**✅ Python 코드 예시**

```Python
import boto3

def get_secret(secret_name, region_name):
    # Secrets Manager 클라이언트 생성
    client = boto3.client('secretsmanager', region_name=region_name)
    
    try:
        get_secret_value_response = client.get_secret_value(
            SecretId=secret_name
        )
    except ClientError as e:
        raise e
    else:
        # Secrets Manager는 암호화된 값을 자동으로 복호화하여 반환
        if 'SecretString' in get_secret_value_response:
            secret = get_secret_value_response['SecretString']
            return secret
        else:
            decoded_binary_secret = base64.b64decode(get_secret_value_response['SecretBinary'])
            return decoded_binary_secret

# Secrets Manager에서 'prod/my-secret-api' 비밀 정보를 가져와 사용
secret_string = get_secret('prod/my-secret-api', 'us-east-1')
print(f"Retrieved secret: {secret_string}")
```

---

## 4. 🌟 결론

Secrets Manager는 **데이터베이스 자격 증명**과 같이 **주기적인 순환**이 필요한 민감한 정보를 관리하는 데 최적화된 서비스입니다. SSM 파라미터 스토어와 달리 유료 서비스이지만, 자동 순환 기능과 RDS와의 긴밀한 통합은 높은 수준의 보안 및 규정 준수가 필요한 환경에 매우 강력한 솔루션을 제공합니다.