

CloudWatch Logs는 애플리케이션 로그를 수집하고 저장하는 AWS 서비스입니다. 기본적으로 로그는 AWS가 관리하는 키로 암호화되지만, 민감한 로그 데이터를 보호하기 위해 KMS(Key Management Service) 고객 관리형 키를 사용하여 로그 그룹을 암호화할 수 있습니다. 이 가이드에서는 CLI를 활용하여 CloudWatch Logs를 KMS와 연동하는 방법을 상세히 설명합니다.

---

## 1. 🔑 CloudWatch Logs 암호화 원리

CloudWatch Logs 암호화는 **로그 그룹(Log Group)** 수준에서 이루어집니다. 로그 그룹에 KMS 키를 연결하면, 해당 그룹에 속한 모든 로그 스트림(Log Stream)과 로그 데이터가 해당 키로 암호화됩니다.

### 중요 사항:

- **UI 미지원**: CloudWatch 콘솔에서는 기존 로그 그룹에 KMS 키를 연결할 수 없습니다. 이 작업은 반드시 **AWS CLI** 또는 **SDK**를 통해서만 가능합니다.
    
- **키 정책 필수**: KMS 키에 CloudWatch Logs 서비스가 접근할 수 있도록 **키 정책**을 수정해야 합니다.
    

---

## 2. 📝 CloudWatch Logs 암호화 실습 (CLI)

### 단계 1: KMS 키 정책 수정

CloudWatch Logs 서비스가 KMS 키를 사용할 수 있도록 권한을 부여해야 합니다. 이를 위해, 해당 KMS 키의 정책에 다음 `Statement`를 추가합니다.

**✅ KMS 키 정책 추가 예시**

```JSON
{
  "Sid": "Allow CloudWatch Logs to use the key",
  "Effect": "Allow",
  "Principal": {
    "Service": "logs.eu-west-2.amazonaws.com"
  },
  "Action": [
    "kms:Encrypt",
    "kms:Decrypt",
    "kms:ReEncrypt*",
    "kms:GenerateDataKey*",
    "kms:DescribeKey"
  ],
  "Resource": "*"
}
```

- **`Principal`**: `logs.<리전>.amazonaws.com`으로 지정하여 해당 리전의 CloudWatch Logs 서비스에 권한을 부여합니다.
    
- **`Action`**: `Encrypt`, `Decrypt` 등 KMS 암호화 작업을 허용합니다.
    

### 단계 2: 기존 로그 그룹에 KMS 키 연결

이미 존재하는 로그 그룹에 KMS 키를 연결하려면 `associate-kms-key` 명령을 사용합니다.

**✅ `associate-kms-key` 명령어**

```Bash
aws logs associate-kms-key \
    --log-group-name /aws/lambda/hello-world \
    --kms-key-id arn:aws:kms:eu-west-2:123456789012:key/your-tutorial-key-id
```

- `--log-group-name`: KMS 키를 연결할 로그 그룹의 이름입니다.
    
- `--kms-key-id`: 사용할 KMS 키의 ID 또는 ARN입니다.
    

명령어를 성공적으로 실행하면, 해당 로그 그룹의 상세 정보에 KMS 키 ID가 표시됩니다.

### 단계 3: 새 로그 그룹 생성과 동시에 KMS 키 연결

새로운 로그 그룹을 생성하면서 KMS 키를 연결하려면 `create-log-group` 명령을 사용합니다.

**✅ `create-log-group` 명령어**

```Bash
aws logs create-log-group \
    --log-group-name example-encrypted-log-group \
    --kms-key-id arn:aws:kms:eu-west-2:123456789012:key/your-tutorial-key-id
```

- `--log-group-name`: 새로 생성할 로그 그룹의 이름입니다.
    
- `--kms-key-id`: KMS 키의 ID 또는 ARN입니다.
    

---

## 3. 🛡️ 보안 강화의 중요성

이 실습은 AWS 서비스 간의 권한 상호작용의 중요성을 보여줍니다. CloudWatch Logs가 KMS 키를 사용하려면 명시적인 키 정책을 통해 권한을 부여해야 합니다. 이는 **최소 권한의 원칙(Principle of Least Privilege)**을 준수하는 모범 사례이며, 보안을 강화하는 데 매우 중요한 단계입니다.

CloudWatch 콘솔에서는 KMS 키 ID를 확인할 수 있지만, 해당 작업을 수행하는 것은 허용하지 않습니다. 이는 관리 편의성보다 **보안과 권한 분리**를 우선시하는 AWS의 설계 철학을 보여줍니다.