
## 🏗️ 키네시스 데이터 스트림 생성

### 1. 스트림 이름 및 용량 모드 선택

- **이름:** `DemoStream`
- **용량 모드:**
    
    - **`On-demand` (온디맨드):** 용량을 자동으로 확장 및 축소합니다. 개발자가 샤드를 관리할 필요가 없습니다.
    - **`Provisioned` (프로비저닝):** 사용자가 직접 **샤드(Shard)** 수를 지정합니다. 각 샤드는 초당 1MB/1,000 레코드 쓰기, 초당 2MB 읽기 용량을 가집니다.

- **실습:** 비용 효율적인 데모를 위해 **`Provisioned` 모드를 선택하고 샤드 수를 1개**로 설정합니다.

---

## 💻 키네시스 데이터 스트림에 데이터 쓰기 (Put)

데이터를 스트림에 보내는 것을 **Put**이라고 합니다. CLI(Command Line Interface)를 사용하여 데이터를 전송합니다.

### 1. AWS CloudShell 사용

- **AWS CloudShell:** AWS 관리 콘솔에서 바로 실행할 수 있는 터미널 환경입니다. IAM 자격 증명과 리전이 자동으로 구성되어 있어 편리합니다.

### 2. `put-record` 명령 사용

`put-record` API를 사용하여 스트림에 단일 레코드를 전송합니다.

- **Stream Name:** `DemoStream`으로 지정합니다.
- **Partition Key:** 데이터를 논리적으로 그룹화하고 샤드를 지정하는 데 사용됩니다. 동일한 `Partition Key`를 가진 데이터는 동일한 샤드에 저장되어 **순서가 보장**됩니다. (예: `user1`)
- **Data:** 보낼 데이터(예: `user signup`)를 입력합니다.
- **`cli-binary-format`:** CLI에서 바이너리 데이터를 처리하기 위한 필수 파라미터입니다.

```Bash
aws kinesis put-record --stream-name DemoStream --partition-key user1 --data "user signup" --cli-binary-format raw-in-base64-out
aws kinesis put-record --stream-name DemoStream --partition-key user1 --data "user login" --cli-binary-format raw-in-base64-out
aws kinesis put-record --stream-name DemoStream --partition-key user1 --data "user logout" --cli-binary-format raw-in-base64-out
```

---

## ⬇️ 키네시스 데이터 스트림에서 데이터 읽기 (Get)

### 1. 스트림 정보 확인

데이터를 읽기 전에 `describe-stream` API를 사용하여 스트림의 샤드 정보를 확인해야 합니다.

```Bash
aws kinesis describe-stream --stream-name DemoStream
```

- **결과:** 스트림의 `StreamDescription`과 샤드 ID(`shardId-0000000000000`)를 확인할 수 있습니다. CLI를 통해 데이터를 읽으려면 이 샤드 ID가 필요합니다.

### 2. `get-shard-iterator` 명령 사용

`get-shard-iterator` API를 사용하여 데이터를 읽을 시작 지점을 지정합니다.
- **`shard-iterator-type TRIM_HORIZON`:** 스트림의 가장 처음부터 데이터를 읽습니다.
- **결과:** `get-records` API에 사용할 **`ShardIterator`**가 반환됩니다.


```Bash
aws kinesis get-shard-iterator --stream-name DemoStream --shard-id shardId-0000000000000 --shard-iterator-type TRIM_HORIZON
```

### 3. `get-records` 명령 사용

`get-records` API를 사용하여 실제 데이터를 가져옵니다. `get-shard-iterator`에서 받은 `ShardIterator`를 파라미터로 사용합니다.

- **결과:** 데이터가 **Base64**로 인코딩된 `Records` 배열이 반환됩니다.
- **데이터 디코딩:** Base64로 인코딩된 데이터를 디코딩하면(`user signup`, `user login` 등) 원본 메시지를 확인할 수 있습니다.

```Bash
aws kinesis get-records --shard-iterator <복사한_ShardIterator>
```

이 실습을 통해 키네시스 데이터 스트림의 **Put(쓰기)** 및 **Get(읽기)** API를 사용하여 데이터를 직접 처리하는 과정을 이해할 수 있습니다. 이는 실시간 데이터 처리 파이프라인의 기본이 되는 작업입니다.