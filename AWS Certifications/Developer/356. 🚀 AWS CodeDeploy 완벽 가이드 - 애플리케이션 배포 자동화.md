
AWS CodeDeploy는 애플리케이션 배포를 자동화하고, 안전하게 업데이트하며, 문제가 발생했을 때 롤백까지 지원하는 서비스입니다. 이 가이드에서는 CodeDeploy의 핵심 개념과 주요 플랫폼별 배포 방식에 대해 자세히 알아보겠습니다.

---

## 🔍 1. CodeDeploy의 역할과 특징

CodeDeploy는 애플리케이션의 새로운 버전을 **EC2 인스턴스**, **온프레미스 서버**, **람다 함수**, 또는 **ECS 서비스**에 배포하는 과정을 자동화합니다.

- **자동화된 배포:** 수동으로 하던 배포 작업을 자동화하여 반복적인 실수를 줄입니다.
    
- **안전한 업데이트 및 롤백:** 배포 과정에서 문제가 발생하거나 특정 알람이 트리거되면 자동으로 롤백을 수행하여 안정성을 확보합니다.
    
- **배포 속도 제어:** 배포 속도를 세밀하게 제어하여 서비스 중단 시간을 최소화할 수 있습니다.
    
- **`appspec.yml` 파일:** 배포 방식을 정의하는 YAML 파일로, 배포 과정의 각 단계(예: 파일 복사, 스크립트 실행)를 설정합니다.
    

---

## ☁️ 2. EC2 / 온프레미스 플랫폼 배포

이 플랫폼은 EC2 인스턴스 또는 온프레미스 서버에 애플리케이션 코드를 배포하는 데 사용됩니다.

### **배포 유형**

1. **인플레이스(In-place) 배포:**
    
    - 기존 인스턴스 그룹의 애플리케이션을 직접 중단, 업데이트, 재시작하는 방식입니다.
        
    - 배포 중 일부 또는 전체 인스턴스에 서비스 중단(downtime)이 발생할 수 있습니다.
        
2. **블루/그린(Blue/Green) 배포:**
    
    - **"블루(Blue)"**는 현재 운영 중인 애플리케이션 버전(v1)을 의미합니다.
        
    - **"그린(Green)"**은 새로운 애플리케이션 버전(v2)을 위한 새로운 인스턴스 그룹입니다.
        
    - 새로운 `그린` 환경에 v2를 배포하고 테스트가 완료되면, 로드 밸런서가 트래픽을 `블루`에서 `그린`으로 전환합니다.
        
    - `블루` 환경은 트래픽을 받지 않게 된 후 종료되거나 유지됩니다.
        
    - **장점:** 서비스 중단 없이(zero downtime) 배포가 가능하며, 문제가 발생하면 트래픽을 다시 `블루` 환경으로 쉽게 롤백할 수 있습니다.
        

### **배포 속도 제어(Deployment Configurations)**

인플레이스 배포 시, 배포 속도를 제어하여 서비스 중단 시간을 조절할 수 있습니다.

|배포 속도|설명|서비스 영향|
|---|---|---|
|**`AllAtOnce`**|모든 인스턴스를 동시에 업데이트합니다.|가장 많은 서비스 중단 발생|
|**`HalfAtATime`**|한 번에 절반의 인스턴스를 업데이트합니다.|용량이 50%로 감소|
|**`OneAtATime`**|한 번에 하나의 인스턴스만 업데이트합니다.|가장 느리지만, 서비스 영향 최소화|
|**사용자 정의**|필요에 따라 속도를 직접 정의할 수 있습니다.|-|

### **CodeDeploy 에이전트**

CodeDeploy가 EC2 인스턴스에 배포를 수행하려면 **CodeDeploy 에이전트**가 각 인스턴스에 설치되어 실행되어야 합니다. 이 에이전트는 S3 버킷에 저장된 **애플리케이션 리비전(revision)**을 다운로드하고, `appspec.yml` 파일에 정의된 대로 배포 명령을 실행합니다.

---

## 🌐 3. 람다(Lambda) 플랫폼 배포

CodeDeploy는 람다 함수의 배포 시 **트래픽 전환**을 자동화하여 안전하게 업데이트를 수행합니다.

### **트래픽 전환 방식**

람다 함수의 `별칭(alias)`을 사용하여 트래픽을 기존 버전(v1)에서 새 버전(v2)으로 전환합니다. 이를 통해 v2로의 전환을 점진적으로 진행하거나, 빠르게 전환할 수 있습니다.

|전략|설명|예시|
|---|---|---|
|**선형(Linear)**|일정 시간 간격으로 트래픽을 점진적으로 증가시킵니다.|**`LambdaLinear10PercentEvery3Minutes`**: 3분마다 트래픽을 10%씩 증가시킵니다.|
|**카나리(Canary)**|짧은 시간 동안 소량의 트래픽을 새 버전으로 보낸 후, 문제가 없으면 즉시 전체 트래픽을 전환합니다.|**`LambdaCanary10Percent5Minutes`**: 5분 동안 10%의 트래픽을 새 버전으로 보내고, 이후 100%로 전환합니다.|
|**한 번에(AllAtOnce)**|모든 트래픽을 즉시 새 버전으로 전환합니다.|테스트할 시간 없이 즉시 전환이 필요한 경우 사용합니다.|

---

## 🐳 4. ECS 플랫폼 배포

ECS(Elastic Container Service) 플랫폼에서의 CodeDeploy는 **블루/그린 배포**만을 지원하며, 새로운 ECS 태스크 정의를 배포하는 과정을 자동화합니다.

### **블루/그린 배포 과정**

1. **로드 밸런서와 타겟 그룹:** 애플리케이션 로드 밸런서(ALB)가 현재 운영 중인 `v1` 태스크가 포함된 **'블루'** 타겟 그룹으로 트래픽을 라우팅합니다.
    
2. **새로운 타겟 그룹 생성:** CodeDeploy가 `v2` 태스크 정의를 사용하여 새로운 **'그린'** 타겟 그룹을 생성하고 태스크를 실행합니다.
    
3. **트래픽 전환:** 람다와 유사한 **선형, 카나리, 한 번에** 등의 전략에 따라 ALB가 트래픽을 `블루`에서 `그린` 타겟 그룹으로 점진적 또는 즉시 전환합니다.
    
4. **기존 태스크 정리:** 트래픽 전환이 완료되면 기존 `블루` 타겟 그룹의 태스크가 종료됩니다.