
이번 강의에서는 Amazon Route 53의 중요한 기능인 <mark class="hltr-red">헬스 체크(Health Checks)</mark>에 대해 알아봅니다. 헬스 체크는 DNS 레코드와 연동하여 애플리케이션의 가용성을 높이고 <mark class="hltr-red">자동 장애 조치(Automatic Failover)</mark>를 구현하는 데 사용됩니다.

---

### 1. 헬스 체크란? 🤔

- **개념**: Route 53이 지정된 엔드포인트(예: 서버, 로드 밸런서)의 상태를 주기적으로 확인하여, 해당 엔드포인트가 정상적으로 작동하는지 판단하는 기능입니다.
    
- **목적**: 헬스 체크 결과를 DNS 레코드와 결합하여, 비정상(unhealthy) 상태인 엔드포인트로는 트래픽을 라우팅하지 않도록 합니다. 이를 통해 사용자가 다운된 애플리케이션에 접속하는 것을 방지하고 서비스 가용성을 유지할 수 있습니다.
    
- **예시 시나리오**: 다중 리전에 로드 밸런서가 있는 경우, 헬스 체크를 통해 한 리전의 서비스가 다운되면 해당 리전으로는 DNS 응답을 보내지 않고, 다른 정상적인 리전으로만 트래픽을 라우팅합니다.

### 2. 헬스 체크 유형 📜

Route 53은 세 가지 주요 헬스 체크 유형을 지원합니다.

#### 2.1. 엔드포인트 모니터링 (Endpoint Monitoring)

![[Pasted image 20250726222616.png]]

- **대상**: 공개적으로 접근 가능한 엔드포인트(Public Endpoint) (예: ALB, CloudFront, EC2 인스턴스 등).
- **작동 방식**:
    - 전 세계에 분산된 약 15개의 Route 53 <mark class="hltr-red">헬스 체커(Health Checkers)</mark>가 엔드포인트에 주기적으로 요청을 보냅니다.
    - 응답으로 `HTTP 2xx`, `3xx` 상태 코드를 받거나, 특정 응답 본문 텍스트를 찾으면 정상(`Healthy`)으로 간주합니다.
- **설정**:
    - **임계값(Threshold)**: 몇 번의 실패 후 비정상으로 판단할지 설정합니다.
    - **간격(Interval)**: 헬스 체크 요청을 보내는 주기 (일반: 30초, 빠른: 10초).
    - **프로토콜**: HTTP, HTTPS, TCP 지원.
- **네트워크 설정**: 헬스 체커가 엔드포인트에 접근할 수 있도록, <mark class="hltr-red">Route 53 헬스 체커의 IP 주소 범위</mark>를 보안 그룹 등에 허용해야 합니다.
    

#### 2.2. 계산된 헬스 체크 (Calculated Health Checks)

![[Pasted image 20250726222644.png]]

- **개념**: 여러 개의 헬스 체크 결과를 하나로 통합하여 단일 헬스 체크로 만드는 기능입니다.
- **활용**: 여러 자식(Child) 헬스 체크의 결과를 조합하여 부모(Parent) 헬스 체크의 상태를 결정합니다.
- **예시**:
    - 세 개의 EC2 인스턴스 각각에 대해 헬스 체크를 생성합니다.
    - 이 세 개의 헬스 체크를 조합하는 부모 헬스 체크를 생성합니다.
    - 조건(AND, OR, NOT)을 설정하여, 예를 들어 "세 개의 인스턴스 중 두 개 이상이 정상일 때만 전체를 정상으로 간주"하는 규칙을 만들 수 있습니다.

#### 2.3. CloudWatch 지표 모니터링 (Monitoring a CloudWatch Alarm)

![[Pasted image 20250726222711.png]]

- **개념**: **프라이빗 리소스(Private Resources)**의 상태를 모니터링하는 데 가장 흔히 사용되는 방법입니다.
- **작동 방식**:
    - Route 53의 헬스 체커는 공개 인터넷에 있으므로 VPC 내부의 프라이빗 리소스에는 직접 접근할 수 없습니다.
    - 따라서, CloudWatch를 사용하여 프라이빗 EC2 인스턴스(예: CPU 사용량)의 지표를 모니터링합니다.
    - 이 지표가 특정 임계값을 초과하면 **CloudWatch 알람(CloudWatch Alarm)**을 트리거합니다.
    - Route 53은 이 **CloudWatch 알람의 상태**를 모니터링하여, 알람이 `ALARM` 상태가 되면 해당 헬스 체크를 `Unhealthy`로 간주합니다.

### 3. Route 53과 헬스 체크 연동 🌐

헬스 체크는 Route 53의 특정 라우팅 정책(예: Weighted, Failover, Latency)과 결합될 때 진정한 가치를 발휘합니다.
- **예시**: 지연 시간 기반 라우팅 정책을 사용하는 경우, Route 53은 사용자에게 가장 가까운 리전의 IP 주소를 응답으로 보냅니다. 만약 해당 리전의 헬스 체크 상태가 `Unhealthy`라면, Route 53은 그 리전을 건너뛰고 그 다음으로 지연 시간이 낮은 리전의 IP 주소를 대신 반환하여 자동 장애 조치(Automatic Failover)를 수행합니다.
    

### 4. 결론 💡

Route 53 헬스 체크는 단순한 DNS 서비스에 **가용성과 장애 조치(Failover)** 기능을 추가하는 핵심 요소입니다. 공개 엔드포인트는 Route 53 헬스 체커가 직접 모니터링하고, 프라이빗 엔드포인트는 CloudWatch 알람을 통해 간접적으로 모니터링함으로써, 어떤 환경에서도 서비스의 상태를 안정적으로 관리할 수 있습니다.
