
CloudWatch는 AWS 서비스가 기본적으로 제공하는 지표 외에도, 사용자가 직접 정의하는 **커스텀 지표(Custom Metrics)**를 수집할 수 있는 기능을 제공합니다. 이 기능은 애플리케이션의 특정 동작이나 시스템 상태를 세밀하게 모니터링할 때 매우 유용합니다.

## 🚀 커스텀 지표란?

커스텀 지표는 AWS 서비스에서 기본적으로 제공하지 않는 데이터를 CloudWatch로 전송하는 기능입니다. 예를 들어, 다음과 같은 데이터를 모니터링하고 싶을 때 커스텀 지표를 활용할 수 있습니다.

- **메모리 사용량:** EC2 인스턴스의 RAM 사용량은 기본 지표에 포함되지 않으므로, 커스텀 지표로 전송해야 합니다.
    
- **디스크 공간:** 디스크 사용량 지표는 세부 모니터링을 활성화해도 기본적으로 제공되지 않습니다.
    
- **애플리케이션 로그 분석:** 애플리케이션에 로그인한 사용자 수, 특정 API 호출 횟수, 오류 발생 횟수 등 애플리케이션 레벨의 지표를 정의할 수 있습니다.

### API 호출: `PutMetricData`

커스텀 지표를 CloudWatch로 푸시(Push)하려면 `PutMetricData`라는 API 호출을 사용합니다. 이 API를 사용하면 지표의 이름, 값, 단위, 차원(Dimensions) 등을 자유롭게 정의할 수 있습니다.

### 지표 해상도(Metric Resolution)

`PutMetricData` API의 `StorageResolution` 파라미터를 사용해 지표의 해상도를 설정할 수 있습니다.

|해상도 유형|설명|데이터 푸시 주기|
|---|---|---|
|**Standard Resolution**|기본 해상도|최소 **1분(60초)**|
|**High Resolution**|고해상도|**1초, 5초, 10초, 30초**|

높은 해상도를 사용하면 더 세밀한 데이터 포인트를 얻을 수 있어, 실시간에 가까운 모니터링이 필요한 경우에 유용합니다.

---

## 🕰️ 시간 여행 지표: 과거 및 미래 데이터 푸시

`PutMetricData` API를 사용하면 현재 시간뿐만 아니라 **과거 또는 미래의 타임스탬프**를 가진 데이터를 푸시할 수 있습니다. 이는 시험에서도 중요한 포인트입니다.

- **최대 2주(14일) 전**의 과거 데이터
    
- **최대 2시간** 후의 미래 데이터
    

만약 EC2 인스턴스의 시스템 시간이 정확히 설정되지 않은 경우에도, 이 기능을 통해 CloudWatch와 동기화된 타임스탬프로 데이터를 보낼 수 있습니다.

## 💻 CLI를 이용한 커스텀 지표 푸시 예시

이제 CloudShell을 활용해 커스텀 지표를 푸시하는 과정을 살펴보겠습니다. 다음은 `aws cloudwatch put-metric-data` CLI 명령어를 사용한 간단한 예시입니다.

Bash

```
aws cloudwatch put-metric-data \
    --metric-name Buffers \
    --namespace "MyNameSpace" \
    --unit Bytes \
    --value 23143143 \
    --dimensions InstanceId=i-1234567890abcdef0,InstanceType=t2.micro
```

**코드 설명:**

- `--metric-name Buffers`: 지표의 이름을 **Buffers**로 정의합니다.
- `--namespace "MyNameSpace"`: **MyNameSpace**라는 새로운 네임스페이스를 생성합니다.
- `--unit Bytes`: 지표의 단위를 **Bytes**로 설정합니다.
- `--value 23143143`: 지표의 값을 지정합니다.
- `--dimensions ...`: `InstanceId`와 `InstanceType`이라는 두 가지 차원을 정의합니다.

### 결과 확인

위 명령어를 실행하면, CloudWatch 콘솔의 **'지표'** 메뉴에 **"MyNameSpace"**라는 새로운 네임스페이스가 생성된 것을 확인할 수 있습니다. 이 네임스페이스를 클릭하면 우리가 정의한 **`InstanceId`**와 **`InstanceType`** 차원과 함께 **`Buffers`** 지표가 나타납니다.

이러한 방식으로 EC2 인스턴스의 스크립트나 애플리케이션 코드를 통해 정기적으로 `PutMetricData` API를 호출하면, 원하는 모든 데이터를 CloudWatch로 보내 종합적으로 모니터링할 수 있습니다. CloudWatch 에이전트(Agent) 역시 이 API를 사용하여 시스템 지표를 CloudWatch로 푸시하는 방식으로 작동합니다.