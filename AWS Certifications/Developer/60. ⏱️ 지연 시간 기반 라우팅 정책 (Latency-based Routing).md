
이번 강의에서는 사용자에게 가장 빠른 응답 속도를 제공하는 데 초점을 맞춘 **지연 시간 기반 라우팅 정책(Latency-based Routing Policy)**에 대해 알아봅니다.

---

### 1. 지연 시간 기반 라우팅 정책이란? 🤔

- **개념**: Route 53이 사용자에게 **가장 낮은 네트워크 지연 시간(Latency)**을 가진 리소스(AWS 리전)의 IP 주소를 반환하는 정책입니다.
- **작동 방식**:
    - Route 53은 사용자가 쿼리를 보내는 위치를 파악하고, 각 AWS 리전과의 네트워크 지연 시간을 평가합니다.
    - 이 정보를 바탕으로 사용자에게 지리적으로 가장 가까운 AWS 리전에 있는 리소스의 DNS 레코드를 응답으로 반환합니다.
    - **예시**:
        - 독일에 있는 사용자는 `eu-central-1` (프랑크푸르트) 리전의 리소스에 가장 낮은 지연 시간을 가질 가능성이 높습니다.
        - 캐나다에 있는 사용자는 `us-east-1` (버지니아 북부) 리전의 리소스에 가장 낮은 지연 시간을 가질 가능성이 높습니다.
        - 홍콩에 있는 사용자는 `ap-southeast-1` (싱가포르) 리전의 리소스에 가장 낮은 지연 시간을 가질 가능성이 높습니다.
- **주요 특징**:
    - **지연 시간 측정**: Route 53은 사용자의 IP 주소를 기반으로 지연 시간을 측정합니다.
    - **헬스 체크 연동 가능**: (다음 강의에서 자세히 다룰 내용) 헬스 체크와 결합하여 비정상적인 리소스는 지연 시간이 낮더라도 응답에서 제외할 수 있습니다.

### 2. 지연 시간 기반 라우팅 실습 🧪

이전에 생성한 세 개의 EC2 인스턴스를 사용하여 사용자의 위치에 따라 가장 가까운 리전으로 트래픽이 라우팅되는 것을 확인해 보겠습니다.

#### 2.1 지연 시간 기반 레코드 세트 생성

1. **Route 53 콘솔 접속**: 이전에 등록한 도메인(`yourchosendomain.com`)의 호스트 존으로 이동합니다.
2. **레코드 생성**: `레코드 생성(Create record)` 클릭.
3. **첫 번째 레코드 (싱가포르)**:
    - **레코드 이름**: `latency` (FQDN: `latency.yourchosendomain.com`)
    - **레코드 유형**: `A`
    - **값**: 싱가포르(`ap-southeast-1`) EC2 인스턴스의 IP 주소.
    - **라우팅 정책**: `지연 시간 기반(Latency)` 선택.
    - **리전(Region)**: `아시아 태평양(싱가포르)` 또는 `ap-southeast-1` 선택.
    - **레코드 ID**: `ap-southeast-1`
    - **다른 레코드 추가(Add another record)** 클릭.
4. **두 번째 레코드 (버지니아 북부)**:
    - **값**: 버지니아 북부(`us-east-1`) EC2 인스턴스의 IP 주소.
    - **라우팅 정책**: `지연 시간 기반(Latency)`
    - **리전**: `미국 동부(버지니아 북부)` 또는 `us-east-1` 선택.
    - **레코드 ID**: `us-east-1`
    - **다른 레코드 추가(Add another record)** 클릭.
5. **세 번째 레코드 (프랑크푸르트)**:
    - **값**: 프랑크푸르트(`eu-central-1`) EC2 인스턴스의 IP 주소.
    - **라우팅 정책**: `지연 시간 기반(Latency)`
    - **리전**: `유럽(프랑크푸르트)` 또는 `eu-central-1` 선택.
    - **레코드 ID**: `eu-central-1`
6. **레코드 생성**: 설정이 완료되면 `레코드 생성(Create records)`을 클릭합니다.

#### 2.2 지연 시간 기반 라우팅 작동 확인 (VPN 사용)

지연 시간 기반 라우팅을 테스트하려면, 사용자의 IP 주소(위치)를 변경해야 합니다. 이를 위해 VPN을 사용합니다.

1. **초기 위치 (예: 유럽)**:
    - 웹 브라우저에서 `http://latency.yourchosendomain.com`에 접속합니다.
    - 지연 시간이 가장 짧은 프랑크푸르트(`eu-central-1`) 리전의 EC2 인스턴스에서 응답이 올 것입니다. (메시지: `Hello World from AZ eu-central-1c!`)
2. **위치 변경 (VPN을 캐나다로)**:
    - VPN을 사용하여 위치를 캐나다로 변경합니다.
    - 웹 브라우저를 새로고침하면, 지연 시간이 가장 짧은 버지니아 북부(`us-east-1`) 리전의 EC2 인스턴스에서 응답이 올 것입니다. (메시지: `Hello World from AZ us-east-1a!`)
3. **위치 변경 (VPN을 홍콩으로)**:
    - VPN을 사용하여 위치를 홍콩으로 변경합니다.
    - 웹 브라우저를 새로고침하면, 지연 시간이 가장 짧은 싱가포르(`ap-southeast-1`) 리전의 EC2 인스턴스에서 응답이 올 것입니다. (메시지: `Hello World from AZ ap-southeast-1b!`)

**참고**: AWS Cloud Shell은 유럽(프랑크푸르트) 리전에 위치하므로, Cloud Shell에서 `dig latency.yourchosendomain.com` 명령어를 실행하면 항상 `eu-central-1`의 IP 주소가 응답으로 반환됩니다. 이는 Cloud Shell의 위치에 따라 지연 시간이 측정되기 때문입니다.

### 3. 결론 💡

**지연 시간 기반 라우팅 정책**은 사용자가 가장 가까운 리소스에 연결될 수 있도록 하여, 애플리케이션의 응답 속도를 최적화하는 데 매우 효과적인 정책입니다. 전 세계 사용자에게 서비스를 제공하는 애플리케이션의 성능 향상에 필수적인 기능입니다.
