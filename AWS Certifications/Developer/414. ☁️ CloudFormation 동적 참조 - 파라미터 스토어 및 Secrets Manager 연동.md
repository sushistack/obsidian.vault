
![[Pasted image 20250914193251.png]]

CloudFormation í…œí”Œë¦¿ì— ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸, API í‚¤ì™€ ê°™ì€ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì§ì ‘ í•˜ë“œì½”ë”©í•˜ëŠ” ê²ƒì€ ë³´ì•ˆìƒ ë§¤ìš° ìœ„í—˜í•©ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ CloudFormationì€ **ë™ì  ì°¸ì¡°(Dynamic References)** ê¸°ëŠ¥ì„ ì œê³µí•˜ì—¬, SSM íŒŒë¼ë¯¸í„° ìŠ¤í† ì–´ë‚˜ Secrets Managerì— ì €ì¥ëœ ê°’ì„ í…œí”Œë¦¿ì— ì•ˆì „í•˜ê²Œ ì‚½ì…í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

---

## 1. ğŸ”— ë™ì  ì°¸ì¡°ì˜ ê¸°ë³¸ ë¬¸ë²•

ë™ì  ì°¸ì¡°ëŠ” í…œí”Œë¦¿ ë°°í¬ ì‹œ ì§€ì •ëœ ì™¸ë¶€ ì €ì¥ì†Œì—ì„œ ê°’ì„ ê°€ì ¸ì™€ ë¦¬ì†ŒìŠ¤ ì†ì„±ì— ì ìš©í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

- **ê¸°ë³¸ êµ¬ë¬¸**: `{{resolve:ì„œë¹„ìŠ¤:ì°¸ì¡° í‚¤}}`
    
    - `resolve`: ë™ì  ì°¸ì¡°ë¥¼ ì‚¬ìš©í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
        
    - `ì„œë¹„ìŠ¤`: `ssm`, `ssm-secure`, `secretsmanager` ì¤‘ í•˜ë‚˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
        
    - `ì°¸ì¡° í‚¤`: íŒŒë¼ë¯¸í„° ì´ë¦„ ë˜ëŠ” ë¹„ë°€ ì •ë³´ì˜ ARN/ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.

|ì„œë¹„ìŠ¤ ì´ë¦„|ì„¤ëª…|ì˜ˆì‹œ|
|---|---|---|
|**`ssm`**|SSM íŒŒë¼ë¯¸í„° ìŠ¤í† ì–´ì— ì €ì¥ëœ **ì¼ë°˜ ë¬¸ìì—´**|`{{resolve:ssm:/my-app/dev/db-url:1}}`|
|**`ssm-secure`**|SSM íŒŒë¼ë¯¸í„° ìŠ¤í† ì–´ì— ì €ì¥ëœ **ì•”í˜¸í™”ëœ ë¬¸ìì—´**|`{{resolve:ssm-secure:/my-app/dev/db-password:1}}`|
|**`secretsmanager`**|Secrets Managerì— ì €ì¥ëœ **ë¹„ë°€ ì •ë³´**|`{{resolve:secretsmanager:prod/my-api-key:SecretString:AWSCURRENT}}`|

---

## 2. ğŸ“ ë™ì  ì°¸ì¡° ì˜ˆì‹œ

### 1. S3 ë²„í‚·ì— SSM íŒŒë¼ë¯¸í„° ì°¸ì¡°í•˜ê¸°

S3 ë²„í‚·ì˜ ì ‘ê·¼ ì œì–´ ëª©ë¡ì„ SSM íŒŒë¼ë¯¸í„° ìŠ¤í† ì–´ì— ì €ì¥í•˜ê³ , ì´ë¥¼ CloudFormation í…œí”Œë¦¿ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```YAML
Resources:
  MyS3Bucket:
    Type: AWS::S3::Bucket
    Properties:
      AccessControl: "{{resolve:ssm:/myapp/s3/access-control:1}}"
```

### 2. IAM ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ SSMì—ì„œ ê°€ì ¸ì˜¤ê¸°

IAM ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì´ ë¯¼ê°í•œ ì •ë³´ëŠ” `ssm-secure`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```YAML
Resources:
  MyUser:
    Type: AWS::IAM::User
    Properties:
      UserName: "MySecureUser"
      LoginProfile:
        Password: "{{resolve:ssm-secure:/myapp/secure/password:1}}"
        PasswordResetRequired: true
```

### 3. RDS ë°ì´í„°ë² ì´ìŠ¤ì— Secrets Manager ì°¸ì¡°í•˜ê¸°

RDS ë°ì´í„°ë² ì´ìŠ¤ì˜ ë§ˆìŠ¤í„° ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ Secrets Managerì—ì„œ ì°¸ì¡°í•˜ëŠ” ê²ƒì€ ë™ì  ì°¸ì¡°ì˜ ê°€ì¥ ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

```YAML
Resources:
  MyDBInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      DBInstanceIdentifier: "my-db-instance"
      MasterUsername: "{{resolve:secretsmanager:prod/db-credentials:SecretString:username::AWSCURRENT}}"
      MasterUserPassword: "{{resolve:secretsmanager:prod/db-credentials:SecretString:password::AWSCURRENT}}"
```

---

## 3. ğŸ”„ RDSì™€ Secrets Manager ì—°ë™ ì‹œ CloudFormation íŒ¨í„´

RDS ë°ì´í„°ë² ì´ìŠ¤ì˜ ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë‘ ê°€ì§€ CloudFormation íŒ¨í„´ì´ ìˆìŠµë‹ˆë‹¤.

### íŒ¨í„´ 1: RDSê°€ ì§ì ‘ Secrets Managerë¥¼ ê´€ë¦¬

![[Pasted image 20250914193323.png]]

CloudFormationì´ RDS í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•˜ê³ , RDS ì„œë¹„ìŠ¤ê°€ Secrets Managerì— ë¹„ë°€ ì •ë³´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ê²Œ í•©ë‹ˆë‹¤.

1. **CloudFormation**: `AWS::RDS::DBCluster` ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•˜ê³ , `ManageMasterUserPassword: true` ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
    
2. **RDS**: RDS ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ Secrets Managerì— ë¹„ë°€ ì •ë³´ë¥¼ ìƒì„±í•˜ê³ , ê·¸ ARNì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
    
3. **ê²°ê³¼**: CloudFormationì€ ë¹„ë°€ ì •ë³´ë¥¼ ì§ì ‘ ìƒì„±í•˜ì§€ ì•Šê³ , **RDS ì„œë¹„ìŠ¤ê°€ ë¹„ë°€ ì •ë³´ì˜ ë¼ì´í”„ì‚¬ì´í´ì„ ì „ì ìœ¼ë¡œ ë‹´ë‹¹**í•˜ê²Œ ë©ë‹ˆë‹¤. ìŠ¤íƒì˜ `Outputs`ë¥¼ í†µí•´ ìƒì„±ëœ ë¹„ë°€ ì •ë³´ì˜ ARNì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### íŒ¨í„´ 2: CloudFormationì´ Secrets Managerì™€ RDSë¥¼ ëª¨ë‘ ê´€ë¦¬

í…œí”Œë¦¿ ë‚´ì—ì„œ Secrets Manager ë¹„ë°€ ì •ë³´ì™€ RDS ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ëª¨ë‘ ì •ì˜í•˜ê³ , ì´ ë‘˜ì„ ì—°ê²°í•©ë‹ˆë‹¤.

1. **Secrets Manager ìƒì„±**: `AWS::SecretsManager::Secret` ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. `GenerateStringKey` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
2. **RDS ìƒì„±**: `AWS::RDS::DBInstance` ë˜ëŠ” `AWS::RDS::DBCluster`ë¥¼ ì •ì˜í•˜ê³ , `MasterUserPassword` ì†ì„±ì—ì„œ ë™ì  ì°¸ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±ëœ Secrets Manager ë¹„ë°€ ì •ë³´ì˜ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
    
3. **ì—°ê²°**: **`AWS::SecretsManager::SecretTargetAttachment`** ë¦¬ì†ŒìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ Secrets Manager ë¹„ë°€ ì •ë³´ì™€ RDS ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤. ì´ ì—°ê²°ì„ í†µí•´ Secrets Managerê°€ RDS ë¹„ë°€ë²ˆí˜¸ë¥¼ ìë™ìœ¼ë¡œ ìˆœí™˜ì‹œí‚¬ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.


---

## 4. ğŸŒŸ ê²°ë¡ 

CloudFormationì˜ ë™ì  ì°¸ì¡°ëŠ” **IaC(Infrastructure as Code)**ì˜ ë³´ì•ˆê³¼ ìœ ì—°ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚µë‹ˆë‹¤. ë¯¼ê°í•œ ì •ë³´ë¥¼ í…œí”Œë¦¿ì— ë…¸ì¶œì‹œí‚¤ì§€ ì•Šê³ ë„ SSM íŒŒë¼ë¯¸í„° ìŠ¤í† ì–´ë‚˜ Secrets Managerì˜ ê°’ì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ RDSì™€ Secrets Managerë¥¼ ì—°ë™í•˜ëŠ” ë‘ ê°€ì§€ íŒ¨í„´ì„ ì´í•´í•˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬ë¥¼ ìë™í™”í•˜ê³  ë³´ì•ˆì„ ê°•í™”í•˜ëŠ” ë° ë§¤ìš° íš¨ê³¼ì ì…ë‹ˆë‹¤.