
Amazon DynamoDB는 고성능 애플리케이션에 최적화된 NoSQL 데이터베이스입니다. DynamoDB를 효과적으로 사용하려면 데이터에 접근하고 조작하는 다양한 API 호출(API calls)에 대한 명확한 이해가 필요합니다. 이 아티클에서는 DynamoDB의 핵심 API들을 용도별로 분류하여 자세히 설명하고, 각 API의 특징과 활용법을 알아보겠습니다.

---

## ✍️ 데이터 쓰기 (Write Operations)

데이터를 DynamoDB에 추가하거나 수정할 때는 주로 세 가지 API를 사용합니다.

### 1. `PutItem`

`PutItem`은 새로운 항목을 생성하거나, **기존 항목을 완전히 교체**할 때 사용합니다. 동일한 기본 키(Primary Key)를 가진 항목이 이미 존재하면, 기존 항목의 모든 속성(attributes)을 새로 작성된 데이터로 덮어씁니다.

- **용도**: 새로운 항목을 추가하거나, 기존 항목을 완전히 대체해야 할 때.
    
- **작동 방식**: 지정된 기본 키를 가진 항목이 있으면 덮어쓰고, 없으면 새로 생성합니다.

### 2. `UpdateItem`

`UpdateItem`은 기존 항목의 일부 속성만 수정하거나, 조건에 따라 새로운 속성을 추가할 때 사용합니다. `PutItem`과 달리 항목 전체를 덮어쓰지 않고, 필요한 부분만 선택적으로 업데이트합니다.

- **용도**: 기존 항목의 특정 속성만 수정하거나, 항목에 새로운 속성을 추가할 때.
    
- **특징**: `PutItem`보다 효율적이며, **원자적 카운터(Atomic Counter)**와 같은 특정 용도에 활용할 수 있습니다.

### 3. 조건부 쓰기 (Conditional Writes)

`PutItem`, `UpdateItem`, `DeleteItem` 작업 시 특정 조건이 충족될 때만 작업을 실행하도록 할 수 있습니다. 이는 여러 사용자가 동시에 같은 항목에 접근할 때 데이터 충돌을 방지하는 데 유용합니다.

- **용도**: 데이터의 동시 접근 문제를 해결하고, 특정 조건이 만족될 때만 쓰기 작업을 허용해야 할 때.
    
- **예시**: "상품의 재고 수량(stock_count)이 0보다 클 때만 구매 요청을 허용하라."

---

## 📖 데이터 읽기 (Read Operations)

DynamoDB에서 데이터를 읽는 방법은 여러 가지가 있으며, 사용 목적과 효율성에 따라 적절한 API를 선택해야 합니다.

### 1. `GetItem`

`GetItem`은 DynamoDB에서 **가장 효율적인 읽기 API**입니다. 기본 키(파티션 키 + 정렬 키)를 사용하여 단일 항목을 직접 읽습니다.

- **용도**: 특정 항목 1개를 읽을 때.
    
- **특징**:
    
    - **읽기 모드**: **결과적으로 일관된 읽기(Eventually Consistent)** 또는 **강력히 일관된 읽기(Strongly Consistent)**를 선택할 수 있습니다. 강력히 일관된 읽기는 최신 데이터를 보장하지만, 더 많은 RCU를 소모하고 지연 시간이 약간 더 길어질 수 있습니다.
        
    - **속성 선택**: `ProjectionExpression`을 사용하여 필요한 속성만 선택적으로 읽을 수 있습니다.

### 2. `Query`

`Query`는 특정 **파티션 키**를 공유하는 항목들을 검색할 때 사용합니다. 파티션 키는 반드시 일치(equal)해야 하며, 정렬 키를 이용하여 더 정밀한 검색이 가능합니다.

- **용도**: 특정 파티션 키에 속한 여러 항목을 검색할 때.
    
- **특징**:
    
    - **필수 조건**: 파티션 키에 대한 조건(`Key Condition Expression`)이 반드시 포함되어야 합니다.
        
    - **정렬 키 활용**: 정렬 키를 사용해 `=`뿐만 아니라 `<`, `>`, `begins_with`, `between` 등의 연산자를 적용할 수 있습니다.
        
    - **`FilterExpression`**: 검색 결과를 반환하기 전에 비-키(non-key) 속성들을 대상으로 추가적인 필터링을 수행합니다. 이 필터링은 쿼리 후 클라이언트 측에서 이루어지므로, RCU 소모량에 영향을 주지 않습니다.
        
    - **결과 반환**: 최대 1MB의 데이터를 반환하며, 더 많은 데이터를 가져오려면 **페이지네이션(Pagination)**을 사용해야 합니다.

### 3. `Scan`

`Scan`은 **테이블 전체**를 읽는 API입니다. 매우 비효율적이며, 데이터 내보내기나 백업과 같은 특수한 경우에만 사용해야 합니다.

- **용도**: 테이블의 모든 데이터를 순차적으로 읽어야 할 때.
    
- **특징**:
    
    - **높은 RCU 소모**: 테이블 전체를 읽으므로 많은 RCU를 소모하여 정상적인 운영에 영향을 줄 수 있습니다.
        
    - **`FilterExpression`**: 쿼리와 마찬가지로 `FilterExpression`을 사용해 결과를 필터링할 수 있습니다.
        
    - **병렬 스캔 (Parallel Scan)**: 여러 워커(worker)를 사용하여 테이블을 여러 세그먼트로 나누어 동시에 스캔하는 방식으로, 처리량을 높이지만 RCU 소모도 급격히 증가합니다.


---

## 🗑️ 데이터 삭제 (Delete Operations)

### 1. `DeleteItem`

`DeleteItem`은 `GetItem`과 마찬가지로 기본 키를 사용하여 특정 항목 하나를 삭제합니다. 조건부 삭제도 가능합니다.

### 2. `DeleteTable`

테이블과 그 안에 있는 모든 데이터를 한 번에 삭제하는 가장 빠르고 효율적인 방법입니다. 항목을 하나씩 스캔하고 삭제하는 것보다 훨씬 빠릅니다. 시험에서 테이블의 모든 데이터를 삭제하라는 문제가 나온다면, `Scan` 후 `DeleteItem`을 쓰는 비효율적인 방식이 아닌 **`DeleteTable` API를 사용해야 합니다.**

---

## 🚀 일괄 작업 및 PartiQL

### 1. 일괄 작업 (Batch Operations)

네트워크 지연 시간을 줄이고 효율성을 높이기 위해 여러 API 호출을 한 번에 묶어서 실행할 수 있습니다.

- **`BatchWriteItem`**: 최대 25개의 `PutItem` 또는 `DeleteItem` 요청을 한 번의 API 호출로 처리합니다. 단, `UpdateItem`은 지원하지 않습니다.
    
- **`BatchGetItem`**: 최대 100개의 `GetItem` 요청을 한 번에 처리합니다.

일괄 작업 중 일부 항목이 용량 부족 등으로 실패할 수 있으며, 이 경우 `UnprocessedItems` 또는 `UnprocessedKeys`로 반환됩니다. 실패한 항목은 **지수 백오프(Exponential Backoff)** 전략을 사용하여 재시도하거나, 용량을 늘려야 합니다.

### 2. PartiQL

PartiQL은 SQL-호환 쿼리 언어로, DynamoDB API 호출 대신 SQL 구문을 사용해 데이터를 조작할 수 있도록 합니다.

- **용도**: SQL에 익숙한 개발자가 DynamoDB를 더 쉽게 다룰 수 있도록 돕습니다.
    
- **지원 기능**: `SELECT`, `INSERT`, `UPDATE`, `DELETE` 등 기본적인 SQL 작업을 지원합니다.
    
- **제한 사항**: SQL의 모든 기능(예: 조인)을 지원하지는 않습니다. 기존 DynamoDB API와 동일한 기능만 SQL 문법으로 제공합니다.