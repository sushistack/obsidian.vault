
이번 실습에서는 S3 버킷에 대한 접근 로그(Access Logs)를 활성화하여 모든 요청 활동을 기록하는 방법을 직접 해보겠습니다. 로그는 별도의 버킷에 저장되며, 이 과정을 통해 AWS가 자동으로 권한을 설정하는 방식도 확인합니다.

---

### 1단계: 로그를 저장할 버킷 생성 📥

먼저, 접근 로그 파일이 저장될 전용 버킷을 생성합니다. **로그를 기록하는 버킷과 로그가 저장될 버킷은 절대로 동일하면 안 됩니다.**

1. S3 콘솔에서 `stephane-v3-access-log`와 같은 이름의 버킷을 생성합니다.
2. 이 버킷은 특별한 설정 없이 기본값으로 생성해도 무방합니다.

### 2단계: 접근 로그 활성화 ⚙️

이제 로그를 기록할 대상 버킷(예: `s3-storage-classes-demos-2022`)에서 서버 접근 로깅을 활성화합니다.

1. 로그를 기록할 대상 버킷으로 이동합니다.
2. `속성(Properties)` 탭으로 이동합니다.
3. `서버 액세스 로깅(Server access logging)` 섹션에서 `편집(Edit)`을 클릭합니다.
4. `활성화(Enable)`를 선택합니다.
5. **대상 버킷(Target bucket)** 필드에 1단계에서 생성한 버킷(`stephane-v3-access-log`)을 지정합니다.
6. `변경 사항 저장(Save changes)`을 클릭합니다.

**결과 확인:**

- 접근 로깅을 활성화하면, AWS가 대상 버킷의 버킷 정책을 자동으로 업데이트하여 S3 로깅 서비스가 해당 버킷에 로그 파일을 `PutObject`할 수 있도록 허용합니다.
    
- 대상 버킷의 `권한(Permissions)` 탭에서 버킷 정책을 확인하면, S3 로깅 서비스에 대한 `s3:PutObject` 권한이 추가된 것을 볼 수 있습니다.


### 3단계: 로그 기록 확인 ✅

이제 대상 버킷에서 몇 가지 활동을 수행하여 로그가 생성되는지 확인합니다.

1. 대상 버킷에서 객체(예: `coffee.jpg`)를 업로드하거나 다운로드하는 등 여러 API 호출을 시도합니다.
2. 로그가 저장될 버킷(`stephane-v3-access-log`)으로 이동하여 객체 목록을 새로고침합니다.
3. **로그 파일 확인:** 몇 분에서 몇 시간 후, 버킷에 로그 파일들이 생성된 것을 확인할 수 있습니다.
4. 로그 파일을 열어보면, 타임스탬프, 요청자, API 호출 유형(예: `REST.GET.OBJECT`, `REST.PUT.OBJECT`) 등 다양한 정보가 포함된 것을 볼 수 있습니다.

이 실습을 통해 S3 버킷의 모든 활동을 감사 목적으로 기록하는 방법을 익혔습니다. 이 로그는 추후 Amazon Athena와 같은 분석 도구를 사용하여 유용한 통찰을 얻는 데 활용될 수 있습니다.