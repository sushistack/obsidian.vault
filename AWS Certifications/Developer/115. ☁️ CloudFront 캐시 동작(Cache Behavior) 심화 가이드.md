
CloudFront **캐시 동작(Cache Behavior)**은 URL 경로 패턴에 따라 콘텐츠를 다르게 처리하는 규칙입니다. 이를 통해 하나의 CloudFront 배포로 여러 원본(Origin)에 연결하고, 캐싱 및 보안 설정을 세밀하게 제어하여 콘텐츠 전송을 최적화할 수 있습니다.

---

### 1. 캐시 동작의 기본 원리 🎯

![[Pasted image 20250809233419.png]]

하나의 CloudFront 배포는 여러 개의 캐시 동작을 가질 수 있습니다. 각 캐시 동작은 특정 **URL 경로 패턴**에 따라 요청을 어떤 **원본(Origin)**으로 보낼지, 그리고 캐싱을 어떻게 할지 정의합니다.

- **경로 패턴:** `/images/*`, `/api/*`, `/*`와 같이 와일드카드를 사용하여 경로를 지정합니다. CloudFront는 요청된 URL과 일치하는 **가장 구체적인** 경로 패턴의 캐시 동작을 우선적으로 적용합니다. 예를 들어, `/images/logo.jpg` 요청은 `/*`보다 `/images/*` 패턴에 먼저 일치합니다.
    
- **기본 캐시 동작(Default Cache Behavior):** `/*`는 모든 경로에 일치하는 기본 캐시 동작입니다. 다른 모든 캐시 동작이 일치하지 않을 경우 항상 이 규칙이 적용되며, 우선순위가 가장 낮습니다.
    

---

### 2. 캐시 동작의 활용 사례 📝

#### 사례 1: 여러 원본에 대한 라우팅

하나의 웹사이트에서 정적 파일과 동적 API 호출을 다른 서버로 분리할 때 유용합니다.

|경로 패턴|원본 서버|설명|
|---|---|---|
|`/images/*`|S3 버킷|모든 이미지 파일 요청은 S3로 라우팅|
|`/api/*`|애플리케이션 로드 밸런서|모든 API 요청은 애플리케이션 서버로 라우팅|
|`/*`|S3 버킷 (기본값)|위 패턴에 해당하지 않는 모든 요청은 기본 S3 버킷으로 라우팅|

이 방식을 사용하면 이미지 파일은 캐싱에 최적화된 S3에서 제공하고, 동적 API 요청은 로드 밸런서 뒤의 EC2 인스턴스에서 처리할 수 있어, 각 서비스의 특성에 맞는 최적의 성능을 끌어낼 수 있습니다.

---

#### 사례 2: 유료 콘텐츠 접근 제어 🔒

![[Pasted image 20250809233717.png]]

로그인한 사용자에게만 특정 콘텐츠를 제공하는 시나리오에 활용할 수 있습니다.

1. **로그인 페이지 라우팅:** `/login` 경로에 대한 캐시 동작을 EC2 인스턴스로 설정합니다. 사용자가 이 경로로 접근하면 EC2 인스턴스는 로그인 절차를 수행합니다.

2. **서명된 쿠키(Signed Cookies) 발행:** 로그인이 성공하면 EC2 인스턴스는 **CloudFront 서명된 쿠키**를 생성하여 사용자에게 전달합니다.

3. **콘텐츠 접근:** 사용자는 서명된 쿠키를 사용하여 `/*` (기본 캐시 동작)에 해당하는 S3 버킷의 콘텐츠에 접근합니다.

4. **미인증 사용자 차단:** 기본 캐시 동작 설정에서 서명된 쿠키가 없는 요청은 차단하도록 구성합니다. 서명된 쿠키가 없는 사용자가 콘텐츠에 접근하려 하면 `/login` 페이지로 리디렉션됩니다.


이 방식을 통해 S3 버킷을 공개하지 않고도, 인증된 사용자에게만 콘텐츠 접근 권한을 부여할 수 있습니다.

---

#### 사례 3: 캐싱 전략 최적화 📈

![[Pasted image 20250809233754.png]]

동적/정적 콘텐츠에 따라 다른 캐싱 정책을 적용하여 캐시 히트율을 극대화할 수 있습니다.

- **정적 콘텐츠:** `/static/*` 경로에 대한 캐시 동작은 S3 버킷을 원본으로 설정하고, 캐시 정책에서 헤더, 쿠키, 쿼리 스트링을 포함하지 않도록 설정합니다. 이는 캐시 키를 단순화하여 캐시 히트율을 높입니다.

- **동적 콘텐츠:** `/api/*` 경로에 대한 캐시 동작은 로드 밸런서를 원본으로 설정하고, 캐시 정책에서 세션 정보가 포함된 쿠키 등 필요한 정보만 캐시 키에 포함시킵니다.