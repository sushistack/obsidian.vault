
기본적으로 람다 함수는 AWS가 관리하는 VPC 외부에서 실행되므로, 사용자의 VPC 내 리소스에는 직접 접근할 수 없습니다. 람다 함수가 VPC 내의 리소스(예: RDS 데이터베이스, EC2 인스턴스)에 접근해야 할 경우, 람다 함수를 VPC 내에 배포해야 합니다. 이 아티클에서는 람다 함수의 VPC 연동 방법과 인터넷 접속에 대한 규칙을 상세히 설명합니다.

---

## 1. 람다 함수와 VPC 연동 🔗

람다 함수를 사용자의 VPC 내에 배포하면 프라이빗 리소스와 안전하게 통신할 수 있습니다. 이 과정은 다음과 같은 단계를 거칩니다.

### a. ENI(Elastic Network Interface) 생성

람다 함수를 VPC에 연결하도록 설정하면, AWS Lambda 서비스는 지정된 서브넷에 **ENI(Elastic Network Interface)**를 생성합니다. 이 ENI는 람다 함수와 VPC 리소스 간의 통신을 위한 가상의 네트워크 인터페이스 역할을 합니다.

### b. IAM 권한 및 보안 그룹

- **IAM 권한:** 람다 함수가 ENI를 생성하고 관리할 수 있도록, 함수의 실행 역할에 `AWSLambdaVPCAccessExecutionRole` 관리형 정책이 포함되어야 합니다. 이 정책은 람다 함수에게 ENI를 생성하고 삭제하는 등의 필요한 권한을 부여합니다.
    
- **보안 그룹:** 람다 함수에 할당된 보안 그룹은 접근하려는 리소스(예: RDS)의 보안 그룹이 허용하는 트래픽 규칙과 일치해야 합니다. 예를 들어, 람다 함수가 RDS에 접속하려면, RDS 보안 그룹의 인바운드 규칙에 람다 함수의 보안 그룹이 포함되어야 합니다.

---

## 2. VPC 내 람다 함수의 인터넷 액세스 🌍

![[Pasted image 20250831212854.png]]

**⚠️ 매우 중요한 규칙:** VPC 내에 배포된 람다 함수는 기본적으로 인터넷에 접속할 수 없습니다. 이 규칙은 다음과 같은 핵심 사항을 포함합니다.

- **프라이빗 서브넷 배포:** 람다 함수를 프라이빗 서브넷에 배포하면, VPC 내부 리소스에만 접근할 수 있습니다. 외부 인터넷 접속은 차단됩니다.
    
- **퍼블릭 서브넷 배포:** EC2 인스턴스와 달리, 람다 함수를 퍼블릭 서브넷에 배포해도 퍼블릭 IP가 할당되지 않습니다. 따라서 퍼블릭 서브넷에 있더라도 인터넷에 접속할 수 없습니다.
    

### 인터넷 접속 방법: NAT 게이트웨이

![[Pasted image 20250831212905.png]]

람다 함수가 VPC 내에 있으면서도 인터넷에 접속해야 할 경우, **NAT 게이트웨이(NAT Gateway)**를 사용해야 합니다.

- **구성:** 람다 함수는 **프라이빗 서브넷**에 위치하고, NAT 게이트웨이는 **퍼블릭 서브넷**에 배치됩니다. 프라이빗 서브넷의 라우팅 테이블은 외부 트래픽을 NAT 게이트웨이를 통해 인터넷 게이트웨이로 라우팅하도록 설정됩니다.
    
- **동작:** 람다 함수는 NAT 게이트웨이를 통해 안전하게 외부 API나 웹사이트에 접속할 수 있으며, 이 모든 트래픽은 NAT 게이트웨이의 고정 IP를 사용하게 됩니다.

### AWS 서비스에 비공개로 접근하기: VPC 엔드포인트

외부 인터넷을 거치지 않고 DynamoDB와 같은 AWS 서비스에 안전하게 접근하려면 **VPC 엔드포인트(VPC Endpoint)**를 사용합니다. VPC 엔드포인트는 AWS의 프라이빗 네트워크를 통해 서비스에 접근하는 통로를 제공하므로, NAT 게이트웨이가 필요하지 않아 비용을 절감하고 보안을 강화할 수 있습니다.

|접근 대상|접근 경로|
|---|---|
|**VPC 내 리소스**|람다 ENI → 보안 그룹 → VPC 내 리소스 (예: RDS)|
|**인터넷 / 외부 API**|람다 ENI → 프라이빗 서브넷 → 라우팅 테이블 → NAT 게이트웨이 → 인터넷 게이트웨이 → 인터넷|
|**AWS 서비스**|람다 ENI → 프라이빗 서브넷 → VPC 엔드포인트 → AWS 서비스 (예: DynamoDB)|

**CloudWatch Logs:** 람다 함수가 VPC 내에 배포되더라도 CloudWatch Logs는 VPC 연동과 무관하게 항상 작동합니다. 람다 함수는 별도의 설정 없이도 로그를 기록할 수 있습니다.