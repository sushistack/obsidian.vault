## CloudWatch Synthetics Canary란?

![[Pasted image 20250824205636.png]]

**CloudWatch Synthetics Canary**는 웹사이트, API, 또는 URL의 가용성과 성능을 모니터링하기 위해 주기적으로 실행되는 **스크립트**입니다. 마치 광산에 갇힌 카나리아가 위험을 알려주듯, Canary는 고객이 문제를 발견하기 전에 서비스의 결함을 찾아내는 데 사용됩니다. Canary 스크립트는 실제 사용자의 행동을 프로그래밍 방식으로 모방하여 웹사이트의 주요 흐름을 테스트합니다.

### 주요 기능

- **가용성 및 지연 시간 모니터링**: 엔드포인트의 응답 시간과 가용성을 정기적으로 확인합니다.

- **사용자 워크플로우 테스트**: "상품을 장바구니에 담기 → 결제 페이지로 이동 → 결제 완료"와 같은 복잡한 사용자 여정을 자동으로 시뮬레이션합니다.

- **UI 스크린샷 캡처**: 스크립트 실행 중 UI의 스크린샷을 찍어 시각적 변화나 오류를 파악하는 데 도움을 줍니다.

- **HTTP 아카이브 파일 저장**: 요청 및 응답에 대한 자세한 정보를 담은 파일을 생성하여 디버깅을 돕습니다.

---

## 🛠️ Canary 스크립트의 구성 및 실행

Canary 스크립트는 **Node.js** 또는 **Python**으로 작성할 수 있습니다. 특히, **헤드리스(Headless) Chrome 브라우저** 환경에 접근할 수 있어, 실제 사용자와 동일한 웹 환경에서 복잡한 UI 상호작용을 테스트할 수 있습니다.

### Canary의 실행 방법

|실행 방식|설명|
|---|---|
|**일회성 실행**|즉시 실행하여 특정 시점의 테스트 결과를 확인합니다.|
|**정기적인 스케줄링**|주기적으로(예: 5분마다) 스크립트를 실행하여 지속적인 가용성을 모니터링합니다.|

---

## 📄 Canary 블루프린트: 손쉬운 시작을 위한 템플릿

CloudWatch Synthetics는 사용자가 쉽게 Canary를 시작할 수 있도록 다양한 **블루프린트(Blueprint)**를 제공합니다.

|블루프린트|용도|설명|
|---|---|---|
|**Heartbeat Monitor**|URL 가용성 확인|URL을 로드하고, 스크린샷 및 HTTP 아카이브를 저장하여 기본 연결 상태를 모니터링합니다.|
|**API Canary**|REST API 테스트|REST API의 읽기/쓰기 기능을 테스트하는 간단한 스크립트를 생성합니다.|
|**Broken Link Checker**|깨진 링크 확인|웹페이지 내의 모든 링크를 크롤링하여 유효성을 검사하고 깨진 링크를 찾아냅니다.|
|**Visual Monitoring**|시각적 변화 감지|현재 페이지의 스크린샷을 이전에 찍은 기준(baseline) 스크린샷과 비교하여 UI의 변화를 감지합니다.|
|**Canary Recorder**|사용자 행동 기록|**CloudWatch Synthetics Recorder**를 사용하여 웹사이트에서 사용자의 행동을 기록하고, 이를 스크립트로 자동 변환합니다.|
|**GUI Workflow Builder**|GUI 워크플로우 테스트|로그인, 폼 제출과 같은 GUI 상호작용이 올바르게 작동하는지 확인합니다.|

---

## 🔔 Canary와 다른 AWS 서비스의 연동

Canary는 단독으로 사용되지 않고 다른 AWS 서비스와 결합하여 강력한 자동화 시스템을 구축할 수 있습니다.

- **CloudWatch Alarms**: Canary 실행이 실패하면 **CloudWatch Alarms**가 트리거됩니다.

- **AWS Lambda**: 알람이 발생하면 Lambda 함수를 호출하여 복구 작업을 시작할 수 있습니다.

- **Route 53**: Lambda 함수는 Route 53 DNS 레코드를 업데이트하여 트래픽을 정상 작동하는 다른 리전의 애플리케이션으로 라우팅할 수 있습니다.


이러한 연동을 통해, 문제가 감지되면 자동으로 페일오버(failover)를 수행하여 고객에게 중단 없는 서비스를 제공할 수 있습니다.