
이번 글에서는 AWS IAM의 심화 개념인 **정책 평가 로직**, **S3 버킷 정책**과의 상호작용, **동적 정책**, 그리고 **관리형 정책**의 종류에 대해 상세히 알아보겠습니다.

---

## 1. 🔍 IAM 정책 평가 로직

![[Pasted image 20250913170759.png]]

IAM 정책은 다음의 논리적 순서에 따라 평가됩니다.

1. **명시적 거부(Explicit Deny)**: 정책에 명시적 거부(`"Effect": "Deny"`)가 있다면, 다른 모든 허용 규칙보다 우선하며 최종 결정은 **거부(Deny)**가 됩니다.
    
2. **명시적 허용(Explicit Allow)**: 명시적 거부 규칙이 없는 경우, 하나라도 명시적 허용(`"Effect": "Allow"`) 규칙이 있다면 최종 결정은 **허용(Allow)**이 됩니다.
    
3. **암묵적 거부(Implicit Deny)**: 어떤 정책에도 명시적 허용이나 명시적 거부 규칙이 없다면, 최종 결정은 기본적으로 **거부(Denial)**가 됩니다.

---

## 2. 🪣 IAM 정책과 S3 버킷 정책의 관계

![[Pasted image 20250913170811.png]]

S3 버킷에 대한 접근 권한은 사용자의 **IAM 정책**과 S3 버킷 자체에 연결된 **버킷 정책**의 **합집합(Union)**에 의해 결정됩니다.

- **IAM 정책**: IAM 사용자, 그룹, 역할에 연결됩니다.
    
- **S3 버킷 정책**: S3 버킷에 직접 연결됩니다.
    

이 두 정책은 모두 평가에 사용되며, 만약 한쪽에서라도 **명시적 거부**가 있으면, 최종적으로는 접근이 거부됩니다. 반대로, 한쪽에라도 명시적 허용이 있고 다른 쪽에서 명시적 거부가 없다면, 접근은 허용됩니다.

|IAM 정책|S3 버킷 정책|최종 결과|
|---|---|---|
|읽기/쓰기 허용|정책 없음|**허용** (IAM 정책이 유일한 규칙)|
|읽기/쓰기 허용|명시적 거부|**거부** (명시적 거부 규칙이 우선)|
|정책 없음|읽기/쓰기 허용|**허용** (S3 버킷 정책에 허용 규칙이 존재)|
|명시적 거부|읽기/쓰기 허용|**거부** (명시적 거부 규칙이 우선)|

---

## 3. 🧩 동적 정책(Dynamic Policy)

동적 정책은 모든 사용자에게 개별 정책을 할당하는 대신, 하나의 정책으로 여러 사용자에게 **사용자별 맞춤 권한**을 부여하는 데 사용됩니다. **정책 변수(Policy Variables)**를 활용하는 것이 핵심입니다.

### 사용 예시: 사용자별 S3 홈 폴더

모든 IAM 사용자에게 `s3://<버킷이름>/home/<사용자이름>/` 경로에만 접근을 허용하는 경우, 다음과 같이 `aws:username` 변수를 사용할 수 있습니다.

```JSON
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["s3:*"],
      "Resource": "arn:aws:s3:::<버킷이름>/home/${aws:username}/*"
    }
  ]
}
```

이 정책은 **`aws:username`** 변수가 런타임에 현재 로그인한 사용자의 이름으로 자동 치환되므로, 하나의 정책만으로 `georges`, `sarah`, `matt` 등 모든 사용자의 폴더에 대한 접근을 제어할 수 있습니다.

---

## 4. 📄 인라인 vs. 관리형 정책

IAM 정책은 관리 방식에 따라 세 가지로 나뉩니다.

|종류|특징|장점|
|---|---|---|
|**AWS 관리형**|AWS에서 생성 및 유지 관리합니다.|최신 AWS 서비스 및 API를 자동으로 반영합니다.|
|**고객 관리형**|사용자가 직접 생성 및 관리합니다.|더 세분화된 제어가 가능하며, 재사용, 버전 관리, 중앙 집중식 관리가 용이합니다. **모범 사례**로 권장됩니다.|
|**인라인(Inline)**|IAM 사용자, 그룹, 역할에 직접 내장됩니다.|원칙에 1:1로 직접 연결되며, 다른 정책과 분리됩니다.|

인라인 정책은 크기 제한(최대 2KB)이 있으며, 버전 관리가 되지 않고 재사용이 불가능하다는 단점이 있습니다. 따라서 **재사용**이 필요하거나 **중앙 집중식 관리**를 하려면 **고객 관리형 정책**을 사용하는 것이 훨씬 효율적입니다.