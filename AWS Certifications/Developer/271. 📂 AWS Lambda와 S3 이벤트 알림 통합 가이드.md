이번 아티클에서는 **AWS S3 이벤트 알림(S3 Event Notifications)**을 사용하여 Lambda 함수를 자동으로 트리거하는 방법에 대해 알아보겠습니다. 이 통합은 S3 버킷에 객체가 생성, 삭제 또는 수정될 때 특정 작업을 자동으로 수행해야 하는 경우에 매우 유용합니다.

### 📜 S3 이벤트 알림이란?

![[Pasted image 20250826214919.png]]

S3 이벤트 알림은 S3 버킷에서 발생하는 다양한 활동(예: 객체 생성, 삭제, 복원 등)을 감지하고, 이를 지정된 대상(Destination)으로 알리는 기능입니다.

- **주요 이벤트**: `s3:ObjectCreated`, `s3:ObjectRemoved`, `s3:ObjectRestore` 등
    
- **필터링**: 접두사(Prefix) 및 접미사(Suffix)를 사용하여 특정 경로 또는 파일 확장자를 가진 객체에 대해서만 알림을 설정할 수 있습니다.
    
- **대표적인 사용 사례**: 이미지 파일을 S3에 업로드하면 자동으로 썸네일을 생성하는 작업

S3 이벤트 알림은 SQS, SNS, 또는 Lambda 함수를 대상으로 이벤트를 보낼 수 있으며, Lambda 함수로 직접 전송하는 방식은 **비동기 호출**로 작동합니다.

---

### 🔄 S3 이벤트 알림 패턴

S3 이벤트 알림을 Lambda와 통합하는 일반적인 패턴은 다음과 같습니다.

![[Pasted image 20250826214931.png]]

1. **S3 버킷**: 새로운 파일이 버킷에 업로드됩니다.
    
2. **S3 이벤트 알림**: S3는 이 `ObjectCreated` 이벤트를 감지합니다.
    
3. **Lambda 함수 호출**: S3는 미리 설정된 규칙에 따라 Lambda 함수를 **비동기식**으로 호출합니다.
    
4. **Lambda 함수 처리**: Lambda 함수는 전달받은 이벤트 데이터(업로드된 파일 정보)를 기반으로 필요한 작업을 수행합니다. 예를 들어, 이미지 파일이라면 썸네일을 생성하고 다른 S3 버킷에 저장하거나, CSV 파일이라면 데이터를 파싱하여 DynamoDB나 RDS에 저장할 수 있습니다.

### 💡 주의사항: 이벤트 손실 방지

두 개의 객체가 동시에 S3에 쓰여질 경우, 이벤트 알림이 누락될 수 있는 가능성이 있습니다. 이러한 문제를 방지하려면 **S3 버킷에 버전 관리(Versioning)를 활성화**하는 것이 좋습니다. 버전 관리가 활성화되면 동일한 객체에 대한 여러 번의 쓰기 작업이 각각 고유한 버전으로 저장되어 모든 이벤트에 대한 알림이 보장됩니다.

### 🚀 실습을 통한 통합 과정

실제로 S3 이벤트 알림을 Lambda와 통합하는 과정은 다음과 같습니다.

1. **Lambda 함수 생성**: S3 이벤트를 처리할 Lambda 함수를 생성합니다. 함수 코드는 S3 이벤트 페이로드에서 객체 정보를 추출하여 필요한 로직을 수행하도록 작성합니다.
    
2. **S3 버킷 생성**: 이벤트 알림을 설정할 S3 버킷을 생성합니다.
    
3. **이벤트 알림 설정**: S3 버킷의 '속성(Properties)' 탭에서 '이벤트 알림(Event notifications)'을 구성합니다.
    
    - **이벤트 유형**: `All object create events`와 같이 원하는 이벤트를 선택합니다.
        
    - **대상(Destination)**: `Lambda function`을 선택하고, 앞서 생성한 Lambda 함수를 지정합니다.
        
    - 필요에 따라 접두사(Prefix)나 접미사(Suffix) 필터를 추가하여 특정 객체에만 알림이 전송되도록 할 수 있습니다.
    
4. **권한 설정**: S3가 Lambda 함수를 호출할 수 있도록 리소스 기반 정책이 자동으로 추가됩니다.


이러한 과정을 통해 S3 버킷에 파일이 업로드될 때마다 Lambda 함수가 자동으로 실행되는 강력한 이벤트 기반 시스템을 구축할 수 있습니다.