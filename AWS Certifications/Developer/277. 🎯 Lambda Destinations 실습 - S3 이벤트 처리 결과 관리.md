
μ΄λ² μ‹¤μµμ—μ„λ” **Lambda Destinations** κΈ°λ¥μ„ μ§μ ‘ μ‚¬μ©ν•μ—¬ S3 μ΄λ²¤νΈλ΅ νΈλ¦¬κ±°λλ” λλ‹¤ ν•¨μμ μ‹¤ν–‰ κ²°κ³Όλ¥Ό κ΄€λ¦¬ν•λ” λ°©λ²•μ„ μ‚΄ν΄λ³΄κ² μµλ‹λ‹¤. λλ‹¤ ν•¨μμ μ„±κ³µ(Success) λ° μ‹¤ν¨(Failure) κ²°κ³Όμ— λ”°λΌ λ©”μ‹μ§€λ¥Ό λ‹¤λ¥Έ SQS(Simple Queue Service) νλ΅ λ³΄λ‚΄λ” κ³Όμ •μ„ λ‹¨κ³„λ³„λ΅ μ§„ν–‰ν•©λ‹λ‹¤.

---

## 1. SQS λ€κΈ°μ—΄(Queue) μƒμ„±

λ¨Όμ €, λλ‹¤ ν•¨μμ μ„±κ³µ λ° μ‹¤ν¨ κ²°κ³Όλ¥Ό λ°›μ„ λ‘ κ°μ SQS νλ¥Ό μƒμ„±ν•΄μ•Ό ν•©λ‹λ‹¤.

- `S3-success`: λλ‹¤ ν•¨μκ°€ μ„±κ³µμ μΌλ΅ μ‹¤ν–‰λμ—μ„ λ• λ©”μ‹μ§€λ¥Ό λ°›μ„ ν
    
- `S3-failure`: λλ‹¤ ν•¨μ μ‹¤ν–‰ μ¤‘ μμ™Έκ°€ λ°μƒν•μ—¬ μ‹¤ν¨ν–μ„ λ• λ©”μ‹μ§€λ¥Ό λ°›μ„ ν

SQS μ½μ†”μ—μ„ κ° νμ μ΄λ¦„μ„ μ§€μ •ν•κ³  κΈ°λ³Έ μ„¤μ •μΌλ΅ μƒμ„±ν•©λ‹λ‹¤.

---

## 2. λλ‹¤ ν•¨μμ— Destinations μ„¤μ •

λ‘ κ°μ SQS νκ°€ μ¤€λΉ„λμ—λ‹¤λ©΄, λλ‹¤ ν•¨μ (`lambda S3 function`)μ **`Configuration`** νƒ­μΌλ΅ μ΄λ™ν•μ—¬ Destinationsλ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.

1. **`Destinations`** λ©”λ‰΄μ—μ„ `Add destination`μ„ ν΄λ¦­ν•©λ‹λ‹¤.
    
2. **`Source`** νƒ€μ…μ€ **`Asynchronous invocation`**μΌλ΅ μ„¤μ •ν•©λ‹λ‹¤.
    
3. **μ„±κ³µ μ΅°κ±΄ μ¶”κ°€:**
    
    - **`Condition`**μ„ **`On success`**λ΅ μ„ νƒν•©λ‹λ‹¤.
        
    - **`Destination type`**μ€ **`SQS queue`**λ¥Ό μ„ νƒν•©λ‹λ‹¤.
        
    - **`Destination`** λ“λ΅­λ‹¤μ΄μ—μ„ `S3-success` νλ¥Ό μ„ νƒν•©λ‹λ‹¤.
        
4. **μ‹¤ν¨ μ΅°κ±΄ μ¶”κ°€:**
    
    - **`Condition`**μ„ **`On failure`**λ΅ μ„ νƒν•©λ‹λ‹¤.
        
    - **`Destination type`**μ€ **`SQS queue`**λ¥Ό μ„ νƒν•©λ‹λ‹¤.
        
    - **`Destination`** λ“λ΅­λ‹¤μ΄μ—μ„ `S3-failure` νλ¥Ό μ„ νƒν•©λ‹λ‹¤.
        

β… κ¶ν• μλ™ μ¶”κ°€:

Destinationsλ¥Ό μ„¤μ •ν•λ©΄ λλ‹¤ ν•¨μκ°€ SQS νμ— λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό μ μλ„λ΅ IAM μ‹¤ν–‰ μ—­ν• (Execution Role)μ— ν•„μ”ν• sqs:SendMessage κ¶ν•μ΄ μλ™μΌλ΅ μ¶”κ°€λ©λ‹λ‹¤. IAM μ½μ†”μ—μ„ λλ‹¤ ν•¨μμ μ—­ν• μ„ ν™•μΈν•λ©΄, Destinationsμ— λ€ν• LambdaSQSQueueDestinationExecutionRole μ •μ±…μ΄ μƒμ„±λ κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤.

---

## 3. μ„±κ³µ λ° μ‹¤ν¨ μ΄λ²¤νΈ ν…μ¤νΈ

μ΄μ  Destinations μ„¤μ •μ΄ μ¬λ°”λ¥΄κ² μ‘λ™ν•λ”μ§€ ν™•μΈν•κΈ° μ„ν•΄ λ‘ κ°€μ§€ μ‹λ‚λ¦¬μ¤λ¥Ό ν…μ¤νΈν•©λ‹λ‹¤.

### πΆ μ„±κ³µ μ‹λ‚λ¦¬μ¤

1. λλ‹¤ ν•¨μ μ½”λ“λ¥Ό **μ„±κ³µμ μΌλ΅ μ‹¤ν–‰λλ„λ΅** μ μ§€ν•©λ‹λ‹¤. (μ: λ‹¨μν κ°μ²΄λ¥Ό λ°ν™ν•λ” μ½”λ“)
    
2. S3 λ²„ν‚·μ— νμΌμ„ μ—…λ΅λ“ν•μ—¬ λλ‹¤ ν•¨μλ¥Ό λΉ„λ™κΈ°μ μΌλ΅ νΈλ¦¬κ±°ν•©λ‹λ‹¤.
    
3. SQS μ½μ†”λ΅ μ΄λ™ν•μ—¬ `S3-success` νλ¥Ό ν™•μΈν•©λ‹λ‹¤. `Available` λ©”μ‹μ§€ μκ°€ 1λ΅ ν‘μ‹λ©λ‹λ‹¤.
    
4. νμ **`Send and receive messages`** νƒ­μ—μ„ λ©”μ‹μ§€λ¥Ό ν΄λ§(poll)ν•λ©΄, λ©”μ‹μ§€ λ³Έλ¬Έμ—μ„ **μ„±κ³µμ μΌλ΅ μ²λ¦¬λ S3 μ΄λ²¤νΈμ™€ λλ‹¤ ν•¨μμ μ‘λ‹µ νμ΄λ΅λ“**λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.
    

**λ©”μ‹μ§€ λ³Έλ¬Έ κµ¬μ„±:**

- `requestContext`: νΈμ¶μ— λ€ν• μ •λ³΄
    
- `responsePayload`: λλ‹¤ ν•¨μμ λ°ν™ κ°’ (μ: `{"statusCode": 200, "body": "..."}`)
    
- `Records`: λλ‹¤ ν•¨μλ¥Ό νΈμ¶ν• μ›λ³Έ μ΄λ²¤νΈ λ μ½”λ“ (μ: S3 `ObjectCreated:Put` μ΄λ²¤νΈ)
    

### π”΄ μ‹¤ν¨ μ‹λ‚λ¦¬μ¤

1. λλ‹¤ ν•¨μ μ½”λ“λ¥Ό μμ •ν•μ—¬ **μμ™Έ(`Exception`)λ¥Ό λ°μƒ**μ‹ν‚µλ‹λ‹¤.
    
    
```Python
def lambda_handler(event, context):
	raise Exception("Boom!")
```
    
2. λ³€κ²½λ μ½”λ“λ¥Ό λ°°ν¬(Deploy)ν• ν›„, S3 λ²„ν‚·μ— λ‹¤μ‹ νμΌμ„ μ—…λ΅λ“ν•©λ‹λ‹¤.
    
3. SQS μ½μ†”λ΅ μ΄λ™ν•μ—¬ `S3-failure` νλ¥Ό ν™•μΈν•©λ‹λ‹¤.
    
4. μ²μμ—λ” λ©”μ‹μ§€κ°€ λ³΄μ΄μ§€ μ•μ„ μ μμµλ‹λ‹¤. μ΄λ” λλ‹¤μ λΉ„λ™κΈ° νΈμ¶μ΄ κΈ°λ³Έμ μΌλ΅ **2λ²μ μ¬μ‹λ„(retry)**λ¥Ό μν–‰ν•κΈ° λ•λ¬Έμ…λ‹λ‹¤. μ¬μ‹λ„κ°€ λ¨λ‘ μ‹¤ν¨ν• ν›„μ—μ•Ό `S3-failure` νλ΅ λ©”μ‹μ§€κ°€ μ „μ†΅λ©λ‹λ‹¤.
    
5. μ μ‹ ν›„ `S3-failure` νμ— `Available` λ©”μ‹μ§€κ°€ 1λ΅ ν‘μ‹λ©λ‹λ‹¤.
    
6. λ©”μ‹μ§€λ¥Ό ν΄λ§ν•λ©΄, λ©”μ‹μ§€ λ³Έλ¬Έμ—μ„ **μ‹¤ν¨μ μ›μΈκ³Ό μ¤νƒ νΈλ μ΄μ¤**λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.

**λ©”μ‹μ§€ λ³Έλ¬Έ κµ¬μ„±:**

- `requestContext`: μ¬μ‹λ„ νμ (`approximateInvokeCount`), μ‹¤ν¨ μ΄μ  (`condition: Retries exhausted`)
    
- `responsePayload`: μμ™Έ λ©”μ‹μ§€ (`errorMessage`), μμ™Έ νƒ€μ… (`errorType`), μ¤νƒ νΈλ μ΄μ¤ (`stackTrace`)
    
- `Records`: λλ‹¤ ν•¨μλ¥Ό μ‹¤ν¨ν•κ² λ§λ“  μ›λ³Έ μ΄λ²¤νΈ λ μ½”λ“

μ΄μ²λΌ Destinationsλ¥Ό ν™μ©ν•λ©΄ λλ‹¤ ν•¨μ μ‹¤ν–‰ κ²°κ³Όλ¥Ό μ²΄κ³„μ μΌλ΅ κ΄€λ¦¬ν•κ³ , μ‹¤ν¨ μ›μΈμ„ μ‰½κ² νμ•…ν•μ—¬ μ•μ •μ μΈ μ„λ²„λ¦¬μ¤ μ• ν”λ¦¬μΌ€μ΄μ…μ„ κµ¬μ¶•ν•  μ μμµλ‹λ‹¤.