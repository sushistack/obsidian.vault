EC2 인스턴스 주변의 방화벽에 대해 이야기해 보겠습니다. 이전 강의에서 간단히 설정했지만, **보안 그룹 (Security Groups)**은 AWS 클라우드에서 네트워크 보안을 수행하는 데 다시 한번 기본적인 요소가 될 것입니다. 보안 그룹은 EC2 인스턴스로 들어오고 나가는 트래픽을 제어합니다.

보안 그룹은 매우 간단하며, **허용 (allow)** 규칙만 포함합니다. 즉, 무엇이 들어오고 나갈 수 있는지 정의합니다. 보안 그룹 규칙은 IP 주소 (여러분의 컴퓨터가 어디에서 왔는지) 또는 다른 보안 그룹을 참조할 수 있습니다. 따라서 보안 그룹끼리 서로 참조할 수 있습니다.

다음 예시를 살펴보겠습니다. 여러분의 컴퓨터 (공용 인터넷 상에 있음)에서 EC2 인스턴스에 접근하려고 합니다. EC2 인스턴스 주변에 보안 그룹 (방화벽)을 생성합니다. 이 보안 그룹에는 규칙이 있으며, 이러한 규칙은 외부에서 EC2 인스턴스로 들어오는 인바운드 트래픽이 허용되는지 여부와 EC2 인스턴스가 인터넷으로 아웃바운드 트래픽을 수행할 수 있는지 여부를 결정합니다.

### 보안 그룹의 작동 방식

![[Pasted image 20250601182836.png]]

보안 그룹은 EC2 인스턴스의 방화벽이며, 포트에 대한 접근을 규제합니다. 승인된 IP 주소 범위 (IPv4 또는 IPv6)를 확인하고, 외부에서 인스턴스로 들어오는 인바운드 네트워크와 인스턴스에서 외부로 나가는 아웃바운드 네트워크를 제어합니다.

보안 그룹 규칙은 다음과 같은 형태를 가집니다.

| **유형** | **프로토콜** | **포트**  | **소스 IP 범위** |
| ------ | -------- | ------- | ------------ |
| 인바운드   | TCP      | (예: 22) | 0.0.0.0/0    |
| 아웃바운드  | 모든       | 모든      | 0.0.0.0/0    |

여기서 `0.0.0.0/0`은 모든 IP 주소를 의미하며, 특정 IP 주소를 지정할 수도 있습니다.

### 보안 그룹 다이어그램

다음 다이어그램을 보겠습니다. EC2 인스턴스에 하나의 보안 그룹이 연결되어 있으며, 인바운드 규칙과 아웃바운드 규칙이 있습니다.

![[Pasted image 20250601182905.png]]

여러분의 컴퓨터는 예를 들어 포트 22로 승인되어 트래픽이 여러분의 컴퓨터에서 EC2 인스턴스로 통과할 수 있습니다. 하지만 여러분의 IP 주소를 사용하지 않는 다른 사람의 컴퓨터는 방화벽에 의해 차단되어 EC2 인스턴스에 접근할 수 없으며, 타임아웃이 발생할 것입니다.

아웃바운드 규칙의 경우, 기본적으로 모든 보안 그룹의 EC2 인스턴스는 외부로 나가는 모든 트래픽을 허용합니다. 따라서 EC2 인스턴스가 웹사이트에 접근하여 연결을 시작하려고 하면 보안 그룹에 의해 허용됩니다.

### 보안 그룹 관련 중요 사항

- 하나의 보안 그룹은 여러 인스턴스에 연결될 수 있습니다. 보안 그룹과 인스턴스 간에 일대일 관계가 아닙니다.
- 하나의 인스턴스는 여러 보안 그룹을 가질 수도 있습니다.
- 보안 그룹은 특정 리전 및 VPC 조합에 묶여 있습니다. 다른 리전이나 다른 VPC를 사용하는 경우 새 보안 그룹을 생성해야 합니다. (VPC가 무엇인지는 나중에 다룰 것입니다.)
- 보안 그룹은 EC2 인스턴스 외부에 존재합니다. 따라서 트래픽이 차단되면 EC2 인스턴스는 해당 트래픽을 아예 보지 못합니다. EC2에서 실행되는 애플리케이션의 방화벽과는 다릅니다. EC2 인스턴스 외부의 방화벽입니다.
- 개인적인 조언이지만, SSH 접근만을 위한 별도의 보안 그룹을 유지하는 것이 좋습니다. SSH 접근은 가장 복잡할 수 있으며, 올바르게 설정되었는지 확인하는 것이 중요합니다.
- 애플리케이션에 접근할 수 없고 타임아웃이 발생하면 (이전 강의에서 보았듯이) 보안 그룹 문제일 가능성이 큽니다. 특정 포트에 연결하려고 할 때 컴퓨터가 계속 응답 없이 기다린다면 보안 그룹을 확인해 보세요.
- "Connection refused" 오류가 발생하면 보안 그룹 자체는 제대로 작동하여 트래픽이 통과했지만, 애플리케이션에 오류가 발생했거나 실행되지 않았을 가능성이 큽니다.
- 기본적으로 모든 인바운드 트래픽은 차단되고, 모든 아웃바운드 트래픽은 허용됩니다.

### 고급 기능: 보안 그룹 간 참조

매우 유용한 고급 기능이 하나 있습니다. 특히 로드 밸런서를 사용하기 시작할 때 유용하며 (다음 강의에서 다룰 예정), 보안 그룹에서 다른 보안 그룹을 참조하는 방법입니다.

예를 들어, EC2 인스턴스에 "그룹 1"이라는 보안 그룹이 연결되어 있고, 인바운드 규칙에서 "그룹 1"과 "그룹 2"의 트래픽을 허용한다고 설정할 수 있습니다.

이렇게 하면 다른 EC2 인스턴스를 시작하고 "그룹 2" 보안 그룹을 연결했을 때, 이전에 설정한 보안 그룹 규칙 덕분에 첫 번째 EC2 인스턴스에 우리가 결정한 포트를 통해 직접 연결할 수 있습니다. 마찬가지로 "그룹 1" 보안 그룹이 연결된 다른 EC2 인스턴스도 첫 번째 인스턴스와 직접 통신할 수 있습니다.

이렇게 하면 EC2 인스턴스의 IP 주소에 관계없이 올바른 보안 그룹이 연결되어 있다면 서로 직접 통신할 수 있어 IP 관리에 대한 부담을 줄여줍니다. "그룹 3" 보안 그룹이 연결된 다른 EC2 인스턴스는 "그룹 1"의 인바운드 규칙에서 승인되지 않았으므로 접근이 거부됩니다.

이는 약간 고급 기능이지만, 로드 밸런서를 다룰 때 흔히 사용되는 패턴이므로 알아두시면 좋습니다. 이 다이어그램을 다시 한번 기억해 주세요. 이제 보안 그룹에 대해 잘 이해하셨기를 바랍니다.

### 시험에 대비하여 알아야 할 주요 포트

- **SSH (Secure Shell)**: 포트 22. Linux EC2 인스턴스에 로그인하는 데 사용됩니다. 다음 강의에서 자세히 다룰 것입니다.
- **FTP (File Transfer Protocol)**: 포트 21. 파일 공유에 파일을 업로드하는 데 사용됩니다.
- **SFTP (SSH File Transfer Protocol)**: 포트 22를 사용합니다. 파일을 업로드하지만, 이번에는 SSH를 사용하여 보안 파일 전송을 수행합니다.
- **HTTP (Hypertext Transfer Protocol)**: 포트 80. 보안되지 않은 웹사이트에 접근하는 데 사용됩니다. 인터넷에서 `http://`로 시작하는 주소를 입력할 때 보셨을 것입니다.
- **HTTPS (HTTP Secure)**: 포트 443. 보안된 웹사이트에 접근하는 데 사용되며, 요즘은 표준입니다. 인터넷에서 `https://`로 시작하는 주소를 많이 보셨을 것입니다.
- **RDP (Remote Desktop Protocol)**: 포트 3389. Windows 인스턴스에 로그인하는 데 사용됩니다.

요약하자면, 22번 포트는 Linux 인스턴스를 위한 SSH이고, 3389번 포트는 Windows 인스턴스를 위한 RDP입니다.

이것으로 보안 그룹에 대한 모든 이론을 마쳤습니다. 다음 강의에서는 실습을 진행하겠습니다.