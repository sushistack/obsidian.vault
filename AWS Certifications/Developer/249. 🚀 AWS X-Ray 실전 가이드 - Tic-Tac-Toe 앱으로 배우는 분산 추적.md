## 소개: X-Ray 콘솔과 데모 애플리케이션

**AWS X-Ray**는 복잡한 분산 애플리케이션의 성능 문제를 해결하고 디버깅하는 데 필수적인 서비스입니다. 현재는 CloudWatch 콘솔 내에 통합되어 **서비스 맵** 및 **트레이스** 기능을 제공하며, 개발자가 로그, 지표, 알람과 함께 한 곳에서 문제를 진단할 수 있도록 돕습니다.

이번 실습에서는 AWS가 제공하는 Tic-Tac-Toe 게임 데모 애플리케이션(`Scorekeep X-Ray`)을 사용하여 X-Ray의 주요 기능을 직접 체험해 보겠습니다.

---

## 🏗️ 데모 애플리케이션 배포

데모 애플리케이션은 **AWS CloudFormation** 템플릿을 통해 쉽게 배포할 수 있습니다. 이 템플릿은 프런트엔드와 백엔드 API를 가진 ECS 클러스터, 그리고 DynamoDB 테이블, SNS 토픽 등 여러 AWS 리소스를 자동으로 생성합니다. 모든 구성 요소는 X-Ray를 사용하도록 설정되어 있어, 애플리케이션 실행 시 X-Ray로 추적 데이터가 전송됩니다.

### 배포 절차

1. **CloudFormation 콘솔**에서 **스택 생성**을 클릭합니다.
2. `EB-Java-Scorekeep-XRay-simplified` 템플릿 파일을 업로드합니다.
3. 스택 이름을 `Scorekeep-X-Ray`로 지정합니다.
4. **VPC ID**와 두 개의 **서브넷 ID**를 선택하여 리소스가 배포될 위치를 지정합니다.
5. 스택 생성을 완료합니다.

스택 생성이 완료되면, CloudFormation의 **`출력(Outputs)`** 탭에서 로드 밸런서 URL을 찾아 데모 웹 애플리케이션에 접속할 수 있습니다.

---

## 🎮 데모 앱 사용 및 트레이스 생성

웹 애플리케이션에 접속하여 Tic-Tac-Toe 게임을 진행하면서 X-Ray에 트레이스 데이터를 전송합니다.

1. 웹 UI에서 게임 이름(`Sample Game`)과 규칙(`Tic Tac Toe`)을 설정합니다.
2. 게임을 시작하여 몇 번의 턴을 진행하고 게임을 끝냅니다.
3. 게임을 진행하는 동안, 백엔드에서는 DynamoDB 테이블에 게임 상태를 저장하고 SNS로 알림을 보내는 등의 API 호출이 발생합니다.

이러한 모든 요청은 X-Ray SDK에 의해 자동으로 추적되어 X-Ray 서비스로 전송됩니다.

---

## 🔍 X-Ray 콘솔에서 데이터 분석

이제 CloudWatch 콘솔의 X-Ray 섹션에서 애플리케이션의 동작을 시각적으로 분석해 보겠습니다.

### 1. 서비스 맵(Service Map)

**서비스 맵**은 애플리케이션의 모든 구성 요소(노드)와 그들의 상호 의존성을 보여주는 시각적 다이어그램입니다. 각 노드는 서비스의 상태에 따라 색상 코딩되어, 문제 발생 지점을 한눈에 파악할 수 있습니다.

!

- **노드**: ECS 컨테이너, DynamoDB 테이블, SNS 토픽 등 애플리케이션을 구성하는 서비스가 원 형태로 표시됩니다.

- **연결**: 노드 간의 API 호출 관계가 선으로 연결되어 있습니다.

- **색상**: 노드가 주황색(4xx 오류)이나 빨간색(5xx 오류)으로 표시되면, 해당 서비스에 오류가 발생했음을 의미합니다. 이번 실습에서는 SNS 토픽에서 오류가 발생했음을 확인할 수 있습니다.


### 2. 트레이스(Traces)

**트레이스**는 단일 요청의 전체 흐름을 상세하게 보여주는 기능입니다. 서비스 맵에서 오류가 발생한 노드를 클릭하고 `View traces`를 선택하면 해당 노드와 관련된 모든 요청의 트레이스 목록을 볼 수 있습니다.

- **트레이스 목록**: `Response time` 그래프를 통해 요청의 지연 시간 분포를 확인하고, 특정 트레이스를 클릭하여 상세 분석을 시작합니다.
    
- **트레이스 상세 보기**:
    
    - **트레이스 맵**: 해당 요청에 관련된 서비스만 나타내는 축소된 서비스 맵을 보여줍니다.
    
    - **세그먼트(Segments)**: 요청이 시작부터 끝까지 거친 모든 서비스 호출을 시간 순서대로 보여줍니다. 각 호출에 대한 지연 시간, 오류 정보 등이 상세히 표시됩니다.
    
    - **메타데이터 및 어노테이션**: 요청과 관련된 추가적인 정보(예: 사용자 ID, 애플리케이션 버전)를 확인할 수 있습니다.


이러한 기능을 통해 느린 요청이 어떤 서비스에서 병목 현상을 겪었는지, 또는 오류가 어디서 시작되었는지를 정확히 파악할 수 있습니다.

---

## 🧹 스택 삭제

실습을 마친 후에는 불필요한 비용 발생을 막기 위해 CloudFormation 스택을 삭제해야 합니다.

1. **CloudFormation 콘솔**로 이동합니다.

2. `Scorekeep-X-Ray` 스택을 선택합니다.

3. **`삭제(Delete)`** 버튼을 클릭하여 스택과 관련된 모든 리소스를 제거합니다.


X-Ray는 복잡한 분산 환경에서 디버깅과 성능 분석을 혁신적으로 변화시키는 강력한 도구임을 이번 실습을 통해 확인할 수 있습니다.