
AWS Elastic Beanstalk은 애플리케이션 배포와 관리를 자동화하는 서비스예요. 다행히 Elastic Beanstalk 플랫폼에는 **X-Ray 데몬**이 기본적으로 포함되어 있어, 별도로 설치할 필요가 없어요. X-Ray를 활성화하려면 몇 가지 간단한 옵션만 설정하면 돼요.

### 1. X-Ray 활성화 방법

Elastic Beanstalk 환경에서 X-Ray를 활성화하는 방법은 두 가지가 있어요.

|방법|설명|
|---|---|
|**환경 설정(콘솔) 이용**|Elastic Beanstalk 환경 생성 또는 수정 시 **`Monitoring`** 섹션으로 이동해서 **`X-Ray`** 옵션을 활성화하는 방법이에요. 가장 간단하고 추천되는 방법이죠.|
|**`.ebextensions` 파일 이용**|`.ebextensions` 디렉터리 아래에 `xray-daemon.config` 파일을 생성하고 X-Ray를 활성화하는 한 줄의 YAML 코드를 추가하는 방법이에요.|

`.ebextensions` 파일 예시:

```YAML
option_settings:
  aws:elasticbeanstalk:xray:
    XRayEnabled: 'true'
```

---

### 2. IAM 권한 설정

X-Ray 데몬이 EC2 인스턴스에서 올바르게 작동하려면, 해당 인스턴스에 올바른 **IAM 역할**이 부여되어야 해요. Elastic Beanstalk 환경에 사용되는 기본 EC2 인스턴스 프로파일인 `aws-elasticbeanstalk-ec2-role`에는 이미 X-Ray에 필요한 권한이 포함되어 있어요.

- 기본 역할(aws-elasticbeanstalk-ec2-role):
    
	이 역할에 연결된 AWSElasticBeanstalkWebTier 정책을 살펴보면, xray:PutTraceSegments와 같은 X-Ray API 호출에 대한 권한이 이미 부여되어 있어요. 따라서 기본 역할을 사용한다면 별도로 권한을 추가할 필요가 없어요.
    
- 사용자 지정 역할:
    
	만약 사용자 지정 IAM 역할을 사용한다면, X-Ray 데몬이 트레이스 데이터를 X-Ray 서비스로 전송할 수 있도록 XRayWriteOnlyAccess와 같은 필요한 권한을 직접 추가해 줘야 해요.


### 3. 애플리케이션 코드 계측

마지막으로, Elastic Beanstalk에서 실행될 애플리케이션 코드가 **X-Ray SDK**를 사용하도록 계측되어 있어야 해요. SDK는 애플리케이션의 API 호출, HTTP 요청 등을 자동으로 캡처하여 X-Ray 데몬으로 보냅니다.

**요약 표**:

|요소|설정 내용|
|---|---|
|**X-Ray 데몬**|Elastic Beanstalk 플랫폼에 내장되어 있어 활성화만 하면 됨.|
|**IAM 권한**|기본 역할(`aws-elasticbeanstalk-ec2-role`)에 필요한 권한이 이미 포함되어 있음.|
|**애플리케이션 코드**|X-Ray SDK를 임포트하고 코드를 계측해야 함.|

이러한 단계를 거치면 Elastic Beanstalk 환경에서 실행되는 애플리케이션의 트레이스가 자동으로 X-Ray 콘솔에 나타나게 돼요.