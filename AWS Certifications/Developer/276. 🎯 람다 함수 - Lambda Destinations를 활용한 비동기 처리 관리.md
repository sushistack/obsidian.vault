
2019년 11월에 출시된 **Lambda Destinations**는 람다 함수의 비동기 호출 및 이벤트 소스 매핑(Event Source Mapping) 결과를 쉽게 추적하고 처리할 수 있는 기능입니다. 기존에는 비동기 호출의 성공 및 실패 여부를 파악하고 데이터를 재처리하는 것이 어려웠지만, Destinations 기능을 통해 람다 함수의 실행 결과를 특정 대상으로 보낼 수 있게 되었습니다.

---

## 📝 비동기 호출(Asynchronous Invocation)을 위한 Destinations

비동기 호출은 S3 이벤트, EventBridge 규칙 등과 같이 람다 함수가 비동기적으로 실행될 때 사용됩니다. Destinations를 사용하면 함수의 **성공(Success)** 또는 **실패(Failure)** 결과에 따라 다른 대상을 지정할 수 있습니다.

### Destinations vs. DLQ (Dead-Letter Queue)

기존의 비동기 호출 실패 처리를 위해 **DLQ(Dead-Letter Queue)**를 사용했습니다. 하지만 Destinations는 DLQ의 기능을 확장하여 더 많은 기능을 제공합니다.

|구분|Lambda Destinations|DLQ (Dead-Letter Queue)|
|---|---|---|
|**적용 범위**|**성공 및 실패** 이벤트 모두 가능|**실패** 이벤트만 가능|
|**지원 대상**|SQS, SNS, Lambda, EventBridge|SQS, SNS|
|**특징**|비동기 호출의 전체 워크플로우를 유연하게 관리|실패한 메시지를 큐에 저장하여 재처리 가능|

Destinations는 더 다양한 대상을 지원하고 성공 이벤트까지 추적할 수 있어, 비동기 호출 워크플로우를 더욱 효과적으로 구축할 수 있습니다. 따라서 AWS는 대부분의 경우 DLQ 대신 Destinations를 사용하도록 권장합니다.

### 지원 대상

- **SQS (Simple Queue Service):** 실패한 메시지를 SQS 큐에 넣어 재처리하거나, 성공 메시지를 다음 워크플로우로 전달합니다.

- **SNS (Simple Notification Service):** 실패/성공 알림을 SNS 토픽으로 발행하여 구독자에게 통지합니다.

- **Lambda (다른 람다 함수):** 함수의 실행 결과를 다른 람다 함수로 전달하여 추가적인 로직을 수행할 수 있습니다.

- **EventBridge:** 함수의 실행 결과를 EventBridge 이벤트 버스로 보내 다른 AWS 서비스나 규칙을 트리거할 수 있습니다.
    

---

## 📦 이벤트 소스 매핑(Event Source Mapping)을 위한 Destinations

이벤트 소스 매핑은 Kinesis, SQS, DynamoDB Streams 등에서 배치(Batch) 형태로 데이터를 읽어와 람다 함수를 호출하는 방식입니다. 이때 람다 함수가 배치를 처리하지 못하고 **배치 자체가 폐기(Discarded)**될 경우, 해당 배치를 Destinations로 보낼 수 있습니다.

### Event Source Mapping Failures

이벤트 소스 매핑에서 발생하는 실패는 다음과 같은 경우에 해당합니다.

1. **배치 처리 타임아웃:** 람다 함수의 실행 시간이 타임아웃에 도달하여 배치를 처리하지 못한 경우.
    
2. **처리 실패 횟수 초과:** 배치 처리 중 실패가 반복되어 재시도 횟수를 초과한 경우.

이러한 경우, 폐기된 배치 데이터를 SQS 큐나 SNS 토픽으로 보내 손실을 방지하고 추후 재처리할 수 있습니다. 특히 SQS에서 이벤트를 읽는 경우, Destinations를 설정하거나 SQS 큐 자체에 DLQ를 설정하는 두 가지 옵션이 있습니다. 람다 함수에 대한 Destinations 설정은 SQS 큐 자체의 DLQ 설정보다 세밀한 제어가 가능합니다.

---

## 📖 활용 시나리오

- **성공 알림:** S3 파일 업로드 이벤트가 람다를 통해 처리된 후, Destinations를 사용하여 성공 알림을 SNS로 보내 사용자에게 통지합니다.
    
- **실패 재처리:** Kinesis 데이터 스트림을 처리하는 람다 함수가 실패하면, 해당 배치 데이터를 SQS로 보내 다른 람다 함수가 재처리하도록 합니다.
    
- **다중 워크플로우:** 람다 함수가 성공하면 다른 람다 함수를 호출하여 다음 단계를 진행하고, 실패하면 SQS로 보내 관리자에게 알림을 보냅니다.