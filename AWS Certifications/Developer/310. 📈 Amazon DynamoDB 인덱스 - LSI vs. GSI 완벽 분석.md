

Amazon DynamoDB는 기본 테이블 구조만으로는 다양한 쿼리 요구사항을 충족하기 어렵습니다. 이때, 테이블의 기본 키(Primary Key) 외에 다른 속성을 기준으로 데이터를 효율적으로 검색할 수 있도록 도와주는 것이 바로 **보조 인덱스(Secondary Indexes)**입니다. DynamoDB에는 두 가지 종류의 보조 인덱스가 있습니다: **로컬 보조 인덱스(Local Secondary Index, LSI)**와 **글로벌 보조 인덱스(Global Secondary Index, GSI)**.

---

## 🔑 로컬 보조 인덱스 (LSI)

![[Pasted image 20250903220505.png]]

로컬 보조 인덱스는 기본 테이블과 **동일한 파티션 키(Partition Key)**를 사용하지만, **다른 정렬 키(Sort Key)**를 제공하여 쿼리 기능을 확장합니다.

### **주요 특징**

- **동일한 파티션 키**: LSI는 기본 테이블과 파티션 키를 공유합니다. 이 때문에 동일 파티션 키 내에서만 쿼리할 수 있습니다.
    
- **새로운 정렬 키**: 기본 테이블의 정렬 키 외에 다른 스칼라 속성(문자열, 숫자, 이진수)을 정렬 키로 사용하여 효율적으로 데이터를 검색할 수 있습니다.
    
- **생성 시점**: LSI는 **테이블 생성 시에만 정의**할 수 있으며, 일단 생성된 후에는 추가하거나 삭제할 수 없습니다. 따라서 테이블 설계 단계에서 신중하게 고려해야 합니다.
    
- **용량 단위**: LSI는 기본 테이블의 읽기 및 쓰기 용량 단위(RCU/WCU)를 공유합니다. 별도의 프로비저닝이 필요 없습니다.
    
- **개수 제한**: 테이블당 **최대 5개**의 LSI를 가질 수 있습니다.
    

### **활용 예시**

`Users` 테이블이 `user_id` (파티션 키)와 `game_id` (정렬 키)로 구성되어 있다고 가정해 보겠습니다. 이 테이블로는 특정 사용자의 모든 게임 기록을 찾을 수 있지만, 특정 사용자가 특정 기간에 플레이한 게임 목록을 찾기는 어렵습니다.

이때, `game_timestamp`를 새로운 정렬 키로 하는 LSI를 생성하면, `user_id`와 `game_timestamp`를 결합하여 "A 사용자가 2024년 1월 1일 이후에 플레이한 모든 게임"과 같은 쿼리를 효율적으로 수행할 수 있습니다.

---

## 🌎 글로벌 보조 인덱스 (GSI)

![[Pasted image 20250903220527.png]]

글로벌 보조 인덱스는 기본 테이블과 **독립적인 기본 키(Primary Key)**를 가집니다. 즉, 기본 테이블과 다른 파티션 키와 정렬 키를 가질 수 있습니다.

### **주요 특징**

- **독립적인 기본 키**: GSI는 기본 테이블의 키와 다른 파티션 키, 그리고 정렬 키를 가질 수 있습니다. 이 때문에 기본 테이블에서 쿼리가 불가능했던 비-키(Non-key) 속성으로도 쿼리를 수행할 수 있습니다.
    
- **생성 시점**: GSI는 **테이블 생성 후에도 언제든지 추가, 수정, 삭제**가 가능합니다. 이는 유연한 스키마 변경을 가능하게 합니다.
    
- **독립적인 용량 단위**: GSI는 별도로 **RCU와 WCU를 프로비저닝**해야 합니다. GSI에 대한 쓰기 작업은 기본 테이블에 대한 쓰기 작업과 동시에 이루어지므로, GSI의 WCU가 부족할 경우 **기본 테이블의 쓰기 작업도 스로틀링(Throttling)**될 수 있습니다. 이 점은 시험에서 매우 중요하게 다루는 부분입니다.
    
- **개수 제한**: 테이블당 **최대 20개**의 GSI를 가질 수 있습니다.
    

### **활용 예시**

앞선 예시와 동일한 `Users` 테이블(`user_id`, `game_id`)이 있다고 가정해 보겠습니다. 이 테이블로는 특정 게임 ID를 기준으로 해당 게임을 플레이한 모든 사용자를 찾을 수 없습니다.

이때, **`game_id`를 새로운 파티션 키**로 하는 GSI를 생성하면, `game_id`를 기준으로 쿼리하여 "특정 게임을 플레이한 모든 사용자"를 효율적으로 찾을 수 있습니다. 또한, `game_timestamp`를 정렬 키로 추가하여 더 정교한 쿼리도 가능하게 됩니다.

---

## 🆚 LSI와 GSI의 핵심 비교

|구분|**로컬 보조 인덱스 (LSI)**|**글로벌 보조 인덱스 (GSI)**|
|---|---|---|
|**파티션 키**|기본 테이블과 **동일**|기본 테이블과 **다름** (독립적)|
|**정렬 키**|기본 테이블과 **다름**|기본 테이블과 **다름** (독립적)|
|**생성 시점**|테이블 **생성 시에만** 가능|테이블 **생성 후에도** 가능|
|**용량 단위**|기본 테이블의 용량 단위 **공유**|별도로 **프로비저닝**해야 함|
|**스로틀링**|기본 테이블에 영향 없음|GSI의 쓰기 스로틀링이 기본 테이블의 쓰기 스로틀링을 유발할 수 있음|
|**최대 개수**|5개|20개|

**결론적으로, LSI는 동일한 파티션 내에서 다양한 정렬 기준으로 쿼리해야 할 때 적합하며, GSI는 기본 테이블의 키가 아닌 속성을 기준으로 완전히 새로운 쿼리를 수행해야 할 때 사용합니다.** DynamoDB 테이블을 설계할 때는 LSI와 GSI의 특징을 명확히 이해하고, 어떤 쿼리가 필요한지를 먼저 파악하여 최적의 인덱스를 구성해야 합니다.