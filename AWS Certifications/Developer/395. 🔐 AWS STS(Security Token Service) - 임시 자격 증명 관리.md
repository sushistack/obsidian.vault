
AWS **STS(Security Token Service)**는 IAM 사용자가 아닌 주체에게 AWS 리소스에 접근할 수 있는 **임시 보안 자격 증명**을 제공하는 서비스입니다. 이 임시 자격 증명은 정해진 유효 기간(최대 1시간) 동안만 유효하며, 보안을 강화하는 데 핵심적인 역할을 합니다.

---

## 1. 🔍 주요 STS API

STS는 다양한 상황에 맞는 여러 API를 제공하며, 각 API는 특정 용도로 사용됩니다.

|API 이름|주요 기능|설명|
|---|---|---|
|**`AssumeRole`**|IAM 역할 위임|한 계정 내에서 다른 IAM 역할을 맡거나, **교차 계정(Cross-Account)**으로 다른 계정의 역할을 맡아 해당 역할의 권한을 일시적으로 획득합니다.|
|**`AssumeRoleWithSAML`**|SAML 로그인|SAML을 통해 로그인한 사용자에게 임시 자격 증명을 부여합니다.|
|**`AssumeRoleWithWebIdentity`**|웹 ID 로그인|Google, Facebook 등 웹 ID를 통해 로그인한 사용자에게 임시 자격 증명을 부여합니다. 현재는 **Cognito Identity Pools**가 이 기능을 대체합니다.|
|**`GetSessionToken`**|MFA 세션 발급|MFA(다중 요소 인증)가 활성화된 IAM 사용자나 루트 계정에게 추가적인 세션 토큰을 발급하여 보안을 강화합니다.|
|**`GetFederationToken`**|페더레이션|페더레이션 사용자에게 임시 자격 증명을 발급합니다.|
|**`GetCallerIdentity`**|호출자 정보 확인|현재 API를 호출한 주체(사용자, 역할)의 IAM 정보 및 계정 번호를 반환합니다.|
|**`DecodeAuthorizationMessage`**|오류 메시지 디코딩|API 호출이 거부된 경우, 거부 원인을 담은 인코딩된 메시지를 디코딩하여 보여줍니다.|

---

## 2. 🤝 `AssumeRole`: 역할 위임

`AssumeRole`은 가장 중요한 STS API 중 하나로, 다른 역할의 권한을 일시적으로 획득하는 데 사용됩니다. 이는 **동일 계정 내** 또는 **교차 계정** 환경에서 유용합니다.

![[Pasted image 20250913170603.png]]

### 동작 과정

1. **IAM 역할 생성**: 다른 계정(혹은 동일 계정)에 임시로 맡길 IAM 역할을 생성하고, 이 역할에 필요한 권한 정책을 연결합니다.
    
2. **신뢰 정책 설정**: 이 역할을 맡을 주체(Principal)를 명시하여 신뢰 관계를 정의합니다.
    
3. **`AssumeRole` 호출**: 사용자는 `STS:AssumeRole` 권한을 가진 상태에서 STS API를 호출하여 해당 역할을 위임받습니다.
    
4. **임시 자격 증명 획득**: STS는 역할을 맡은 주체에게 임시 액세스 키, 시크릿 키, 세션 토큰을 반환합니다.
    
5. **리소스 접근**: 사용자는 이 임시 자격 증명으로 IAM 역할에 부여된 AWS 리소스에 접근할 수 있습니다.

---

## 3. 🛡️ MFA(다중 요소 인증)와 STS

MFA는 AWS 계정 보안의 핵심입니다. **`GetSessionToken`** API는 MFA가 활성화된 IAM 사용자나 루트 계정의 API 호출에 추가적인 보호 계층을 제공합니다.

### IAM 정책과 MFA 조건

IAM 정책에 **`aws:MultiFactorAuthPresent:true`** 조건을 추가하면, 사용자가 MFA를 사용하여 인증했을 때만 특정 작업을 허용할 수 있습니다. 이는 특히 인스턴스 종료와 같이 민감한 작업에 대한 접근을 제어할 때 유용합니다.

```JSON
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:StopInstances",
        "ec2:TerminateInstances"
      ],
      "Resource": "*",
      "Condition": {
        "Bool": {
          "aws:MultiFactorAuthPresent": "true"
        }
      }
    }
  ]
}
```

### `GetSessionToken`의 역할

MFA가 활성화된 상태에서 API 호출을 하려면, `GetSessionToken` API를 통해 발급받은 **세션 토큰**이 포함되어야 합니다. `GetSessionToken`은 `Access Key ID`, `Secret Access Key`와 함께 `Session Token`을 반환하며, 이 세 가지를 모두 포함해야 MFA 조건이 충족되는 API를 호출할 수 있습니다.

---

**요약**:

- **`STS`**: 임시 자격 증명 발급 서비스.
    
- **`AssumeRole`**: 다른 역할의 권한을 위임받음.
    
- **`GetSessionToken`**: MFA와 함께 사용되어 API 호출에 추가 보안 계층을 추가.
    
- **`aws:MultiFactorAuthPresent`**: IAM 정책에 MFA 조건을 적용.