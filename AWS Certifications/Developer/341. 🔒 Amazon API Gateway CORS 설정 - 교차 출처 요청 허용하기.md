
이번 가이드에서는 Amazon API Gateway에서 **CORS(Cross-Origin Resource Sharing)**를 설정하는 방법을 상세히 알아보겠습니다. CORS는 웹 브라우저의 보안 정책으로, 다른 도메인에 있는 API에 접근할 때 반드시 필요한 설정입니다.

---

## 🧭 1단계: CORS의 작동 원리

![[Pasted image 20250907194711.png]]

CORS는 웹 페이지가 로드된 도메인(Origin)과 다른 도메인(Cross-Origin)에 있는 리소스에 접근할 수 있도록 허용하는 메커니즘입니다.

### 📝 CORS의 필요성

웹 브라우저는 기본적으로 **동일 출처 정책(Same-Origin Policy)**을 따릅니다. 이는 `www.example.com`에서 실행되는 스크립트가 `api.example.com`과 같은 다른 도메인의 리소스에 직접 접근하는 것을 제한하여 보안 위협을 막습니다.

하지만 현대 웹 애플리케이션은 종종 여러 도메인의 리소스를 필요로 합니다. 예를 들어, `www.example.com`에서 호스팅되는 웹사이트의 프런트엔드가 `api.example.com`에 있는 백엔드 API를 호출해야 하는 경우가 많습니다. 이때 CORS를 통해 교차 출처 요청을 명시적으로 허용해야 합니다.

### ➡️ Preflight 요청 (OPTIONS Method)

CORS가 활성화되면, 웹 브라우저는 실제 요청(예: `GET`, `POST`)을 보내기 전에 **Preflight 요청**이라는 사전 검증 과정을 거칩니다.

1. **Preflight 요청**: 브라우저는 `OPTIONS` 메서드를 사용하여 API Gateway에 실제 요청을 보낼 수 있는지 미리 물어봅니다. 이 요청에는 `Access-Control-Request-Method`와 같은 헤더가 포함되어 있습니다.
    
2. **Preflight 응답**: API Gateway는 설정된 CORS 규칙에 따라 해당 도메인에서의 요청을 허용할지 여부를 응답합니다. 응답에는 `Access-Control-Allow-Origin`, `Access-Control-Allow-Methods`와 같은 CORS 관련 헤더가 포함됩니다.
    
3. **실제 요청**: Preflight 응답이 긍정적이면, 브라우저는 비로소 실제 요청을 백엔드로 보냅니다.

---

## ⚙️ 2단계: API Gateway에서 CORS 설정하기

API Gateway 콘솔에서는 CORS를 쉽게 활성화할 수 있습니다.

### 📝 설정 단계

1. **리소스 선택**: CORS를 적용할 API Gateway의 리소스(예: `/`)를 선택합니다.
    
2. **CORS 활성화**: **작업(Actions)** 드롭다운 메뉴에서 **CORS 활성화(Enable CORS)**를 클릭합니다.
    
3. **헤더 설정**:
    
    - **`Access-Control-Allow-Origin`**: 교차 출처 요청을 허용할 도메인(Origin)을 지정합니다. 모든 도메인을 허용하려면 `*`를 입력합니다.
        
    - **`Access-Control-Allow-Methods`**: 허용할 HTTP 메서드(`GET`, `POST`, `OPTIONS` 등)를 지정합니다.
        
    - **`Access-Control-Allow-Headers`**: 요청 시 허용할 헤더를 지정합니다. (`Content-Type`, `x-api-key` 등)
        
4. **확인**: 설정을 확인하고 저장합니다. API Gateway는 자동으로 `OPTIONS` 메서드를 생성하고 필요한 CORS 헤더를 추가합니다.

---

## 💡 CORS 설정의 핵심

API Gateway에서 CORS를 설정하는 것은 단순한 작업처럼 보이지만, 올바르게 설정하는 것이 매우 중요합니다.

|설정 항목|설명|
|---|---|
|**`Access-Control-Allow-Origin`**|브라우저가 API에 접근할 수 있도록 허용된 도메인(Origin)을 명시합니다. 보안을 위해 필요한 도메인만 허용하는 것이 좋습니다.|
|**`OPTIONS` 메서드**|API Gateway가 자동으로 생성하는 사전 검증 요청(Preflight)을 처리하는 메서드입니다. 이 메서드에 대한 응답은 CORS 헤더를 포함합니다.|
|**`Authorization` 헤더**|인증이 필요한 API의 경우 `Access-Control-Allow-Headers`에 `Authorization`을 포함시켜야 합니다.|

CORS는 웹 브라우저의 필수 보안 기능이므로, 웹 애플리케이션의 프런트엔드에서 API Gateway를 호출해야 한다면 CORS를 반드시 활성화해야 한다는 점을 기억해야 합니다.