
이번 아티클에서는 **AWS SAM(Serverless Application Model) CLI**가 제공하는 강력한 **로컬 개발 및 테스트 기능**에 대해 자세히 살펴보겠습니다. 이 기능들을 활용하면 AWS 클라우드에 배포하기 전에 로컬 환경에서 Lambda 함수와 API Gateway를 직접 실행하고 테스트할 수 있어 개발 효율성을 크게 높일 수 있습니다.

---

### 1️⃣ SAM 로컬 기능의 중요성

SAM CLI의 로컬 기능은 서버리스 애플리케이션 개발 워크플로우를 혁신적으로 개선합니다.

- **빠른 개발/테스트 사이클:** 클라우드에 매번 배포할 필요 없이 로컬에서 코드를 변경하고 즉시 결과를 확인할 수 있습니다.
    
- **비용 절감:** 실제 AWS 리소스를 사용하지 않으므로 개발 단계에서 발생할 수 있는 클라우드 비용을 절약할 수 있습니다.
    
- **오프라인 개발:** 인터넷 연결 없이도 기본적인 테스트를 수행할 수 있어 개발의 유연성이 높아집니다.
    

SAM 로컬 기능을 사용하려면 **Docker**가 시스템에 설치되어 있어야 합니다. SAM CLI는 Docker 컨테이너를 사용하여 Lambda 함수의 런타임 환경을 에뮬레이션합니다.

---

### 2️⃣ 주요 SAM 로컬 명령어

SAM CLI는 로컬 환경에서 Lambda 함수, API Gateway, 이벤트 소스 등을 에뮬레이션하기 위한 다양한 명령어를 제공합니다.

#### **`sam local invoke`**

이 명령어는 로컬 환경에서 **단일 Lambda 함수를 한 번 실행**하는 데 사용됩니다. 특정 이벤트 페이로드(payload)를 전달하여 함수의 동작을 테스트할 때 유용합니다.



```Bash
# S3 PUT 이벤트와 함께 로컬 Lambda 함수 호출
sam local invoke "MyFunction" --event-name "S3Put"
```

- `--event-name`: 미리 정의된 샘플 이벤트 페이로드를 사용합니다.
    
- `--event`: 로컬 JSON 파일을 사용하여 이벤트를 직접 전달할 수 있습니다.
    
- `--profile`: Lambda 함수가 DynamoDB나 S3 같은 다른 AWS 서비스와 상호작용하는 경우, 해당 서비스에 접근할 AWS 프로필을 지정해야 합니다.
    

#### **`sam local start-api`**

이 명령어는 로컬 머신에 **API Gateway를 에뮬레이션하는 HTTP 서버를 시작**합니다. `template.yaml`에 정의된 모든 API와 Lambda 함수를 로컬에서 호스팅합니다.

```Bash
# 로컬 API Gateway 서버 시작
sam local start-api
```

- 이 서버는 기본적으로 `http://127.0.0.1:3000`에서 실행됩니다.
    
- 코드를 수정하면 서버가 자동으로 업데이트된 함수를 다시 로드하므로, 개발자는 API를 재시작할 필요 없이 즉시 변경 사항을 테스트할 수 있습니다.

#### **`sam local start-lambda`**

이 명령어는 로컬 머신에 **로컬 Lambda 엔드포인트**를 시작합니다. 이는 API Gateway를 사용하지 않고 Lambda 함수 자체를 엔드포인트로 테스트하고 싶을 때 유용합니다.

```Bash
# 로컬 Lambda 엔드포인트 시작
sam local start-lambda
```

- 이 엔드포인트에 테스트 자동화 스크립트나 외부 애플리케이션을 연결하여 로컬에서 통합 테스트를 수행할 수 있습니다.
    

#### **`sam local generate-event`**

이 명령어는 Lambda 함수가 트리거될 수 있는 **다양한 AWS 서비스의 이벤트 페이로드 샘플을 생성**합니다. `sam local invoke` 명령어와 함께 파이프(`|`)를 사용하여 함수에 입력으로 전달할 수 있습니다.

|서비스|이벤트 유형|명령어 예시|
|---|---|---|
|**S3**|`put`, `delete`|`sam local generate-event s3 put --bucket my-bucket --key my-file.txt`|
|**API Gateway**|`proxy-request`|`sam local generate-event apigateway proxy-request --path /my-path --method GET`|
|**SNS**|`notification`|`sam local generate-event sns notification --topic-arn arn:aws:sns:REGION:ACCOUNT:mytopic --message "Hello, world!"`|
|**Kinesis**|`record`|`sam local generate-event kinesis record --partition-key my-key --data "base64-encoded-data"`|

**활용 예시:**

```Bash
# S3 PUT 이벤트를 생성하여 Lambda 함수에 전달
sam local generate-event s3 put --bucket my-bucket --key my-file.txt | sam local invoke MyS3Handler
```

---

### 3️⃣ SAM 로컬 기능의 워크플로우

1. **프로젝트 초기화:** `sam init` 명령어로 프로젝트를 생성합니다.
    
2. **`template.yaml` 정의:** 함수, API, DynamoDB 테이블 등 필요한 AWS 리소스를 템플릿에 정의합니다.
    
3. **로컬 개발 시작:**
    
    - API를 개발 중이라면 `sam local start-api`를 실행합니다.
        
    - 단일 함수를 테스트하려면 `sam local invoke`를 사용합니다.
        
4. **코드 수정:** 코드 에디터에서 자유롭게 코드를 수정합니다.
    
5. **즉시 테스트:** 브라우저, `curl`, 또는 테스트 스크립트를 사용하여 로컬 API에 요청을 보냅니다. `sam local start-api`는 코드 변경 사항을 자동으로 반영합니다.
    
6. **배포:** 로컬 테스트가 완료되면 `sam deploy` 명령어로 애플리케이션을 클라우드에 배포합니다.