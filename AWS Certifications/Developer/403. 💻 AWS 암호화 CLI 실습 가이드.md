
AWS KMS(Key Management Service)λ” AWSμ—μ„ λ°μ΄ν„° μ•”νΈν™”λ¥Ό κ΄€λ¦¬ν•λ” ν•µμ‹¬ μ„λΉ„μ¤μ…λ‹λ‹¤. `AWS μ•”νΈν™” CLI(Encryption CLI)`λ¥Ό μ‚¬μ©ν•λ©΄, λ€μ©λ‰ νμΌμ„ μ†μ‰½κ² μ•”νΈν™”ν•κ³  λ³µνΈν™”ν•  μ μμµλ‹λ‹¤. μ΄ κ°€μ΄λ“μ—μ„λ” Python `pip`λ¥Ό μ‚¬μ©ν•μ—¬ CLIλ¥Ό μ„¤μΉν•κ³ , μ‹¤μ  νμΌμ„ μ•”νΈν™” λ° λ³µνΈν™”ν•λ” κ³Όμ •μ„ λ‹¨κ³„λ³„λ΅ μƒμ„Έν μ„¤λ…ν•©λ‹λ‹¤.

---

## π€ 1. AWS μ•”νΈν™” CLI μ„¤μΉ

AWS μ•”νΈν™” CLIλ” Python ν™κ²½μ—μ„ `pip`λ¥Ό ν†µν•΄ κ°„λ‹¨ν•κ² μ„¤μΉν•  μ μμµλ‹λ‹¤.

**β… μ„¤μΉ λ…λ Ήμ–΄**

```Bash
# Python pipλ¥Ό μ‚¬μ©ν•μ—¬ AWS Encryption SDK CLI μ„¤μΉ
pip install aws-encryption-sdk-cli
```

μ„¤μΉκ°€ μ™„λ£λλ©΄, λ‹¤μ λ…λ Ήμ–΄λ΅ λ²„μ „μ„ ν™•μΈν•μ—¬ μ„¤μΉκ°€ μ λ€λ΅ λμ—λ”μ§€ κ²€μ¦ν•  μ μμµλ‹λ‹¤.

```Bash
aws-encryption-cli --version
```

[κ²°κ³Ό μμ‹]

aws-encryption-cli/1.3.7 aws-encryption-sdk/1.3.7 Python/3.9.6

---

## π”‘ 2. KMS ν‚¤ μ •λ³΄ μ„¤μ •

μ•”νΈν™” λ° λ³µνΈν™”μ— μ‚¬μ©ν•  **κ³ κ° κ΄€λ¦¬ν• ν‚¤(CMK)**μ ARN(Amazon Resource Name)μ΄ ν•„μ”ν•©λ‹λ‹¤. ARNμ€ AWS Consoleμ—μ„ KMS ν‚¤μ μƒμ„Έ μ •λ³΄ νμ΄μ§€μ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

**β… CMK ARN ν™κ²½ λ³€μ μ„¤μ •**

```Bash
# KMS ν‚¤μ ARNμ„ ν™κ²½ λ³€μλ΅ μ €μ¥
export KEY_ARN=arn:aws:kms:eu-west-2:123456789012:key/your-key-id
```

μ΄ ν™κ²½ λ³€μλ” μ΄ν›„μ μ•”νΈν™” λ° λ³µνΈν™” λ…λ Ήμ—μ„ ν‚¤λ¥Ό μ‰½κ² μ°Έμ΅°ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

---

## π“‚ 3. μ•”νΈν™”ν•  νμΌ μƒμ„±

λ€μ©λ‰ μ•”νΈν™”μ ν¨κ³Όλ¥Ό μ‹μ—°ν•κΈ° μ„ν•΄ 1MB μ΄μƒμ ν° ν…μ¤νΈ νμΌμ„ κ°€μ •ν•©λ‹λ‹¤. κ°„λ‹¨ν• μμ λ¥Ό μ„ν•΄ λ‹¤μ λ‚΄μ©μ„ κ°€μ§„ `hello.txt` νμΌμ„ μƒμ„±ν•©λ‹λ‹¤.

```Bash
# hello.txt νμΌ μƒμ„± λ° λ‚΄μ© μ¶”κ°€
echo "This is a super secret data that is over one megabyte." > hello.txt
```

μ‹¤μ λ΅ μ΄ νμΌμ ν¬κΈ°λ” μ¤‘μ”ν•μ§€ μ•μΌλ©°, CLIκ°€ Envelope Encryption κΈ°μ μ„ μ‚¬μ©ν•μ—¬ μλ™μΌλ΅ μ²λ¦¬ν•©λ‹λ‹¤.

---

## π”’ 4. νμΌ μ•”νΈν™”

μ΄μ  `aws-encryption-cli`μ `encrypt` λ…λ Ήμ„ μ‚¬μ©ν•μ—¬ `hello.txt` νμΌμ„ μ•”νΈν™”ν•©λ‹λ‹¤.

**β… μ•”νΈν™” λ…λ Ήμ–΄**

```Bash
# μ•”νΈν™” λ…λ Ήμ–΄ μ‹¤ν–‰
aws-encryption-cli --encrypt \
    --input hello.txt \
    --master-keys key=$KEY_ARN \
    --output ./output \
    --metadata-output ./metadata
```

**[λ…λ Ήμ–΄ μ„¤λ…]**

- `--encrypt`: μ•”νΈν™” μ‘μ—…μ„ μ§€μ •ν•©λ‹λ‹¤.
- `--input hello.txt`: μ•”νΈν™”ν•  μ›λ³Έ νμΌμ κ²½λ΅μ…λ‹λ‹¤.
- `--master-keys key=$KEY_ARN`: μ‚¬μ©ν•  KMS λ§μ¤ν„° ν‚¤(CMK)λ¥Ό ν™κ²½ λ³€μ `$KEY_ARN`μ„ ν†µν•΄ μ§€μ •ν•©λ‹λ‹¤.
- `--output ./output`: μ•”νΈν™”λ νμΌμ΄ μ €μ¥λ  μ¶λ ¥ λ””λ ‰ν„°λ¦¬μ…λ‹λ‹¤.
- `--metadata-output ./metadata`: μ•”νΈν™” κ³Όμ •μ— λ€ν• λ©”νƒ€λ°μ΄ν„°κ°€ μ €μ¥λ  νμΌ κ²½λ΅μ…λ‹λ‹¤. μ΄ νμΌμ€ μ•”νΈν™”λ λ°μ΄ν„°μ μ •λ³΄λ¥Ό λ‹΄κ³  μμΌλ©°, λ””λ²„κΉ… λ©μ μΌλ΅ μ μ©ν•©λ‹λ‹¤.

λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄ `./output` λ””λ ‰ν„°λ¦¬ λ‚΄μ— `hello.txt.encrypted` νμΌμ΄ μƒμ„±λ©λ‹λ‹¤. μ΄ νμΌμ λ‚΄μ©μ„ μ—΄μ–΄λ³΄λ©΄ μ•μ•„λ³Ό μ μ—†λ” **λ‚μ(gibberish)**κ°€ λ‚νƒ€λ‚λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

---

## π”“ 5. νμΌ λ³µνΈν™”

μ•”νΈν™”λ νμΌμ„ μ›λμ ν‰λ¬ΈμΌλ΅ λλλ¦¬κΈ° μ„ν•΄ `decrypt` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

**β… λ³µνΈν™” λ…λ Ήμ–΄**

```Bash
# λ³µνΈν™” λ…λ Ήμ–΄ μ‹¤ν–‰
aws-encryption-cli --decrypt \
    --input ./output/hello.txt.encrypted \
    --master-keys key=$KEY_ARN \
    --output ./decrypted \
    --metadata-output ./metadata
```

**[λ…λ Ήμ–΄ μ„¤λ…]**

- `--decrypt`: λ³µνΈν™” μ‘μ—…μ„ μ§€μ •ν•©λ‹λ‹¤.
- `--input ./output/hello.txt.encrypted`: λ³µνΈν™”ν•  μ•”νΈν™”λ νμΌμ κ²½λ΅μ…λ‹λ‹¤.
- `--master-keys key=$KEY_ARN`: λ³µνΈν™”μ— μ‚¬μ©ν•  λ§μ¤ν„° ν‚¤λ¥Ό μ§€μ •ν•©λ‹λ‹¤. **KMSλ” μ•”νΈν™”λ λ°μ΄ν„°μ— ν¬ν•¨λ ν‚¤ μ •λ³΄λ¥Ό μλ™μΌλ΅ μΈμ‹ν•λ―€λ΅ μ΄ μΈμλ” ν•„μλ” μ•„λ‹™λ‹λ‹¤.** ν•μ§€λ§ λ…μ‹μ μΌλ΅ μ§€μ •ν•λ©΄ μΆ‹μµλ‹λ‹¤.
- `--output ./decrypted`: λ³µνΈν™”λ νμΌμ΄ μ €μ¥λ  μ¶λ ¥ λ””λ ‰ν„°λ¦¬μ…λ‹λ‹¤.

λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄ `./decrypted` λ””λ ‰ν„°λ¦¬μ— `hello.txt.encrypted.decrypted` νμΌμ΄ μƒμ„±λ©λ‹λ‹¤. μ΄ νμΌμ„ μ—΄μ–΄λ³΄λ©΄, μ•”νΈν™”ν•κΈ° μ „μ μ›λ λ‚΄μ©μΈ "This is a super secret data that is over one megabyte."κ°€ λ³µμ›λ κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

---

## π κ²°λ΅ 

`AWS Encryption CLI`λ” λ³µμ΅ν• **Envelope Encryption** κΈ°μ μ„ μ¶”μƒν™”ν•μ—¬, μ‚¬μ©μκ°€ κ°„λ‹¨ν• λ‘ κ°€μ§€ λ…λ Ήμ–΄λ΅ λ€μ©λ‰ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ•”νΈν™”ν•κ³  λ³µνΈν™”ν•  μ μλ„λ΅ λ•μµλ‹λ‹¤. μ΄ CLIλ¥Ό μ‚¬μ©ν• μ‹¤μµμ„ ν†µν•΄ KMSμ κ°•λ ¥ν• λ°μ΄ν„° λ³΄νΈ κΈ°λ¥μ„ μ§μ ‘ κ²½ν—ν•  μ μμΌλ©°, μ‹¤μ  μ• ν”λ¦¬μΌ€μ΄μ… κ°λ°μ— μ΄ κΈ°μ μ„ μ μ©ν•λ” λ° μμ‹ κ°μ„ μ–»μ„ μ μμµλ‹λ‹¤.