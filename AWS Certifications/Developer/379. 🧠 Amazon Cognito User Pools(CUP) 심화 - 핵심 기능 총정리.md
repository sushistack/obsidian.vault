
이번 글에서는 Amazon Cognito User Pools(CUP)의 심화 기능인 Lambda Triggers, 호스팅 UI, 적응형 인증, 그리고 JWT(JSON Web Token)에 대해 상세히 알아보겠습니다.

---

## 🚀 Lambda Triggers: 인증 워크플로우 커스터마이징

Cognito User Pools는 특정 이벤트 발생 시 **Lambda 함수를 동기적으로 호출**하여 인증 워크플로우를 유연하게 커스터마이징할 수 있는 기능을 제공합니다. 이를 통해 다음과 같은 다양한 시나리오를 구현할 수 있습니다.

### 1. 인증 이벤트

- `Pre-authentication`: 로그인 요청을 수락하거나 거부합니다.
    
- `Post-authentication`: 성공적인 로그인 후 이벤트를 로깅하거나 사용자 데이터를 분석합니다.
    
- `Pre-token generation`: 토큰이 생성되기 전에 클레임을 추가하거나 수정합니다.

### 2. 회원가입 이벤트

- `Pre sign-up`: 사용자 등록 요청을 검증합니다.
    
- `Post confirmation`: 사용자 등록 완료 후 환영 메시지를 보내거나 커스텀 분석 이벤트를 로깅합니다.
    
- `Migrate user`: 기존 시스템의 사용자를 Cognito로 마이그레이션합니다.

### 3. 기타

- `Custom message`: 사용자에게 전송되는 메시지(예: 확인 코드)를 커스터마이징합니다.
    
- `Define auth challenge`: 커스텀 인증 플로우를 정의합니다.

---

## 🎨 Hosted UI: 커스터마이징 가능한 로그인 페이지

Cognito는 별도의 개발 없이 바로 사용할 수 있는 **호스팅 인증 UI**를 제공합니다. 이 UI는 회원가입 및 로그인 페이지를 포함하며, 소셜 로그인(Google, Facebook 등), OIDC(OpenID Connect), SAML과 같은 제휴 로그인 기능이 기본적으로 통합되어 있습니다.

### 주요 특징

- **커스터마이징**: 로고 및 CSS를 수정하여 애플리케이션의 브랜드 정체성에 맞게 디자인을 변경할 수 있습니다.
    
- **커스텀 도메인**: `example.com`과 같이 사용자 지정 도메인을 사용하여 로그인 페이지를 호스팅할 수 있습니다. 단, 이 경우 **`us-east-1` 리전에 ACM(AWS Certificate Manager)**의 HTTPS 인증서가 반드시 필요합니다.

---

## 🛡️ 적응형 인증(Adaptive Authentication) 및 계정 보호

Cognito의 **적응형 인증**은 로그인 시도를 분석하여 위험도를 평가하고, 의심스러운 활동에 대해 추가적인 보안 조치를 취합니다.

### 동작 원리

1. **위험 점수 평가**: Cognito는 로그인 시도의 디바이스, IP 주소, 위치 등 여러 요소를 기반으로 위험 점수(낮음, 중간, 높음)를 매깁니다.
    
2. **보안 조치**:
    
    - **위험도가 높을 경우**: 로그인을 차단하거나 **MFA(다중 요소 인증)**를 필수로 요구합니다.
        
    - **위험도가 낮을 경우**: 정상적으로 비밀번호를 통한 로그인을 허용합니다.

이러한 모든 활동은 CloudWatch Logs에 기록되어 추후 분석 및 모니터링에 활용할 수 있습니다.

---

## 🔑 JSON Web Token (JWT) 이해하기

Cognito 사용자 풀에서 로그인을 성공하면, 클라이언트는 **JWT(JSON Web Token)**를 반환받습니다. JWT는 Base64로 인코딩된 문자열이며, 세 부분으로 구성됩니다.

|부분|역할|
|---|---|
|**헤더(Header)**|토큰의 타입과 서명 알고리즘 정보|
|**페이로드(Payload)**|사용자 정보(클레임)|
|**서명(Signature)**|토큰의 유효성을 검증하기 위한 암호화된 서명|

### 페이로드(Payload)의 중요성

페이로드에는 사용자의 고유 ID(`sub UUID`), 사용자 이름, 이메일, 그룹 정보, 토큰 만료 시간 등 중요한 정보가 포함되어 있습니다. 백엔드 서비스는 이 페이로드를 사용하여 사용자 인증 및 권한 부여를 처리할 수 있습니다.

**⚠️ 주의사항**: 페이로드의 정보는 복호화될 수 있으므로, 반드시 **서명(Signature)을 검증**하여 토큰의 무결성을 확인해야 합니다. 서명 검증이 성공해야 페이로드의 정보를 신뢰할 수 있습니다. 페이로드의 `sub UUID`를 사용하면 Cognito 데이터베이스에서 사용자의 추가 정보를 조회할 수 있습니다.