Amazon API Gateway의 **스테이지(Stage)**는 단순한 배포 환경 구분을 넘어, API의 성능, 보안, 로깅 등 다양한 측면을 제어하는 핵심적인 구성 요소입니다. 이번 아티클에서는 스테이지에서 설정할 수 있는 다양한 옵션들을 상세히 살펴보겠습니다.

---

## 🚀 1단계: 일반 설정 및 성능 최적화

스테이지의 **편집(Edit)** 기능을 통해 API의 기본 정보와 성능 관련 옵션을 설정할 수 있습니다.

### 📝 스테이지 세부 정보

- **설명(Description)**: 스테이지에 대한 설명을 추가하여 어떤 목적으로 사용되는지 명확히 할 수 있습니다.

### 📈 API 캐싱

- **캐시 활성화**: API 캐시를 설정하여 반복되는 요청에 대한 응답을 캐시함으로써 백엔드 서비스(예: Lambda)의 부하를 줄이고 응답 속도를 향상시킬 수 있습니다. 캐시 크기, TTL(Time to Live) 등을 세밀하게 조정할 수 있습니다.
    

### 🚦 스로틀링(Throttling)

- **요청 제한**: API의 초당 요청 수(Rate)와 최대 버스트 요청 수(Burst)를 설정하여 API가 과도한 트래픽으로 인해 마비되는 것을 방지합니다. 이는 서비스 안정성을 유지하는 데 필수적인 기능입니다.
    

### 🔒 웹 애플리케이션 방화벽(WAF) 및 클라이언트 인증서

- **WAF 연동**: AWS WAF(Web Application Firewall)를 연동하여 SQL Injection이나 XSS(Cross-Site Scripting) 같은 일반적인 웹 공격으로부터 API를 보호할 수 있습니다.
    
- **클라이언트 인증서**: API Gateway에 요청을 보내는 클라이언트(예: 다른 AWS 서비스)를 식별하고 인증하기 위해 클라이언트 인증서를 설정할 수 있습니다.

---

## 📊 2단계: 로깅 및 모니터링

스테이지는 API 호출에 대한 상세한 로그와 지표를 제공하여 문제 해결 및 모니터링을 용이하게 합니다.

### 📜 CloudWatch 로깅

- **액세스 로그**: API 호출의 상세 정보를 기록합니다.
    
- **실행 로그**: API Gateway의 실행 단계별 상세 정보를 기록하며, 오류만 기록하거나 요청/응답 전체를 기록하도록 설정할 수 있습니다. **민감한 데이터가 포함될 수 있으므로 주의해야 합니다.**
    

### 📈 CloudWatch 지표(Metrics)

- **세부 지표(Detailed Metrics)**: API의 호출 수, 지연 시간, 오류 수 등 다양한 지표를 CloudWatch에 게시하여 API 상태를 실시간으로 모니터링할 수 있습니다.
    

### 🔍 AWS X-Ray 트레이싱

- **X-Ray 통합**: X-Ray를 활성화하면 API Gateway부터 백엔드 서비스(예: Lambda, EC2 등)까지 요청의 전체 흐름을 시각화하여 지연 시간의 병목 구간을 쉽게 찾을 수 있습니다.

---

## 📁 3단계: 관리 및 기타 옵션

스테이지는 API의 버저닝, 문서화, 그리고 배포 전략을 관리하는 다양한 기능을 제공합니다.

### 🌿 스테이지 변수(Stage Variables)

- 스테이지에 특화된 환경 변수입니다. 이전 가이드에서 보았듯이, 이를 활용하여 API를 재배포하지 않고도 Lambda 함수 별칭이나 백엔드 엔드포인트를 동적으로 변경할 수 있습니다.
    

### 🕰️ 배포 히스토리(Deployment History)

- **이력 관리**: 스테이지에 배포된 모든 이력을 확인할 수 있습니다. 이를 통해 언제 어떤 버전이 배포되었는지 추적하고, 필요한 경우 이전 버전으로 **롤백**할 수 있습니다.
    

### 📝 문서화(Documentation)

- API Gateway에서 API 문서를 관리할 때, 문서의 변경 이력을 추적할 수 있습니다.
    

### 🕊️ 카나리 배포(Canary Deployment)

- **점진적 출시**: 카나리 배포를 활성화하면 새로운 버전의 API를 소수의 사용자에게만 먼저 노출하고, 문제가 없는지 확인한 후 전체 사용자에게 확대 적용할 수 있습니다. 이는 무중단 배포를 위한 고급 전략입니다.

### 🏷️ 태그(Tags)

- **리소스 관리**: 스테이지에 태그를 지정하여 비용 할당, 자동화 스크립트, 리소스 관리 등에 활용할 수 있습니다.