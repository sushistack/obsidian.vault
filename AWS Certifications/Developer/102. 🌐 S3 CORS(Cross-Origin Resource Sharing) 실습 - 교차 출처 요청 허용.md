
이번 실습에서는 S3 버킷을 정적 웹사이트로 호스팅하고, 다른 버킷에 있는 리소스에 접근할 때 발생하는 CORS(Cross-Origin Resource Sharing) 문제를 해결하는 방법을 알아봅니다. 이 과정을 통해 CORS가 웹 브라우저의 보안 메커니즘으로 어떻게 작동하는지 직접 확인할 수 있습니다.

---

### 1. `index.html` 파일 수정 및 초기 설정 📝

우선, CORS 데모를 위해 `index.html` 파일을 수정합니다. 이 파일은 `fetch` 요청을 사용하여 다른 페이지를 로드하도록 설정되어 있습니다.

1. 기존 `index.html` 파일에서 주석 처리된 `fetch` 코드를 활성화합니다. 이 코드는 `extra-page.html` 파일을 가져와 웹 페이지에 표시하는 역할을 합니다.

2. `index.html` 파일과 `extra-page.html` 파일을 첫 번째 버킷(예: `demo-origin-stephane`)에 업로드하고, 이 버킷을 정적 웹사이트로 설정합니다.

**초기 결과 확인:**

- 웹사이트 엔드포인트 URL에 접속하면 "I love coffee. Hello world!"와 함께 `extra-page.html`의 내용인 "This extra page has been successfully loaded."가 표시됩니다.

- 이는 두 파일이 동일한 버킷에 있으므로 **"동일 출처(Same Origin)"** 요청으로 간주되어 정상적으로 작동한 결과입니다.

---

### 2. CORS 문제 발생시키기: 교차 출처 요청 💥

이제 `extra-page.html` 파일을 다른 버킷으로 옮겨 "교차 출처" 요청을 발생시켜 보겠습니다.

1. **두 번째 버킷 생성:** `demo-other-origin-stephane`와 같이 다른 이름의 버킷을 생성하고, 다른 리전(예: 캐나다)에 위치시킵니다.
    
2. **두 번째 버킷 설정:**
    - `퍼블릭 액세스 차단` 설정을 해제합니다.
    - 버킷 정책을 설정하여 모든 객체에 대한 `s3:GetObject` 권한을 공개적으로 허용합니다.
    - `속성(Properties)` 탭에서 정적 웹사이트 호스팅을 활성화합니다.

3. `extra-page.html` 파일을 두 번째 버킷에 업로드합니다.
    
4. 첫 번째 버킷(`demo-origin-stephane`)에 있는 `extra-page.html` 파일을 **삭제**합니다.
    
5. `index.html` 파일을 수정하여 `fetch` 요청의 URL을 두 번째 버킷의 `extra-page.html` 파일 URL로 변경합니다.
    
6. 수정한 `index.html` 파일을 첫 번째 버킷에 다시 업로드합니다.
    

**CORS 오류 확인:**

- 웹 브라우저의 개발자 도구(Console)를 열고 첫 번째 버킷의 웹사이트 URL을 새로고침합니다.

- 콘솔에 **"Cross-Origin Request Blocked"** 오류 메시지가 표시되는 것을 확인할 수 있습니다.

- 이는 웹 브라우저가 보안상의 이유로 다른 출처(`demo-other-origin-stephane`)의 리소스를 가져오는 요청을 차단했기 때문입니다.

---

### 3. CORS 문제 해결하기: CORS 설정 추가 ✅

오류를 해결하기 위해 두 번째 버킷에 CORS 규칙을 추가하여 첫 번째 버킷의 요청을 허용합니다.

1. **두 번째 버킷**(`demo-other-origin-stephane`)으로 이동합니다.

2. `권한(Permissions)` 탭으로 이동하여 `교차 출처 리소스 공유 (CORS)` 섹션의 `편집(Edit)`을 클릭합니다.

3. 다음과 같은 JSON 형식의 CORS 규칙을 추가합니다. `AllowedOrigins`에는 **첫 번째 버킷의 정적 웹사이트 URL**을 입력합니다.


```JSON
[
	{
		"AllowedHeaders": [
			"*"
		],
		"AllowedMethods": [
			"GET"
		],
		"AllowedOrigins": [
			"<첫 번째 버킷의 웹사이트 URL>"
		],
		"ExposeHeaders": []
	}
]
```

4. `변경 사항 저장(Save changes)`을 클릭하여 CORS 규칙을 적용합니다.


---

### 4. CORS 해결 결과 확인 🚀

CORS 설정이 올바르게 적용되었는지 확인합니다.

1. 첫 번째 버킷의 웹사이트 URL로 돌아가 페이지를 새로고침합니다.
    
2. 웹 브라우저 콘솔에 오류 메시지가 사라지고, "This extra page has been successfully loaded."가 정상적으로 표시되는 것을 확인할 수 있습니다.
    
3. 개발자 도구의 **네트워크(Network)** 탭을 보면, `extra-page.html` 파일에 대한 요청의 응답 헤더에 `Access-Control-Allow-Origin`과 `Access-Control-Allow-Methods` 같은 CORS 헤더가 포함된 것을 볼 수 있습니다.
    

이 실습을 통해 S3 버킷의 CORS 설정이 웹 브라우저의 교차 출처 요청을 제어하는 핵심 메커니즘임을 명확히 이해할 수 있습니다. S3 객체를 다른 웹사이트에서 사용하려면 반드시 CORS 설정을 올바르게 구성해야 합니다.