## 🗑️ 메시지 중복 제거 (Deduplication)

![[Pasted image 20250817204649.png]]

FIFO 큐는 **정확히 한 번 메시지 처리(Exactly-Once Processing)**를 보장하기 위해 메시지 중복 제거 기능을 제공합니다. 5분 내에 동일한 메시지가 두 번 전송되면 두 번째 메시지는 거부됩니다.

### 중복 제거 방법

|방법|설명|사용법|
|---|---|---|
|**콘텐츠 기반**|메시지 본문(Body)을 SHA-256 해시 함수로 변환하여 중복을 판단합니다. 동일한 본문을 가진 메시지는 동일한 해시 값을 가지므로 중복으로 간주됩니다.|큐 설정에서 **`Content-based deduplication`**을 활성화하면 자동으로 적용됩니다.|
|**메시지 ID 기반**|개발자가 직접 **`MessageDeduplicationId`**를 제공하여 중복을 판단합니다. 5분 내에 동일한 ID를 가진 메시지가 전송되면 중복으로 간주됩니다.|`SendMessage` API 호출 시 `MessageDeduplicationId` 파라미터를 명시적으로 전달합니다.|

### 동작 시뮬레이션

1. **`Content-based deduplication`**을 활성화한 FIFO 큐에 `hello world` 메시지를 전송합니다.
    
2. 큐는 이 메시지의 해시 값을 계산하고 저장합니다.
    
3. 1~5분 이내에 동일한 `hello world` 메시지를 다시 전송하면, SQS는 저장된 해시 값과 비교하여 중복을 감지하고 두 번째 메시지를 거부합니다. 큐의 메시지 수는 1개로 유지됩니다.
    
4. 만약 다른 메시지(`hello world two`)를 보내면, 다른 해시 값이 생성되므로 새로운 메시지로 인식하여 큐에 추가됩니다.
    

---

## 🗂️ 메시지 그룹핑 (Message Grouping)

FIFO 큐는 **`MessageGroupId`**를 사용하여 메시지 순서를 관리합니다. 이는 FIFO 큐를 효과적으로 활용하기 위한 필수적인 개념입니다.

### 동작 원리

- **그룹 내 순서 보장:** 동일한 `MessageGroupId`를 가진 모든 메시지는 순서가 보장되며, 단일 컨슈머에 의해 순차적으로 처리됩니다.
    
- **그룹 간 병렬 처리:** 서로 다른 `MessageGroupId`를 가진 메시지들은 동시에 여러 컨슈머에 의해 병렬로 처리될 수 있습니다. 이를 통해 전체 처리량을 향상시킬 수 있습니다.
    

### 활용 예시

- **사용자별 순서 처리:** 온라인 쇼핑몰에서 한 사용자의 주문 처리 순서가 중요한 경우, **`MessageGroupId`를 사용자 ID**로 설정할 수 있습니다.
    
    - 메시지 1: `user123`이 사과를 구매 (메시지 그룹 ID: `user123`)
        
    - 메시지 2: `user123`이 바나나를 구매 (메시지 그룹 ID: `user123`)
        
    - 메시지 3: `user234`가 오렌지를 구매 (메시지 그룹 ID: `user234`)
        
- 이 경우, `user123`의 메시지는 순서대로 처리되고, `user234`의 메시지는 `user123`의 메시지와 병렬로 처리될 수 있습니다.
    

`MessageGroupId`를 사용하면 전체 메시지에 대한 순서를 보장하지 않아도 되므로, 애플리케이션의 확장성과 처리 효율성을 극대화할 수 있습니다.