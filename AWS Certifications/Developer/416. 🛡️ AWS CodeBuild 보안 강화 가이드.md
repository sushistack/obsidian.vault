
AWS CodeBuild는 소스 코드를 컴파일하고 테스트하며 배포 패키지를 생성하는 완전 관리형 빌드 서비스입니다. CodeBuild 환경의 보안을 강화하기 위해 **민감한 정보**를 안전하게 관리하고, **VPC** 내의 리소스에 안전하게 접근하는 방법을 알아보겠습니다.

---

## 1. 🔑 CodeBuild와 비밀 정보 관리

CodeBuild 빌드 환경에 데이터베이스 비밀번호, API 키와 같은 비밀 정보를 직접 저장하는 것은 매우 위험합니다. CodeBuild는 이러한 문제를 해결하기 위해 **SSM 파라미터 스토어**와 **Secrets Manager**를 활용한 안전한 방식을 제공합니다.

### 잘못된 방법: 일반 환경 변수 사용

CodeBuild 프로젝트 설정에서 환경 변수에 `DB_PASSWORD` 값을 **평문으로 직접 입력**하는 것은 보안에 취약하며, 절대 권장되지 않습니다.

### 올바른 방법: 파라미터 스토어 또는 Secrets Manager 참조

CodeBuild는 빌드 시점에 SSM 파라미터 스토어나 Secrets Manager에서 값을 가져와 환경 변수에 주입하는 기능을 지원합니다.

1. **SSM 파라미터 스토어 사용**:
    
    - **파라미터 생성**: SSM 파라미터 스토어에 `/CodeBuild/DBPassword`와 같은 이름으로 **`SecureString`** 유형의 파라미터를 생성하고 KMS 키로 암호화합니다.
        
    - **CodeBuild 설정**: CodeBuild 프로젝트의 환경 변수 설정에서 `Type`을 `Parameter`로 선택하고, `Value`에 생성한 파라미터의 이름(예: `/CodeBuild/DBPassword`)을 입력합니다.
        
2. **Secrets Manager 사용**:
    
    - **비밀 정보 생성**: Secrets Manager에 데이터베이스 비밀번호를 포함하는 비밀 정보를 생성합니다.
        
    - **CodeBuild 설정**: 환경 변수 `Type`을 `Secrets Manager`로 선택하고, `Value`에 Secrets Manager에 저장된 비밀 정보의 ARN 또는 이름을 입력합니다.


이렇게 설정하면, CodeBuild는 빌드 시작 시 **자동으로 해당 서비스에 접근하여 값을 복호화한 후 환경 변수에 주입**합니다.

---

## 2. 🛡️ VPC 내 CodeBuild 환경 구성

기본적으로 CodeBuild는 AWS VPC 외부에서 실행됩니다. 하지만 VPC 내에 있는 리소스(예: 프라이빗 서브넷의 RDS 데이터베이스)에 접근해야 할 경우, CodeBuild를 VPC 내부에서 실행하도록 구성할 수 있습니다.

### 설정 방법

1. **VPC 선택**: CodeBuild 프로젝트 생성 시 **`Additional configuration`** 섹션의 **`VPC`** 옵션에서 CodeBuild를 실행할 VPC를 선택합니다.
    
2. **서브넷 및 보안 그룹**: VPC 내의 **서브넷**과 **보안 그룹**을 지정합니다.
    
3. **결과**: CodeBuild 환경이 지정된 VPC의 서브넷 내에 생성되어, 보안 그룹 규칙에 따라 다른 VPC 리소스에 안전하게 접근할 수 있습니다.

### 필수 IAM 권한

SSM 파라미터 스토어와 Secrets Manager를 사용하려면, CodeBuild 프로젝트의 **서비스 역할(IAM Role)**에 해당 서비스에 대한 `kms:Decrypt` 및 `ssm:GetParameter`, `secretsmanager:GetSecretValue` 권한이 부여되어야 합니다. 그렇지 않으면 빌드 중 권한 부족으로 인해 실패합니다.

---

## 3. 🌟 결론

CodeBuild의 보안은 단순한 환경 변수 설정을 넘어, **SSM 파라미터 스토어/Secrets Manager**를 통한 민감 정보 관리와 **VPC** 내에서 실행되는 빌드 환경 설정을 통해 강화될 수 있습니다. 이 두 가지 핵심 보안 기능을 활용하면, CI/CD 파이프라인의 안전성을 크게 높일 수 있습니다.