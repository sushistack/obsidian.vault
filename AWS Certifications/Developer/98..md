# 아마존 S3 객체 암호화 완벽 가이드 :lock:

아마존 S3(Simple Storage Service)는 클라우드에서 객체를 저장하고 관리하는 서비스입니다. 데이터의 보안을 위해 S3는 다양한 암호화 방법을 제공하며, 사용자는 자신의 요구사항에 맞춰 적절한 방식을 선택할 수 있습니다. 이 가이드에서는 S3 객체 암호화의 주요 네 가지 방법과 전송 중 암호화에 대해 자세히 살펴보겠습니다.

## 1. 서버 측 암호화 (Server-Side Encryption, SSE)

서버 측 암호화는 데이터를 S3에 업로드할 때 S3가 직접 데이터를 암호화하여 저장하는 방식입니다. 암호화 과정은 AWS 서버에서 이루어지며, 키 관리 방식에 따라 세 가지 종류로 나뉩니다.

### 1.1 SSE-S3 : Amazon S3 관리 키 사용

**SSE-S3**는 가장 기본적인 서버 측 암호화 방식입니다. 암호화에 사용되는 키를 AWS가 완전히 관리하고 소유합니다. 사용자는 이 키에 직접 접근할 수 없으며, AWS는 AES-256 암호화 알고리즘을 사용해 객체를 암호화합니다.

- **동작 방식:**
    
    1. 사용자가 `x-amz-server-side-encryption: AES256` 헤더를 포함하여 파일을 S3에 업로드합니다.
        
    2. S3는 AWS가 소유하고 관리하는 키를 사용하여 객체를 서버 측에서 암호화합니다.
        
    3. 암호화된 객체는 S3 버킷에 저장됩니다.
        
- **특징:**
    
    - **기본 암호화 방식:** 새로운 버킷과 객체에 대해 기본적으로 활성화되어 있습니다.
        
    - **간편성:** 사용자가 키를 관리할 필요가 없어 가장 쉽게 적용할 수 있습니다.
        
    - **헤더 사용:** 파일 업로드 시 특정 HTTP 헤더를 지정해야 암호화를 요청할 수 있습니다.
        

Bash

```
# AWS CLI를 사용하여 SSE-S3로 파일 업로드 예시
aws s3api put-object --bucket my-s3-bucket --key my-file.txt --body my-file.txt \
--server-side-encryption AES256
```

---

### 1.2 SSE-KMS : AWS KMS 관리 키 사용

**SSE-KMS**는 AWS KMS(Key Management Service)를 사용하여 암호화 키를 관리하는 방식입니다. 사용자가 직접 KMS에서 키를 생성하고 관리하며, 누가 언제 이 키를 사용했는지 AWS CloudTrail을 통해 상세하게 기록할 수 있다는 장점이 있습니다.

- **동작 방식:**
    
    1. 사용자가 `x-amz-server-side-encryption: aws:kms` 헤더와 함께 사용할 KMS 키를 지정하여 파일을 S3에 업로드합니다.
        
    2. S3는 AWS KMS에 요청하여 해당 키로 객체를 암호화합니다.
        
    3. 암호화된 객체가 S3 버킷에 저장됩니다.
        
- **특징:**
    
    - **키 제어:** 사용자가 암호화 키를 직접 제어하고 관리할 수 있습니다.
        
    - **감사(Audit) 기능:** 모든 키 사용 내역이 CloudTrail에 기록되어 보안 감사가 용이합니다.
        
    - **보안 강화:** 객체에 접근하려면 S3 객체에 대한 권한뿐만 아니라 KMS 키에 대한 권한도 필요합니다.
        
    - **요청 제한:** KMS API 호출은 초당 요청 수에 제한이 있으므로, 매우 높은 처리량(high throughput)이 필요한 경우 성능 제한(throttling)이 발생할 수 있습니다.
        

Bash

```
# AWS CLI를 사용하여 SSE-KMS로 파일 업로드 예시
aws s3api put-object --bucket my-s3-bucket --key my-file.txt --body my-file.txt \
--server-side-encryption aws:kms --sse-kms-key-id arn:aws:kms:us-east-1:123456789012:key/your-kms-key-id
```

---

### 1.3 SSE-C : 고객 제공 키 사용

**SSE-C**는 암호화에 사용되는 키를 AWS가 아닌 사용자가 직접 제공하는 방식입니다. S3는 사용자가 전송한 키를 사용하여 서버 측에서 데이터를 암호화하지만, 해당 키는 객체 암호화/복호화 작업 후 즉시 폐기하며 저장하지 않습니다.

- **동작 방식:**
    
    1. 사용자가 암호화 키와 함께 파일을 S3에 업로드합니다.
        
    2. S3는 사용자가 제공한 키를 이용해 객체를 암호화하고 저장합니다.
        
    3. 이때, 사용자는 반드시 HTTPS를 사용해야 하며, 키는 HTTP 헤더를 통해 전송됩니다.
        
- **특징:**
    
    - **외부 키 관리:** 사용자가 AWS 외부에서 키를 완전히 관리합니다.
        
    - **일회성 키 사용:** S3는 사용자가 제공한 키를 저장하지 않고 일회성으로만 사용합니다.
        
    - **HTTPS 필수:** 키가 네트워크를 통해 전송되므로 반드시 HTTPS를 사용해야 합니다.
        

|방법|키 관리 주체|키 보관 장소|사용 헤더|주요 특징|
|---|---|---|---|---|
|**SSE-S3**|AWS (S3 서비스)|AWS|`AES256`|가장 간단하고 기본적으로 활성화됨|
|**SSE-KMS**|고객 (KMS 서비스)|AWS (KMS)|`aws:kms`|키 제어 및 감사 기능 제공|
|**SSE-C**|고객 (AWS 외부)|없음 (일회성)|`x-amz-server-side-encryption-customer-key`|키를 AWS에 노출시키지 않고 제어|

## 2. 클라이언트 측 암호화 (Client-Side Encryption)

클라이언트 측 암호화는 S3에 데이터를 업로드하기 전에 사용자가 직접 데이터를 암호화하는 방식입니다. 암호화와 복호화 모두 클라이언트 단에서 이루어지므로, S3에 저장되는 데이터는 이미 암호화된 상태입니다.

- **동작 방식:**
    
    1. 사용자가 AWS SDK와 같은 클라이언트 라이브러리를 사용해 로컬에서 파일을 암호화합니다.
        
    2. 암호화된 파일을 S3에 업로드합니다.
        
    3. 데이터를 다운로드할 때도 S3에서 암호화된 데이터를 받아 클라이언트에서 직접 복호화합니다.
        
- **특징:**
    
    - **완전한 키 제어:** 사용자가 키와 암호화/복호화 프로세스를 완전히 관리합니다. AWS는 암호화된 데이터만 저장합니다.
        
    - **S3의 역할 제한:** S3는 암호화된 객체를 그대로 저장하고 전달하는 역할만 수행합니다.
        

## 3. 전송 중 암호화 (Encryption in Transit) :airplane:

전송 중 암호화는 클라이언트와 S3 버킷 간에 데이터가 전송되는 동안 데이터를 보호하는 것을 의미합니다. 이를 위해 **SSL/TLS(HTTPS)** 프로토콜을 사용합니다. S3는 HTTP(암호화되지 않음)와 HTTPS(암호화됨) 두 가지 엔드포인트를 제공하며, 데이터 보안을 위해 항상 HTTPS 사용을 권장합니다.

- **HTTPS 필수:** 특히 SSE-C를 사용하는 경우, 키를 전송해야 하므로 HTTPS 사용이 필수적입니다.
    
- **강제 적용:** 버킷 정책(Bucket Policy)을 사용하여 HTTP 요청을 거부하고 HTTPS만 허용하도록 강제할 수 있습니다.
    

JSON

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "ForceSSLOnlyAccess",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-s3-bucket",
        "arn:aws:s3:::my-s3-bucket/*"
      ],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}
```

위의 정책은 `aws:SecureTransport` 조건이 `false`일 때, 즉 HTTPS가 아닌 HTTP로 요청이 들어올 경우 모든 `s3:*` 작업을 거부합니다. 이 정책을 적용하면 버킷에 대한 모든 HTTP 요청이 차단되어 보안이 강화됩니다.