## 소개: AWS CloudWatch Logs란?

AWS CloudWatch Logs는 AWS 환경에서 실행되는 애플리케이션, 서비스, 시스템의 로그를 중앙에서 손쉽게 수집, 모니터링, 저장 및 분석할 수 있게 해주는 서비스입니다. 개발자와 시스템 관리자가 로그 데이터를 효과적으로 관리하고 문제를 빠르게 진단할 수 있도록 도와줍니다.

---

## 🏗️ CloudWatch Logs의 기본 구조

CloudWatch Logs는 논리적으로 **로그 그룹(Log Group)**과 **로그 스트림(Log Stream)**이라는 두 가지 핵심 개념으로 구성됩니다.

### 로그 그룹 (Log Group)

- **역할**: 애플리케이션이나 서비스 별로 로그를 모아두는 논리적 컨테이너입니다.
    
- **특징**:
    
    - 사용자가 원하는 대로 이름을 지정할 수 있습니다.
    - 일반적으로 하나의 애플리케이션 또는 서비스 단위를 나타냅니다.
    - 로그 보존 정책(Retention Policy)을 설정하여 로그를 무기한 저장하거나, 1일에서 10년 사이의 특정 기간 동안만 보관할 수 있습니다.

### 로그 스트림 (Log Stream)

- **역할**: 특정 로그 그룹 내에서 개별 인스턴스, 파일, 컨테이너 등의 로그 이벤트를 저장하는 시퀀스입니다.
    
- **특징**:
    
    - 하나의 애플리케이션 내에서 여러 소스(예: 각기 다른 EC2 인스턴스, ECS 컨테이너)의 로그를 구분하는 데 사용됩니다.
    - 각 로그 스트림은 특정 로그 소스를 대표합니다.

|구조|설명|예시|
|---|---|---|
|**로그 그룹**|특정 애플리케이션의 모든 로그를 담는 통|`my-web-application`|
|**로그 스트림**|특정 인스턴스 또는 컨테이너의 로그를 담는 통|`i-1a2b3c4d`, `container-id-01`|

---

## 📤 로그 데이터 수집 방법

다양한 AWS 서비스와 도구를 통해 CloudWatch Logs로 로그 데이터를 손쉽게 보낼 수 있습니다.

### CloudWatch Agent

- **CloudWatch Unified Agent**: 현재 권장되는 로그 수집 방법입니다. EC2 인스턴스, 온프레미스 서버 등에서 시스템 메트릭과 로그를 수집하여 CloudWatch로 전송합니다. 기존의 CloudWatch Logs Agent를 대체하는 통합 에이전트입니다.
    

### AWS 서비스 통합

- **Elastic Beanstalk**: 애플리케이션 로그를 CloudWatch로 자동 전송합니다.
- **ECS/EKS**: 컨테이너의 로그를 CloudWatch로 직접 보낼 수 있습니다.
- **Lambda**: 람다 함수 실행 로그가 자동으로 CloudWatch로 전송됩니다.
- **VPC Flow Logs**: VPC 네트워크 트래픽에 대한 메타데이터 로그를 전송합니다.
- **API Gateway**: API 요청 및 응답 로그를 전송합니다.
- **CloudTrail**: CloudTrail 로그를 필터링하여 특정 이벤트를 CloudWatch로 보낼 수 있습니다.
- **Route 53**: DNS 쿼리 로그를 전송합니다.

---

## 🔍 로그 데이터 분석 및 검색: CloudWatch Logs Insights

![[Pasted image 20250823121642.png]]

CloudWatch Logs Insights는 CloudWatch Logs에 저장된 로그 데이터를 대화식으로 탐색하고 분석할 수 있는 강력한 쿼리 엔진입니다.

### 주요 기능

- **쿼리 언어**: 목적에 맞게 설계된 쿼리 언어를 사용하여 로그를 검색하고 분석합니다.
- **자동 필드 감지**: 로그 필드를 자동으로 감지하여 쿼리 작성을 돕습니다.
- **다양한 분석**: `filter`, `stats`, `sort`, `limit` 등의 명령어를 사용하여 특정 조건에 맞는 로그를 필터링하거나, 통계 값을 계산하고, 이벤트를 정렬할 수 있습니다.
- **시각화**: 쿼리 결과를 시각화하여 데이터의 패턴을 쉽게 파악할 수 있습니다.
- **쿼리 저장**: 자주 사용하는 쿼리를 저장하고, CloudWatch 대시보드에 추가하여 재사용할 수 있습니다.
- **다중 로그 그룹 쿼리**: 여러 로그 그룹의 데이터를 한 번에 쿼리할 수 있어 로그 통합 분석이 용이합니다.

### 예시 쿼리

가장 최근에 발생한 25개의 로그 이벤트를 검색하는 쿼리입니다.

```SQL
fields @timestamp, @message
| sort @timestamp desc
| limit 25
```

로그에 `ERROR` 또는 `Exception`이 포함된 이벤트를 찾아 집계하는 쿼리입니다.

```SQL
fields @timestamp, @message
| filter @message like /ERROR/ or @message like /Exception/
| stats count() as error_count
| sort error_count desc
```

🚨 **주의**: CloudWatch Logs Insights는 실시간 쿼리 엔진이 아닌 **이력 데이터**를 분석하는 도구입니다. 쿼리를 실행하는 시점에 이미 저장된 로그를 대상으로 작동합니다.

---

## 🚚 로그 데이터 내보내기 및 스트리밍

CloudWatch Logs의 데이터를 다른 AWS 서비스로 내보내거나 실시간으로 스트리밍하여 다양한 용도로 활용할 수 있습니다.

### 배치 내보내기 (Batch Export)

- **대상**: Amazon S3
- **특징**: 대량의 로그 데이터를 S3 버킷으로 비동기적으로 내보냅니다.
- **API**: `CreateExportTask`를 사용합니다.
- **시간**: 내보내기 완료까지 최대 12시간이 소요될 수 있습니다. 실시간 처리가 아닌, 대규모 아카이빙 목적에 적합합니다.
    

### 실시간 스트리밍 (Real-time Streaming)

![[Pasted image 20250824204353.png]]

- **CloudWatch Logs Subscription Filter**: 로그 이벤트를 실시간으로 다른 서비스로 스트리밍할 수 있게 해주는 기능입니다.
    
- **대상**:
    
    - **Kinesis Data Streams**: 실시간 데이터 분석 및 처리에 적합합니다.
    - **Kinesis Data Firehose**: S3, OpenSearch Service 등 다양한 대상으로 로그를 손쉽게 전송할 수 있습니다.
    - **Lambda**: 사용자 지정 람다 함수를 통해 로그 데이터를 실시간으로 가공하고 처리할 수 있습니다.

- **로그 통합**: 여러 계정 및 리전의 로그를 하나의 중앙 계정으로 통합하여 관리할 수 있습니다.
    
- **작동 방식**:
    
    1. **발신 계정**: CloudWatch Logs 구독 필터를 생성합니다.
    2. **수신 계정**: Kinesis Data Stream과 같은 대상 서비스를 준비하고, 해당 스트림을 가리키는 `Destination`을 생성합니다.
    3. `Destination Access Policy`를 설정하여 발신 계정의 로그 전송을 허용합니다.
    4. 발신 계정에서 `IAM Role`을 생성하여 로그를 전송할 수 있는 권한을 부여하고, 이 역할을 수신 계정이 `Assume`하도록 설정합니다.

이러한 메커니즘을 통해 복잡한 로그 집계 및 분석 파이프라인을 구축할 수 있습니다.

---

## 🛡️ 데이터 보안 및 암호화

CloudWatch Logs에 저장되는 모든 로그는 기본적으로 AWS에 의해 암호화됩니다. 사용자는 추가적으로 AWS KMS(Key Management Service)를 사용하여 직접 관리하는 암호화 키로 로그를 암호화할 수도 있습니다. 이는 민감한 데이터에 대한 보안 요구사항을 충족시키는 데 유용합니다.