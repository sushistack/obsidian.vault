
## 🎨 CodePipeline이란 무엇인가?

**AWS CodePipeline**은 AWS에서 제공하는 완전 관리형 **지속적 통합 및 배포(CI/CD)** 서비스입니다. 개발자가 정의한 워크플로우에 따라 소스 코드 변경 사항을 자동으로 빌드, 테스트, 배포하는 과정을 시각적으로 보여주고 관리하는 도구입니다.

### 🧱 CodePipeline의 구성 요소

CodePipeline은 다양한 **스테이지(Stage)**와 **액션(Action)**으로 구성됩니다. 각 스테이지는 순차적 또는 병렬적으로 실행되는 여러 액션을 포함할 수 있습니다.

- **소스(Source) ➡️**: 코드 소스를 가져오는 단계입니다.
    
    - **AWS 서비스**: CodeCommit, ECR(Elastic Container Registry), S3 등
        
    - **외부 서비스**: GitHub, Bitbucket 등
        
- **빌드(Build) 🛠️**: 소스 코드를 실행 가능한 형태로 변환하는 단계입니다.
    
    - **도구**: CodeBuild, Jenkins, CloudBees 등
        
- **테스트(Test) ✅**: 빌드된 코드의 품질을 검증하는 단계입니다.
    
    - **도구**: CodeBuild, Device Farm(모바일 앱 테스트) 등
        
- **배포(Deploy) 🚀**: 최종 산출물을 실제 환경에 배포하는 단계입니다.
    
    - **도구**: CodeDeploy, Beanstalk, CloudFormation, ECS, S3 등
        
- **호출(Invoke) 💡**: Lambda 함수나 Step Function과 같은 AWS 서비스를 호출하는 단계입니다.
    

### 🔄 CI/CD 파이프라인 예시

CodePipeline을 사용하면 복잡한 CI/CD 워크플로우를 쉽게 구성할 수 있습니다. 예를 들어, 다음과 같은 과정을 자동화할 수 있습니다.

1. **빌드**: 코드를 빌드합니다.
    
2. **테스트**: 빌드된 코드를 테스트합니다.
    
3. **스테이징 배포**: 테스트가 완료된 코드를 스테이징(Staging) 환경에 배포합니다.
    
4. **부하 테스트**: 스테이징 환경에서 부하 테스트를 수행하여 성능을 검증합니다.
    
5. **수동 승인(Manual Approval) ✍️**: 운영(Production) 환경에 배포하기 전에 수동으로 승인 과정을 거칩니다.
    
6. **운영 배포**: 승인이 완료되면 최종적으로 운영 환경에 배포합니다.
    

이처럼 **수동 승인** 단계를 추가하여 중요한 배포를 사람이 직접 확인하도록 설정할 수도 있습니다.

---

## 📦 CodePipeline의 내부 작동 원리: 아티팩트와 S3


![[Pasted image 20250908233251.png]]
CodePipeline의 각 스테이지는 **아티팩트(Artifact)**라는 개념을 통해 서로 데이터를 주고받습니다. 아티팩트는 코드, 빌드된 파일, 배포 패키지 등 파이프라인을 거치며 생성되는 모든 산출물을 의미합니다.

### 🔗 S3를 통한 아티팩트 전달 과정

CodePipeline은 각 스테이지에서 생성된 아티팩트를 **S3 버킷**에 저장하고, 다음 스테이지는 해당 S3 버킷에서 아티팩트를 가져와 작업을 수행합니다.

|단계|작동 방식|아티팩트 흐름|
|---|---|---|
|**소스**|개발자가 CodeCommit에 코드를 **푸시(Push)**합니다.|CodePipeline이 코드를 가져와 `소스 아티팩트`를 생성하고 S3에 저장합니다.|
|**빌드**|CodePipeline은 S3 버킷에서 `소스 아티팩트`를 가져와 CodeBuild에 전달합니다.|CodeBuild는 코드를 빌드하고 `배포 아티팩트`를 생성, CodePipeline이 이를 S3에 저장합니다.|
|**배포**|CodePipeline은 S3 버킷에서 `배포 아티팩트`를 가져와 CodeDeploy에 전달합니다.|CodeDeploy는 아티팩트를 최종 환경에 배포합니다.|

이러한 과정을 통해 각 스테이지는 직접적으로 서로 의존하지 않고, S3를 통해 독립적으로 아티팩트를 주고받으며 유연하게 연결됩니다. 즉, CodePipeline이 전체 워크플로우를 **오케스트레이션(Orchestration)**하는 역할을 담당합니다.

---

## ❗ CodePipeline 문제 해결 및 모니터링

CodePipeline을 사용하면서 발생할 수 있는 문제들은 AWS의 다른 서비스들과 연동하여 해결할 수 있습니다.

### 1. CloudWatch Events / EventBridge를 활용한 모니터링

파이프라인의 상태 변화를 실시간으로 추적하고 알림을 받으려면 **CloudWatch Events** 또는 **EventBridge**를 사용합니다.

- **활용 예시**:
    
    - 파이프라인 실패 시 이벤트 생성 및 이메일 알림 받기
        
    - 특정 스테이지 취소 시 알림 설정


```JSON
{
  "source": ["aws.codepipeline"],
  "detail-type": ["CodePipeline Action Execution State Change"],
  "detail": {
    "state": ["FAILED"]
  }
}
```

위와 같은 이벤트 규칙을 생성하여 실패한 파이프라인을 즉시 파악할 수 있습니다.

### 2. IAM 권한 확인

CodePipeline이 다른 AWS 서비스(예: CodeCommit, CodeBuild, S3)와 상호 작용하려면 올바른 **IAM 서비스 역할(IAM Service Role)** 권한이 필요합니다.

- 파이프라인이 소스 코드를 가져오거나, 빌드 서비스를 호출하거나, 아티팩트를 S3에 저장할 수 없는 경우, CodePipeline의 IAM 역할이 필요한 권한을 가지고 있는지 반드시 확인해야 합니다.
    

### 3. CloudTrail을 통한 API 호출 감사

CodePipeline이 어떤 AWS API를 호출했는지 상세히 확인하려면 **CloudTrail**을 사용합니다.

- API 호출 거부(Access Denied)와 같은 오류가 발생했을 때, CloudTrail 로그를 분석하여 원인을 파악할 수 있습니다.
    

CodePipeline은 복잡한 CI/CD 과정을 자동화하고 시각화하는 강력한 도구이며, AWS의 다양한 서비스와 유기적으로 결합하여 유연하고 확장 가능한 파이프라인을 구축할 수 있게 해줍니다.