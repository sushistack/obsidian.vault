
이번 실습에서는 Amazon ECS에서 컨테이너를 실행하기 위한 **태스크 정의(Task Definition)**를 생성하는 과정을 단계별로 진행합니다. 이 과정을 통해 다양한 설정 옵션들을 직접 확인하고 구성해 보겠습니다.

---

### 1단계: 새 태스크 정의 생성 시작 🚀

1. AWS **ECS 콘솔**로 이동합니다.
2. 왼쪽 탐색 메뉴에서 **`태스크 정의(Task Definitions)`**를 선택합니다.
3. **`새 태스크 정의 생성(Create new task definition)`** 버튼을 클릭합니다.
4. **`태스크 정의 패밀리(Task definition family)`**에 `wordpress`와 같이 태스크 정의의 이름을 지정합니다.

---

### 2단계: 인프라 및 리소스 설정 ⚙️

태스크가 실행될 환경과 필요한 리소스를 정의합니다.

1. **인프라 요구사항(Infrastructure requirements):**
    
    - `Fargate` 또는 `Amazon EC2` 중 원하는 시작 유형을 선택합니다.
    - **Fargate**를 선택하면, **`운영 체제/아키텍처`**를 선택하고, **`태스크 크기(Task size)`** 섹션에서 `vCPU`와 `메모리(Memory)`의 값을 드롭다운 메뉴에서 지정합니다.
    - **Amazon EC2**를 선택하면, `vCPU`와 `메모리` 값을 자유롭게 입력할 수 있습니다.

2. **IAM 역할:**
    - **`태스크 역할(Task role)`:** 컨테이너가 다른 AWS 서비스에 접근하는 데 필요한 권한을 부여합니다.
    - **`태스크 실행 역할(Task execution role)`:** ECS 에이전트가 ECR 이미지 가져오기, CloudWatch 로그 전송 등을 수행하는 데 필요한 권한을 부여합니다.

---

### 3단계: 컨테이너 추가 및 설정 📦

태스크 내에서 실행될 컨테이너에 대한 세부 정보를 구성합니다.

1. **`컨테이너(Container)`** 섹션에서 **`컨테이너 추가(Add container)`**를 클릭합니다.
2. **`이름(Name)`:** 컨테이너의 이름을 지정합니다. (예: `wordpress`)
3. **`이미지 URI(Image URI)`:** Docker 이미지의 경로를 입력합니다. (예: `wordpress:latest`)
4. **`필수(Essential)`:** 이 컨테이너가 중지되었을 때 태스크를 중지시킬지 여부를 결정합니다. 기본적으로 활성화되어 있습니다.
5. **`포트 매핑(Port mappings)`:**
    - **`컨테이너 포트(Container port)`:** 컨테이너가 노출하는 포트(예: `80`)를 입력합니다.
    - **`호스트 포트(Host port)`:** EC2 시작 유형에서만 사용되며, `컨0`으로 설정하면 동적으로 포트가 할당됩니다.
6. **`환경(Environment)`:**
    - **`환경 변수(Environment variables)`:** `이름`과 `값`을 직접 입력하거나, `valueFrom`을 통해 `Secrets Manager`나 `SSM Parameter Store`의 값을 참조할 수 있습니다.
    - **`파일에서(From file)`:** S3 버킷에 있는 파일에서 환경 변수를 일괄적으로 로드할 수 있습니다.
7. **`로깅(Logging)`:** 로그를 `CloudWatch Logs`로 보내거나 `FireLens`를 사용하여 다른 목적지(S3, Splunk 등)로 보낼 수 있습니다.
8. **`헬스 체크(HealthCheck)`:** 컨테이너의 상태를 확인하기 위한 명령 및 설정을 정의합니다.
9. **`스토리지(Storage)`:**
    - **`볼륨(Volumes)`:** `바인드 마운트(Bind mount)` 또는 `EFS 파일 시스템`을 정의하여 컨테이너에 마운트할 수 있습니다.
    - **`마운트 지점(Mount points)`:** 정의한 볼륨을 컨테이너 내의 특정 경로에 마운트합니다.

---

### 4단계: 태스크 정의 생성 완료 ✅

모든 설정을 마친 후, **`생성(Create)`** 버튼을 클릭하여 태스크 정의를 완료합니다. 생성된 태스크 정의는 JSON 형식으로 요약되어 표시되며, 이를 통해 구성 내용을 한눈에 확인할 수 있습니다. 이제 이 태스크 정의를 사용하여 ECS 서비스나 배치 태스크를 배포할 수 있습니다.