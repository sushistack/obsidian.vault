
AWS 클라우드 환경에서는 수많은 **API 호출**이 발생하며, 이러한 호출을 효율적으로 모니터링하고 관리하는 것은 보안 및 운영 측면에서 매우 중요합니다. 이번 아티클에서는 AWS의 두 가지 핵심 서비스인 **CloudTrail**과 **Amazon EventBridge**를 연동하여 특정 API 호출 발생 시 자동으로 알림을 받는 방법에 대해 자세히 알아보겠습니다.

---

## 🧐 CloudTrail과 EventBridge는 무엇인가요?

먼저, 두 서비스의 역할을 간단히 살펴보겠습니다.

![[Pasted image 20250825221051.png]]

- **AWS CloudTrail**: CloudTrail은 AWS 계정의 모든 API 활동을 기록하는 서비스입니다. 사용자가 AWS Management Console, CLI, SDK를 통해 수행하는 모든 작업(예: EC2 인스턴스 시작, S3 버킷 생성, IAM 역할 변경 등)은 CloudTrail에 로그로 남습니다. 이는 계정 활동에 대한 완전한 가시성을 제공하여 보안 분석, 거버넌스, 규정 준수 및 운영 감사를 지원합니다. 모든 AWS API 호출은 기본적으로 CloudTrail에 자동으로 기록됩니다.


![[Pasted image 20250825220946.png]]


- **Amazon EventBridge**: EventBridge는 AWS 서비스, SaaS 애플리케이션, 또는 사용자 지정 애플리케이션의 데이터를 기반으로 실시간으로 이벤트를 수신하고, 이를 규칙(Rule)에 따라 특정 대상으로 라우팅하는 서버리스 이벤트 버스입니다. EventBridge는 **CloudTrail이 기록한 API 호출 로그를 이벤트로 수신**하여, 원하는 조건에 맞는 이벤트를 필터링하고 다양한 대상(Target)으로 보낼 수 있는 강력한 기능을 제공합니다.

---

## 🛠️ 연동의 핵심 원리: 어떻게 동작하나요?

![[Pasted image 20250825221028.png]]

CloudTrail과 EventBridge의 연동은 다음과 같은 간단한 흐름으로 이루어집니다.

1. **API 호출 발생**: 사용자가 AWS 환경에서 특정 작업을 수행합니다. 예를 들어, DynamoDB에서 테이블을 삭제하기 위해 `DeleteTable` API를 호출합니다.

2. **CloudTrail 로그 기록**: 이 API 호출은 즉시 CloudTrail에 기록됩니다. 모든 API 호출이 CloudTrail 로그 파일에 저장됩니다.

3. **EventBridge로 이벤트 전송**: CloudTrail에 기록된 모든 API 호출은 자동으로 EventBridge의 **기본 이벤트 버스(default event bus)**로 이벤트 형태로 전송됩니다. 이 과정은 별도의 설정 없이 자동으로 이루어집니다.

4. **EventBridge 규칙 생성**: 사용자는 EventBridge에서 특정 이벤트 패턴을 감지하는 규칙을 생성합니다. 예를 들어, 소스(Source)가 `aws.dynamodb`이고, 상세 타입(DetailType)이 `AWS API Call via CloudTrail`이며, 이벤트명(EventName)이 `DeleteTable`인 이벤트를 필터링하는 규칙을 만듭니다.

5. **알림 대상 지정**: 이 규칙이 감지되면, 사전에 정의된 대상(Target)으로 이벤트가 전달됩니다. 예를 들어, Amazon SNS(Simple Notification Service) 토픽을 대상으로 지정하면, 이메일, SMS 등으로 알림을 받을 수 있습니다.


이러한 연동을 통해 특정 API 호출을 실시간으로 감지하고, 이에 대한 자동화된 알림 또는 작업을 트리거할 수 있습니다.

---

## 🚨 실제 시나리오: DynamoDB 테이블 삭제 알림 설정

DynamoDB 테이블 삭제는 중요한 운영 작업이므로, 이 작업이 발생할 때마다 팀에게 알림을 보내는 시나리오를 통해 연동 방법을 자세히 살펴보겠습니다.

### 1단계: DynamoDB `DeleteTable` 이벤트 패턴 정의

EventBridge에서 특정 API 호출을 필터링하려면 **이벤트 패턴**을 정확하게 정의해야 합니다. `DeleteTable` API 호출에 대한 이벤트 패턴은 다음과 같습니다.

```JSON
{
  "source": ["aws.dynamodb"],
  "detail-type": ["AWS API Call via CloudTrail"],
  "detail": {
    "eventSource": ["dynamodb.amazonaws.com"],
    "eventName": ["DeleteTable"]
  }
}
```

- `source`: 이벤트를 발생시킨 서비스. CloudTrail을 통해 들어오는 AWS 서비스 이벤트는 대부분 `aws.` 접두사를 사용합니다. DynamoDB의 경우 `aws.dynamodb`입니다.

- `detail-type`: 이벤트의 세부 유형. CloudTrail API 호출의 경우 `AWS API Call via CloudTrail`입니다.

- `detail`: 이벤트의 상세 정보. `eventSource`는 API 호출의 실제 엔드포인트이며, `eventName`은 호출된 API의 이름입니다.

### 2단계: EventBridge 규칙 생성

1. **EventBridge 콘솔**로 이동하여 **규칙(Rules)** 메뉴를 선택합니다.

2. **규칙 생성(Create rule)** 버튼을 클릭합니다.

3. **규칙 이름**을 지정합니다(예: `DynamoDB-DeleteTable-Alert`).

4. **이벤트 버스**는 `default`로 설정합니다.

5. **이벤트 패턴** 섹션에서 위에서 정의한 JSON 패턴을 직접 붙여넣습니다.

6. **대상(Target)** 섹션에서 `SNS 토픽`을 선택하고, 미리 생성해 둔 SNS 토픽을 지정합니다.

### 3단계: SNS 토픽 및 구독 설정

아직 SNS 토픽이 없다면, EventBridge 규칙을 생성하기 전에 미리 만들어야 합니다.

|단계|설명|
|---|---|
|**토픽 생성**|**Amazon SNS 콘솔**에서 **토픽(Topics)** 메뉴로 이동하여 `Standard` 토픽을 생성합니다. (예: `Critical-Ops-Alerts`)|
|**구독 추가**|생성한 토픽을 클릭하여 **구독(Subscriptions)**을 추가합니다. 프로토콜로 `이메일`을 선택하고, 알림을 받을 이메일 주소를 입력합니다.|
|**구독 확인**|입력한 이메일 주소로 전송된 **확인 링크**를 클릭하여 구독을 활성화합니다.|

---

## 💡 추가적인 활용 사례

CloudTrail과 EventBridge 연동은 매우 다양한 시나리오에 적용할 수 있습니다. 아래는 몇 가지 유용한 활용 사례입니다.

|**시나리오**|**설명**|**필요한 이벤트 패턴**|
|---|---|---|
|**IAM 역할 탈취 경고**|특정 사용자가 **AssumeRole** API를 호출할 때마다 알림을 받아 보안 문제를 조기에 감지합니다.|`{"source": ["aws.iam"], "detail-type": ["AWS API Call via CloudTrail"], "detail": {"eventName": ["AssumeRole"]}}`|
|**보안 그룹 변경 감지**|EC2 보안 그룹의 인바운드 규칙이 변경될 때 알림을 받습니다. (예: `AuthorizeSecurityGroupIngress` API 호출)|`{"source": ["aws.ec2"], "detail-type": ["AWS API Call via CloudTrail"], "detail": {"eventName": ["AuthorizeSecurityGroupIngress"]}}`|
|**민감한 리소스 삭제 알림**|S3 버킷, RDS 데이터베이스 등 중요한 리소스가 삭제될 때 알림을 받습니다. (예: `DeleteBucket`, `DeleteDBInstance`)|`{"source": ["aws.s3"], "detail-type": ["AWS API Call via CloudTrail"], "detail": {"eventName": ["DeleteBucket"]}}`|

이처럼 CloudTrail과 EventBridge를 연동하면 AWS 계정의 **보안 및 운영 가시성을 크게 향상**시킬 수 있습니다. 원하는 API 호출을 감지하고, 이를 기반으로 자동화된 알림 또는 후속 작업을 설정하여 클라우드 환경을 더욱 안전하고 효율적으로 관리해 보세요.