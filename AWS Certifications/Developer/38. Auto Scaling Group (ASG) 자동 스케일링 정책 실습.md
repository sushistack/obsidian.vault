
이전 실습에서 ASG의 기본 동작을 확인했습니다. 이제 ASG의 핵심인 **자동 스케일링 정책**을 설정하고, 실제 트래픽 부하를 통해 인스턴스 수가 자동으로 조절되는 과정을 심도 있게 살펴보겠습니다. ASG는 **다이내믹 스케일링**, **예측 스케일링**, **예약된 작업**의 세 가지 주요 정책 유형을 제공합니다.

---

### 1. ASG 자동 스케일링 정책 카테고리 이해

ASG의 자동 스케일링 정책은 크게 세 가지 범주로 나뉩니다.

#### 1.1. 예약된 작업 (Scheduled Actions)

- **설명:** 미래의 특정 시점에 ASG의 최소, 희망, 최대 용량을 변경하도록 미리 예약하는 정책입니다.
    
- **활용:** 블랙프라이데이, 특정 프로모션 등 **예측 가능하고 정해진 시점에 트래픽 변화가 예상될 때** 유용합니다. (예: 매주 금요일 오후 5시에 최소 인스턴스 수를 10으로 증가)
    
- **설정:** 원하는 용량, 최소 용량, 최대 용량을 지정하고, 반복 주기(한 번, 매일, 매주 등)와 시작/종료 시간을 설정합니다.

#### 1.2. 예측 스케일링 정책 (Predictive Scaling Policies)

- **설명:** 머신러닝을 사용하여 과거 트래픽 패턴을 분석하고 미래의 로드를 예측하여, ASG가 해당 예측에 따라 인스턴스 수를 미리 조절하도록 하는 정책입니다.
    
- **활용:** **주기적으로 반복되는 트래픽 패턴(예: 매일 아침 출근 시간 트래픽 증가)**이 있는 경우, 미리 인스턴스를 준비하여 서비스 지연을 방지할 수 있습니다.
    
- **설정:** 스케일링할 지표(예: CPU 사용률, 네트워크 입/출력, ALB 요청 수)와 목표 사용률(예: CPU 50%)을 지정하면, ASG가 자동으로 과거 데이터를 기반으로 예측 및 스케줄링을 수행합니다.
    
- **참고:** 이 정책은 충분한 과거 데이터가 필요하므로, 단기 실습으로는 직접적인 동작 확인이 어렵습니다.

#### 1.3. 다이내믹 스케일링 정책 (Dynamic Scaling Policies)

- **설명:** CloudWatch 알람을 기반으로 실시간 지표 변화에 반응하여 ASG를 확장 또는 축소하는 정책입니다.
    
- **유형:**
    - **대상 추적 스케일링 (Target Tracking Scaling):** 특정 지표를 목표 값으로 유지하도록 ASG가 인스턴스 수를 자동으로 조절합니다. 설정이 매우 간단하고 가장 권장되는 방식입니다.
        
    - **단순 스케일링 (Simple Scaling):** CloudWatch 알람이 트리거되면 사전에 정의된 특정 단위(예: 2개 인스턴스 추가, 10% 그룹 확장)만큼 스케일링을 수행합니다. 한 번 실행되면 쿨다운 기간 동안 추가 스케일링은 무시됩니다.
        
    - **스텝 스케일링 (Step Scaling):** CloudWatch 알람의 임계값 범위에 따라 스케일링 단위를 다르게 설정할 수 있어 더 세밀한 제어가 가능합니다 (예: CPU 70% 초과 시 1대 추가, 90% 초과 시 2대 추가).

---

### 2. 다이내믹 스케일링 정책: 대상 추적 스케일링 실습

가장 강력하고 일반적으로 사용되는 **대상 추적 스케일링** 정책을 직접 설정하고 동작을 확인해 보겠습니다. 이 정책은 CloudWatch 알람을 자동으로 생성해 줍니다.

#### 2.1. ASG 설정 변경: 최대 용량 늘리기

대상 추적 스케일링이 인스턴스를 추가할 수 있도록 ASG의 최대 용량을 늘려야 합니다.

1. AWS 콘솔에서 **Auto Scaling Groups**로 이동하여 `Demo ASG`를 선택합니다.
2. **"Edit"**을 클릭합니다.
3. **"Maximum capacity"**를 `3` (또는 `2` 이상)으로 변경합니다.
4. **"Update"**를 클릭하여 저장합니다.

#### 2.2. 대상 추적 스케일링 정책 생성

1. `Demo ASG` 상세 페이지에서 **"Automatic scaling"** 탭을 클릭합니다.
2. **"Create dynamic scaling policy"**를 클릭합니다.
3. **"Policy type"**에서 **"Target tracking scaling"**을 선택합니다.
4. **"Policy name"**에 `target-tracking-policy`를 입력합니다.
5. **"Metric type"**에서 **"Average CPU utilization"**을 선택합니다.
6. **"Target value"**에 `40`을 입력합니다. (ASG 전체의 평균 CPU 사용률을 40%로 유지하려고 시도합니다.)
7. **"Create"**를 클릭하여 정책을 생성합니다.
    - 이 정책을 생성하면, ASG는 자동으로 CPU 사용률이 40%를 초과할 때 스케일 아웃(AlarmHigh)하고, 28% 미만으로 떨어질 때 스케일 인(AlarmLow)하는 CloudWatch 알람을 생성합니다.

#### 2.3. EC2 인스턴스에 CPU 부하 주기 (스케일 아웃 유도)

현재 ASG에는 1개의 인스턴스만 실행 중이며 CPU 사용률은 거의 0%일 것입니다. 이제 이 인스턴스에 고의로 CPU 부하를 주어 스케일 아웃을 유도해 봅시다.

1. EC2 콘솔의 **"Instances"** 탭으로 이동하여 `Demo ASG`가 관리하는 EC2 인스턴스 (현재 1개)를 선택합니다.
2. **"Connect"**를 클릭하고 **"EC2 Instance Connect"**를 통해 인스턴스에 접속합니다.
3. SSH 터미널에서 다음 명령어를 실행하여 `stress` 도구를 설치합니다.

```bash
sudo yum update -y
sudo amazon-linux-extras install epel -y
sudo yum install -y stress
```

4. `stress` 도구를 사용하여 CPU에 부하를 줍니다. (예: 4개의 가상 CPU를 100% 사용)

```bash
stress -c 4
```
    
이 명령어를 실행하면 인스턴스의 CPU 사용률이 급격히 100% 가까이 상승할 것입니다.

#### 2.4. 스케일 아웃 동작 확인

이제 ASG가 CPU 사용률 증가에 반응하여 스케일 아웃하는지 확인합니다.

1. ASG 콘솔로 돌아와 `Demo ASG`를 선택합니다.
    
2. **"Monitoring"** 탭에서 **"CPU utilization (Average)"** 그래프를 확인합니다. CPU 사용률이 40% 이상으로 올라가는지 지켜봅니다.
    
3. **"Activity"** 탭의 **"Activity history"**를 주기적으로 새로 고침합니다.
    
4. CPU 사용률이 충분히 높아지면, ASG가 새로운 인스턴스를 **"Launching"**하는 활동을 기록하는 것을 볼 수 있습니다. (CPU 사용률이 알람 임계값을 3분간 초과해야 트리거됩니다.)
    
5. **"Instance management"** 탭으로 이동하면, 새로운 EC2 인스턴스가 추가되어 총 2개의 인스턴스가 실행 중임을 확인할 수 있습니다.
    

#### 2.5. CloudWatch 알람 확인

대상 추적 정책은 스케일 아웃 및 스케일 인을 위한 CloudWatch 알람을 자동으로 생성합니다.

1. AWS 콘솔에서 **CloudWatch** 서비스로 이동합니다.
    
2. 왼쪽 탐색 창에서 **"Alarms"**를 클릭합니다.
    
3. `TargetTracking-target-tracking-policy-AlarmHigh-[ASG ID]` 및 `TargetTracking-target-tracking-policy-AlarmLow-[ASG ID]`와 같은 이름의 알람이 생성된 것을 확인할 수 있습니다.
    
    - `AlarmHigh`는 CPU 사용률이 40%를 초과할 때 트리거되어 스케일 아웃을 유도합니다.
        
    - `AlarmLow`는 CPU 사용률이 28% 미만으로 떨어질 때 트리거되어 스케일 인을 유도합니다.
        
4. `AlarmHigh` 알람이 "In Alarm" 상태로 변경된 것을 확인할 수 있습니다.
    

#### 2.6. EC2 인스턴스 CPU 부하 중단 (스케일 인 유도)

이제 `stress` 명령어를 중지하여 CPU 사용률을 낮추고 스케일 인을 유도해 봅시다.

1. EC2 인스턴스 SSH 터미널로 돌아가 `stress -c 4` 명령어를 중지합니다 (일반적으로 `Ctrl+C`).
    
2. 또는, 더 확실하게 CPU 부하를 중단하기 위해 해당 EC2 인스턴스를 **재부팅(Reboot)**할 수 있습니다. EC2 콘솔에서 인스턴스를 선택하고 **"Instance state" -> "Reboot instance"**를 클릭합니다.
    

#### 2.7. 스케일 인 동작 확인

CPU 사용률이 낮아지면 ASG가 스케일 인 하는지 확인합니다.

1. ASG 콘솔로 돌아와 **"Monitoring"** 탭에서 CPU 사용률이 다시 낮아지는지 확인합니다.
    
2. **"Activity"** 탭의 **"Activity history"**를 주기적으로 새로 고침합니다.
    
3. CPU 사용률이 28% 미만으로 충분히 떨어지면, ASG가 인스턴스를 **"Terminating"**하는 활동을 기록하는 것을 볼 수 있습니다. (알람 임계값을 15분간 미달해야 트리거될 수 있습니다.)
    
4. **"Instance management"** 탭으로 이동하면, EC2 인스턴스 중 하나가 종료되고 최종적으로 1개의 인스턴스만 남는 것을 확인할 수 있습니다.
    
5. CloudWatch `AlarmLow` 알람이 "In Alarm" 상태로 변경되었다가, 스케일 인이 완료되면 "OK" 상태로 돌아오는 것을 확인할 수 있습니다.
    
    - **참고:** CPU 부하를 중단했지만, CPU 사용률이 40% 이상으로 유지되는 경우 ASG가 인스턴스를 계속 추가할 수 있습니다. (실제로 `stress` 명령어가 제대로 종료되지 않아 인스턴스가 3개까지 늘어나는 경우도 발생할 수 있습니다.) 이럴 때는 인스턴스 관리 탭에서 추가된 모든 인스턴스를 직접 재부팅하여 CPU 사용률을 확실히 낮춰주는 것이 좋습니다.
        

---

### 3. 실습 후 정리 (Cleanup)

불필요한 AWS 요금 발생을 막기 위해 실습 후에는 생성된 리소스를 모두 삭제하는 것이 중요합니다.

1. **ASG 삭제:**
    
    - ASG 콘솔에서 `Demo ASG`를 선택하고 **"Delete"**를 클릭합니다.
        
    - ASG를 삭제하면 ASG가 관리하던 모든 EC2 인스턴스도 자동으로 종료됩니다.
        
2. **시작 템플릿 삭제:**
    
    - EC2 콘솔의 왼쪽 탐색 창에서 **"Launch Templates"**를 클릭합니다.
        
    - `my-demo-template`을 선택하고 **"Actions" -> "Delete template"**을 클릭합니다.
        
3. **CloudWatch 알람 삭제:**
    
    - CloudWatch 콘솔의 왼쪽 탐색 창에서 **"Alarms"**를 클릭합니다.
        
    - 대상 추적 정책이 생성한 두 개의 알람(예: `TargetTracking-target-tracking-policy-AlarmHigh-...`, `TargetTracking-target-tracking-policy-AlarmLow-...`)을 선택하고 **"Delete"**를 클릭합니다.
        

---

이 실습을 통해 ASG의 자동 스케일링 정책, 특히 대상 추적 스케일링이 어떻게 작동하고, CloudWatch 알람과 연동하여 동적으로 인스턴스 수를 조절하는지 명확하게 이해할 수 있을 것입니다. 이는 AWS 클라우드 환경에서 고가용성과 탄력성을 갖춘 애플리케이션을 구축하는 데 필수적인 지식입니다.