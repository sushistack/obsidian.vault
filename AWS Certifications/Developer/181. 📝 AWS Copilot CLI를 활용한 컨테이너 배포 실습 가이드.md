
## ⚙️ Copilot CLI 설치 및 사전 준비

AWS Copilot을 활용한 배포 실습을 진행하기 위해 먼저 필요한 도구들을 설치하고 환경을 설정해야 합니다.

|도구|설명|설치 링크|
|---|---|---|
|**AWS CLI**|AWS 서비스와 상호작용하는 명령줄 도구입니다.|[AWS CLI 설치](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)|
|**Docker Desktop**|컨테이너 이미지를 빌드하고 실행하기 위한 필수 도구입니다.|[Docker Desktop 설치](https://www.docker.com/products/docker-desktop/)|
|**Copilot CLI**|AWS Copilot의 핵심 도구입니다. 운영체제에 맞는 설치 방법을 따릅니다.|[Copilot 설치](https://aws.github.io/copilot-cli/docs/getting-started/install/)|

모든 설치가 완료되면 터미널에서 `copilot --help` 명령어를 입력하여 Copilot이 정상적으로 설치되었는지 확인합니다.

---

## 📦 예제 애플리케이션 배포 단계

실습을 위해 AWS에서 제공하는 샘플 애플리케이션을 사용합니다. 아래 단계를 따라 간단한 웹 서비스를 배포해 보겠습니다.

### 1. 예제 저장소 클론

Copilot 실습을 위한 예제 코드가 담긴 GitHub 저장소를 로컬에 클론합니다.

Bash

```
git clone https://github.com/aws/copilot-sample-service.git
cd copilot-sample-service/example
```

### 2. Copilot 초기화 및 서비스 설정

클론한 디렉토리에서 `copilot init` 명령어를 실행하여 배포할 애플리케이션을 초기화합니다.

Bash

```
copilot init
```

명령어를 실행하면 몇 가지 질문에 답하게 됩니다.

- **Application Name**: 애플리케이션의 이름을 입력합니다. (예: `example-app`)
    
- **Service Type**: 배포할 서비스 유형을 선택합니다. 여기서는 **"Load Balanced Web Service"**를 선택합니다.
    
- **Service Name**: 서비스의 이름을 입력합니다. (예: `front-end`)
    
- **Dockerfile Path**: 사용할 Dockerfile의 경로를 입력합니다. (예: `./Dockerfile`)
    

이 과정을 통해 Copilot은 필요한 AWS 리소스(ECR, IAM 역할, S3 등)를 구성하기 위한 기본 설정을 마칩니다.

### 3. 환경 생성 및 배포

애플리케이션을 배포할 환경(예: 테스트, 프로덕션)을 생성하고 배포합니다.

Bash

```
copilot env init --name test
copilot deploy --name front-end --env test
```

- `copilot env init`: `test`라는 이름의 새로운 환경을 초기화합니다.
    
- `copilot deploy`: `test` 환경에 `front-end` 서비스를 배포합니다.
    

이 명령어를 실행하면 AWS CloudFormation 스택이 자동으로 생성되며, VPC, ECS 클러스터, 로드 밸런서, ECR 레포지토리 등 복잡한 인프라가 배포됩니다. 배포 과정은 다소 시간이 소요될 수 있습니다.

### 4. 배포 확인

배포가 완료되면, 터미널에 출력된 URL을 통해 웹 서비스에 접속하여 정상적으로 배포되었는지 확인할 수 있습니다.

---

## 🧹 배포 리소스 삭제

실습 후 불필요한 비용 발생을 막기 위해 배포한 모든 리소스를 깨끗하게 삭제하는 것이 중요합니다. 다음 명령어를 사용하면 CloudFormation 스택과 모든 관련 리소스가 제거됩니다.

Bash

```
copilot app delete
```

---

## 📁 Copilot 구성 파일 살펴보기

`copilot init` 명령어를 실행하면 `.copilot` 디렉토리가 생성됩니다. 이 디렉토리에는 애플리케이션의 설정이 담긴 `manifest.yml` 파일이 포함되어 있습니다.

```
.
└── copilot
    ├── environments
    │   └── test
    │       └── manifest.yml
    └── front-end
        └── manifest.yml
```

- **`front-end/manifest.yml`**: `front-end` 서비스에 대한 설정 파일입니다. 컨테이너 이미지, 포트, CPU/메모리 할당 등 서비스의 상세 설정을 정의할 수 있습니다.
    
- **`environments/test/manifest.yml`**: `test` 환경에 대한 설정 파일입니다. VPC, 서브넷 등 환경 수준의 설정을 정의할 수 있습니다.
    

이 파일들을 직접 수정하여 애플리케이션의 아키텍처를 '코드로서의 인프라(Infrastructure as Code)' 방식으로 관리할 수 있습니다.