
## 💡 AMI 생성 시 재부팅(Reboot) 옵션의 중요성

![[Pasted image 20250921164935.png]]

**AMI(Amazon Machine Image)**는 EC2 인스턴스의 스냅샷을 기반으로 생성되는 이미지로, 동일한 환경의 인스턴스를 빠르게 복제하는 데 사용됩니다. AMI를 생성할 때는 인스턴스를 **재부팅(Reboot)**할지 여부를 선택할 수 있으며, 이 옵션은 데이터의 무결성과 안정성에 중요한 영향을 미칩니다.

### 재부팅(Reboot) 활성화 (기본 설정)

**재부팅(Reboot)** 옵션을 활성화하면, AMI 생성 전에 인스턴스가 먼저 종료(Shutdown)됩니다. 이 과정은 **파일 시스템의 무결성을 보장**합니다.

1. **인스턴스 종료:** 실행 중인 인스턴스가 잠시 중지됩니다.
    
2. **스냅샷 생성:** EBS 볼륨에 대한 스냅샷이 생성됩니다. 이 시점에는 모든 디스크 I/O가 정지되므로, 모든 데이터가 안전하게 디스크에 기록됩니다.
    
3. **AMI 생성:** 스냅샷을 기반으로 AMI가 생성됩니다.
    

이 방식은 인스턴스 가동 중단이 발생하지만, 생성된 AMI가 **완전하고 일관된 상태**의 파일 시스템을 갖도록 보장합니다.

---

## ⚠️ 무재부팅(No-Reboot) 옵션의 위험성

**무재부팅(No-Reboot)** 옵션을 활성화하면, 인스턴스를 중단하지 않고 실행 중인 상태에서 즉시 AMI가 생성됩니다. 이는 서비스의 연속성을 보장하는 장점이 있지만, **데이터 무결성을 해칠 수 있는 위험**이 있습니다.

### 무재부팅의 위험성

- **파일 시스템 무결성 손상:** 스냅샷이 생성되는 시점에 아직 디스크에 기록되지 않은 **메모리 버퍼의 데이터**가 있을 수 있습니다. 이로 인해 생성된 AMI는 파일 시스템의 일관성이 깨진 상태일 수 있습니다.
    
- **복제 문제:** `fsck` 명령어가 필요하거나, 부팅 시 예상치 못한 오류가 발생할 수 있습니다.
    

> **💡 주의:** 이 옵션은 사용자가 데이터의 일관성을 스스로 보장할 수 있을 때만 신중하게 사용해야 합니다.

---

## 🛡️ AWS Backup 서비스와의 관계

![[Pasted image 20250921165006.png]]

**AWS Backup** 서비스는 EC2 인스턴스에 대한 백업 계획을 자동화하는 데 사용됩니다. AWS Backup은 기본적으로 **무재부팅(No-Reboot)** 옵션을 사용하여 AMI를 생성합니다.

- **동작 방식:** AWS Backup은 인스턴스의 가동 중단 없이 백업을 수행하기 위해 이 옵션을 사용합니다.
    
- **중요 사항:** 따라서 AWS Backup을 통해 생성된 AMI는 파일 시스템의 무결성이 보장되지 않습니다. 이는 사용자가 반드시 인지하고 있어야 할 부분입니다.
    

### 파일 시스템 무결성을 위한 대안

만약 자동화된 AMI 백업을 원하지만 데이터 무결성을 보장해야 한다면, **AWS EventBridge**와 **AWS Lambda**를 결합하여 백업을 자동화하는 방법을 고려할 수 있습니다.

1. **EventBridge 규칙:** 지정된 시간에 Lambda 함수를 호출하도록 예약 규칙을 생성합니다.
    
2. **Lambda 함수:** Lambda 함수가 실행되면, 인스턴스를 재부팅하고 AMI를 생성한 후 다시 시작하도록 코드를 작성합니다. 이 방법은 인스턴스의 중단이 발생하지만, 파일 시스템의 무결성을 보장할 수 있습니다.
    

---

## 📝 AMI 생성 실습

1. EC2 대시보드에서 인스턴스를 선택합니다.
    
2. **`작업(Actions)`** 메뉴 > **`이미지 및 템플릿(Image and templates)`** > **`이미지 생성(Create image)`**으로 이동합니다.
    
3. AMI 생성 페이지에서 **`재부팅 없음(No-reboot)`** 옵션을 확인할 수 있습니다. 이 옵션은 기본적으로 비활성화되어 있습니다.
    

이 옵션은 AWS Backup과 같이 **서비스 중단을 최소화**하면서 백업을 수행할 때 유용하지만, 무결성이 중요한 시스템에는 주의해서 사용해야 합니다.