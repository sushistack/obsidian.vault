
## π—οΈ μ¤‘μ²© μ¤νƒ(Nested Stacks)μ΄λ€?

![[Pasted image 20250928160258.png]]

**μ¤‘μ²© μ¤νƒ**μ€ λ‹¤λ¥Έ CloudFormation μ¤νƒ λ‚΄λ¶€μ— ν¬ν•¨λ μ¤νƒμ…λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μ¬μ‚¬μ© κ°€λ¥ν• κµ¬μ„± μ”μ†λ‚ λ°λ³µλλ” ν¨ν„΄μ„ λ³„λ„μ μ¤νƒμΌλ΅ λ¶„λ¦¬ν•μ—¬ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ— ν•„μ”ν• μ›Ή μ„λ²„, λ°μ΄ν„°λ² μ΄μ¤, λ΅λ“ λ°Έλ°μ„ λ“±μ κµ¬μ„±μ„ κ°κ°μ μ¤‘μ²© μ¤νƒμΌλ΅ λ‚λ„μ–΄ λ¨λ“ν™”ν•  μ μμµλ‹λ‹¤.

### μ¤‘μ²© μ¤νƒκ³Ό κµμ°¨ μ¤νƒ(Cross-Stack)μ μ°¨μ΄μ 

![[Pasted image 20250928160311.png]]

|νΉμ§•|μ¤‘μ²© μ¤νƒ(Nested Stacks)|κµμ°¨ μ¤νƒ(Cross-Stack)|
|---|---|---|
|**λ©μ **|**μ»΄ν¬λ„νΈ μ¬μ‚¬μ©** λ° ν…ν”λ¦Ώ λ¨λ“ν™”. ν•λ‚μ μƒμ„ μ¤νƒμ΄ μ—¬λ¬ ν•μ„ μ¤νƒμ„ κ΄€λ¦¬ν•©λ‹λ‹¤.|**λ‹¤λ¥Έ λΌμ΄ν”„μ‚¬μ΄ν΄**μ„ κ°€μ§„ μ¤νƒ κ°„μ— λ°μ΄ν„°(μ¶λ ¥ κ°’)λ¥Ό κ³µμ ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, VPC μ¤νƒκ³Ό μ• ν”λ¦¬μΌ€μ΄μ… μ¤νƒμ΄ λ…λ¦½μ μΌλ΅ κ΄€λ¦¬λ  λ• μ‚¬μ©ν•©λ‹λ‹¤.|
|**κ΄€κ³„**|**λ¶€λ¨-μμ‹ κ΄€κ³„**. λ¶€λ¨ μ¤νƒμ΄ μμ‹(μ¤‘μ²©) μ¤νƒμ λΌμ΄ν”„μ‚¬μ΄ν΄μ„ μ™„μ „ν μ μ–΄ν•©λ‹λ‹¤.|**λμ¨ν• κ²°ν•©(Loose Coupling)**. ν• μ¤νƒμ μ¶λ ¥ κ°’μ„ λ‹¤λ¥Έ μ¤νƒμ΄ κ°€μ Έμ™€ μ‚¬μ©ν•λ” κ΄€κ³„μ…λ‹λ‹¤.|
|**κ΄€λ¦¬**|λ¶€λ¨ μ¤νƒμ„ μ—…λ°μ΄νΈν•κ±°λ‚ μ‚­μ ν•λ©΄ μ¤‘μ²© μ¤νƒλ„ ν•¨κ» μ—…λ°μ΄νΈ/μ‚­μ λ©λ‹λ‹¤.|κ° μ¤νƒμ€ λ…λ¦½μ μΌλ΅ κ΄€λ¦¬λλ©°, ν• μ¤νƒμ„ μ‚­μ ν•λ ¤λ©΄ μμ΅΄μ„±μ„ λ¨Όμ € μ κ±°ν•΄μ•Ό ν•©λ‹λ‹¤.|
|**ν•¨μ**|`AWS::CloudFormation::Stack` λ¦¬μ†μ¤μ™€ `TemplateURL` μ†μ„±μ„ μ‚¬μ©ν•©λ‹λ‹¤.|`Fn::ImportValue` ν•¨μλ¥Ό μ‚¬μ©ν•κ³  `Export` μ†μ„±μΌλ΅ κ°’μ„ μ™Έλ¶€μ— κ³µκ°ν•©λ‹λ‹¤.|
|**ν™μ© μμ‹**|LAMP μ¤νƒ, AWS Elastic Beanstalk ν™κ²½ λ“± μ—¬λ¬ μ»΄ν¬λ„νΈκ°€ ν•¨κ» λ°°ν¬λλ” λ‹¨μΌ μ• ν”λ¦¬μΌ€μ΄μ….|νμ‚¬ μ „μ²΄κ°€ μ‚¬μ©ν•λ” μ¤‘μ•™ VPCμ™€, κ° ν€μ΄ μ‚¬μ©ν•λ” κ°λ³„ μ• ν”λ¦¬μΌ€μ΄μ… μ¤νƒ.|

---

## π“– μ¤‘μ²© μ¤νƒ ν…ν”λ¦Ώ κµ¬μ΅° λ° λ™μ‘ μ›λ¦¬

μ¤‘μ²© μ¤νƒμ€ `AWS::CloudFormation::Stack` λ¦¬μ†μ¤λ¥Ό μ‚¬μ©ν•μ—¬ μ •μν•©λ‹λ‹¤. μ΄ λ¦¬μ†μ¤λ” **`TemplateURL`** μ†μ„±μΌλ΅ μ¤‘μ²© μ¤νƒμ ν…ν”λ¦Ώ νμΌ μ„μΉλ¥Ό μ§€μ •ν•λ©°, **`Parameters`** μ†μ„±μΌλ΅ ν•μ„ μ¤νƒμ— ν•„μ”ν• κ°’μ„ μ „λ‹¬ν•  μ μμµλ‹λ‹¤.

### μμ‹ ν…ν”λ¦Ώ (`parent-stack.yaml`)

```YAML
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  MyKeyPair:
    Type: AWS::EC2::KeyPair
    Properties:
      KeyName: my-key-pair
      
  MyNestedStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: "https://s3.amazonaws.com/your-bucket/nested-stack-template.yaml"
      Parameters:
        KeyName: !Ref MyKeyPair
        DBUser: "admin"
        DBPassword: "MySuperSecretPassword"
```

### λ™μ‘ μ›λ¦¬

1. **μƒμ„ μ¤νƒ μƒμ„±**: CloudFormationμ΄ λ¶€λ¨ ν…ν”λ¦Ώ(`parent-stack.yaml`)μ„ μ²λ¦¬ν•κΈ° μ‹μ‘ν•©λ‹λ‹¤.
    
2. **`AWS::CloudFormation::Stack` λ¦¬μ†μ¤ κ°μ§€**: `MyNestedStack` λ¦¬μ†μ¤λ¥Ό λ°κ²¬ν•κ³  `TemplateURL`μ„ ν†µν•΄ ν•μ„ ν…ν”λ¦Ώ(`nested-stack-template.yaml`)μ„ κ°€μ Έμµλ‹λ‹¤.
    
3. **νλΌλ―Έν„° μ „λ‹¬**: μƒμ„ μ¤νƒμ—μ„ μ •μλ `Parameters`λ¥Ό ν•μ„ μ¤νƒμΌλ΅ μ „λ‹¬ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, `!Ref MyKeyPair`λ΅ μƒμ„±λ ν‚¤νμ–΄ μ΄λ¦„μ„ `KeyName` νλΌλ―Έν„°λ΅ μ „λ‹¬ν•©λ‹λ‹¤.
    
4. **ν•μ„ μ¤νƒ μƒμ„±**: ν•μ„ ν…ν”λ¦Ώμ— μ •μλ λ¦¬μ†μ¤(μ: EC2 μΈμ¤ν„΄μ¤, λ³΄μ• κ·Έλ£Ή)κ°€ μμ°¨μ μΌλ΅ μƒμ„±λ©λ‹λ‹¤. μ΄ κ³Όμ •μ€ λ³„λ„μ μ¤‘μ²© μ¤νƒ μ΄λ²¤νΈλ΅ ν‘μ‹λμ–΄ λ””λ²„κΉ…μ΄ μ©μ΄ν•©λ‹λ‹¤.
    
5. **μ‹ νΈ λ€κΈ°**: ν•μ„ μ¤νƒμ— `CreationPolicy`κ°€ μλ‹¤λ©΄ `cfn-signal`μ„ κΈ°λ‹¤λ Έλ‹¤κ°€ μ„±κ³µ μ‹ νΈλ¥Ό λ°›μΌλ©΄ μ¤νƒ μƒμ„±μ„ μ™„λ£ν•©λ‹λ‹¤.
    
6. **μ „μ²΄ μ¤νƒ μ™„λ£**: λ¨λ“  μ¤‘μ²© μ¤νƒμ΄ μ„±κ³µμ μΌλ΅ μƒμ„±λλ©΄, λ¶€λ¨ μ¤νƒλ„ `CREATE_COMPLETE` μƒνƒλ΅ μ „ν™λ©λ‹λ‹¤.
    

---

## π›΅οΈ μ¤‘μ²© μ¤νƒκ³Ό `Capabilities`

μ¤‘μ²© μ¤νƒμ„ μ‚¬μ©ν•λ” ν…ν”λ¦Ώμ„ μƒμ„±ν•  λ•, CloudFormationμ€ ν…ν”λ¦Ώ λ‚΄μ— **`AWS::CloudFormation::Stack`** λ¦¬μ†μ¤κ°€ μμμ„ κ°μ§€ν•κ³  **`CAPABILITY_AUTO_EXPAND`** κ¶ν•μ„ μ”κµ¬ν•©λ‹λ‹¤. λν•, λ§μ•½ μ¤‘μ²© μ¤νƒ ν…ν”λ¦Ώμ— IAM λ¦¬μ†μ¤κ°€ ν¬ν•¨λμ–΄ μλ‹¤λ©΄ **`CAPABILITY_IAM`** λλ” **`CAPABILITY_NAMED_IAM`** κ¶ν•λ„ ν•„μ”ν•©λ‹λ‹¤.

- `CAPABILITY_AUTO_EXPAND`: CloudFormationμ΄ μ¤‘μ²© μ¤νƒμ λ‚΄μ©μ„ "μλ™ ν™•μ¥"ν•μ—¬ λ¨λ“  λ¦¬μ†μ¤λ¥Ό ν™•μΈν•κ³  μ²λ¦¬ν•  μ μλ„λ΅ ν—μ©ν•λ” κ¶ν•μ…λ‹λ‹¤. μ΄λ” μ¤‘μ²© μ¤νƒμ΄ ν¬ν•¨ν•λ” λ¨λ“  λ¦¬μ†μ¤(νΉν IAM λ¦¬μ†μ¤)μ— λ€ν• μ„ν—μ„ μ‚¬μ©μκ°€ μΈμ§€ν•κ³  μμμ„ ν™•μΈν•λ” κ³Όμ •μ…λ‹λ‹¤.
    

---

## π”„ μ¤‘μ²© μ¤νƒ μ—…λ°μ΄νΈ λ° μ‚­μ 

μ¤‘μ²© μ¤νƒμ€ λ¶€λ¨ μ¤νƒμ— μν•΄ λΌμ΄ν”„μ‚¬μ΄ν΄μ΄ κ΄€λ¦¬λλ―€λ΅, μ§μ ‘ μ—…λ°μ΄νΈν•κ±°λ‚ μ‚­μ ν•μ§€ μ•μµλ‹λ‹¤.

- **μ—…λ°μ΄νΈ**: μ¤‘μ²© μ¤νƒμ„ μμ •ν•λ ¤λ©΄ **λ¶€λ¨ μ¤νƒμ ν…ν”λ¦Ώμ„ μ—…λ°μ΄νΈ**ν•λ©΄ λ©λ‹λ‹¤. CloudFormationμ€ λ¶€λ¨ ν…ν”λ¦Ώμ λ³€κ²½ μ‚¬ν•­μ„ κ°μ§€ν•κ³  ν•„μ”ν• κ²½μ° μ¤‘μ²© μ¤νƒμ„ μ—…λ°μ΄νΈν•©λ‹λ‹¤.
    
- **μ‚­μ **: μ¤‘μ²© μ¤νƒμ„ μ‚­μ ν•λ ¤λ©΄ **λ¶€λ¨ μ¤νƒμ„ μ‚­μ **ν•λ©΄ λ©λ‹λ‹¤. λ¶€λ¨ μ¤νƒμ΄ μ‚­μ λλ©΄ κ·Έ μ•„λμ— μλ” λ¨λ“  μ¤‘μ²© μ¤νƒκ³Ό ν•΄λ‹Ή λ¦¬μ†μ¤λ„ ν•¨κ» μ‚­μ λ©λ‹λ‹¤.
    

μ¤‘μ²© μ¤νƒμ€ λ³µμ΅ν• μΈν”„λΌλ¥Ό λ…Όλ¦¬μ μΈ λ‹¨μ„λ΅ λ¶„λ¦¬ν•κ³ , μ½”λ“ μ¬μ‚¬μ©μ„±μ„ λ†’μ—¬ CloudFormation ν…ν”λ¦Ώμ„ λ³΄λ‹¤ ν¨κ³Όμ μΌλ΅ κ΄€λ¦¬ν•  μ μλ” λ¨λ²” μ‚¬λ΅€μ…λ‹λ‹¤.