## 💡 EC2 스팟 인스턴스란?

**EC2 스팟 인스턴스(Spot Instances)**는 AWS의 **사용되지 않는 EC2 용량**을 저렴한 가격으로 제공하는 서비스입니다. 온디맨드(On-Demand) 가격 대비 **최대 90%까지 저렴**하여 비용을 크게 절감할 수 있습니다. 스팟 인스턴스는 유휴 용량에 대한 경매 개념으로 작동하며, 현재의 스팟 가격이 사용자가 설정한 **최대 가격(Max Price)**보다 낮을 때만 인스턴스를 유지할 수 있습니다.

### 스팟 인스턴스 중단과 복구

![[Pasted image 20250921163427.png]]

https://console.aws.amazon.com/ec2sp/v1/spot/home?region=us-east-1

만약 현재 스팟 가격이 사용자가 설정한 최대 가격을 초과하면, AWS는 인스턴스를 회수(reclaim)합니다. 이 경우, 사용자에게는 **2분의 유예 기간**이 주어지며, 다음 두 가지 옵션 중 하나를 선택할 수 있습니다.

|옵션|설명|장점|
|---|---|---|
|**Stop**|인스턴스를 중지하고, 데이터(EBS 볼륨)를 보존합니다.|스팟 가격이 다시 떨어지면 인스턴스를 재시작하여 중단된 시점부터 작업을 재개할 수 있습니다.|
|**Terminate**|인스턴스를 즉시 종료합니다. 인스턴스에 저장된 모든 데이터가 사라집니다.|새로운 인스턴스로 처음부터 작업을 시작할 수 있는 워크로드에 적합합니다.|

---

### 스팟 블록(Spot Block)

스팟 블록은 **중단 없는 스팟 인스턴스**를 일정 기간(1~6시간) 동안 확보할 수 있는 기능입니다. 이 기간 동안은 스팟 가격이 올라도 AWS가 인스턴스를 회수하지 않으므로, 단기적이고 중단에 민감한 작업에 적합합니다.

### 스팟 인스턴스 활용에 적합한 워크로드

- **배치 작업(Batch Jobs):** 대량의 데이터를 일괄 처리하는 작업.
    
- **데이터 분석:** 방대한 데이터를 분석하는 작업.
    
- **내결함성(Fault-tolerant) 워크로드:** 중간에 중단되더라도 다시 시작할 수 있는 유연한 작업.
    

**⚠️ 주의:** 스팟 인스턴스는 가격 변동성으로 인해 **미션 크리티컬한 작업**이나 **데이터베이스**와 같이 지속적인 가용성이 필수적인 워크로드에는 적합하지 않습니다.

---

## 🖥️ 스팟 인스턴스 요청과 관리

스팟 인스턴스는 **스팟 요청(Spot Request)**을 통해 시작됩니다. 스팟 요청에는 인스턴스 수량, 최대 가격, AMI 등과 같은 사양이 포함됩니다. 스팟 요청에는 두 가지 유형이 있습니다.

- **일회성 요청(One-time Request):** 요청이 한 번 충족되면 자동으로 사라집니다.
    
- **영구적 요청(Persistent Request):** 인스턴스가 중단되거나 종료되더라도, 스팟 요청이 유효한 동안 자동으로 새 인스턴스를 재시작합니다.
    

### 스팟 인스턴스를 올바르게 종료하는 방법

![[Pasted image 20250921163459.png]]

영구적 요청(Persistent Request) 유형의 스팟 인스턴스를 완전히 종료하려면 다음의 순서를 따라야 합니다.

1. **스팟 요청 취소:** 먼저 활성 상태인 **스팟 요청을 취소**합니다. 이 작업은 AWS가 더 이상 새 인스턴스를 시작하지 않도록 합니다.
    
2. **인스턴스 종료:** 그 다음, 해당 스팟 요청에 의해 실행된 **EC2 인스턴스를 수동으로 종료**합니다.
    

만약 이 순서를 반대로 진행하여 인스턴스를 먼저 종료하면, 영구적 요청은 자동으로 새로운 인스턴스를 다시 시작합니다.

---

## 🎯 스팟 플릿(Spot Fleets)이란?

**스팟 플릿(Spot Fleets)**은 여러 **인스턴스 유형, 가용 영역** 및 **가격 모델(스팟 및 온디맨드)**을 조합하여 원하는 컴퓨팅 용량(Target Capacity)을 확보하는 기능입니다. 스팟 플릿은 가장 비용 효율적인 인스턴스 풀을 자동으로 식별하고, 사용자가 설정한 예산 내에서 용량을 확보합니다.

### 스팟 플릿의 할당 전략

스팟 플릿은 목표 용량을 달성하기 위해 다음 네 가지 할당 전략 중 하나를 사용합니다.

|전략|설명|
|---|---|
|**최저 가격(Lowest Price)**|사용 가능한 모든 풀 중에서 가장 낮은 가격의 스팟 인스턴스 풀에서만 인스턴스를 시작합니다. 비용 최적화에 가장 유리합니다.|
|**분산(Diversified)**|여러 풀에 인스턴스를 분산시켜 시작합니다. 단일 풀의 가용성이 떨어지더라도 다른 풀에서 인스턴스를 확보할 수 있어 **가용성이 높습니다.**|
|**용량 최적화(Capacity Optimized)**|가장 많은 용량을 확보할 수 있는 풀에서 인스턴스를 시작합니다. 가격보다 **안정적인 용량 확보**가 중요할 때 사용합니다.|
|**가격 용량 최적화(Price Capacity Optimized)**|용량이 가장 많은 풀을 선택한 후, 그 안에서 가장 저렴한 가격의 인스턴스를 선택합니다. **가장 좋은 가격과 용량을 동시에** 고려하는 전략으로 대부분의 워크로드에 가장 적합합니다.|

### 스팟 플릿의 장점

스팟 플릿은 단순히 하나의 인스턴스 유형과 가용 영역에 의존하는 스팟 인스턴스 요청과 달리, 여러 옵션을 동시에 고려함으로써 **비용 절감 효과를 극대화**하고 **인스턴스 가용성을 높입니다.** 이는 사용자가 복잡한 최적화 작업을 직접 하지 않아도 되게 해줍니다.