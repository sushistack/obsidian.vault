
---

## 💡 `DependsOn` 속성이란?

**`DependsOn`** 속성은 CloudFormation 템플릿에서 리소스 간의 **명시적인 의존성**을 정의하는 데 사용됩니다. 이 속성을 사용하면 특정 리소스가 다른 리소스가 성공적으로 생성된 후에만 생성되도록 순서를 지정할 수 있습니다.

CloudFormation은 기본적으로 템플릿에 정의된 리소스 간의 논리적 연결(예: `Ref` 또는 `Fn::GetAtt` 함수 사용)을 자동으로 파악하여 생성 순서를 결정합니다. 하지만 논리적인 연결이 없을 경우, 두 리소스는 동시에 생성될 수 있습니다. `DependsOn`은 이러한 경우에 수동으로 순서를 제어하는 강력한 도구입니다.

### `DependsOn` 사용이 필요한 경우

- **논리적 의존성이 없는 리소스**: EC2 인스턴스와 S3 버킷처럼, 템플릿 내에서 직접적으로 연결되지 않았지만, 인프라의 논리적 흐름상 S3 버킷이 먼저 생성되어야 하는 경우.
    
- **복잡한 애플리케이션 아키텍처**: 데이터베이스(RDS)가 먼저 생성되고 초기화되어야만 웹 서버(EC2)가 시작될 수 있는 경우.
    

---

## 📝 `DependsOn` 사용 예시: S3 버킷 생성 순서 지정하기

다음은 `DependsOn` 속성을 사용하여 EC2 인스턴스가 먼저 생성된 후, S3 버킷이 생성되도록 순서를 지정하는 CloudFormation 템플릿 예시입니다.

### 템플릿 (`dependson.yaml`)

```YAML
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  MyEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0abcdef1234567890
      InstanceType: t2.micro
      
  MyBucket:
    Type: AWS::S3::Bucket
    DependsOn: MyEC2Instance
```

### 동작 방식

1. **템플릿 제출**: 위 템플릿을 CloudFormation에 제출하면 스택 생성 프로세스가 시작됩니다.
    
2. **`DependsOn` 속성 확인**: CloudFormation은 `MyBucket` 리소스에 `DependsOn: MyEC2Instance`라는 속성이 있는 것을 확인합니다.
    
3. **의존성 충족**: `MyEC2Instance`가 성공적으로 **`CREATE_COMPLETE`** 상태가 될 때까지 `MyBucket`의 생성을 보류합니다.
    
4. **`MyEC2Instance` 생성**: `MyEC2Instance`가 먼저 생성됩니다.
    
5. **`MyBucket` 생성**: `MyEC2Instance`가 성공적으로 생성된 후, `MyBucket` 리소스의 생성이 시작됩니다.
    

### 스택 삭제 시 동작

`DependsOn` 속성은 스택 삭제 시에도 반대 방향으로 작동합니다. 즉, 의존성을 가진 리소스(`MyBucket`)가 먼저 삭제되고, 그 후에 의존 대상 리소스(`MyEC2Instance`)가 삭제됩니다.

- `MyBucket`의 삭제가 먼저 시작됩니다.
    
- `MyBucket`이 삭제 완료된 후, `MyEC2Instance`의 삭제가 시작됩니다.
    

이러한 특성 덕분에 리소스 간의 올바른 삭제 순서를 보장하여, 삭제 시 발생하는 오류를 방지할 수 있습니다. 예를 들어, 웹 서버를 삭제하기 전에 먼저 연결된 데이터베이스를 삭제해야 할 때 유용합니다.

---

## 🆚 `DependsOn` vs. 논리적 의존성

|구분|`DependsOn`|논리적 의존성|
|---|---|---|
|**정의 방법**|`DependsOn: ResourceName` 속성을 명시적으로 추가합니다.|`Ref` 또는 `Fn::GetAtt` 같은 내장 함수를 사용하여 한 리소스의 속성을 다른 리소스가 참조합니다.|
|**예시**|`MyBucket DependsOn: MyEC2Instance`|`InstanceSecurityGroup: !Ref MyInstanceSecurityGroup`|
|**자동 판단 여부**|개발자가 수동으로 정의합니다.|CloudFormation이 자동으로 의존성을 파악하고 순서를 지정합니다.|
|**활용 시점**|두 리소스 간에 직접적인 논리적 연결이 없을 때 순서를 강제하고 싶을 경우.|대부분의 리소스 간 연결에 사용되는 일반적인 방법입니다.|

**`DependsOn`**은 CloudFormation이 자동으로 처리할 수 없는 복잡한 의존 관계를 제어하는 데 필수적인 속성입니다. 이를 통해 템플릿의 예측 가능성을 높이고, 인프라 배포의 안정성을 향상시킬 수 있습니다.