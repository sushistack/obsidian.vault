
안녕하세요! 이번에는 AWS Systems Manager의 강력한 기능 중 하나인 **인벤토리(Inventory)**와 **State Manager**에 대해 알아보겠습니다. 이 두 가지 기능은 인스턴스의 현재 상태를 파악하고, 원하는 상태를 유지하도록 자동화하는 데 필수적인 도구입니다.

---

## 🧐 Systems Manager 인벤토리(Inventory)란?

**인벤토리**는 관리형 인스턴스(EC2 또는 온프레미스)에서 **메타데이터**를 자동으로 수집하여 중앙에 저장하고 분석할 수 있게 해주는 기능입니다. 인벤토리는 인스턴스에 대한 다양한 정보를 수집합니다.

- **수집 가능한 데이터**: 설치된 애플리케이션, AWS 구성, 시스템 정보, 네트워크 구성, 서비스, 파일 정보, 윈도우 레지스트리 등
    
- **활용**: 수집된 데이터를 AWS 콘솔에서 보거나, S3 버킷에 저장하여 Athena 또는 Amazon QuickSight를 통해 심층적으로 분석하고 시각화할 수 있습니다. 이를 통해 수천 개의 인스턴스에 대한 소프트웨어 현황이나 운영체제 버전을 한눈에 파악할 수 있습니다.
    

### 인벤토리 활성화하기

1. **Systems Manager** 콘솔에서 **Inventory**로 이동합니다.
    
2. **Enable inventory on all instances**를 클릭하여 모든 인스턴스에 대한 인벤토리 수집을 활성화합니다.
    
3. 이 작업은 내부적으로 **State Manager**를 통해 수행됩니다.
    

---

## ⚙️ State Manager: 원하는 상태를 유지하는 자동화

**State Manager**는 관리형 인스턴스가 사용자가 정의한 특정 **상태(State)**를 유지하도록 돕는 자동화 서비스입니다. 인스턴스에 대한 구성이나 소프트웨어가 항상 최신 상태인지, 또는 보안 규칙을 준수하는지 등을 지속적으로 검사하고 필요 시 자동 조치를 취할 수 있습니다.

- **핵심 개념: Association (연결)**
    
    - **Association**은 인스턴스에 적용할 상태를 정의하는 구성입니다. 예를 들어, "모든 인스턴스에 SSM 인벤토리를 활성화하라"는 명령이 바로 하나의 Association이 됩니다.
        
    - **State Manager**는 이 Association을 지정된 **스케줄**에 따라 주기적으로 실행하여 인스턴스의 상태를 원하는 대로 유지합니다.
        

### 인벤토리 활성화와 State Manager의 관계

인벤토리 기능을 활성화하면, Systems Manager는 **자동으로 SSM 문서(`AWS-GatherSoftwareInventory`)를 사용하는 Association을 생성**하여 모든 인스턴스에 적용합니다. 이 Association이 실행되면서 인스턴스들은 인벤토리 데이터를 수집하기 시작합니다.

---

## 📊 인벤토리 데이터 확인 및 동기화

State Manager를 통해 인벤토리 수집이 완료되면, Systems Manager 콘솔에서 수집된 데이터를 확인할 수 있습니다.

### 1. 인벤토리 요약 정보

**Inventory** 대시보드에서 다음과 같은 요약 정보를 볼 수 있습니다.

- **인스턴스 커버리지**: 인벤토리가 활성화된 인스턴스 수
    
- **OS 버전**: 가장 많이 사용되는 운영체제 버전
    
- **애플리케이션**: 설치된 주요 애플리케이션 목록
    

### 2. S3 데이터 동기화 (Resource Data Sync)

수집된 인벤토리 데이터를 더 상세하게 분석하고 싶다면, **S3 버킷에 동기화**하여 Athena, QuickSight 등 다른 AWS 서비스와 연동할 수 있습니다.

1. **Inventory** 대시보드에서 **Resource Data Sync**를 클릭합니다.
    
2. **Create sync**를 선택하고, **Sync name**과 **S3 bucket** 이름을 지정합니다.
    
3. **S3 버킷 정책**에 SSM 서비스가 데이터를 버킷에 쓸 수 있는 **권한을 부여**해야 합니다. 다음은 S3 버킷 정책의 예시입니다.

```JSON
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "ssm.amazonaws.com"
            },
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<버킷_이름>/*",
            "Condition": {
                "StringEquals": {
                    "s3:x-amz-acl": "bucket-owner-full-control"
                }
            }
        },
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "ssm.amazonaws.com"
            },
            "Action": "s3:GetBucketAcl",
            "Resource": "arn:aws:s3:::<버킷_이름>"
        }
    ]
}
```

- `<버킷_이름>` 부분에 실제 S3 버킷 이름을 입력해야 합니다.

4. 동기화 설정이 완료되면, 인벤토리 데이터가 주기적으로 S3 버킷에 저장됩니다.

### 3. Athena를 활용한 고급 쿼리

S3에 동기화된 인벤토리 데이터는 Athena를 통해 SQL 쿼리로 분석할 수 있습니다. 예를 들어, 특정 애플리케이션이 설치된 인스턴스를 찾거나, 특정 OS 버전을 사용하는 인스턴스 목록을 추출할 수 있습니다.

---

## 📚 마무리

**Systems Manager 인벤토리**와 **State Manager**는 개별 인스턴스를 일일이 확인하는 번거로움 없이, 대규모 인프라의 현재 상태를 파악하고 원하는 상태로 유지하는 데 큰 도움을 줍니다. 이는 곧 **보안 강화**와 **운영 효율성 증대**로 이어집니다. 이 기능을 통해 여러분의 AWS 인프라를 보다 체계적으로 관리해보세요!