
안녕하세요! 이번 시간에는 Application Load Balancer(ALB)의 핵심 기능인 **규칙(Rules)**에 대해 알아보겠습니다. ALB의 규칙은 단순히 트래픽을 타겟 그룹으로 전달하는 것을 넘어, 복잡한 조건에 따라 다양한 방식으로 트래픽을 분산시킬 수 있게 해줍니다.

---

## 1. ⚙️ ALB 규칙의 기본 구조

![[Pasted image 20250927191531.png]]

ALB의 규칙은 리스너(Listener)에 연결되며, 여러 개의 규칙을 설정할 수 있습니다.

- **처리 순서**: 규칙들은 설정된 순서대로 처리됩니다.
    
- **기본 규칙(Default Rule)**: 가장 마지막에 처리되는 규칙입니다. 다른 어떤 규칙에도 해당되지 않는 요청은 이 기본 규칙을 따릅니다.
    
- **조건(Conditions)**: 각 규칙은 특정 조건이 충족될 때만 작동합니다.
    
- **동작(Actions)**: 조건이 충족되면 수행되는 작업입니다.
    

### 규칙에 사용되는 조건 예시

|조건 유형|설명|예시|
|---|---|---|
|**호스트 헤더(Host header)**|요청이 들어온 도메인 이름을 기준으로 판단합니다.|`my-app.com`|
|**HTTP 요청 메소드**|요청의 메소드(GET, POST, PUT 등)를 기준으로 판단합니다.|`POST`|
|**경로 패턴(Path pattern)**|요청 URL의 경로를 기준으로 판단합니다.|`/images/*`, `/api/v1/users`|
|**소스 IP**|요청이 들어온 클라이언트의 IP 주소를 기준으로 판단합니다.|`192.168.1.1`|
|**HTTP 헤더**|특정 HTTP 헤더의 존재 또는 값을 기준으로 판단합니다.|`X-Custom-Header: value`|
|**쿼리 파라미터**|요청 URL의 쿼리 스트링 파라미터를 기준으로 판단합니다.|`?version=2.0`|

### 규칙의 동작(Actions) 예시

- **Forward**: 트래픽을 특정 타겟 그룹으로 전달합니다.
    
- **Redirect**: 클라이언트를 다른 URL로 리디렉션합니다.
    
- **Fixed response**: HTTP 응답 코드를 포함한 고정된 응답을 클라이언트에게 즉시 보냅니다.
    

---

## 2. 🚀 고급 배포 전략: 가중치 기반 라우팅 (Weighted Target Groups)

ALB의 규칙은 단일 타겟 그룹뿐만 아니라 **여러 타겟 그룹에 트래픽을 분산**시킬 수 있습니다. 특히, 각 타겟 그룹에 **가중치(Weight)**를 설정하여 트래픽 비율을 제어하는 기능은 **블루/그린 배포(Blue/Green Deployment)**나 **카나리 배포(Canary Deployment)**와 같은 고급 배포 전략에 필수적입니다.


![[Pasted image 20250927191553.png]]

### 작동 원리

1. **두 개의 타겟 그룹 준비**: 기존 버전(`v1`)이 실행 중인 **타겟 그룹 1**과 새 버전(`v2`)이 실행될 **타겟 그룹 2**를 준비합니다.
    
2. **가중치 설정**: ALB 규칙에 `타겟 그룹 1`에 **80%**의 가중치를, `타겟 그룹 2`에 **20%**의 가중치를 부여합니다.
    
3. **점진적 배포**: 이제 ALB는 전체 트래픽의 80%를 기존 버전으로, 20%를 새 버전으로 보냅니다.
    
4. **모니터링**: 새 버전(`v2`)이 예상대로 작동하는지 모니터링합니다.
    
5. **트래픽 전환**: 새 버전의 안정성이 확인되면, 점진적으로 가중치를 조정하여 100% 트래픽이 새 버전으로 전달되도록 변경합니다.
    

이를 통해 전체 트래픽을 한 번에 전환하는 위험을 줄이고, 새로운 버전을 소수의 사용자에게만 먼저 노출하여 잠재적인 문제를 조기에 발견할 수 있습니다.

---

## 📚 마무리

ALB의 규칙은 단순한 로드 밸런싱을 넘어, 매우 세밀한 조건부 라우팅과 고급 배포 전략을 가능하게 하는 강력한 기능입니다. **호스트, 경로, 헤더** 등 다양한 조건을 활용하여 트래픽을 원하는 대로 분산하고, **가중치 기반 라우팅**을 통해 안전하고 효율적인 애플리케이션 업데이트를 수행할 수 있습니다.