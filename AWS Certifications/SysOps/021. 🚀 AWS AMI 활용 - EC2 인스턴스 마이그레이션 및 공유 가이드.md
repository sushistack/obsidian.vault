
## 📋 개요

이 가이드는 AWS EC2 인스턴스를 다른 가용 영역(AZ)으로 마이그레이션하는 방법과 AWS 계정 간에 AMI(Amazon Machine Image)를 공유하거나 복사하는 방법에 대해 상세히 설명합니다. AMI는 EC2 인스턴스의 스냅샷 역할을 하며, 동일한 환경의 새 인스턴스를 빠르고 쉽게 생성할 수 있게 해주는 중요한 AWS 서비스입니다.

---

## 🗺️ AZ 간 EC2 인스턴스 마이그레이션

EC2 인스턴스를 동일 리전 내의 다른 AZ로 이동해야 할 경우, **AMI**를 사용하는 것이 가장 일반적이고 효율적인 방법입니다. 이 방법은 원본 인스턴스의 데이터, 파일 시스템, 애플리케이션을 그대로 보존하면서 새로운 위치에 인스턴스를 생성할 수 있게 해줍니다.

### 마이그레이션 단계

|단계|설명|
|---|---|
|**1단계: AMI 생성**|마이그레이션하려는 원본 EC2 인스턴스에서 AMI를 생성합니다. 이 AMI는 인스턴스의 모든 설정과 데이터를 포함하는 템플릿 역할을 합니다.|
|**2단계: 새 인스턴스 생성**|AMI를 사용하여 새 EC2 인스턴스를 시작합니다. 이때, 인스턴스 시작 마법사에서 원하는 대상 AZ의 서브넷을 선택하여 인스턴스를 배치합니다.|
|**3단계: 검증 및 정리**|새 인스턴스가 정상적으로 작동하는지 확인합니다. 모든 것이 정상이라면, 필요에 따라 원본 인스턴스를 종료하고 관련 리소스를 정리할 수 있습니다.|

---

## 🔗 AWS 계정 간 AMI 공유 (Cross Account AMI Sharing)

AWS AMI는 다른 AWS 계정과 공유할 수 있습니다. AMI를 공유하면 AMI의 소유권은 원본 계정에 그대로 유지되며, 공유받은 계정은 해당 AMI를 사용하여 EC2 인스턴스를 시작할 수 있습니다.

### 공유 유형

|유형|설명|주의사항|
|---|---|---|
|**암호화되지 않은 AMI**|암호화되지 않은 볼륨을 가진 AMI는 특정 계정 ID와 공유하거나 **퍼블릭(Public)**으로 설정하여 전 세계 모든 AWS 계정과 공유할 수 있습니다.|퍼블릭 공유는 보안에 매우 취약하므로 신중해야 합니다.|
|**암호화된 AMI**|KMS(Key Management Service) 고객 관리 키(CMK)로 암호화된 AMI는 공유할 때 추가적인 단계를 거쳐야 합니다.|AMI와 함께 암호화에 사용된 **CMK**도 공유 대상 계정에 권한을 부여해야 합니다.|

### KMS 암호화 AMI 공유 예시

![[Pasted image 20250925195852.png]]

1. **계정 A (원본)**: AMI를 CMK-A로 암호화합니다.
    
2. **계정 A**: 계정 B에 AMI와 CMK-A에 대한 권한(예: `kms:DescribeKey`, `kms:Decrypt`, `kms:ReEncrypt` 등)을 부여합니다.
    
3. **계정 B (대상)**: 공유된 AMI와 키 권한을 통해 EC2 인스턴스를 시작할 수 있습니다.

**주의**: CMK 권한을 부여하지 않으면 대상 계정에서 AMI를 사용할 수 없습니다.

---

## 📚 AWS 계정 간 AMI 복사 (Cross Account AMI Copy)

![[Pasted image 20250925195904.png]]

공유받은 AMI를 자신의 계정으로 복사하여 **자체 소유**하고 싶을 때 사용합니다. 복사하면 원본 AMI와의 독립성이 생기며, 필요에 따라 복사 과정에서 AMI를 재암호화할 수도 있습니다.

### 복사 절차 및 특징

1. **권한 부여**: 원본 AMI의 소유자(계정 A)는 대상 계정(계정 B)에게 AMI의 기반이 되는 EBS 스냅샷에 대한 읽기 권한을 부여해야 합니다.
    
2. **API 호출**: 계정 B는 `CopyImage` API를 호출하여 원본 AMI를 자신의 계정으로 복사합니다.
    
3. **소유권 이전**: 복사된 AMI의 소유권은 계정 B로 완전히 이전됩니다.
    
4. **재암호화**: 복사 과정에서 대상 계정의 CMK(예: CMK-B)를 사용하여 AMI를 재암호화할 수 있습니다.

### KMS 암호화 AMI 복사 예시

![[Pasted image 20250925195930.png]]

1. **계정 A (원본)**: AMI를 CMK-A로 암호화한 후, 계정 B에게 EBS 스냅샷 및 CMK-A에 대한 권한을 부여합니다.
    
2. **계정 B (대상)**: `CopyImage` 명령을 실행하여 AMI를 복사합니다. 이때, 복사 옵션에서 자신의 CMK-B를 지정하여 새로운 AMI를 재암호화합니다.
    
3. **결과**: 계정 B는 CMK-B로 암호화되고 자체 소유권을 가진 새로운 AMI를 갖게 됩니다.

---

## 🔒 AMI 권한 설정 방법

AWS 콘솔에서 AMI의 권한을 손쉽게 설정할 수 있습니다.

1. **AMI 메뉴 접속**: AWS 콘솔에서 `EC2` > `AMI` 메뉴로 이동합니다.
    
2. **권한 편집**: 원하는 AMI를 선택한 후, `작업` > `AMI 권한 편집`을 클릭합니다.
    
3. **옵션 설정**:
    
    - **Public**: **암호화되지 않은 AMI**에 한해 퍼블릭으로 설정할 수 있습니다.
        
    - **Private**: `계정 ID 추가`를 통해 특정 계정, 조직(Organization) 또는 OU(Organizational Unit)와 공유할 수 있습니다.
        
    - **스냅샷 권한**: `연관된 스냅샷에 대한 볼륨 생성 권한 추가` 옵션을 통해 공유받은 계정이 해당 AMI를 더 원활하게 사용할 수 있도록 합니다.

이러한 AMI 권한 설정은 다른 사용자와 효율적으로 협업하거나 보안 정책을 관리하는 데 매우 중요합니다.