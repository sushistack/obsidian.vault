
## ☁️ 통합 CloudWatch 에이전트란?

![[Pasted image 20250921164118.png]]

**통합 CloudWatch 에이전트(Unified CloudWatch Agent)**는 AWS EC2 인스턴스 및 온프레미스 서버에서 **시스템 수준 지표**와 **로그**를 수집하여 CloudWatch로 전송하는 소프트웨어입니다.

기본적으로 AWS가 제공하는 EC2 모니터링 지표는 CPU, 네트워크, 디스크, 상태 점검 등에 국한됩니다. 따라서 **메모리(RAM)**, **디스크 공간 사용량**, **프로세스 정보**와 같은 더 상세한 지표를 수집하거나, 인스턴스 내부의 로그 파일을 CloudWatch Logs로 보내려면 반드시 이 에이전트를 설치해야 합니다.

### 에이전트의 주요 기능

|기능|설명|
|---|---|
|**시스템 지표 수집**|RAM, 디스크 사용량, 시스템 부하 등 AWS가 기본 제공하지 않는 지표를 수집합니다.|
|**로그 전송**|서버 내의 다양한 로그 파일(예: 애플리케이션 로그, 시스템 로그)을 CloudWatch Logs로 실시간 전송합니다.|
|**프로세스 모니터링**|`procstat` 플러그인을 통해 개별 프로세스의 CPU 및 메모리 사용량을 포함한 상세한 지표를 수집합니다.|

---

## ⚙️ 에이전트 설정 및 배포

통합 CloudWatch 에이전트를 사용하려면 다음과 같은 절차를 따라야 합니다.

### 1. 에이전트 설치

- **EC2 인스턴스:** AWS Systems Manager(SSM)를 사용하여 에이전트를 자동으로 설치할 수 있습니다.
    
- **온프레미스 서버:** AWS CLI 또는 수동 설치 스크립트를 통해 에이전트를 설치해야 합니다.
    

### 2. 설정 파일 구성

에이전트의 동작을 정의하는 설정 파일은 두 가지 방법으로 관리할 수 있습니다.

- **SSM 파라미터 스토어(Parameter Store):** 중앙 집중식으로 설정 파일을 저장하여 여러 인스턴스에 일관된 구성을 적용할 수 있습니다.
    
- **로컬 파일:** 각 서버에 직접 `.json` 형식의 설정 파일을 배포합니다.
    

### 3. IAM 권한 부여

에이전트가 CloudWatch에 데이터를 보낼 수 있도록 **적절한 권한**을 부여해야 합니다.

- **EC2 인스턴스:** `IAM 역할`을 생성하여 에이전트가 `CloudWatch`와 `SSM`에 접근할 수 있는 권한을 부여합니다.
    
- **온프레미스 서버:** 서버에 AWS 자격 증명(access key, secret key)을 설정하여 권한을 부여합니다.
    

---

## 🔍 Procstat 플러그인: 프로세스별 모니터링

통합 CloudWatch 에이전트에 포함된 **`procstat`** 플러그인은 개별 프로세스에 대한 상세한 성능 지표를 수집하는 강력한 기능입니다.

### 수집 가능한 지표

- **`procstat_cpu_usage`:** 각 프로세스의 CPU 사용률
    
- **`procstat_memory_rss`:** 각 프로세스가 사용하는 물리적 메모리(RAM) 양
    
- **`procstat_pid_count`:** 프로세스 ID(PID)별 카운트
    

### 모니터링 대상 지정

`procstat` 플러그인 설정 시, 모니터링할 프로세스를 다음 기준을 통해 지정할 수 있습니다.

|기준|설명|
|---|---|
|**PID 파일**|프로세스 ID가 기록된 파일 경로를 지정합니다.|
|**프로세스 이름**|`httpd`나 `nginx`와 같이 프로세스 이름을 직접 지정합니다.|
|**정규식(Pattern)**|특정 패턴에 일치하는 모든 프로세스를 모니터링할 수 있습니다.|

`procstat` 플러그인을 통해 수집된 모든 지표는 `procstat_` 접두사가 붙은 네임스페이스에 저장됩니다. 이를 통해 특정 애플리케이션의 성능 문제를 진단하고 최적화하는 데 큰 도움이 됩니다.

---

## 📚 요약

통합 CloudWatch 에이전트는 EC2 인스턴스의 모니터링 범위를 확장하는 필수적인 도구입니다. **RAM 사용량**이나 **개별 프로세스의 성능**과 같은 고급 지표는 이 에이전트를 통해서만 수집할 수 있다는 점을 반드시 기억해야 합니다. 올바른 IAM 권한과 설정 파일을 통해 에이전트를 배포하면, EC2 및 온프레미스 환경에 대한 포괄적인 모니터링 시스템을 구축할 수 있습니다.