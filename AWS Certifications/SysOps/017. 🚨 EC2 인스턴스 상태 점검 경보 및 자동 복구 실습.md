
## 🚦 EC2 상태 점검 경보 생성하기

EC2 인스턴스의 상태 점검 실패에 대응하기 위해, CloudWatch 경보를 설정하여 자동으로 복구 작업을 수행할 수 있습니다. 이 실습에서는 **시스템 상태 점검(System Status Check)** 실패 시 인스턴스를 자동으로 **복구(Recover)**하는 경보를 생성합니다.

### 1. EC2 인스턴스에서 경보 생성

1. **EC2 대시보드**에서 원하는 인스턴스를 선택하고 **`작업(Actions)`** 메뉴에서 **`경보(Alarms)`** > **`상태 점검 경보 생성(Create status check alarm)`**을 클릭합니다.
    
2. **`Alarm notification`** 섹션에서 경보가 발생했을 때 알림을 받을 SNS 주제를 설정합니다. 알림을 원하지 않으면 이 기능을 비활성화할 수 있습니다.
    
3. **`Alarm action`** 섹션에서 경보가 트리거될 때 수행할 작업을 선택합니다.
    
    - **`Recover`:** **시스템 상태 점검 실패**에 대한 대응으로, 인스턴스를 다른 물리적 호스트로 마이그레이션하여 복구합니다. 인스턴스 ID, 프라이빗 IP, EIP 등이 그대로 유지됩니다.
        
    - **`Reboot`:** **인스턴스 상태 점검 실패**에 대한 대응으로, 인스턴스를 재부팅합니다.
        

### 2. 경보 임계값 설정

- **`임계값(Thresholds)`:** `Status check failed (System)` 지표가 **1분 동안 1회 이상** 실패할 경우 경보가 트리거되도록 설정합니다.

### 3. 경보 이름 및 생성

경보 이름을 지정하고 **`생성(Create)`**을 클릭하면, **`OK`** 상태의 경보가 생성됩니다.

> **💡 참고:** **인스턴스 상태 점검 실패(Instance Status Check Failed)**에 대한 경보를 생성할 때는 **Reboot** 작업을 선택해야 합니다. 이는 인스턴스 내부의 소프트웨어 문제에 대한 적절한 조치입니다.

---

## ⚡ CloudShell을 이용한 경보 상태 시뮬레이션

실제로 인스턴스에 문제가 발생하기를 기다리는 대신, **AWS CloudShell**을 사용하여 CloudWatch 경보 상태를 강제로 변경하여 복구 작업이 실행되는지 테스트할 수 있습니다.

### 1. 경보 이름 확인

CloudWatch 콘솔의 **`경보(Alarms)`** 메뉴에서 생성한 경보의 이름을 복사합니다.

### 2. CloudShell에서 API 호출

1. **CloudShell**을 실행합니다.
    
2. 다음 명령어를 사용하여 경보의 상태를 **`ALARM`**으로 강제 변경합니다.
    
```Bash
aws cloudwatch set-alarm-state --alarm-name "your_alarm_name" --state-value ALARM --state-reason "Testing recovery action"
```
    
    - `alarm-name`: 복사한 경보 이름
        
    - `state-value`: 경보 상태 (OK, ALARM, INSUFFICIENT_DATA)
        
    - `state-reason`: 상태 변경 이유

### 3. 경보 및 인스턴스 상태 확인

- CloudWatch 콘솔에서 경보의 상태가 **`ALARM`**으로 변경된 것을 확인합니다.
    
- **`History`** 탭을 보면, 경보 상태 변경과 함께 **`EC2 Recover`** 작업이 성공적으로 실행되었다는 기록이 나타납니다.
    
- EC2 인스턴스의 상태는 잠시 **`recovering`** 상태를 거쳐 다시 **`running`**으로 돌아옵니다. 이는 인스턴스가 문제없는 새로운 하드웨어로 성공적으로 마이그레이션되었음을 의미합니다.


---

## 🗑️ 마무리: 리소스 정리

실습이 완료된 후, 불필요한 비용 발생을 막기 위해 생성한 CloudWatch 경보를 삭제해야 합니다.

1. CloudWatch 콘솔의 **`경보`** 메뉴로 이동합니다.
    
2. 생성한 경보를 선택하고 **`작업`** > **`삭제`**를 클릭합니다.


이러한 자동 복구 시스템을 구축하면, 예기치 않은 인프라 문제에도 서비스의 가용성을 높게 유지할 수 있습니다.