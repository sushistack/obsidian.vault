
안녕하세요! 이번 시간에는 로드 밸런서에서 발생하는 다양한 **오류 유형**과 이를 파악하기 위한 **모니터링 지표** 및 **액세스 로그**에 대해 깊이 있게 알아보겠습니다.

---

## 1. 🚨 로드 밸런서 오류 코드 이해하기

클라이언트 또는 서버에서 발생하는 문제에 따라 로드 밸런서에서 반환하는 HTTP 응답 코드는 다르게 나타납니다.

|오류 코드|유형|원인|예시|
|---|---|---|---|
|**4XX**|**클라이언트 오류**|클라이언트의 요청이 잘못되었거나 권한이 없는 경우.|`400 Bad Request`, `401 Unauthorized`, `403 Forbidden`|
|**5XX**|**서버 오류**|로드 밸런서 또는 백엔드 인스턴스에 문제가 있는 경우.|`500 Internal Server Error`, `502 Bad Gateway`, `503 Service Unavailable`, `504 Gateway Timeout`|

**✅ 핵심**: 시험 관점에서 `4XX` 코드는 클라이언트 문제, `5XX` 코드는 서버 문제로 기억하는 것이 중요합니다. 특히 `503 Service Unavailable`은 헬스 체크 실패로 인해 정상 인스턴스가 없을 때 발생하며, `504 Gateway Timeout`은 로드 밸런서의 유휴 시간 초과(idle timeout)보다 백엔드 인스턴스의 응답 시간이 더 길어 발생합니다.

---

## 2. 📊 CloudWatch를 활용한 로드 밸런서 지표 (Metrics)

로드 밸런서는 다양한 지표를 **CloudWatch**에 자동으로 푸시하여 실시간 모니터링을 가능하게 합니다.

|지표 이름|설명|
|---|---|
|`HealthyHostCount`|정상 상태인 인스턴스의 수.|
|`UnHealthyHostCount`|비정상 상태인 인스턴스의 수. 이 지표가 0보다 크면 즉시 확인이 필요합니다.|
|`HTTPCode_Target_5XX_Count`|백엔드 인스턴스에서 반환된 `5XX` 오류 코드의 수.|
|`RequestCount`|로드 밸런서가 처리한 전체 요청 수.|
|`Latency`|클라이언트가 요청을 보낸 시점부터 응답을 받는 데까지 걸린 시간.|
|`RequestCountPerTarget`|각 타겟 인스턴스가 받은 평균 요청 수. 자동 스케일링 정책에 유용합니다.|
|`SpilloverCount`|대기열(queue)이 가득 차서 거부된 요청의 수. 이 값이 0보다 크면 백엔드 인스턴스를 즉시 확장해야 합니다.|

---

## 3. 📄 액세스 로그 (Access Logs)와 요청 추적 (Request Tracing)

### 3.1. 액세스 로그

로드 밸런서는 모든 요청에 대한 상세 정보를 **S3 버킷**에 저장하는 **액세스 로그** 기능을 제공합니다.

- **포함 정보**: 요청 시간, 클라이언트 IP, 지연 시간, 요청 경로, 서버 응답 등 모든 요청의 메타데이터.
    
- **활용**: 규정 준수, 디버깅, 사용자 행동 분석 등에 유용합니다.
    
- **장점**: ELB나 EC2 인스턴스가 종료된 후에도 로그 데이터가 보존됩니다. S3 스토리지 비용만 지불하면 됩니다.
    
- **쿼리**: 저장된 로그는 **Amazon Athena**를 사용하여 SQL로 쉽게 분석할 수 있습니다.
### 3.2. 요청 추적 (Request Tracing)

Application Load Balancer(ALB)는 모든 HTTP 요청에 `X-Amzn-Trace-Id`라는 사용자 지정 헤더를 자동으로 추가합니다. 이 헤더는 단일 요청을 추적하는 데 사용되며, 분산 추적(distributed tracing) 플랫폼에서 유용하게 활용될 수 있습니다.

---

## 4. 👩‍💻 실습: 로드 밸런서 모니터링 설정

1. **EC2 콘솔**에서 **Load Balancers**를 선택하고, 원하는 ALB를 클릭합니다.
    
2. **Monitoring** 탭에서 **CloudWatch 지표**들을 시각적으로 확인할 수 있습니다.
    
3. **Description** 탭으로 이동하여 **Attributes**를 편집합니다.
    
4. **Access logs**를 활성화하고, 로그를 저장할 S3 버킷과 선택적 접두사(prefix)를 지정합니다. 이렇게 설정하면 로드 밸런서로 들어오는 모든 요청에 대한 상세 로그가 S3에 기록됩니다.

이처럼 로드 밸런서의 다양한 지표와 로그를 모니터링하면 애플리케이션의 성능 문제를 신속하게 파악하고 대응할 수 있습니다.