
안녕하세요! 이번에는 ELB(Elastic Load Balancing)의 핵심 기능인 **헬스 체크(Health Checks)**에 대해 더 깊이 알아보겠습니다. 헬스 체크는 로드 밸런서가 트래픽을 분산할 대상을 결정하는 데 있어 가장 중요한 기준이 됩니다.

---

## 🧐 헬스 체크란 무엇인가요?

**헬스 체크**는 로드 밸런서가 등록된 인스턴스(타겟)의 상태를 주기적으로 확인하는 기능입니다. 이를 통해 로드 밸런서는 정상적으로 작동하는 인스턴스로만 트래픽을 보내 서비스의 가용성을 유지합니다.

---

## 🛠️ 헬스 체크의 주요 설정 항목

헬스 체크는 **타겟 그룹(Target Group)** 수준에서 설정하며, 다음과 같은 다양한 옵션을 세밀하게 조정할 수 있습니다.

|설정 항목|설명|기본값|
|---|---|---|
|**Protocol**|헬스 체크에 사용할 프로토콜 (HTTP, HTTPS 등)|HTTP|
|**Port**|헬스 체크 요청을 보낼 인스턴스의 포트. 트래픽 포트와 다르게 설정 가능|`traffic port`|
|**Check path**|헬스 체크 요청을 보낼 경로. `/` 또는 `/health` 등 특정 경로를 지정하여 애플리케이션의 상태를 정밀하게 확인할 수 있습니다.|`/`|
|**Healthy threshold**|타겟이 정상(`healthy`) 상태로 간주되기 위해 연속적으로 성공해야 하는 헬스 체크 횟수.|5|
|**Unhealthy threshold**|타겟이 비정상(`unhealthy`) 상태로 간주되기 위해 연속적으로 실패해야 하는 헬스 체크 횟수.|2|
|**Timeout**|헬스 체크 응답이 없을 경우 실패로 간주하는 시간 (초).|5초|
|**Interval**|헬스 체크를 수행하는 주기 (초). 너무 짧으면 인스턴스에 부하를 줄 수 있습니다.|30초|
|**Success codes**|헬스 체크 성공으로 간주하는 HTTP 응답 코드. 기본적으로 200 코드가 사용되지만, 여러 코드를 지정할 수 있습니다 (예: `200,301`).|200|

### 헬스 체크 상태 (Health Status)

- `initial`: 타겟이 등록되었지만 아직 헬스 체크가 시작되지 않은 상태.
    
- `healthy`: 헬스 체크를 성공적으로 통과하여 트래픽을 수신할 수 있는 상태.
    
- `unhealthy`: 헬스 체크를 연속적으로 실패하여 더 이상 트래픽을 수신할 수 없는 상태.
    
- `unused`: 타겟 그룹에 등록되었지만, 현재 사용되지 않는 상태 (예: ELB가 연결되지 않은 타겟 그룹).
    
- `draining`: 타겟 그룹에서 등록 해제되는 중인 상태.
    
- `unavailable`: 헬스 체크가 비활성화된 상태.
    

---

## ⚠️ 중요: 모든 타겟이 Unhealthy 상태일 경우

만약 타겟 그룹에 등록된 **모든 인스턴스가 `unhealthy` 상태**가 되면, ELB는 트래픽을 분산할 대상이 없다고 판단하지 않습니다. 대신 **최선의 노력(best-effort)**을 다해 **모든 `unhealthy` 타겟에 트래픽을 라우팅**합니다. 이는 헬스 체크에 오류가 있거나, 일시적인 문제로 모든 인스턴스가 `unhealthy`로 표시되었을 경우에도 서비스가 완전히 중단되는 것을 방지하기 위한 조치입니다.

---

## 👩‍💻 실습: 헬스 체크 설정 변경하기

타겟 그룹에서 헬스 체크 설정을 직접 수정하는 방법을 살펴보겠습니다.

1. **EC2 콘솔**에서 **Target Groups**로 이동합니다.
    
2. 수정할 타겟 그룹을 선택하고 **Actions** 드롭다운 메뉴에서 **Edit health check settings**를 클릭합니다.
    
3. 앞서 설명한 다양한 설정을 원하는 값으로 변경할 수 있습니다.
    
4. 예를 들어, **Check path**를 `/health`로 변경하거나, **Interval**을 10초로 낮춰 헬스 체크 주기를 단축할 수 있습니다.

---

## 📚 마무리

**ELB 헬스 체크**는 로드 밸런싱의 핵심이자 서비스의 가용성을 결정하는 중요한 요소입니다. 헬스 체크 설정을 잘 이해하고 조정하면 애플리케이션의 안정성을 크게 높일 수 있습니다. 특히, 헬스 체크 경로를 `/` 대신 `/health`와 같이 특정 경로로 분리하여 사용하는 것은 애플리케이션의 상태를 더욱 정확하게 파악하는 좋은 방법입니다.