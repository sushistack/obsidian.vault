
안녕하세요! 이번에는 AWS Systems Manager의 **Patch Manager**를 직접 활용하여 패치 정책을 설정하고, **유지 관리 기간(Maintenance Window)**과 연동하는 실습 과정을 살펴보겠습니다. 이를 통해 인스턴스 패치 작업을 자동화하고, 시스템의 안정성을 확보하는 방법을 익힐 수 있습니다.

---

## 1. 📋 패치 정책(Patch Policy) 생성하기

**패치 정책**은 인스턴스에 적용할 패치 스케줄, 기준선, 대상 등을 한 번에 정의하는 기능입니다.

1. **Systems Manager** 콘솔에서 **Patch Manager**로 이동합니다.
    
2. **Create patch policy**를 클릭하여 새로운 패치 정책을 생성합니다.

### 주요 설정 항목

- **정책 이름**: `DemoPolicy`와 같이 식별 가능한 이름을 지정합니다.
    
- **패치 작업**:
    
    - **Scan**: 인스턴스에 누락된 패치가 있는지 검사만 수행합니다.
        
    - **Scan and install**: 검사 후 누락된 패치를 자동으로 설치합니다.

- **스케줄**:
    
    - **스캔 스케줄**: 매일, 매주 등 스캔을 수행할 빈도와 시간을 설정합니다 (예: 매일 오전 1시).
        
    - **설치 스케줄**: 패치를 실제로 설치할 빈도와 시간을 설정합니다 (예: 매주 일요일).

- **재부팅 옵션**: 패치 설치 후 인스턴스를 재부팅할지 여부를 선택합니다.
    
- **패치 기준선**:
    
    - **Recommended default**: AWS가 운영체제별로 제공하는 기본 패치 기준선을 사용합니다.
        
    - **Custom patch baseline**: 직접 생성한 사용자 지정 패치 기준선을 사용합니다.

- **출력 로그**: 패치 작업 로그를 S3 버킷에 저장하여 나중에 분석할 수 있도록 설정할 수 있습니다.
    
- **대상**:
    
    - **All managed nodes**: Systems Manager에 등록된 모든 노드에 정책을 적용합니다.
        
    - **Manually select nodes**: 특정 인스턴스들을 수동으로 선택하여 적용합니다.

- **속도 제어**:
    
    - **Concurrency**: 동시에 패치 작업을 수행할 인스턴스 수를 설정합니다 (예: 전체 노드의 10%씩).
        
    - **Error threshold**: 오류가 발생했을 때 작업을 중단할 임계치를 설정합니다.


이러한 설정을 통해 패치 정책을 생성하면, 지정된 스케줄에 따라 패치 작업이 자동으로 실행됩니다.

---

## 2. 🗓️ 유지 관리 기간(Maintenance Window) 활용하기

**유지 관리 기간**은 정해진 시간 동안만 특정 작업을 수행하도록 제한하는 기능입니다. 이를 통해 서비스 중단을 최소화하면서 패치와 같은 중요한 작업을 수행할 수 있습니다.

### 유지 관리 기간 생성하기

1. **Systems Manager** 콘솔에서 **Maintenance Windows**로 이동합니다.
    
2. **Create maintenance window**를 클릭하고 이름을 `DemoMaintenanceWindow`로 지정합니다.
    
3. **스케줄**을 설정합니다. Cron/Rate 표현식을 사용하여 세밀한 스케줄링이 가능합니다 (예: 매일 새벽 3시에 2시간 동안 실행).
    
4. **Create maintenance window**를 클릭하여 생성합니다.

### 작업(Task) 등록하기

생성된 유지 관리 기간에 패치 작업을 등록합니다.

1. 생성한 **유지 관리 기간**을 선택하고 **Actions** 탭에서 **Register tasks**를 클릭합니다.
    
2. **Run a command**를 선택하고, **이름**을 `patch`로 지정합니다.
    
3. **Command document**에서 `AWS-RunPatchBaseline`을 선택합니다.
    
4. **Targets**에서 패치를 적용할 인스턴스를 선택합니다. **유지 관리 기간**에 등록된 모든 대상을 선택할 수도 있습니다.
    
5. **Rate control** 섹션에서 **Concurrency**와 **Error threshold**를 설정하여 작업 속도를 제어합니다.
    
6. **Register Run Command task**를 클릭하여 작업을 등록합니다.


---

## 3. 🖥️ Patch Manager 대시보드 살펴보기

**Patch Manager** 대시보드는 패치 상태에 대한 종합적인 정보를 제공합니다.

- **컴플라이언스 요약(Compliance Summary)**: 패치 상태를 준수(compliant), 비준수(non-compliant) 등으로 분류하여 보여줍니다.
    
- **패치 기준선(Patch Baselines)**: 기본 및 사용자 지정 패치 기준선 목록을 확인할 수 있습니다. 여기서 `Create patch baseline`을 클릭하여 승인 또는 거부 규칙을 포함한 커스텀 기준선을 직접 만들 수 있습니다.
    
- **패치(Patches)**: 운영 체제별로 릴리스된 모든 패치 목록을 볼 수 있습니다.


---

## 📚 마무리

**Patch Manager**와 **유지 관리 기간**을 결합하면, 인스턴스 패치 작업을 완전하게 자동화하고 시스템의 보안을 강화할 수 있습니다. 이 실습을 통해 **패치 정책**으로 패치 방법을 정의하고, **유지 관리 기간**으로 실행 시간을 제어하는 방법을 이해하셨기를 바랍니다. 이 두 기능을 잘 활용하여 효율적인 시스템 관리를 해보세요!