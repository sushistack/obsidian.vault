
안녕하세요! 오늘은 AWS Systems Manager의 **Fleet Manager**를 활용하여 Amazon EC2 인스턴스를 관리 노드로 등록하는 방법에 대해 자세히 알아보겠습니다. 이 과정을 통해 인스턴스에 직접 접속하지 않고도 손쉽게 인스턴스를 관리할 수 있는 환경을 구축할 수 있습니다.

---

## 🧐 Systems Manager와 Fleet Manager란?

Amazon Systems Manager는 AWS 인프라를 중앙에서 관리할 수 있도록 돕는 서비스입니다. 이 중 **Fleet Manager**는 Systems Manager의 한 기능으로, 여러 EC2 인스턴스를 한곳에서 시각적으로 관리하고 운영할 수 있게 해줍니다.

---

## ⚙️ Fleet Manager에 인스턴스 등록하기 위한 사전 준비

인스턴스를 Fleet Manager에 등록하기 위해서는 몇 가지 핵심적인 준비가 필요합니다. 가장 중요한 것은 **EC2 인스턴스에 적절한 IAM 권한을 부여하는 것**입니다.

### 1. EC2 인스턴스 시작하기

먼저 AWS EC2 콘솔로 이동하여 인스턴스를 시작합니다.

1. **AMI (Amazon Machine Image) 선택**: `Amazon Linux 2`를 선택합니다. 이 AMI는 **SSM Agent**가 기본적으로 설치되어 있어 별도의 수동 설치가 필요 없습니다.
    
2. **인스턴스 타입**: 테스트를 위해 `T2.Micro`를 선택합니다.
    
3. **키 페어**: 키 페어 없이 진행합니다. 이 실습에서는 인스턴스에 직접 SSH로 접속하지 않을 것이기 때문에 키 페어가 필요하지 않습니다.
    
4. **네트워크 설정 (보안 그룹)**: 인바운드 규칙이 **없는** 새로운 보안 그룹을 생성합니다. 이는 외부에서 인스턴스로의 접속이 필요 없음을 보여주기 위함입니다. Systems Manager는 인스턴스에서 서비스로의 통신을 통해 동작하므로, 인스턴스에 인바운드 규칙을 열어줄 필요가 없습니다.
    

---

### 2. IAM 역할(Role) 생성 및 인스턴스에 연결하기

인스턴스가 Systems Manager 서비스와 통신하려면 적절한 **IAM 권한**이 필요합니다.

1. **IAM 인스턴스 프로파일 생성**:
    
    - **Advanced details** (고급 세부 정보) 섹션에서 **IAM instance profile** (IAM 인스턴스 프로파일)을 선택합니다.
        
    - **Create new IAM instance profile** (새 IAM 인스턴스 프로파일 생성)을 클릭합니다.
        
2. **IAM 역할 생성**:
    
    - **EC2**를 신뢰할 수 있는 엔터티(Trusted entity)로 선택합니다.
        
    - 정책 목록에서 `AmazonSSMManagedInstanceCore`를 찾아 연결합니다. 이 정책은 SSM 에이전트가 Systems Manager 서비스와 통신하는 데 필요한 최소한의 권한을 제공합니다.
        
    - 역할 이름을 지정합니다 (예: `AmazonEC2RoleforSSM`).
        
    - 역할 생성을 완료합니다.
        
3. **인스턴스에 IAM 역할 연결**:
    
    - 다시 인스턴스 시작 화면으로 돌아와서 방금 생성한 `AmazonEC2RoleforSSM` 역할을 선택합니다.
        

---

## 🚀 인스턴스 시작 및 Fleet Manager에서 확인하기

모든 설정이 완료되었다면, 인스턴스를 시작합니다.

1. **인스턴스 개수**: 3개로 설정하여 여러 인스턴스를 동시에 관리하는 모습을 보여줄 수 있습니다.
    
2. **인스턴스 시작**: 모든 설정을 확인한 후, 인스턴스를 시작합니다.
    
3. **Fleet Manager 확인**:
    
    - 인스턴스가 `Running` 상태가 되면, Systems Manager 콘솔의 **Fleet Manager**로 이동합니다.
        
    - 페이지를 새로고침하면, 잠시 후 **Managed nodes** 목록에 방금 시작한 3개의 인스턴스가 나타나는 것을 확인할 수 있습니다.
        
    - **SSM Agent status**가 `Online`으로 표시되면 성공적으로 등록된 것입니다.
        

다음 표는 Fleet Manager에서 볼 수 있는 인스턴스 정보의 예시입니다.

|Instance ID|Platform|OS|SSM Agent Version|Agent Status|
|---|---|---|---|---|
|i-0123...|Linux|Amazon Linux 2|3.1.xxx.0|Online|
|i-0abc...|Linux|Amazon Linux 2|3.1.xxx.0|Online|
|i-0def...|Linux|Amazon Linux 2|3.1.xxx.0|Online|

### ⚠️ 핵심 포인트: 접속 방식의 차이

이 실습의 가장 중요한 점은 **Systems Manager가 인스턴스로 접속하는 방식이 아니라는 것**입니다.

- ✅ **SSM Agent가 Systems Manager 서비스로의 연결을 시작합니다.** (인스턴스 -> 서비스)
    
- ❌ **Systems Manager가 인스턴스로의 연결을 시작하지 않습니다.** (서비스 -> 인스턴스)
    

따라서 인스턴스에 인바운드 규칙을 열어주지 않아도, 즉 외부에서 접속이 불가능한 상태에서도 Systems Manager를 통해 인스턴스를 관리할 수 있습니다. 이는 보안 측면에서 매우 유리한 방식입니다.

---

## 📚 마무리

이처럼 적절한 IAM 역할을 부여하고 Amazon Linux 2 AMI를 사용하면, 별다른 설정 없이도 EC2 인스턴스를 Systems Manager Fleet Manager에 자동으로 등록하여 관리할 수 있습니다. 인스턴스에 직접 접속하지 않고도 손쉽게 운영 작업을 수행할 수 있는 강력한 기능이므로, 꼭 한번 활용해보시길 바랍니다!

혹시 SSM 에이전트가 설치되지 않은 다른 OS를 사용하고 싶다면, 해당 OS에 맞는 SSM 에이전트를 수동으로 설치해야 합니다. 다음 강의에서는 이 부분에 대해 더 자세히 다루겠습니다.