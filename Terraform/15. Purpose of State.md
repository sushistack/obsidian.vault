
# **ğŸŒ Terraformì—ì„œ State(ìƒíƒœ)ì˜ ì—­í• **

Terraformì€ **ìƒíƒœ íŒŒì¼(tfstate)** ì„ í†µí•´ êµ¬ì„± íŒŒì¼ê³¼ ì‹¤ì œ ì¸í”„ë¼ ì‚¬ì´ì˜ ë§¤í•‘ì„ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì€ Terraformì´ ë¬´ì—‡ì„ ê´€ë¦¬í•˜ê³  ìˆëŠ”ì§€, ì–´ë–¤ ë¦¬ì†ŒìŠ¤ê°€ ì–´ë–¤ êµ¬ì„±ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ë¥¼ ê¸°ì–µí•˜ëŠ” **ì¤‘ì•™ ì°¸ì¡°ì†Œ** ì—­í• ì„ í•©ë‹ˆë‹¤.

---

## **ğŸ§  1. ìƒíƒœ íŒŒì¼ì˜ ê¸°ë³¸ ê°œë…**

Terraformì€ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ë•Œë§ˆë‹¤, í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ **ê³ ìœ  IDì™€ ì†ì„± ê°’ë“¤**ì„ ìƒíƒœ íŒŒì¼ì— ì €ì¥í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œ ì €ì¥ëœ ìƒíƒœ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤:

- ë¦¬ì†ŒìŠ¤ ë³€ê²½ ì‚¬í•­ ê°ì§€
- ì‹¤í–‰ ê³„íš ìƒì„±
- ë¦¬ì†ŒìŠ¤ ê°„ ì˜ì¡´ì„± íŒŒì•…
- ë¦¬ì†ŒìŠ¤ ì œê±° ì‹œ ì •í™•í•œ ìˆœì„œ ë³´ì¥

---

## **ğŸ”— 2. ë¦¬ì†ŒìŠ¤ ê°„ ì˜ì¡´ì„± ì˜ˆì‹œ**

ì•„ë˜ ì˜ˆì œì—ì„œëŠ” random_pet ë¦¬ì†ŒìŠ¤ì˜ ì¶œë ¥ê°’ì„ local_file ë¦¬ì†ŒìŠ¤ê°€ ì‚¬ìš©í•˜ê³  ìˆì–´, **ì˜ì¡´ì„±**ì´ ìƒê¹ë‹ˆë‹¤.

```
resource "random_pet" "my-pet" {
  length = 2
}

resource "local_file" "pet" {
  filename = "${path.module}/pet.txt"
  content  = random_pet.my-pet.id
}

resource "local_file" "cat" {
  filename = "${path.module}/cat.txt"
  content  = "Hello from cat!"
}
```

### **ìƒì„± ìˆœì„œ:**

1. random_pet.my-pet ì™€ local_file.cat â†’ ë³‘ë ¬ ìƒì„±
2. local_file.pet â†’ random_pet.my-pet ìƒì„± í›„ ìƒì„±ë¨

---

## **âŒ 3. ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí–ˆì„ ë•Œ**

ë§Œì•½ ìœ„ì˜ random_pet ê³¼ local_file.pet ë¦¬ì†ŒìŠ¤ë¥¼ **êµ¬ì„± íŒŒì¼ì—ì„œ ì œê±°**í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?

```
- resource "random_pet" "my-pet" { ... }
- resource "local_file" "pet" { ... }
```

Terraformì€ ìƒíƒœ íŒŒì¼ì— ì €ì¥ëœ **ì˜ì¡´ì„± ì •ë³´**ë¥¼ ì°¸ê³ í•˜ì—¬

ì•„ë˜ ìˆœì„œëŒ€ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤:

3. local_file.pet â†’ ë¨¼ì € ì‚­ì œ
4. random_pet.my-pet â†’ ê·¸ ë‹¤ìŒ ì‚­ì œ

> êµ¬ì„± íŒŒì¼ì—ì„œ ì˜ì¡´ì„± ì •ë³´ê°€ ì‚¬ë¼ì ¸ë„, ìƒíƒœ íŒŒì¼ì´ ì¶”ì í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•œ ì¼ì…ë‹ˆë‹¤.

---

## **ğŸš€ 4. ì„±ëŠ¥ í–¥ìƒ: ìƒíƒœ ìºì‹œ í™œìš©**

  
ì†Œê·œëª¨ ì¸í”„ë¼ëŠ” ìƒíƒœë¥¼ ë§¤ë²ˆ í´ë¼ìš°ë“œì—ì„œ ê°±ì‹ í•´ë„ ê´œì°®ì§€ë§Œ, ìˆ˜ë°± ê°œ ì´ìƒì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•  ê²½ìš° ì„±ëŠ¥ ì €í•˜ê°€ ì‹¬ê°í•©ë‹ˆë‹¤.

Terraformì€ ìƒíƒœ íŒŒì¼ì˜ **ì†ì„± ìºì‹œ(attribute cache)** ë¥¼ í™œìš©í•˜ì—¬ **ì‹¤ì œ í´ë¼ìš°ë“œ ìì›ì— ì ‘ê·¼í•˜ì§€ ì•Šê³ ** ì‹¤í–‰ ê³„íšì„ ë¹ ë¥´ê²Œ ìˆ˜ë¦½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
terraform plan -refresh=false
```

- -refresh=false ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´, ìƒíƒœë¥¼ í´ë¼ìš°ë“œì—ì„œ ê°±ì‹ í•˜ì§€ ì•Šê³  ê¸°ì¡´ ìƒíƒœë§Œìœ¼ë¡œ íŒë‹¨í•©ë‹ˆë‹¤.
- ë³€ê²½ ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°ì—ë„ ë¹ ë¥´ê²Œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## **ğŸ¤ 5. í˜‘ì—…ì„ ìœ„í•œ ìƒíƒœ ê´€ë¦¬**


ê¸°ë³¸ì ìœ¼ë¡œ ìƒíƒœ íŒŒì¼ì€ ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤:

```
./terraform.tfstate
```

### **í•˜ì§€ë§Œ í˜‘ì—…ì—ì„œëŠ”?**

- ì—¬ëŸ¬ ëª…ì´ ë™ì‹œì— ìƒíƒœ íŒŒì¼ì„ ìˆ˜ì •í•˜ë©´ ì¶©ëŒ ê°€ëŠ¥ì„±
- í•­ìƒ ìµœì‹  ìƒíƒœë¥¼ ê³µìœ í•´ì•¼ í•¨

### **í•´ê²°ì±…: ì›ê²© ìƒíƒœ ì €ì¥ì†Œ(Remote State)**

Terraformì€ ì•„ë˜ì™€ ê°™ì€ **ë°±ì—”ë“œ(backends)** ë¥¼ í†µí•´ ìƒíƒœë¥¼ ì›ê²© ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ğŸ”¸ AWS S3
- ğŸ”¸ HashiCorp Consul
- ğŸ”¸ Terraform Cloud

```
terraform {
  backend "s3" {
    bucket = "my-terraform-state"
    key    = "state.tfstate"
    region = "us-east-1"
  }
}
```

> ì›ê²© ìƒíƒœë¥¼ ì‚¬ìš©í•˜ë©´ íŒ€ ì „ì²´ê°€ ì•ˆì „í•˜ê²Œ ìƒíƒœë¥¼ ê³µìœ í•  ìˆ˜ ìˆê³ , ë™ì‹œ ì‘ì—…ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## **ğŸ” ìš”ì•½**

|**ëª©ì **|**ì„¤ëª…**|
|---|---|
|**ë§¤í•‘ ì¶”ì **|êµ¬ì„± vs. ì‹¤ì œ ë¦¬ì†ŒìŠ¤ ë¹„êµ|
|**ì˜ì¡´ì„± íŒŒì•…**|ë¦¬ì†ŒìŠ¤ ìƒì„±/ì‚­ì œ ìˆœì„œ ê²°ì •|
|**ì„±ëŠ¥ ìµœì í™”**|ìƒíƒœ ìºì‹œë¥¼ í™œìš©í•œ ë¹ ë¥¸ plan|
|**í˜‘ì—…**|ì›ê²© ìƒíƒœ ì €ì¥ì†Œë¥¼ í†µí•œ ì•ˆì „í•œ ìƒíƒœ ê³µìœ |

---

## **ğŸ’» ì‹¤ìŠµ íŒ**

- ìƒíƒœë¥¼ ìˆ˜ë™ìœ¼ë¡œ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´:

```
terraform show
```

- ìƒíƒœ íŒŒì¼ì„ JSONìœ¼ë¡œ ì¶œë ¥í•˜ë ¤ë©´:

```
terraform show -json > state.json
```

- íŠ¹ì • ë¦¬ì†ŒìŠ¤ë¥¼ ìƒíƒœì—ì„œ ì‚­ì œí•˜ê³  ì‹¶ë‹¤ë©´:

```
terraform state rm <resource_address>
```
