
## **1. Coroutine Scope**


### **1.1 ì •ì˜**

â€¢ **Coroutine Scope**ëŠ” ì½”ë£¨í‹´ ì‹¤í–‰ í™˜ê²½ì˜ **ë²”ìœ„**ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
â€¢ ëª¨ë“  ì½”ë£¨í‹´ì€ ë°˜ë“œì‹œ íŠ¹ì • **Coroutine Scope** ë‚´ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
â€¢ ì—¬ëŸ¬ ì½”ë£¨í‹´ì´ ë™ì¼í•œ Scopeì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.


### **1.2 Scopeì˜ ì£¼ìš” ì†ì„±**

â€¢ CoroutineScope.context:
	â€¢ ScopeëŠ” ë‹¨ì¼ ì†ì„±ìœ¼ë¡œ **CoroutineContext**ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
	â€¢ Scope ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  ì½”ë£¨í‹´ì€ ì´ Contextë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ìƒì†í•©ë‹ˆë‹¤.

  ![](www.udemy.com_course_coroutines-on-android_learn_lecture_21528334.png)

### **1.3 ë¶€ëª¨-ìžì‹ ê´€ê³„**

â€¢ ë™ì¼í•œ Scopeì—ì„œ ì‹¤í–‰ëœ **ë¶€ëª¨ ì½”ë£¨í‹´ê³¼ ìžì‹ ì½”ë£¨í‹´**ì€ **Job ê°ì²´**ë¥¼ í†µí•´ ê³„ì¸µ êµ¬ì¡°ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤.
â€¢ ì´ ê³„ì¸µ êµ¬ì¡°ëŠ” **êµ¬ì¡°ì  ë™ì‹œì„±(Structured Concurrency)**ì˜ í•µì‹¬ ìš”ì†Œìž…ë‹ˆë‹¤.

**ì˜ˆì œ: ë¶€ëª¨-ìžì‹ ê´€ê³„**

```kotlin
val scope = CoroutineScope(Dispatchers.Main + SupervisorJob())

scope.launch {
    println("ë¶€ëª¨ ì½”ë£¨í‹´ ì‹¤í–‰")
    launch {
        println("ìžì‹ ì½”ë£¨í‹´ ì‹¤í–‰")
    }
}
```

## **2. Coroutine Context**

### **2.1 ì •ì˜**

â€¢ **Coroutine Context**ëŠ” ì½”ë£¨í‹´ì˜ **ì‹¤í–‰ í™˜ê²½**ì„ ì •ì˜í•©ë‹ˆë‹¤.
â€¢ ì‹¤í–‰ ìŠ¤ë ˆë“œ, ì˜¤ë¥˜ ì²˜ë¦¬, ì´ë¦„, Job ë“±ì„ í¬í•¨í•˜ëŠ” ìš”ì†Œë“¤ì˜ ì§‘í•©ìž…ë‹ˆë‹¤.

### **2.2 Contextì˜ êµ¬ì„± ìš”ì†Œ**

1. **Dispatcher**: ì½”ë£¨í‹´ì´ ì‹¤í–‰ë  ìŠ¤ë ˆë“œë‚˜ ìŠ¤ë ˆë“œ í’€.
2. **Job**: ì½”ë£¨í‹´ì˜ ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬.
3. **Error Handler**: ì˜¤ë¥˜ ì²˜ë¦¬.
4. **Coroutine Name**: ë””ë²„ê¹…ì„ ìœ„í•œ ì½”ë£¨í‹´ ì´ë¦„.

## **3. Scopeì™€ Contextì˜ ê´€ê³„**

### **3.1 Scopeê°€ Contextë¥¼ í¬í•¨**

â€¢ **Coroutine Scope**ëŠ” í•­ìƒ í•˜ë‚˜ì˜ **Coroutine Context**ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
â€¢ Scope ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  ì½”ë£¨í‹´ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì´ Contextë¥¼ ìƒì†í•©ë‹ˆë‹¤.

**ê¸°ë³¸ ë™ìž‘**

```kotlin
val scope = CoroutineScope(Dispatchers.Main + SupervisorJob())

scope.launch {
    println("ê¸°ë³¸ Contextì—ì„œ ì‹¤í–‰: ${Thread.currentThread().name}")
}
```

### **3.2 Contextì˜ ìˆ˜ì • ê°€ëŠ¥ì„±**

â€¢ ê°œë³„ ì½”ë£¨í‹´ì€ Scopeì˜ Contextë¥¼ ìˆ˜ì •í•˜ì—¬ **ë‹¤ë¥¸ Contextì—ì„œ ì‹¤í–‰**í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
â€¢ ìžì‹ ì½”ë£¨í‹´ì€ ë¶€ëª¨ ì½”ë£¨í‹´ì˜ ìˆ˜ì •ëœ Contextë¥¼ ìƒì†í•©ë‹ˆë‹¤.

**Context ìˆ˜ì • ì˜ˆì œ**

```kotlin
val scope = CoroutineScope(Dispatchers.Main + SupervisorJob())

scope.launch {
    println("ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰: ${Thread.currentThread().name}")
    launch(Dispatchers.IO) {
        println("I/O ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰: ${Thread.currentThread().name}")
    }
}
```
  

**ì¶œë ¥**:

```
ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰: main
I/O ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰: DefaultDispatcher-worker-1
```

## **4. Scopeì™€ Contextì˜ ì°¨ì´ ìš”ì•½**

| **íŠ¹ì§•**   | **Coroutine Scope**             | **Coroutine Context**              |
| -------- | ------------------------------- | ---------------------------------- |
| ì—­í•        | ì½”ë£¨í‹´ ì‹¤í–‰ì˜ ë²”ìœ„ ì •ì˜                   | ì½”ë£¨í‹´ ì‹¤í–‰ì˜ í™˜ê²½ ì •ì˜                      |
| êµ¬ì„± ìš”ì†Œ    | ë‹¨ì¼ CoroutineContext             | Dispatcher, Job, Error Handler ë“±   |
| ê¸°ë³¸ ë™ìž‘    | Scopeì˜ ContextëŠ” ëª¨ë“  ì½”ë£¨í‹´ì— ìƒì†ë¨     | ì½”ë£¨í‹´ì—ì„œ í•„ìš” ì‹œ ìˆ˜ì • ê°€ëŠ¥                   |
| ë¶€ëª¨-ìžì‹ ê´€ê³„ | ë¶€ëª¨-ìžì‹ ì½”ë£¨í‹´ ê³„ì¸µ êµ¬ì¡° í˜•ì„±              | ìžì‹ ì½”ë£¨í‹´ì€ ë¶€ëª¨ ì½”ë£¨í‹´ì˜ Contextë¥¼ ìƒì†        |
| ì˜ˆì œ ì‚¬ìš©    | ViewModel Scope, CoroutineScope | Dispatchers.Main, Dispatchers.IO ë“± |
| íŠ¹ì§•       | Coroutine Scope                 | Coroutine Context                  |
| ì—­í•        | ì½”ë£¨í‹´ ì‹¤í–‰ì˜ ë²”ìœ„ ì •ì˜                   | ì½”ë£¨í‹´ ì‹¤í–‰ì˜ í™˜ê²½ ì •ì˜                      |
| êµ¬ì„± ìš”ì†Œ    | ë‹¨ì¼ CoroutineContext             | Dispatcher, Job, Error Handler ë“±   |
| ê¸°ë³¸ ë™ìž‘    | Scopeì˜ ContextëŠ” ëª¨ë“  ì½”ë£¨í‹´ì— ìƒì†ë¨     | ì½”ë£¨í‹´ì—ì„œ í•„ìš” ì‹œ ìˆ˜ì • ê°€ëŠ¥                   |
| ë¶€ëª¨-ìžì‹ ê´€ê³„ | ë¶€ëª¨-ìžì‹ ì½”ë£¨í‹´ ê³„ì¸µ êµ¬ì¡° í˜•ì„±              | ìžì‹ ì½”ë£¨í‹´ì€ ë¶€ëª¨ ì½”ë£¨í‹´ì˜ Contextë¥¼ ìƒì†        |
| ì˜ˆì œ ì‚¬ìš©    | ViewModel Scope, CoroutineScope | Dispatchers.Main, Dispatchers.IO ë“± |

## **5. ìš”ì•½**

### 1. **Coroutine Scope**:

â€¢ ì½”ë£¨í‹´ ì‹¤í–‰ì˜ **ë²”ìœ„**ë¥¼ ì •ì˜.
â€¢ ScopeëŠ” **CoroutineContext**ë¥¼ ë‹¨ì¼ ì†ì„±ìœ¼ë¡œ ê°€ì§.

### 2. **Coroutine Context**:

â€¢ ì½”ë£¨í‹´ ì‹¤í–‰ì˜ **í™˜ê²½**ì„ ì •ì˜.
â€¢ ìŠ¤ë ˆë“œ(Dispatcher), ì˜¤ë¥˜ ì²˜ë¦¬, Job ë“±ì„ í¬í•¨.

### 3. **Scopeì™€ Contextì˜ ê´€ê³„**:

â€¢ ScopeëŠ” ê¸°ë³¸ Contextë¥¼ ì œê³µ.
â€¢ ê°œë³„ ì½”ë£¨í‹´ì€ í•„ìš”ì— ë”°ë¼ Contextë¥¼ ìˆ˜ì • ê°€ëŠ¥.

  

Scopeì™€ Contextì˜ ê´€ê³„ë¥¼ ì´í•´í•˜ë©´, ì½”ë£¨í‹´ì˜ êµ¬ì¡°ì  ë™ì‹œì„±(Structured Concurrency)ì„ ë” ìž˜ í™œìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ðŸ˜Š


## ì˜ˆì œ

```kotlin
suspend fun calculateFactorial(  
    factorialOf: Int,  
    numberOfCoroutines: Int  
): BigInteger {  
    return withContext(defaultDispatcher) {  
        val subRanges = createSubRangeList(factorialOf, numberOfCoroutines)  
        subRanges.map { subRange ->  
            async {  
                calculateFactorialOfSubRange(subRange)  
            }  
        }.awaitAll()  
            .fold(BigInteger.ONE, { acc, element ->  
                ensureActive()  
                acc.multiply(element)  
            })  
    }  
}  
  
suspend fun calculateFactorialOfSubRange(  
    subRange: SubRange  
): BigInteger {  
    return withContext(defaultDispatcher) {  
        Timber.d(addCoroutineDebugInfo("Calculate factorial of $subRange"))  
        var factorial = BigInteger.ONE  
        for (i in subRange.start..subRange.end) {  
            ensureActive()  
            factorial = factorial.multiply(BigInteger.valueOf(i.toLong()))  
        }  
        factorial  
    }  
}  
  
fun createSubRangeList(  
    factorialOf: Int,  
    numberOfSubRanges: Int  
): List<SubRange> {  
    val quotient = factorialOf.div(numberOfSubRanges)  
    val rangesList = mutableListOf<SubRange>()  
  
    var curStartIndex = 1  
    repeat(numberOfSubRanges - 1) {  
        rangesList.add(  
            SubRange(  
                curStartIndex,  
                curStartIndex + (quotient - 1)  
            )  
        )  
        curStartIndex += quotient  
    }  
    rangesList.add(SubRange(curStartIndex, factorialOf))  
    return rangesList  
}
```

