**코루틴(Coroutines)**의 개념은 1960년대로 거슬러 올라가지만, **구조적 동시성(Structured Concurrency)**은 비교적 최근에 등장한 개념입니다. 많은 프로그래밍 언어나 동시성 프레임워크가 코루틴을 지원하지만, 구조적 동시성을 지원하는 경우는 드뭅니다.

구조적 동시성이란 무엇인지, 이를 이해하기 위한 5가지 주요 특징을 설명합니다.

### **구조적 동시성의 주요 특징**
  
#### **1. 모든 코루틴은 유한한 수명(scope) 내에서 시작**

• 코루틴은 반드시 **논리적 범위(Logical Scope)** 내에서 시작해야 합니다.
• 이 범위는 특정 UI 객체(예: Android의 Activity 또는 ViewModel)와 같은 유한한 생명주기를 가질 수 있습니다.
• **범위의 생명주기가 끝나면 해당 범위에서 시작된 모든 코루틴이 취소(cancel)됩니다.**
• 이로 인해 개발자가 코루틴을 직접 관리하지 않아도 되는 장점이 있습니다.
• RxJava와 비교해 보면, RxJava에서는 개발자가 직접 **디스포저블(disposables)**을 관리하고 명시적으로 해제해야 하며, 이를 놓치면 리소스 낭비나 충돌이 발생할 수 있습니다.
• 코루틴은 반드시 특정 범위 내에서 시작되어야 하므로, 컴파일러가 이를 강제하며 안전성을 보장합니다.

##### **실제 사례: ViewModelScope**

• AndroidX 라이브러리에서 제공하는 **ViewModelScope**는 ViewModel의 생명주기에 맞춰 코루틴을 관리합니다.
• ViewModel이 소멸되면 ViewModelScope도 종료되며, 그 안의 모든 코루틴이 취소됩니다.
• 이를 통해 불필요한 리소스 낭비와 잠재적 충돌을 방지합니다.

#### **2. 코루틴은 계층 구조(Hierarchy)를 형성**

• 동일한 범위(scope)에서 시작된 코루틴들은 **부모-자식 관계**를 형성합니다.
• **코루틴 자체가 아니라, 각 코루틴의** Job **객체**가 계층 구조를 형성합니다.
• **계층 구조의 최상위에는 Scope의** Job **객체**가 위치하며, 하위 코루틴의 Job은 부모의 자식으로 연결됩니다.
• 계층적 관계는 코루틴 관리와 동작에 있어 중요한 역할을 합니다.

#### **3. 부모 Job은 자식 Job이 완료될 때까지 완료되지 않음**

• 부모 Job은 **모든 자식 Job이 완료된 후에만** 완료 상태가 됩니다.
• 예를 들어, 부모 Job이 Job 2이고, 자식 Job이 Job 3과 Job 4라면:
• Job 3과 Job 4가 완료될 때까지 Job 2는 완료되지 않습니다.

#### **4. 부모 Job이 취소되면 모든 자식 Job도 취소**

• 부모 Job이 취소되면 **모든 자식 Job이 재귀적으로 취소**됩니다.
• 반대로, 자식 Job이 취소되어도 **부모 Job이나 다른 형제 Job에는 영향을 미치지 않습니다.**


##### **예시:**
• 부모 Job(코루틴 범위)의 취소:
• 모든 자식 Job(코루틴)이 취소됩니다.
• 자식 Job의 취소:
• 부모 Job이나 다른 자식 Job에는 영향을 미치지 않습니다.

#### **5. 예외 처리는 부모로 전파**

• 자식 코루틴에서 예외가 발생하면 해당 예외는 **부모 Job으로 전파**됩니다.
• 부모 Job의 타입에 따라 전파 방식이 다릅니다:

• **일반 Job**:
	• 예외가 발생한 자식 코루틴 외의 모든 자식 코루틴도 취소됩니다.
	• 예외는 부모 Job으로 계속 전파됩니다.

• **Supervisor Job**:
	• 예외가 발생해도 다른 자식 코루틴은 취소되지 않으며, 예외도 상위로 전파되지 않습니다.

### **구조적 동시성의 장점**

#### **1. 안전한 자원 관리**

• 코루틴이 논리적 범위 내에서 관리되므로 리소스 낭비와 잠재적 충돌을 방지할 수 있습니다.

#### **2. 계층적 구조로 일관성 유지**

• 코루틴 간의 부모-자식 관계를 통해 작업이 논리적으로 구조화되어 관리가 용이합니다.

#### **3. 자동 취소**

• 부모-자식 관계로 인해 부모 Job의 종료 시점에서 자동으로 모든 자식 Job이 정리됩니다.

#### **4. 예외 처리의 일관성**

• 예외가 부모로 전파되거나 특정 코루틴에 국한되어 관리되므로, 예외가 누락되지 않습니다.

### **정리: 구조적 동시성의 5가지 특징**

1. **코루틴은 논리적 범위(scope) 내에서 시작**되며, 범위가 종료되면 모든 코루틴이 취소됩니다.
2. 동일한 범위 내 코루틴은 **계층적 구조**를 형성합니다.
3. **부모 Job은 자식 Job이 모두 완료될 때까지 완료되지 않습니다.**
4. 부모 Job을 취소하면 **모든 자식 Job이 재귀적으로 취소**되지만, 자식 Job을 취소해도 부모 Job에는 영향을 미치지 않습니다.
5. **자식 코루틴의 예외는 부모로 전파**되며, 부모 Job의 타입에 따라 전파 및 취소 방식이 달라집니다.

구조적 동시성은 코루틴 관리의 복잡성을 줄이고, 예외 처리 및 리소스 관리를 더 안전하게 만드는 데 중요한 개념입니다. 다음 단계에서 이를 실제 코드와 함께 확인할 수 있습니다. 😊